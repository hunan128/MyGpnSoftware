using Ionic.Zip;
using MetroFramework.Forms;
using Microsoft.Win32;
using MySql.Data.MySqlClient;
using SnmpSharpNet;
using System;
using System.Collections;
using System.Collections.Generic;
using System.ComponentModel;
using System.Diagnostics;
using System.Drawing;
using System.Drawing.Drawing2D;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Net;
using System.Net.NetworkInformation;
using System.Net.Sockets;
using System.Runtime.InteropServices;
using System.Runtime.Serialization.Formatters.Binary;
using System.Text;
using System.Text.RegularExpressions;
using System.Threading;
using System.Windows.Forms;
using System.Xml;

namespace MyGpnSoftware
{
    public partial class GPN : MetroForm
    {
        #region 全局变量的声明
        private MySocket mysocket;
        public static string com = "";                      //
        public static string GPN7600EMSURLIP = "192.168.10.101";                                    //GPN模块服务器ip地址
        public static string GPN7600EMSURL = "http://192.168.10.101/dist/gpn7600/nightly/1.0.x/";//GPN模块获取地址
        public static string ts = "10";                //获取socket数据回复等待时间           
        public static long Filesize = 0;                              //下载生在文件流大小
        public static bool uploading = false;            //文件比对，检查是否在升级中
        public static string slot18 = "";               //18槽位状态
        public static string slot11 = "";               //11槽位状态
        public static string slotsw = "";               //SW型号状态
        public static string slot17 = "";               //17槽位状态
        public static string slot12 = "";               //12槽位状态
        public static string sw = "";                   //SW型号状态
        public static string defaultfilePath = "";       //打开文件夹默认路径
        public static string version = "";              //设备版本号
        TcpListener myTcpListener = null;
        private Thread listenThread;
        public int XHTime = 1000;                       //循环间隔时间
        public int XHCount = 720;                       //循环次数
        public static string devtype = "";              //设备类型
        public bool backupfile = false;
        public bool FtpStatusEnable = false;            //FTPserver是否为使能状态
        public bool FtpPortEnable = false;            //FTP 接口是否为使能状态
        public static string ftpCtrlFlagID = "";                //执行操作
        public static int LoadCountany = 0;                //上传下载设备个数
        public static int LoadCountsum = 0;                //上传下载设备个数
        public static object PiLiangShengJi = new object(); //批量升级累计完成数量加锁
        public static bool save = false;                //批量保存设备数据
        public static string linkup = "";//设备Telnet连接状态


        // 保存户名和密码
        Dictionary<string, string> users;
        #endregion
        public GPN()
        {
            InitializeComponent();
            mysocket = new MySocket();
            System.Windows.Forms.Control.CheckForIllegalCrossThreadCalls = false;
            #region 打印网卡的ip地址
            ////打印网卡的ip地址
            NetworkInterface[] NetworkInterfaces = NetworkInterface.GetAllNetworkInterfaces();
            string ftpipall = "";
            foreach (NetworkInterface NetworkIntf in NetworkInterfaces)
            {
                IPInterfaceProperties IPInterfaceProperties = NetworkIntf.GetIPProperties();
                UnicastIPAddressInformationCollection UnicastIPAddressInformationCollection = IPInterfaceProperties.UnicastAddresses;
                foreach (UnicastIPAddressInformation UnicastIPAddressInformation in UnicastIPAddressInformationCollection)
                {
                    if (UnicastIPAddressInformation.Address.AddressFamily == AddressFamily.InterNetwork)
                    {
                        ftpipall = UnicastIPAddressInformation.Address.ToString();
                        if (!ftpipall.Contains("169.") && !ftpipall.Contains("127.0.0.1"))
                        {
                            comftpip.Items.Add(ftpipall.ToString());
                            if (comftpip.Items.Count > 0)
                            {
                                comftpip.SelectedIndex = comftpip.Items.Count - 1;
                            }
                        }
                    }
                }
            }
            #endregion
            Readini();
        }
        private void Readini() {
            #region 读取ini文件
            try
            {
                if (!Directory.Exists(@"C:\gpn"))
                {
                    Directory.CreateDirectory(@"C:\gpn");
                }
                gpnurlupdate();
                //   导入前俩列ToolStripMenuItem.PerformClick();

                if (File.Exists(strFilePath))//读取时先要判读INI文件是否存在
                {
                    strSec = "Config";
                    if (comftpip.Items.Contains(ContentValue(strSec, "FTPip")))
                    {
                        comftpip.Text = ContentValue(strSec, "FTPip");
                    }
                    tbxFtpServerPort.Text = ContentValue(strSec, "FTPport");
                    textftpusr.Text = ContentValue(strSec, "FTPuser");
                    textftppsd.Text = ContentValue(strSec, "FTPpsd");
                    tbxFtpRoot.Text = ContentValue(strSec, "FTPpath");
                    TextVNCUser.Text = ContentValue(strSec, "VNCUSER");
                    if (ContentValue(strSec, "ReadCommunity") != "")
                    {
                        textReadCommunity.Text = ContentValue(strSec, "ReadCommunity");
                    }
                    if (ContentValue(strSec, "WriteCommunity") != "")
                    {
                        textWriteCommunity.Text = ContentValue(strSec, "WriteCommunity");
                    }
                    readgpnip();
                    if (ContentValue(strSec, "GPNip") != "")
                    {
                        comip.Text = ContentValue(strSec, "GPNip");
                    }
                    textusr.Text = ContentValue(strSec, "GPNuser");
                    textpsd.Text = ContentValue(strSec, "GPNpsd");
                    textpsden.Text = ContentValue(strSec, "GPNpsden");
                    if (Directory.Exists(tbxFtpRoot.Text))
                    {
                        Readfile(tbxFtpRoot.Text);
                    }
                    if (comapp.Items.Contains(ContentValue(strSec, "APP")))
                    {
                        comapp.Text = ContentValue(strSec, "APP");
                    }
                    if (comapp2.Items.Contains(ContentValue(strSec, "APP2")))
                    {
                        comapp2.Text = ContentValue(strSec, "APP2");
                    }
                    if (comcode.Items.Contains(ContentValue(strSec, "FPFA_CODE")))
                    {
                        comcode.Text = ContentValue(strSec, "FPFA_CODE");
                    }
                    if (comcode2.Items.Contains(ContentValue(strSec, "FPFA_CODE2")))
                    {
                        comcode2.Text = ContentValue(strSec, "FPFA_CODE2");
                    }
                    if (comcode3.Items.Contains(ContentValue(strSec, "FPFA_CODE3")))
                    {
                        comcode3.Text = ContentValue(strSec, "FPFA_CODE3");
                    }
                    if (comcode4.Items.Contains(ContentValue(strSec, "FPFA_CODE4")))
                    {
                        comcode4.Text = ContentValue(strSec, "FPFA_CODE4");
                    }
                    if (comsdn.Items.Contains(ContentValue(strSec, "SDN")))
                    {
                        comsdn.Text = ContentValue(strSec, "SDN");
                    }
                    if (comnms.Items.Contains(ContentValue(strSec, "NMS")))
                    {
                        comnms.Text = ContentValue(strSec, "NMS");
                    }
                    if (comsw.Items.Contains(ContentValue(strSec, "SW")))
                    {
                        comsw.Text = ContentValue(strSec, "SW");
                    }
                    if (com760s.Items.Contains(ContentValue(strSec, "760S")))
                    {
                        com760s.Text = ContentValue(strSec, "760S");
                    }
                    if (com760b.Items.Contains(ContentValue(strSec, "760B")))
                    {
                        com760b.Text = ContentValue(strSec, "760B");
                    }
                    if (com760c.Items.Contains(ContentValue(strSec, "760C")))
                    {
                        com760c.Text = ContentValue(strSec, "760C");
                    }
                    if (com760d.Items.Contains(ContentValue(strSec, "760D")))
                    {
                        com760d.Text = ContentValue(strSec, "760D");
                    }
                    if (com760e.Items.Contains(ContentValue(strSec, "760E")))
                    {
                        com760e.Text = ContentValue(strSec, "760E");
                    }
                    if (comuxc.Items.Contains(ContentValue(strSec, "UXC")))
                    {
                        comuxc.Text = ContentValue(strSec, "UXC");
                    }
                    if (com7610.Items.Contains(ContentValue(strSec, "7610")))
                    {
                        com7610.Text = ContentValue(strSec, "7610");
                    }
                    if (com7611.Items.Contains(ContentValue(strSec, "7611")))
                    {
                        com7611.Text = ContentValue(strSec, "7611");
                    }
                    if (com7612.Items.Contains(ContentValue(strSec, "7612")))
                    {
                        com7612.Text = ContentValue(strSec, "7612");
                    }
                    if (com7613.Items.Contains(ContentValue(strSec, "7613")))
                    {
                        com7613.Text = ContentValue(strSec, "7613");
                    }
                    if (com7614.Items.Contains(ContentValue(strSec, "7614")))
                    {
                        com7614.Text = ContentValue(strSec, "7614");
                    }
                    if (com7615.Items.Contains(ContentValue(strSec, "7615")))
                    {
                        com7615.Text = ContentValue(strSec, "7615");
                    }
                    if (com7616.Items.Contains(ContentValue(strSec, "7616")))
                    {
                        com7616.Text = ContentValue(strSec, "7616");
                    }
                    if (comsysfile.Items.Contains(ContentValue(strSec, "sysfile")))
                    {
                        comsysfile.Text = ContentValue(strSec, "sysfile");
                    }
                    if (comvoss.Items.Contains(ContentValue(strSec, "voss")))
                    {
                        comvoss.Text = ContentValue(strSec, "voss");
                    }
                    if (comrebootos.Items.Contains(ContentValue(strSec, "rebootos")))
                    {
                        comrebootos.Text = ContentValue(strSec, "rebootos");
                    }
                    if (comcpld.Items.Contains(ContentValue(strSec, "cpld")))
                    {
                        comcpld.Text = ContentValue(strSec, "cpld");
                    }
                    if (comflash.Items.Contains(ContentValue(strSec, "FLASH")))
                    {
                        comflash.Text = ContentValue(strSec, "FLASH");
                    }
                    if (comyaffs.Items.Contains(ContentValue(strSec, "YAFFS")))
                    {
                        comyaffs.Text = ContentValue(strSec, "YAFFS");
                    }
                    comgpn76list.Text = ContentValue(strSec, "GPN7600EMS");
                }
                if (File.Exists(frpcPath))//读取时先要判读INI文件是否存在
                {


                    strSec = "common";
                    TextServerAddr.Text = "dx.hunan128.com";
                    TextServerAddr.Text = ContentValueFrpc(strSec, "server_addr");
                    TextServerPort.Text = ContentValueFrpc(strSec, "server_port");
                    TextToken.Text = ContentValueFrpc(strSec, "token");

                    strSec = TextVNCUser.Text + "RDP";
                    ComRDPType.Text = ContentValueFrpc(strSec, "type");
                    //TextServerPort.Text = ContentValueFrpc(strSec, "local_ip");
                    TextRDPLocalPort.Text = ContentValueFrpc(strSec, "local_port");
                    if (TextRDPLocalPort.Text == "")
                    {
                        TextRDPLocalPort.Text = "3389";
                    }
                    TextRDPRemotePort.Text = ContentValueFrpc(strSec, "remote_port");

                    strSec = TextVNCUser.Text + "VNC";
                    ComVNCType.Text = ContentValueFrpc(strSec, "type");
                    TextVNCLocalPort.Text = ContentValueFrpc(strSec, "local_port");
                    if (TextVNCLocalPort.Text == "")
                    {
                        TextVNCLocalPort.Text = "5900";
                    }
                    TextVNCRemotePort.Text = ContentValueFrpc(strSec, "remote_port");


                }
                else
                {
                    TextServerAddr.Text = "dx.hunan128.com";
                }
            }
            catch (Exception ex)
            {

                MessageBox.Show(ex.Message);
            }
            #endregion
        }
        private Dictionary<string, Gpnip> userss = new Dictionary<string, Gpnip>();
        private Dictionary<string, Batchip> batchipread = new Dictionary<string, Batchip>();
        private void readgpnip()
        {




            FileStream fs = new FileStream(@"C:\gpn\gpnip.bin", FileMode.OpenOrCreate);
            if (fs.Length > 0)
            {
                try
                {
                    BinaryFormatter bf = new BinaryFormatter();
                    //读出存在Data.bin 里的用户信息
                    userss = bf.Deserialize(fs) as Dictionary<string, Gpnip>;
                    //循环添加到Combox1
                    int n = 1;
                    foreach (Gpnip user in userss.Values)
                    {
                        int index = DGVSTATUS.Rows.Add();

                        comip.Items.Add(user.GpnIP);
                        DGVSTATUS.Rows[index].Cells["ip地址"].Value = user.GpnIP;

                        DGVSTATUS.Rows[index].Cells["优先级"].Value = user.GpnPRY;
                        DGVSTATUS.Rows[index].Cells["执行"].Value = user.GpnZX;


                        n++;

                    }
                    //combox1 用户名默认选中第一个
                    if (comip.Items.Count > 0)
                    {
                        comip.SelectedIndex = comip.Items.Count - 1;
                    }
                }
                catch (Exception ex)
                {
                    fs.Close();
                    File.Delete(@"C:\gpn\gpnip.bin");
                    MessageBox.Show(ex.Message);
                }

            }
            DGVSTATUS.RowsDefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;

            fs.Close();











        }
        #region ③启动FTP服务器



        // 启动服务器
        private void BtnFtpServerStartStop_Click(object sender, EventArgs e)
        {
            if (textftpusr.Text == "" || textftppsd.Text == "")
            {
                MessageBox.Show("请填写用户名密码后，点击③启动FTP服务器！");
                return;
            }
            if (tbxFtpRoot.Text == "")
            {
                MessageBox.Show("请选择FTP根目录！");
                打开OToolStripMenuItem.PerformClick();
                //btnFtpServerStartStop.PerformClick();
            }
            else
            {
                if (myTcpListener == null)
                {
                    IPGlobalProperties ipProperties = IPGlobalProperties.GetIPGlobalProperties();
                    IPEndPoint[] ipEndPoints = ipProperties.GetActiveTcpListeners();
                    foreach (IPEndPoint endPoint in ipEndPoints)
                    {
                        int A = int.Parse(tbxFtpServerPort.Text);
                        if (endPoint.Port == A)
                        {
                            FtpPortEnable = true;
                            Process[] pro = Process.GetProcesses();
                            int cunt = 0;
                            foreach (var item in pro)
                            {
                                if (item.ProcessName == "排故好帮手")
                                {
                                    cunt++;

                                }

                            }
                            if (cunt >= 2)
                            {
                                FtpStatusEnable = true;
                                lstboxStatus.Items.Add(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " FTP服务器已经在另一个【排故好帮手】开启，日志信息请到所在FTP服务器中查看！");
                                return;
                            }
                            if (cunt == 1 || cunt == 0)
                            {
                                lstboxStatus.Items.Add(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " ③启动FTP服务器失败!--------------21号端口已被占用！");
                                MessageBox.Show(A + "号端口已占用，请关闭其它FTP软件后，再次尝试！");
                                return;
                            }

                        }
                    }
                    // 初始化户名和密码
                    users = new Dictionary<string, string>();
                    users.Add(textftpusr.Text, textftppsd.Text);
                    // 新建线程开始启动FTP
                    listenThread = new Thread(ListenClientConnect);
                    listenThread.IsBackground = true;
                    listenThread.Start();
                    lstboxStatus.Enabled = true;
                    toolStripStatusLabelreq.Text = "0";
                    //lstboxStatus.Items.Clear();
                    //lstboxStatus.Items.Add("正在③启动FTP服务器...");
                    comftpip.Enabled = false;
                    FtpStatusEnable = true;
                    FtpPortEnable = true;
                    btnFtpServerStartStop.Text = "③停止FTP服务器";
                }
                else
                {
                    myTcpListener.Stop();
                    myTcpListener = null;
                    listenThread.Abort();
                    lstboxStatus.Items.Add(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " ③断开FTP服务器成功!--------------IP地址是：" + comftpip.Text);
                    toolStripStatusLabelFTP.Text = "FTP服务器已断开";
                    LabFtpLed.ForeColor = Color.Red;

                    //lstboxStatus.TopIndex = lstboxStatus.Items.Count - 1;
                    FtpStatusEnable = false;
                    FtpPortEnable = false;
                    btnFtpServerStartStop.Text = "③启动FTP服务器";
                    comftpip.Enabled = true;
                }
            }
        }
        #endregion
        #region 监听端口
        // 监听端口，处理客户端连接
        private void ListenClientConnect()
        {
            Control.CheckForIllegalCrossThreadCalls = false;
            Ping ping = new Ping();
            int timeout = 500;
            PingReply pingReply = ping.Send(comftpip.Text, timeout);
            // MessageBox.Show(ip);
            //判断请求是否超时
            for (int j = 0; j <= 5; j++)
            {
                pingReply = ping.Send(comftpip.Text, timeout);
                if (pingReply.Status == IPStatus.Success)
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            if (pingReply.Status == IPStatus.Success)
            {
                myTcpListener = new TcpListener(IPAddress.Parse("0.0.0.0"), int.Parse(tbxFtpServerPort.Text));
                // 开始监听传入的请求
                myTcpListener.Start();
                AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " ③启动FTP服务器成功!--------------IP地址是：" + comftpip.Text);
                toolStripStatusLabelFTP.Text ="FTP服务器已启动";
                LabFtpLed.ForeColor = Color.GreenYellow;
                //AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")+"开始监听用户端请求....");
                //          AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")+"Ftp服务器运行中...[点击”停止“按钮停止FTP服务]");
                while (true)
                {
                    try
                    {
                        // 接收连接请求
                        TcpClient tcpClient = myTcpListener.AcceptTcpClient();
                        //AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")+string.Format("客户端（{0}）与本机（{1}）建立FTP连接", tcpClient.Client.RemoteEndPoint, myTcpListener.LocalEndpoint));
                        User user = new User
                        {
                            CommandSession = new UserSeesion(tcpClient),
                            WorkDir = tbxFtpRoot.Text
                        };
                        ParameterizedThreadStart p = new ParameterizedThreadStart(UserProcessing);
                        Thread t = new Thread(p);
                        t.IsBackground = true;
                        t.Start(user);
                    }
                    catch
                    {
                        break;
                    }
                }
            }
            else
            {
                lstboxStatus.Items.Add(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " FTP服务启动失败!--------------FTP服务启动失败!");
                btnFtpServerStartStop.Text = "③启动FTP服务器";
                MessageBox.Show("请检查FTP服务器IP地址是否正确!，FTP服务器已关闭！");
                toolStripStatusLabelFTP.Text = "FTP服务器错误";

            }
        }
        #endregion
        #region 处理客户端户请求
        // 处理客户端户请求
        private void UserProcessing(object obj)
        {
            User user = (User)obj;
            int s = int.Parse(toolStripStatusLabelreq.Text);
            s = s + 1;
            toolStripStatusLabelreq.Text = s.ToString();
            string sendString = "220 FTP Server v1.0";
            RepleyCommandToUser(user, sendString);
            while (true)
            {
                string receiveString = null;
                try
                {
                    // 读取客户端发来的请求信息
                    receiveString = user.CommandSession.streamReader.ReadLine();
                }
                catch (Exception ex)
                {
                    if (user.CommandSession.tcpClient.Connected == false)
                    {
                        AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + string.Format(" 客户端({0}断开连接！)", user.CommandSession.tcpClient.Client.RemoteEndPoint));
                    }
                    else
                    {
                        AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " 接收命令失败！" + ex.Message);
                    }
                    break;
                }
                if (receiveString == null)
                {
                    AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " 接收字符串为null,结束线程！");
                    break;
                }
                AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + string.Format(" 来自{0}：[{1}]", user.CommandSession.tcpClient.Client.RemoteEndPoint, receiveString));
                // 分解客户端发来的控制信息中的命令和参数
                string command = receiveString;
                string param = string.Empty;
                int index = receiveString.IndexOf(' ');
                if (index != -1)
                {
                    command = receiveString.Substring(0, index).ToUpper();
                    param = receiveString.Substring(command.Length).Trim();
                }
                // 处理不需登录即可响应的命令（这里只处理QUIT）
                if (command == "quit" || command == "QUIT")
                {
                    // 关闭TCP连接并释放与其关联的所有资源
                    user.CommandSession.Close();
                    return;
                }
                else
                {
                    switch (user.LoginOK)
                    {
                        // 等待户输入户名：
                        case 0:
                            CommandUser(user, command, param);
                            break;
                        // 等待户输入密码
                        case 1:
                            CommandPassword(user, command, param);
                            break;
                        // 户名和密码验证正确后登陆
                        case 2:
                            switch (command)
                            {
                                case "CWD":
                                    CommandCWD(user, param);
                                    break;
                                case "PWD":
                                    CommandPWD(user);
                                    break;
                                case "PASV":
                                    CommandPASV(user);
                                    break;
                                case "PORT":
                                    CommandPORT(user, param);
                                    break;
                                case "LIST":
                                    CommandLIST(user, param);
                                    break;
                                case "NLIST":
                                    CommandLIST(user, param);
                                    break;
                                // 处理下载文件命令
                                case "RETR":
                                    CommandRETR(user, param);
                                    break;
                                // 处理上传文件命令
                                case "STOR":
                                    CommandSTOR(user, param);
                                    break;
                                // 处理删除命令
                                case "DELE":
                                    CommandDELE(user, param);
                                    break;
                                // 使Type命令在ASCII和二进制模式进行变换
                                case "TYPE":
                                    CommandTYPE(user, param);
                                    break;
                                // 退出
                                case "quit":
                                    user.CommandSession.Close();
                                    sendString = "FTP quit OK.";
                                    return;
                                default:
                                    sendString = "502 command is not implemented.";
                                    RepleyCommandToUser(user, sendString);
                                    break;
                            }
                            break;
                    }
                }
            }
        }
        #endregion
        #region 向客户端返回响应码
        // 想客户端返回响应码
        private void RepleyCommandToUser(User user, string str)
        {
            try
            {
                user.CommandSession.streamWriter.WriteLine(str);
                //AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")+string.Format("向客户端（{0}）发送[{1}]", user.commandSession.tcpClient.Client.RemoteEndPoint, str));
            }
            catch
            {
                // AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")+string.Format("向客户端（{0}）发送信息失败", user.commandSession.tcpClient.Client.RemoteEndPoint));
            }
        }
        // 向屏幕输出显示状态信息（这里使了委托机制）
        private delegate void AddInfoDelegate(string str);
        #endregion
        #region list addinfo方法
        private void AddInfo(string str)
        {
            // 如果调AddInfo()方法的线程与创建ListView控件的线程不在一个线程时
            // 此时利委托在创建ListView的线程上调
            if (lstboxStatus.InvokeRequired == true)
            {
                AddInfoDelegate d = new AddInfoDelegate(AddInfo);
                this.Invoke(d, str);
            }
            else
            {
                lstboxStatus.Items.Add(str);
                lstboxStatus.TopIndex = lstboxStatus.Items.Count - 1;
                lstboxStatus.ClearSelected();
            }
        }
        #endregion
        #region 登录过程，即户身份验证过程
        // 处理USER命令，接收户名但不进行验证
        private void CommandUser(User user, string command, string param)
        {
            string sendString = string.Empty;
            if (command == "USER")
            {
                sendString = "331 USER command OK, password required.";
                user.UserName = param;
                // 设置loginOk=1为了确保后面紧接的要求输入密码
                // 1表示已接收到户名，等到接收密码
                user.LoginOK = 1;
            }
            else
            {
                sendString = "501 USER command syntax error.";
            }
            RepleyCommandToUser(user, sendString);
        }
        // 处理PASS命令，验证户名和密码
        private void CommandPassword(User user, string command, string param)
        {
            string sendString = string.Empty;
            if (command == "PASS")
            {
                string password = null;
                if (users.TryGetValue(user.UserName, out password))
                {
                    if (password == param)
                    {
                        sendString = "230 User logged in success";
                        // 2表示登录成功
                        user.LoginOK = 2;
                    }
                    else
                    {
                        sendString = "530 Password incorrect.";
                    }
                }
                else
                {
                    sendString = "530 User name or password incorrect.";
                }
            }
            else
            {
                sendString = "501 PASS command Syntax error.";
            }
            RepleyCommandToUser(user, sendString);
            // 户当前工作目录
            user.CurrentDir = user.WorkDir;
        }
        #endregion
        #region 文件管理命令
        private void CommandQUIT(User user, string temp)
        {
            user.CommandSession.Close();
            return;
        }
        // 处理CWD命令，改变工作目录
        private void CommandCWD(User user, string temp)
        {
            string sendString = string.Empty;
            try
            {
                string dir = user.WorkDir.TrimEnd('/') + temp;
                // 是否为当前目录的子目录，且不包含父目录名称
                if (Directory.Exists(dir))
                {
                    user.CurrentDir = dir;
                    sendString = "250 Directory changed to '" + dir + "' successfully";
                }
                else
                {
                    sendString = "550 Directory '" + dir + "' does not exist";
                }
            }
            catch
            {
                sendString = "502 Directory changed unsuccessfully";
            }
            RepleyCommandToUser(user, sendString);
        }
        // 处理PWD命令，显示工作目录
        private void CommandPWD(User user)
        {
            string sendString = string.Empty;
            sendString = "257 '" + user.CurrentDir + "' is the current directory";
            RepleyCommandToUser(user, sendString);
        }
        // 处理LIST/NLIST命令，想客户端发送当前或指定目录下的所有文件名和子目录名
        private void CommandLIST(User user, string parameter)
        {
            string sendString = string.Empty;
            DateTimeFormatInfo dateTimeFormat = new CultureInfo("en-US", true).DateTimeFormat;
            // 得到目录列表
            string[] dir = Directory.GetDirectories(user.CurrentDir);
            if (string.IsNullOrEmpty(parameter) == false)
            {
                if (Directory.Exists(user.CurrentDir + parameter))
                {
                    dir = Directory.GetDirectories(user.CurrentDir + parameter);
                }
                else
                {
                    string s = user.CurrentDir.TrimEnd('/');
                    user.CurrentDir = s.Substring(0, s.LastIndexOf("/") + 1);
                }
            }
            for (int i = 0; i < dir.Length; i++)
            {
                string folderName = Path.GetFileName(dir[i]);
                DirectoryInfo d = new DirectoryInfo(dir[i]);
                // 按下面的格式输出目录列表
                sendString += @"dwr-\t" + Dns.GetHostName() + "\t" + dateTimeFormat.GetAbbreviatedMonthName(d.CreationTime.Month)
                    + d.CreationTime.ToString(" dd yyyy") + "\t" + folderName + Environment.NewLine;
            }
            // 得到文件列表
            string[] files = Directory.GetFiles(user.CurrentDir);
            if (string.IsNullOrEmpty(parameter) == false)
            {
                if (Directory.Exists(user.CurrentDir + parameter + "/"))
                {
                    files = Directory.GetFiles(user.CurrentDir + parameter + "/");
                }
            }
            for (int i = 0; i < files.Length; i++)
            {
                FileInfo f = new FileInfo(files[i]);
                string fileName = Path.GetFileName(files[i]);
                // 按下面的格式输出文件列表
                sendString += "-wr-\t" + Dns.GetHostName() + "\t" + f.Length + " "
                    + dateTimeFormat.GetAbbreviatedMonthName(f.CreationTime.Month)
                    + f.CreationTime.ToString(" dd yyyy") + "\t" + fileName + Environment.NewLine;
            }
            // List命令指示获得FTP服务器上的文件列表字符串信息
            // 所以调List命令过程，客户端接受的指示一些字符串
            // 所以isBinary是false,代表传输的是ASCII数据
            // 但是为了防止isBinary因为 设置user.isBinary = false而改变
            // 所以事先保存user.IsBinary的引（此时为true）,方便后面下载文件
            bool isBinary = user.IsBinary;
            user.IsBinary = false;
            RepleyCommandToUser(user, "150 Opening ASCII data connection");
            InitDataSession(user);
            SendByUserSession(user, sendString);
            RepleyCommandToUser(user, "226 Transfer complete");
            user.IsBinary = isBinary;
        }
        // 处理RETR命令，提供下载功能，将户请求的文件发送给户
        private void CommandRETR(User user, string filename)
        {
            string sendString = "";
            // 下载的文件全名
            string path = user.CurrentDir + filename;
            try
            {

                FileStream filestream = new FileStream(path, FileMode.Open, FileAccess.Read);


                // 发送150到户，表示服务器文件状态良好，将要打开数据连接传输文件
                if (user.IsBinary)
                {
                    sendString = "150 Opening BINARY mode data connection for download";
                }
                else
                {
                    sendString = "150 Opening ASCII mode data connection for download";
                }
                RepleyCommandToUser(user, sendString);
                InitDataSession(user);
                SendFileByUserSession(user, filestream, path);
                RepleyCommandToUser(user, "226 Transfer complete");

            }
            catch 
            {
                AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " 来自" + user.CommandSession.tcpClient.Client.RemoteEndPoint + "：[550 Directory " + path + " does not exist]");
            }

        }
        // 处理STOR命令，提供上传功能，接收客户端上传的文件
        private void CommandSTOR(User user, string filename)
        {
            string sendString = "";
            // 上传的文件全名
            string path = user.CurrentDir + filename;
            FileStream fs = new FileStream(path, FileMode.Create, FileAccess.Write);
            //MessageBox.Show(path);
            // 发送150到户，表示服务器状态良好
            if (user.IsBinary)
            {
                sendString = "150 Opening BINARY mode data connection for upload";
            }
            else
            {
                sendString = "150 Opeing ASCII mode data connection for upload";
            }
            RepleyCommandToUser(user, sendString);
            InitDataSession(user);
            ReadFileByUserSession(user, fs, path);
            RepleyCommandToUser(user, "226 Transfer complete");
        }
        // 处理DELE命令，提供删除功能，删除服务器上的文件
        private void CommandDELE(User user, string filename)
        {
            string sendString = "";
            // 删除的文件全名
            string path = user.CurrentDir + filename;
            AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " 正在删除文件" + filename + "...");
            File.Delete(path);
            AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " 删除成功");
            sendString = "250 File " + filename + " has been deleted.";
            RepleyCommandToUser(user, sendString);
        }
        #endregion
        #region 模式设置命令
        // 处理PASV命令， 使被动模式进行传输
        private void CommandPASV(User user)
        {
            string sendString = string.Empty;
            IPAddress localip = Dns.GetHostEntry("").AddressList[1];
            // 被动模式，即服务器接收客户端的连接请求
            // 被动模式下FTP服务器使随机生成的端口进行传输数据
            // 而主动模式下FTP服务器使端口20进行数据传输
            Random random = new Random();
            int random1, random2;
            int port;
            while (true)
            {
                // 随机生成一个端口进行数据传输
                random1 = random.Next(5, 200);
                random2 = random.Next(0, 200);
                // 生成的端口号控制>1024的随机端口
                // 下面这个运算算法只是为了得到一个大于1024的端口值
                port = random1 << 8 | random2;
                try
                {
                    user.DataListener = new TcpListener(localip, port);
                    AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " TCP 数据连接已打开（被动模式）--" + localip.ToString() + "：" + port);
                }
                catch
                {
                    continue;
                }
                user.IsPassive = true;
                string temp = localip.ToString().Replace('.', ',');
                // 必须把端口号IP地址告诉客户端，客户端接收到响应命令后，
                // 再通过新的端口连接服务器的端口P，然后进行文件数据传输
                sendString = "227 Entering Passive Mode(" + temp + "," + random1 + "," + random2 + ")";
                RepleyCommandToUser(user, sendString);
                user.DataListener.Start();
                break;
            }
        }
        // 处理PORT命令，使主动模式进行传输
        private void CommandPORT(User user, string portstring)
        {
            // 主动模式时，客户端必须告知服务器接收数据的端口号，PORT 命令格式为：PORT address
            // address参数的格式为i1、i2、i3、i4、p1、p2,其中i1、i2、i3、i4表示IP地址
            // 下面通过.字符串来组合这四个参数得到IP地址
            // p1、p2表示端口号，下面通过int.Parse(temp[4]) << 8) | int.Parse(temp[5]
            // 这个算法来获得一个大于1024的端口来发送给服务器
            string sendString = string.Empty;
            string[] temp = portstring.Split(',');
            string ipString = "" + temp[0] + "." + temp[1] + "." + temp[2] + "." + temp[3];
            // 客户端发出PORT命令把客户端的IP地址和随机的端口告诉服务器
            int portNum = (int.Parse(temp[4]) << 8) | int.Parse(temp[5]);
            user.RemoteEndPoint = new IPEndPoint(IPAddress.Parse(ipString), portNum);
            sendString = "200 PORT command successful.";
            // 服务器以接受到的客户端IP地址和端口为目标发起主动连接请求
            // 服务器根据客户端发送过来的IP地址和端口主动发起与客户端建立连接
            RepleyCommandToUser(user, sendString);
        }
        // 处理TYPE命令,设置数据传输方式
        private void CommandTYPE(User user, string param)
        {
            string sendstring = "";
            if (param == "I")
            {
                // 二进制
                user.IsBinary = true;
                sendstring = "220 Type set to I(Binary)";
            }
            else
            {
                // ASCII方式
                user.IsBinary = false;
                sendstring = "330 Type set to A(ASCII)";
            }
            RepleyCommandToUser(user, sendstring);
        }
        #endregion
        #region 初始化数据连接
        // 初始化数据连接
        private void InitDataSession(User user)
        {
            TcpClient client = null;
            if (user.IsPassive)
            {
                //AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")+"采被动模式返回LIST目录和文件列表");
                client = user.DataListener.AcceptTcpClient();
            }
            else
            {
                //AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")+"采主动模式向户发送LIST目录和文件列表");
                client = new TcpClient();
                client.Connect(user.RemoteEndPoint);
            }
            user.DataSession = new UserSeesion(client);
        }
        #endregion
        #region 使数据连接发送字符串
        // 使数据连接发送字符串
        private void SendByUserSession(User user, string sendString)
        {
            AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " 向户发送(字符串信息)：[" + sendString + "]");
            try
            {
                user.DataSession.streamWriter.WriteLine(sendString);
                AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " 发送完毕");
            }
            finally
            {
                user.DataSession.Close();
            }
        }
        #endregion
        #region 使数据连接发送文件流
        // 使数据连接发送文件流（客户端发送下载文件命令）
        private void SendFileByUserSession(User user, FileStream fs, string path)
        {
            AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " 向用户发送(文件流)：[........................");
            string ipadd = comip.Text;
            try
            {
                if (user.IsBinary)
                {
                    long totalDownloadedByte = 0;
                    int percent = 0;
                    Filesize = new FileInfo(path).Length;
                    byte[] bytes = new byte[1024];
                    BinaryReader binaryReader = new BinaryReader(fs);
                    int count = binaryReader.Read(bytes, 0, bytes.Length);
                    while (count > 0)
                    {
                        user.DataSession.binaryWriter.Write(bytes, 0, count);
                        user.DataSession.binaryWriter.Flush();
                        count = binaryReader.Read(bytes, 0, bytes.Length);
                        totalDownloadedByte = count + totalDownloadedByte;
                        if (user.CommandSession.tcpClient.Client.RemoteEndPoint.ToString().Contains(ipadd))
                        {

                            percent = (int)Math.Floor((float)totalDownloadedByte / (float)Filesize * 100);
                            //labjindu.Text = percent.ToString() + "%";
                            if (percent >= 0 && percent <= 100)
                            {
                                myProgressBarjindu.Value = percent;
                            }
                        }

                    }
                }
                else
                {
                    StreamReader streamReader = new StreamReader(fs);
                    while (streamReader.Peek() > -1)
                    {
                        user.DataSession.streamWriter.WriteLine(streamReader.ReadLine());
                    }
                }
                if (user.CommandSession.tcpClient.Client.RemoteEndPoint.ToString().Contains(ipadd))
                {
                    myProgressBarjindu.Value = 100;
                    //labjindu.Text = 100 + "%";
                }

                AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + "                                              ...................]发送完毕！");
            }
            finally
            {
                user.DataSession.Close();
                fs.Close();
            }
        }
        #endregion
        #region 使数据连接接收文件流
        // 使数据连接接收文件流(客户端发送上传文件功能)
        private void ReadFileByUserSession(User user, FileStream fs, string path)
        {

            AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " 接收用户上传数据（文件流）：[..................");
            string ipadd = comip.Text;
            try
            {
                if (user.IsBinary)
                {

                    byte[] bytes = new byte[1024];
                    long totalDownloadedByte = 0;
                    int percent = 0;
                    BinaryWriter binaryWriter = new BinaryWriter(fs);
                    int count = user.DataSession.binaryReader.Read(bytes, 0, bytes.Length);
                    while (count > 0)
                    {

                        binaryWriter.Write(bytes, 0, count);
                        totalDownloadedByte = count + totalDownloadedByte;
                        count = user.DataSession.binaryReader.Read(bytes, 0, bytes.Length);
                        binaryWriter.Flush();
                        if (user.CommandSession.tcpClient.Client.RemoteEndPoint.ToString().Contains(ipadd))
                        {

                            //textDOS.AppendText("t2:"+totalBytes.ToString() + "\r\n");
                            percent = (int)Math.Floor((float)totalDownloadedByte / (float)Filesize * 100);
                            // textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + header + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") +" "+percent.ToString() + "\r\np");
                            //textDOS.AppendText("d:"+totalDownloadedByte.ToString() + "\r\n");
                            //labjindu.Text = percent.ToString() + "%";
                            if (percent >= 0 && percent <= 100)
                            {
                                myProgressBarjindu.Value = percent;
                            }
                        }
                    }
                }
                else
                {
                    StreamWriter streamWriter = new StreamWriter(fs);
                    //while (user.DataSession.streamReader.Peek() > -1)
                    //{
                    //    streamWriter.Write(user.DataSession.streamReader.ReadLine());
                    //    streamWriter.Flush();
                    //}
                    while (!user.DataSession.streamReader.EndOfStream)
                    {
                        // 一个元素占文件的一行
                        streamWriter.WriteLine(user.DataSession.streamReader.ReadLine());
                        streamWriter.Flush();
                    }
                }
                if (user.CommandSession.tcpClient.Client.RemoteEndPoint.ToString().Contains(ipadd))
                {
                    myProgressBarjindu.Value = 100;
                    //labjindu.Text = 100 + "%";
                }
                AddInfo(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + "                                              ...................]接收完毕！");
            }
            finally
            {
                user.DataSession.Close();
                fs.Close();
            }
        }
        #endregion
        #region 定时建立telnet连接
        private void timer2_Tick(object sender, EventArgs e)
        {
            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + mysocket.ReceiveData(int.Parse(ts)));
        }
        #endregion

        #region 连接断开按钮
        /// <summary>
        /// 验证IP地址是否合法
        /// </summary>
        /// <param name="ip">要验证的IP地址</param>
        /// 
        public static bool IsIP(string ip)
        {
            //如果为空，认为验证合格
            if (string.IsNullOrEmpty(ip))
            {
                return true;
            }
            //清除要验证字符串中的空格
            ip = ip.Trim();
            //模式字符串
            string pattern = @"^((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)$";
            //验证
            return Regex.IsMatch(ip, pattern);
        }

        private void Butlogin_Click(object sender, EventArgs e)
        {
            Thread Linkgpn = new Thread(LinkGpn);
            if (string.Compare(ButLogin.Text, "①断开设备") == 0)
            {
                ButLogin.Text = "①连接设备";
                comip.Enabled = true;
                textcom.Enabled = false;
                butsend.Enabled = false;
                butguzhangsend.Enabled = false;
                butpaigu.Enabled = false;
                butsyslog.Enabled = false;
                textguzhangmingling.Enabled = false;
                butotnpaigu.Enabled = false;
                toolStripStatusLabelnms.Text = "17:无";
                toolStripStatusLabelnms18.Text = "18:无";
                toolStripStatusLabelswa11.Text = "11:无";
                toolStripStatusLabelswa12.Text = "12:无";
                toolStripStatusLabelver.Text = "APP:无";
                toolStripStatusLabelcpu.Text = "CPU:无";
                toolStripStatusLabelfpgaver.Text = "FPGA:无";
                toolStripStatusLabelmem.Text = "内存:无";
                toolStripStatusLabeltem.Text = "温度:无";
                toolStripStatusLabeldevtype.Text = "型号";
                timer1.Stop();

                slot18 = "";               //18槽位状态
                slot11 = "";                //11槽位状态
                sw = "";                    //SW型号状态
                slot17 = "";               //17槽位状态
                slot12 = "";               //12槽位状态
                version = "";              //设备版本号
                devtype = "";               //设备型号
                textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已断开==================================================OK");
                AcceptButton = ButLogin;
                mysocket.Close();
                linkup = "未连接";
                Linkgpn.Abort();
                Gpnsetini();
                //readgpnip();

                return;
            }
            if (string.Compare(ButLogin.Text, "①连接设备") == 0)
            {

                Linkgpn.Start();
                timer1.Start();
                //  LinkGpn();
            }
        }
        #endregion
        private void LinkGpn()
        {
            try
            {
                if (!IsIP(comip.Text.Trim()))
                {
                    MessageBox.Show("您输入了非法IP地址，请修改后再次尝试！");
                    return;
                }

                Ping ping = new Ping();
                int timeout = 120;
                PingReply pingReply = ping.Send(comip.Text, timeout);
                bool link = false;
                //判断请求是否超时
                for (int but = 0; but < int.Parse(compingcount.Text); but++)
                {
                    if (ButLogin.Text == "①连接设备")
                    {
                        pingReply = ping.Send(comip.Text, timeout);
                        if (pingReply.Status == IPStatus.Success)
                        {
                            link = true;
                            break;
                        }
                    }
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备无法ping通剩余：" + (int.Parse(compingcount.Text) - but).ToString() + "次，请检查IP地址：" + comip.Text + "  设备是否正常！");
                    Thread.Sleep(XHTime);
                }
                if (link == false)
                {
                    return;
                }
                textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备可以ping通，正在尝试Telnet登录，请稍等...");
                if (mysocket.Connect(comip.Text.Trim(), "23"))
                {
                    ButLogin.Text = "①断开设备";
                    comip.Enabled = false;
                    textcom.Enabled = true;
                    butsend.Enabled = true;
                    butpaigu.Enabled = true;
                    butsyslog.Enabled = true;
                    butguzhangsend.Enabled = true;
                    textguzhangmingling.Enabled = true;
                    butotnpaigu.Enabled = true;
                    // textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") +" "+mysocket.ReceiveData(int.Parse(ts)));
                    this.AcceptButton = butsend;
                    textcom.Focus();
                    tabPageGpn.Text = comip.Text;
                    mysocket.SendData(textusr.Text);
                    for (int a = 0; a <= XHCount; a++)
                    {
                        string login = mysocket.ReceiveData(int.Parse(ts));
                        // MessageBox.Show(login);
                        if (login.Contains("Password:"))
                        {
                            mysocket.SendData(textpsd.Text);
                            break;
                        }
                        if (login.Contains("Key"))
                        {
                            MessageBox.Show("非我司设备，请更换IP重启登录！");
                            ButLogin.PerformClick();
                            return;
                        }
                        if (login.Contains("Username or password is invalid"))
                        {
                            MessageBox.Show("非我司设备，请更换IP重启登录！");
                            ButLogin.PerformClick();
                            return;
                        }
                        Thread.Sleep(XHTime / 3);
                    }
                    for (int c = 0; c <= XHCount; c++)
                    {
                        string passd = mysocket.ReceiveData(int.Parse(ts));
                        //MessageBox.Show(passd);
                        if (passd.Contains("Error") || passd.Contains("failed") || passd.Contains("Bad passwords") || passd.Contains("Key"))
                        {
                            MessageBox.Show("用户名或密码错误，请断开重新尝试！");
                            ButLogin.PerformClick();
                            //textDOS.AppendText("\r\n" + "用户名或密码错误，请断开重新尝试！");
                            return;
                        }
                        if (passd.Contains("Password:"))
                        {
                            mysocket.SendData(textpsd.Text);
                        }
                        Thread.Sleep(XHTime / 3);
                        if (passd.Contains(">"))
                        {
                            textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "用户名密码正确==========================================OK");
                            mysocket.SendData("enable");
                            for (int b = 0; b <= XHCount; b++)
                            {
                                string pass = mysocket.ReceiveData(int.Parse(ts));
                                if (pass.Contains("Pas"))
                                {
                                    mysocket.SendData(textpsden.Text);
                                    //Thread.Sleep(XHTime);
                                    for (int d = 0; d <= 1000; d++)
                                    {
                                        string locked = mysocket.ReceiveData(int.Parse(ts));
                                        if (locked.Contains("configuration is locked by other user"))
                                        //configuration is locked by other user
                                        {
                                            textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已经有用户登录，正在重新登录============================OK");
                                            mysocket.SendData("grosadvdebug");
                                            Thread.Sleep(XHTime);
                                            mysocket.SendData("vty user limit no");
                                            Thread.Sleep(XHTime);
                                            mysocket.SendData("exit");
                                            Thread.Sleep(XHTime);
                                            mysocket.SendData("enable");
                                            Thread.Sleep(XHTime);
                                            if (mysocket.ReceiveData(int.Parse(ts)).Contains("Pas"))
                                            {
                                                mysocket.SendData(textpsden.Text);
                                                Thread.Sleep(XHTime);
                                                if (!mysocket.ReceiveData(int.Parse(ts)).Contains("failed"))
                                                {
                                                    MessageBox.Show("用户名或密码错误，请断开重新尝试！");
                                                    ButLogin.PerformClick();
                                                    return;
                                                }
                                                break;
                                            }
                                        }
                                        if (locked.Contains("#"))
                                        {
                                            break;
                                        }
                                        Thread.Sleep(XHTime / 3);
                                    }
                                    break;
                                }
                                if (pass.Contains("#"))
                                {
                                    break;
                                }
                                if (pass.Contains("configuration is locked by other user"))
                                //configuration is locked by other user
                                {
                                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已经有用户登录，正在重新登录============================OK");
                                    mysocket.SendData("grosadvdebug");
                                    Thread.Sleep(XHTime);
                                    mysocket.SendData("vty user limit no");
                                    Thread.Sleep(XHTime);
                                    mysocket.SendData("exit");
                                    Thread.Sleep(XHTime);
                                    mysocket.SendData("enable");
                                    Thread.Sleep(XHTime);
                                    if (mysocket.ReceiveData(int.Parse(ts)).Contains("Pas"))
                                    {
                                        mysocket.SendData(textpsden.Text);
                                        Thread.Sleep(XHTime);
                                        if (!mysocket.ReceiveData(int.Parse(ts)).Contains("failed"))
                                        {
                                            MessageBox.Show("用户名或密码错误，请断开重新尝试！");
                                            ButLogin.PerformClick();
                                            return;
                                        }
                                        break;
                                    }
                                    break;
                                }
                                Thread.Sleep(XHTime / 3);
                            }
                            break;
                        }
                        Thread.Sleep(XHTime / 3);
                    }
                    linkup = "已连接";
                    // mysocket.SendData("service snmp source-ip auto");
                    Thread.Sleep(XHTime);
                    string slot = mysocket.ReceiveData(int.Parse(ts));
                    // SNMP团体名称 
                    OctetString community = new OctetString(textReadCommunity.Text);
                    //定义代理参数类 
                    AgentParameters param = new AgentParameters(SnmpVersion.Ver2, community, true);
                    //将SNMP版本设置为1（或2） 
                    //构造代理地址对象
                    //这里很容易使用IpAddress类，因为
                    //如果不
                    //解析为IP地址，它将尝试解析构造函数参数
                    IpAddress agent = new IpAddress(comip.Text);
                    IPAddress send = new IPAddress(agent);
                    //构建目标 
                    UdpTarget target = new UdpTarget(send, 161, 2000, 1);
                    //  用于所有请求PDU级 
                    Pdu pdu = new Pdu(PduType.Get);
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.6.1.11");   //11槽位主备状态
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.6.1.12");   //12槽位主备状态
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.6.1.17");   //17槽位主备状态
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.6.1.18");   //18槽位主备状态
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.1.1.1.8.1");      //APP版本
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.1.1.1.7.1");      //FPGA版本
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.1.1.1.2.1");      //设备类型


                    SnmpPacket result = null;
                    try
                    {
                        result = target.Request(pdu, param);
                    }
                    catch (SnmpException ex)
                    {
                        MessageBox.Show(ex.Message);
                    }
                    //SnmpV1Packet result = (SnmpV1Packet)target.Request(pdu, param);
                    //如果结果为null，则座席未回复或我们无法解析回复。
                    if (result != null)
                    {
                        //其他的ErrorStatus然后0是通过返回一个错误
                        //代理-见SnmpConstants为错误定义
                        if (result.Pdu.ErrorStatus != 0)
                        {
                            //代理报告与所述请求的错误 
                            textDOS.Text += string.Format("\r\n" + "SNMP回复错误！错误代码：{0}，错误索引：第 {1} 行\r\n",
                                    FindDevType.FindErrorCode(result.Pdu.ErrorStatus),
                                    result.Pdu.ErrorIndex);
                        }
                        else
                        {

                            //返回变量的返回顺序与添加
                            //到VbList

                            toolStripStatusLabelver.Text = "APP:" + result.Pdu.VbList[4].Value.ToString();
                            toolStripStatusLabelfpgaver.Text = "FPGA:" + result.Pdu.VbList[5].Value.ToString();
                            devtype = result.Pdu.VbList[6].Value.ToString();
                            string str = devtype;
                            toolStripStatusLabeldevtype.Text = FindDevType.Finddevtype(str);



                            //slot17 = "ACTIVE";
                            if (result.Pdu.VbList[2].Value.ToString() == "1")
                            {
                                slot17 = "ACTIVE";
                                toolStripStatusLabelnms.Text = "17:主";
                                toolStripStatusLabelnms.ForeColor = Color.DarkGreen;
                                Pdu pdu1 = new Pdu(PduType.Get);
                                pdu1.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.23.1.17");  //17槽位CPU利用率
                                pdu1.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.26.1.17");  //17槽位内存利用率
                                pdu1.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.20.1.17");  //17槽位温度
                                SnmpPacket result1 = null;
                                try
                                {
                                    result1 = target.Request(pdu1, param);
                                }
                                catch (SnmpException ex)
                                {
                                    MessageBox.Show(ex.Message);
                                }
                                catch
                                {
                                    MessageBox.Show("请检查Oid项配置信息！");
                                }
                                toolStripStatusLabelcpu.Text = "CPU:" + result1.Pdu.VbList[0].Value.ToString() + "%";
                                toolStripStatusLabelmem.Text = "内存:" + result1.Pdu.VbList[1].Value.ToString() + "%";
                                toolStripStatusLabeltem.Text = "温度:" + result1.Pdu.VbList[2].Value.ToString() + "°C";

                            }
                            if (result.Pdu.VbList[2].Value.ToString() == "2")
                            {
                                slot17 = "STANDBY";
                                toolStripStatusLabelnms.Text = "17:备";
                                toolStripStatusLabelnms.ForeColor = Color.Red;
                            }
                            if ((result.Pdu.VbList[2].Value.ToString() != "1") && (result.Pdu.VbList[3].Value.ToString() != "1"))
                            {
                                Pdu pdu2 = new Pdu(PduType.Get);
                                pdu2.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.6.1.1");   //1槽位准备状态
                                pdu2.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.23.1.1");  //1槽位CPU利用率
                                pdu2.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.26.1.1");  //1槽位内存利用率
                                pdu2.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.20.1.1");  //1槽位温度
                                SnmpPacket result2 = null;
                                try
                                {
                                    result2 = target.Request(pdu2, param);
                                }
                                catch (SnmpException ex)
                                {
                                    MessageBox.Show(ex.Message);
                                }
                                catch
                                {
                                    MessageBox.Show("请检查Oid项配置信息！");
                                }
                                if (result2.Pdu.VbList[0].Value.ToString() == "1")
                                {
                                    //slot17 = "ACTIVE";
                                    toolStripStatusLabelnms.Text = "1:主";
                                    toolStripStatusLabelnms.ForeColor = Color.DarkGreen;
                                }
                                toolStripStatusLabelcpu.Text = "CPU:" + result2.Pdu.VbList[1].Value.ToString() + "%";
                                toolStripStatusLabelmem.Text = "内存:" + result2.Pdu.VbList[2].Value.ToString() + "%";
                                toolStripStatusLabeltem.Text = "温度:" + result2.Pdu.VbList[3].Value.ToString() + "°C";

                            }
                            if (result.Pdu.VbList[3].Value.ToString() == "1")
                            {
                                slot18 = "ACTIVE";
                                toolStripStatusLabelnms18.Text = "18:主";
                                toolStripStatusLabelnms18.ForeColor = Color.DarkGreen;
                            }
                            if (result.Pdu.VbList[3].Value.ToString() == "2")
                            {
                                slot18 = "STANDBY";
                                toolStripStatusLabelnms18.Text = "18:备";
                                toolStripStatusLabelnms18.ForeColor = Color.Red;
                            }

                            if (result.Pdu.VbList[0].Value.ToString() == "3")
                            {
                                slot11 = "在位";
                                toolStripStatusLabelswa11.Text = "11:主";
                                toolStripStatusLabelswa11.ForeColor = Color.DarkGreen;
                            }
                            if (result.Pdu.VbList[0].Value.ToString() == "4")
                            {
                                slot11 = "在位";
                                toolStripStatusLabelswa11.Text = "11:备";
                                toolStripStatusLabelswa11.ForeColor = Color.DarkGreen;
                            }
                            if (result.Pdu.VbList[1].Value.ToString() == "3")
                            {
                                slot12 = "在位";
                                toolStripStatusLabelswa12.Text = "12:主";
                                toolStripStatusLabelswa12.ForeColor = Color.DarkGreen;
                            }
                            if (result.Pdu.VbList[1].Value.ToString() == "4")
                            {
                                slot12 = "在位";
                                toolStripStatusLabelswa12.Text = "12:备";
                                toolStripStatusLabelswa12.ForeColor = Color.DarkGreen;
                            }


                            //MessageBox.Show("ssss");
                            //toolStripStatusLabelnms.ForeColor = Color.DarkGreen;

                        }
                    }
                    else
                    {
                        textDOS.AppendText("\r\n" + "没有收到来自SNMP代理的响应！");
                    }
                    target.Close();

                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "登录成功可以使用========================================OK" + "\r\n");
                    butsend.PerformClick();
                }
                else
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "无法Telnet登录，请检查设备是否正常！");
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }
        }
        #region 发送按钮
        private void butsend_Click(object sender, EventArgs e)
        {
            if (textcom.Text == "请输入命令行查询")
            {
                textcom.Text = "";
            }
            if (mysocket.SendData(textcom.Text))
            {
                if (textcom.Text == "")
                {
                    Thread.Sleep(XHTime / 3);
                    string ctrlc = "Press any key to continue Ctrl+c to stop";
                    string DOS = textDOS.Text;
                    if (DOS.Contains(ctrlc))
                    {
                        textDOS.Text = DOS.Replace(ctrlc, "");
                        //MessageBox.Show("检测到了");
                    }
                    string str = "\r\n" + mysocket.ReceiveData(int.Parse(ts));
                    textDOS.AppendText(str);
                    //this.textBox3.Text = str;
                }
                else
                {
                    com = textcom.Text;
                    Thread.Sleep(XHTime / 3);
                    string ss = mysocket.ReceiveData(int.Parse(ts));
                    //textBox3.Text = newkou2;
                    textDOS.AppendText(ss);
                    //this.textDOS.Text = ss;
                }
            }
            else
            {
                textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "连接通信故障，请断开后，重新尝试！");
                //this.butlogin.PerformClick();
            }
            textcom.Text = "";
            textDOS.Focus();
            textDOS.ScrollToCaret();
            textcom.Focus();
        }
        #endregion
        #region 保存配置 Save
        private void Save()
        {
            toolStripStatusLabelzt.Text = "正在保存配置";
            mysocket.SendData("save");
            for (int i = 1; i <= 20; i++)
            {
                string save = "successfully";
                string box = mysocket.ReceiveData(int.Parse(ts));
                if (box.Contains(save))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "保存配置===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains("erro"))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "保存配置==============================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string box1 = mysocket.ReceiveData(int.Parse(ts));
        }
        #endregion
        #region 测试FTP服务器IP是否正常 Testftpser
        private void Testftpser()
        {
            toolStripStatusLabelzt.Text = "检查FTP服务器中";
            textDOS.AppendText(DateTime.Now.ToString("\r\n" + "yyyy-MM-dd HH:mm:ss") + " " + "FTP服务器连接测试中，请耐心等待,大约需要15秒钟.....");
            mysocket.SendData("ping " + comftpip.Text);
            for (int i = 1; i <= XHCount; i++)
            {
                string ping = mysocket.ReceiveData(int.Parse(ts));
                if (ping.Contains("ms"))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备ping服务器=========================================OK" + "\r\n");
                    mysocket.SendDate("\x03");
                    Thread.Sleep(XHTime);
                    string ctrlc = mysocket.ReceiveData(int.Parse(ts));
                    break;
                }
                if (ping.Contains("0 packets received"))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备ping服务器=========================================NOK" + "\r\n");
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "FTP服务器故障，请点击停止升级后，检查FTP服务器IP地址！");
                    toolStripStatusLabelzt.Text = "FTP的IP地址故障，请检查！";
                    UpLoadFile_Stop = true;
                    backupfile = false;

                    MessageBox.Show("请检查FTP服务IP地址后，再次尝试！");
                    return;
                }
                Thread.Sleep(XHTime);
            }
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp config " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + "FtpTest.bin");
            for (int i = 1; i <= XHCount; i++)
            {
                string box = mysocket.ReceiveData(int.Parse(ts));
                if (box.Contains("ok"))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "FTP服务器测试==========================================OK" + "\r\n");
                    break;
                }
                if (box.Contains("fail"))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "FTP服务器IP地址故障，请点击停止升级后，检查FTP服务器IP地址！" + "\r\n");
                    toolStripStatusLabelzt.Text = "FTP故障，请检查！";
                    UpLoadFile_Stop = true;
                    backupfile = false;
                    MessageBox.Show("请检查FTP服务IP地址后，再次尝试！");
                    return;
                }
                if (box.Contains("User need password"))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "FTP服务器用户名密码错误，请检查！" + "\r\n");
                    toolStripStatusLabelzt.Text = "FTP故障，请检查！";
                    UpLoadFile_Stop = true;
                    backupfile = false;
                    MessageBox.Show("请检查FTP用户名和密码后，再次尝试！");
                    return;
                }
                Thread.Sleep(XHTime);
            }
        }
        #endregion
        #region 删除残余文件 Rm
        private void Rm()
        {
            toolStripStatusLabelzt.Text = "清空主槽残余文件";
            mysocket.SendData("dosfs");
            for (int a = 1; a <= XHCount; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("dosfs"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            mysocket.SendData("cd /flash/sys");
            for (int a = 1; a <= XHCount; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("cd /flash/sys"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            mysocket.SendData("rm app_code_backup.bin");
            for (int a = 1; a <= XHCount; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("Error. Can't delete"))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽app_code_backup.bin========================文件不存在" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (command.Contains("rm app_code_backup.bin"))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽删除app_code_backup.bin============================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(XHTime);
            }
            mysocket.SendData("rm record.txt");
            for (int a = 1; a <= XHCount; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("Error. Can't delete"))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽record.txt=================================文件不存在" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (command.Contains("rm record.txt"))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽删除record.txt=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(XHTime);
            }
            mysocket.SendData("rm fpga_code.bin");
            for (int a = 1; a <= XHCount; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("Error. Can't delete"))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽/flash/sys/fpga_code.bin===================文件不存在" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (command.Contains("rm fpga_code.bin"))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽删除/flash/sys/fpga_code.bin=======================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(XHTime);
            }
            mysocket.SendData("exit");
            for (int a = 1; a <= XHCount; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("exit"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string nms = mysocket.ReceiveData(int.Parse(ts));
            if (slot18 == "STANDBY" || slot17 == "STANDBY")
            {
                toolStripStatusLabelzt.Text = "清空备槽残余文件";
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备槽在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("grosadvdebug");
                for (int a = 1; a <= XHCount; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("grosadvdebug"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                if (slot18 == "STANDBY")
                {
                    mysocket.SendData("switch 18");
                }
                if (slot17 == "STANDBY")
                {
                    mysocket.SendData("switch 17");
                }
                for (int a = 1; a <= XHCount; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("Slot1"))
                    {
                        break;
                    }
                    if (command.Contains("Please try later"))
                    {
                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备槽有其他户登录，已退出终止升级");
                        return;
                    }
                    if (command.Contains("Login"))
                    {
                        mysocket.SendData(textusr.Text);
                        for (int b = 1; b <= 3000; b++)
                        {
                            string pasd = mysocket.ReceiveData(int.Parse(ts));
                            if (pasd.Contains("Password"))
                            {
                                mysocket.SendData(textpsd.Text);
                                break;
                            }
                            Thread.Sleep(XHTime);
                        }
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                mysocket.SendData("grosadvdebug");
                for (int a = 1; a <= XHCount; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("grosadvdebug"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                mysocket.SendData("slave-config enable");
                for (int a = 1; a <= XHCount; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("slave-config enable"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                mysocket.SendData("exit");
                for (int a = 1; a <= XHCount; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("xit"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                mysocket.SendData("enable");
                for (int a = 1; a <= XHCount; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("enable"))
                    {
                        mysocket.SendData(textpsd.Text);
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                mysocket.SendData("dosfs");
                for (int a = 1; a <= XHCount; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("dosfs"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                mysocket.SendData("cd /flash/sys");
                for (int a = 1; a <= XHCount; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("cd /flash/sys"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                mysocket.SendData("rm app_code_backup.bin");
                for (int a = 1; a <= XHCount; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("Error. Can't delete"))
                    {
                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备槽app_code_backup.bin======================文件不能存在" + toolStripStatusLabeltime.Text + "\r\n");
                        break;
                    }
                    if (command.Contains("rm app_code_backup.bin"))
                    {
                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备槽删除app_code_backup.bin============================OK" + toolStripStatusLabeltime.Text + "\r\n");
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                mysocket.SendData("rm record.txt");
                for (int a = 1; a <= XHCount; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("Error. Can't delete"))
                    {
                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备槽record.txt=================================文件不存在" + toolStripStatusLabeltime.Text + "\r\n");
                        break;
                    }
                    if (command.Contains("rm record.txt"))
                    {
                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备槽删除record.txt=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                mysocket.SendData("rm fpga_code.bin");
                for (int a = 1; a <= XHCount; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("Error. Can't delete"))
                    {
                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备槽/flash/sys/fpga_code.bin===================文件不存在" + toolStripStatusLabeltime.Text + "\r\n");
                        break;
                    }
                    if (command.Contains("rm fpga_code.bin"))
                    {
                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备槽删除/flash/sys/fpga_code.bin=======================OK" + toolStripStatusLabeltime.Text + "\r\n");
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                mysocket.SendData("exit");
                for (int a = 1; a <= 300; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("xit"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                mysocket.SendData("exit");
                for (int a = 1; a <= 300; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("xit"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                mysocket.SendData("exit");
                for (int a = 1; a <= 300; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("xit"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                Thread.Sleep(XHTime);
                mysocket.SendData("exit");
                for (int a = 1; a <= 300; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("(config)#"))
                    {
                        break;
                    }
                    if (command.Contains(">"))
                    {
                        mysocket.SendData("enable");
                        Thread.Sleep(XHTime);
                        string pass = mysocket.ReceiveData(int.Parse(ts));
                        if (pass.Contains("Pas"))
                        {
                            mysocket.SendData(textpsd.Text);
                            Thread.Sleep(XHTime);
                            string locked = mysocket.ReceiveData(int.Parse(ts));
                            if (locked.Contains("configuration is locked by other user"))
                            {
                                mysocket.SendData("grosadvdebug");
                                Thread.Sleep(XHTime);
                                mysocket.SendData("vty user limit no");
                                Thread.Sleep(XHTime);
                                mysocket.SendData("exit");
                                Thread.Sleep(XHTime);
                                mysocket.SendData("enable");
                                Thread.Sleep(XHTime);
                                mysocket.SendData(textpsd.Text);
                            }
                        }
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
            }
            ///OK是判断==0 备槽不在位 == 1 备槽在位
            if (slot18 == "")
            {
                //for (int a = 1; a <= XHCount; a++)
                //{
                //    string command = mysocket.ReceiveData(int.Parse(ts));
                //    if (command.Contains("Press"))
                //    {
                //        break;
                //    }
                //    Thread.Sleep(XHTime);
                //}
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备槽不在位=============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
            }
        }
        #endregion
        #region 下载 App  ///////////////////////////////////////////下载软件APP开始////////////////////////////////
        private void App()
        {
            ///////////////////////////////////////////下载软件APP开始////////////////////////////////
            toolStripStatusLabelzt.Text = "下载APP中";
            mysocket.SendData("download ftp app " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comapp.Text + " gpn");
            for (int a = 1; a <= XHCount; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("Download file ...ok"))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽APP下载成功========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    toolStripStatusLabelzt.Text = "写入APP中";
                    for (int b = 1; b <= XHCount; b++)
                    {
                        string download = mysocket.ReceiveData(int.Parse(ts));
                        if (download.Contains("ok"))
                        {
                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "APP写入成功============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                            if (slot17 == "ACTIVE")
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽APP写入成功==========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                if (slot18 == "STANDBY" && slot11 == "" && slot12 == "")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= 100000; c++)
                                    {
                                        string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up18slot.Contains("auto-upgrade to slot 18"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("18 fail"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 18 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot18 == "STANDBY" && slot11 == "在位" && slot12 == "")
                                {
                                    string S11 = "其他";
                                    string S18 = "未知";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up1118slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up1118slot.Contains("auto-upgrade to slot 18"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up1118slot.Contains("auto-upgrade to slot 11"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到11槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up1118slot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up1118slot.Contains("18 fail"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up1118slot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (up1118slot.Contains("Auto-upgrade to slot 18 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S18 = "OK";
                                        }
                                        if (up1118slot.Contains("upgraded all files successfully") || (S11 == S18))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步APP==========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot18 == "STANDBY" && slot11 == "" && slot12 == "在位")
                                {
                                    string S11 = "其他";
                                    string S18 = "未知";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位==================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up1118slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up1118slot.Contains("auto-upgrade to slot 18"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up1118slot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up1118slot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up1118slot.Contains("18 fail"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up1118slot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (up1118slot.Contains("Auto-upgrade to slot 18 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S18 = "OK";
                                        }
                                        if (up1118slot.Contains("upgraded all files successfully") || (S11 == S18))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步APP==========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot18 == "STANDBY" && slot11 == "在位" && slot12 == "在位")
                                {
                                    string S11 = "其他";
                                    string S12 = "爱好";
                                    string S18 = "号码";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= 100000; c++)
                                    {
                                        string allslot = mysocket.ReceiveData(int.Parse(ts));
                                        if (allslot.Contains("auto-upgrade to slot 18"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (allslot.Contains("auto-upgrade to slot 11"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到11槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (allslot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (allslot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (allslot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (allslot.Contains("18 fail"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (allslot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (allslot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S12 = "OK";
                                        }
                                        if (allslot.Contains("Auto-upgrade to slot 18 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S18 = "OK";
                                        }
                                        if (allslot.Contains("upgraded all files successfully") || (S11 == S12 && S11 == S18))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步APP==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot18 == "" && slot11 == "在位" && slot12 == "在位")
                                {
                                    string S11 = "未知";
                                    string S12 = "其他";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= 100000; c++)
                                    {
                                        string up112slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up112slot.Contains("auto-upgrade to slot 11"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到11槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up112slot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up112slot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up112slot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up112slot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (up112slot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S12 = "OK";
                                        }
                                        if (up112slot.Contains("upgraded all files successfully") || (S11 == S12))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步APP==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot18 == "" && slot11 == "在位" && slot12 == "")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位==================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽不在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up112slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up112slot.Contains("auto-upgrade to slot 11"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到11槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up112slot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up112slot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot18 == "" && slot11 == "" && slot12 == "在位")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位==================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽不在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up112slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up112slot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up112slot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up112slot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot18 == "" && slot11 == "" && slot12 == "")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽不在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    break;
                                }
                            }
                            if (slot18 == "ACTIVE")
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽APP写入成功========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                if (slot17 == "STANDBY" && slot11 == "" && slot12 == "")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位=============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位=============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= 100000; c++)
                                    {
                                        string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up18slot.Contains("auto-upgrade to slot 18"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("17 fail"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 17 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot17 == "STANDBY" && slot11 == "在位" && slot12 == "")
                                {
                                    string S11 = "其他";
                                    string S18 = "未知";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位=============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up1118slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up1118slot.Contains("auto-upgrade to slot 17"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up1118slot.Contains("auto-upgrade to slot 11"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到11槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up1118slot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up1118slot.Contains("18 fail"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up1118slot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (up1118slot.Contains("Auto-upgrade to slot 17 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S18 = "OK";
                                        }
                                        if (up1118slot.Contains("upgraded all files successfully") || (S11 == S18))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot17 == "STANDBY" && slot11 == "" && slot12 == "在位")
                                {
                                    string S11 = "其他";
                                    string S18 = "未知";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位=============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up1118slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up1118slot.Contains("auto-upgrade to slot 17"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up1118slot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up1118slot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up1118slot.Contains("18 fail"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up1118slot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (up1118slot.Contains("Auto-upgrade to slot 17 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S18 = "OK";
                                        }
                                        if (up1118slot.Contains("upgraded all files successfully") || (S11 == S18))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot17 == "STANDBY" && slot11 == "在位" && slot12 == "在位")
                                {
                                    string S11 = "其他";
                                    string S12 = "爱好";
                                    string S18 = "号码";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽在位==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= 100000; c++)
                                    {
                                        string allslot = mysocket.ReceiveData(int.Parse(ts));
                                        if (allslot.Contains("auto-upgrade to slot 17"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (allslot.Contains("auto-upgrade to slot 11"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到11槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (allslot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (allslot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (allslot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (allslot.Contains("17 fail"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (allslot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (allslot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S12 = "OK";
                                        }
                                        if (allslot.Contains("Auto-upgrade to slot 17 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S18 = "OK";
                                        }
                                        if (allslot.Contains("upgraded all files successfully") || (S11 == S12 && S11 == S18))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步APP==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot17 == "" && slot11 == "在位" && slot12 == "在位")
                                {
                                    string S11 = "未知";
                                    string S12 = "其他";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽不在位=============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= 100000; c++)
                                    {
                                        string up112slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up112slot.Contains("auto-upgrade to slot 11"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到11槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up112slot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up112slot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up112slot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up112slot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (up112slot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S12 = "OK";
                                        }
                                        if (up112slot.Contains("upgraded all files successfully") || (S11 == S12))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步APP==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot17 == "" && slot11 == "在位" && slot12 == "")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位==================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽不在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up112slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up112slot.Contains("auto-upgrade to slot 11"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到11槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up112slot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up112slot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot17 == "" && slot11 == "" && slot12 == "在位")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位==================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽不在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up112slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up112slot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步APP========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up112slot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up112slot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步APP============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot17 == "" && slot11 == "" && slot12 == "")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备槽不在位================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    break;
                                }
                            }
                            break;
                        }
                        if (download.Contains("failed"))
                        {
                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽APP写入===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                            return;
                        }
                        Thread.Sleep(XHTime);
                    }
                    break;
                }
                if (command.Contains("failed"))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽APP下载==============================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
        }
        #endregion
        #region 下载 Fpgacode  //////////////////////////////////////下载FPGA_code开始//////////////////////////////
        private void Fpgacode()
        {
            ///////////////////////////////////////////下载FPGA_code开始////////////////////////////////
            toolStripStatusLabelzt.Text = "下载FPGA_CODE中";
            if (comapp.Text.Contains("R13"))
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "升级为R13版本执行特殊升级方式===========================OK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("download ftp file /flash/sys/fpga_code.bin " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comcode.Text);
            }
            else
            {
                mysocket.SendData("download ftp fpga " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comcode.Text + " other");
            }
            for (int a = 1; a <= XHCount; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("Download file ...ok"))
                {
                    toolStripStatusLabelzt.Text = "写入FPGA_CODE中";
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽FPGA_CODE下载成功====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    for (int b = 1; b <= XHCount; b++)
                    {
                        string download = mysocket.ReceiveData(int.Parse(ts));
                        if (comapp.Text.Contains("R13"))
                        {
                            if (download.Contains("ok"))
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽FPGA_CODE写入成功====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                break;
                            }
                        }
                        else
                        {
                            if (download.Contains("ok"))
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽FPGA_CODE写入成功====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                if (slot18 == "STANDBY")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up18slot.Contains("auto-upgrade to slot 18"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步FPGA_CODE到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备槽准备同步FPGA_CODE================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("18 fail") || up18slot.Contains("Failed upgraded slot 18"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步FPGA_CODE=====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 18 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步FPGA_CODE======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot17 == "STANDBY")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up18slot.Contains("auto-upgrade to slot 17"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步FPGA_CODE到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽准备同步FPGA_CODE==================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("17 fail") || up18slot.Contains("Failed upgraded slot 17"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步FPGA_CODE=====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 17 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步FPGA_CODE======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                break;
                            }
                        }
                        if (download.Contains("failed"))
                        {
                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽FPGA_CODE写入=======================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                            return;
                        }
                        Thread.Sleep(XHTime);
                    }
                    break;
                }
                if (command.Contains("failed"))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽FPGA_CODE下载==========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
        }
        #endregion
        #region 下载 Nms  ///////////////////////////////////////////下载FPGA_NMS开始///////////////////////////////
        private void Nms()
        {
            ///////////////////////////////////////////下载FPGA_NMS开始////////////////////////////////
            toolStripStatusLabelzt.Text = "下载FPGA_NMS中";
            mysocket.SendData("download ftp fpga " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comnms.Text + " master");
            for (int a = 1; a <= XHCount; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("Download file ...ok"))
                {
                    toolStripStatusLabelzt.Text = "写入FPGA_NMS中";
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽FPGA_NMS下载成功=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    for (int b = 1; b <= XHCount; b++)
                    {
                        string download = mysocket.ReceiveData(int.Parse(ts));
                        if (download.Contains("ok"))
                        {
                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽FPGA_NMS写入成功=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                            if (slot18 == "STANDBY")
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                for (int c = 1; c <= XHCount; c++)
                                {
                                    string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                    if (up18slot.Contains("auto-upgrade to slot 18"))
                                    {
                                        toolStripStatusLabelzt.Text = "同步FPGA_NMS到备槽中";
                                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽准备同步FPGA_NMS===================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    }
                                    if (up18slot.Contains("18 fail"))
                                    {
                                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步FPGA_NMS======================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                        return;
                                    }
                                    if (up18slot.Contains("Auto-upgrade to slot 18 successful"))
                                    {
                                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步FPGA_NMS=======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        break;
                                    }
                                    Thread.Sleep(XHTime);
                                }
                            }
                            if (slot17 == "STANDBY")
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                for (int c = 1; c <= XHCount; c++)
                                {
                                    string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                    if (up18slot.Contains("auto-upgrade to slot 17"))
                                    {
                                        toolStripStatusLabelzt.Text = "同步FPGA_NMS到备槽中";
                                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽准备同步FPGA_NMS=======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    }
                                    if (up18slot.Contains("17 fail"))
                                    {
                                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步FPGA_NMS==========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                        return;
                                    }
                                    if (up18slot.Contains("Auto-upgrade to slot 17 successful"))
                                    {
                                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步FPGA_NMS===========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        break;
                                    }
                                    Thread.Sleep(XHTime);
                                }
                            }
                            break;
                        }
                        if (download.Contains("failed"))
                        {
                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽FPGA_NMS写入========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                            return;
                        }
                        Thread.Sleep(XHTime);
                    }
                    break;
                }
                if (command.Contains("failed"))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽FPGA_NMS下载===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
        }
        #endregion
        #region 下载 Swfpga /////////////////////////////////////////下载SW-Afpga开始///////////////////////////////
        private void Swfpga()
        {
            ///////////////////////////////////////////下载SW-Afpga开始////////////////////////////////
            toolStripStatusLabelzt.Text = "下载SW_FPGA中";
            if (comsw.Text.Contains("SW-B") || comsw.Text.Contains("SW_B") || comsw.Text.Contains("sw_b") || comsw.Text.Contains("sw-b"))
            {
                if (!version.Contains("R13"))
                {
                    mysocket.SendData("download ftp fpga " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comsw.Text + " sw-b");
                }
                if (version.Contains("R13"))
                {
                    mysocket.SendData("download ftp fpga " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comsw.Text + " sw");
                }
            }
            if (comsw.Text.Contains("SW-A") || comsw.Text.Contains("SW_A") || comsw.Text.Contains("sw_a") || comsw.Text.Contains("sw-a"))
            {
                mysocket.SendData("download ftp fpga " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comsw.Text + " sw");
            }
            for (int a = 1; a <= XHCount; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("Download file ...ok"))
                {
                    toolStripStatusLabelzt.Text = "写入SW_FPGA中";
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主槽SW_FPGA下载成功====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    for (int b = 1; b <= XHCount; b++)
                    {
                        string download = mysocket.ReceiveData(int.Parse(ts));
                        if (download.Contains("ok"))
                        {
                            if (slot17 == "ACTIVE")
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽SW_FPGA写入成功====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                if (slot18 == "STANDBY" && slot11 == "" && slot12 == "")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up18slot.Contains("auto-upgrade to slot 18"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽准备同步SW_FPGA==================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("18 fail"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步SW_FPGA=====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 18 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步SW_FPGA======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot18 == "STANDBY" && slot11 == "在位" && slot12 == "")
                                {
                                    String S11 = "1";
                                    String S18 = "3";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up18slot.Contains("auto-upgrade to slot 18"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽准备同步SW_FPGA========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("auto-upgrade to slot 11"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到11槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步SW_FPGA========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 18"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步SW_FPGA===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 18 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步SW_FPGA==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S18 = "OK";
                                        }
                                        if (up18slot.Contains("upgraded all files successfully") || S11 == S18)
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步SW_FPGA============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot18 == "STANDBY" && slot11 == "" && slot12 == "在位")
                                {
                                    String S11 = "1";
                                    String S18 = "3";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up18slot.Contains("auto-upgrade to slot 18"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽准备同步SW_FPGA========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步SW_FPGA========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA=============================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 18"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步SW_FPGA===============================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 18 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步SW_FPGA==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S18 = "OK";
                                        }
                                        if (up18slot.Contains("upgraded all files successfully") || S11 == S18)
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步SW_FPGA============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot18 == "STANDBY" && slot11 == "在位" && slot12 == "在位")
                                {
                                    string S11 = "1";
                                    string S12 = "2";
                                    string S18 = "3";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up18slot.Contains("auto-upgrade to slot 18"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽准备同步SW_FPGA==================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("auto-upgrade to slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步SW_FPGA======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步SW_FPGA==================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA=====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA=====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("18 fail"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步SW_FPGA=====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA==========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA==========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S12 = "OK";
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 18 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽同步SW_FPGA==========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S18 = "OK";
                                        }
                                        if (up18slot.Contains("upgraded all files successfully") || (S11 == S12 && S11 == S18))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步SW_FPGA========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot18 == "" && slot11 == "在位" && slot12 == "在位")
                                {
                                    string S11 = "1";
                                    string S12 = "2";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up18slot.Contains("auto-upgrade to slot 11"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到11槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步SW_FPGA======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步SW_FPGA==================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA=====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA=====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S12 = "OK";
                                        }
                                        if (up18slot.Contains("upgraded all files successfully") || (S11 == S12))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步SW_FPGA====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot18 == "" && slot11 == "在位" && slot12 == "")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up112slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up112slot.Contains("auto-upgrade to slot 11"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到11槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步SW_FPGA=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up112slot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up112slot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot18 == "" && slot11 == "" && slot12 == "在位")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up112slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up112slot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步SW_FPGA=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up112slot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up112slot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot18 == "" && slot11 == "" && slot12 == "")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    break;
                                }
                                break;
                            }
                            if (slot18 == "ACTIVE")
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "18槽SW_FPGA写入成功====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                if (slot17 == "STANDBY" && slot11 == "" && slot12 == "")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up18slot.Contains("auto-upgrade to slot 17"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽准备同步SW_FPGA===================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("17 fail"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步SW_FPGA======================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 17 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步SW_FPGA=======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot17 == "STANDBY" && slot11 == "在位" && slot12 == "")
                                {
                                    String S11 = "1";
                                    String S18 = "3";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up18slot.Contains("auto-upgrade to slot 17"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽准备同步SW_FPGA======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("auto-upgrade to slot 11"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到11槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步SW_FPGA=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 17"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步SW_FPGA========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA=========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 17 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步SW_FPGA=========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S18 = "OK";
                                        }
                                        if (up18slot.Contains("upgraded all files successfully") || S11 == S18)
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步SW_FPGA=======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot17 == "STANDBY" && slot11 == "" && slot12 == "在位")
                                {
                                    String S11 = "1";
                                    String S18 = "3";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up18slot.Contains("auto-upgrade to slot 17"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽准备同步SW_FPGA======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步SW_FPGA=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 17"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步SW_FPGA========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA=========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 17 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步SW_FPGA=========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S18 = "OK";
                                        }
                                        if (up18slot.Contains("upgraded all files successfully") || S11 == S18)
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步SW_FPGA=======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot17 == "STANDBY" && slot11 == "在位" && slot12 == "在位")
                                {
                                    string S11 = "1";
                                    string S12 = "2";
                                    string S18 = "3";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up18slot.Contains("auto-upgrade to slot 17"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到备槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽准备同步SW_FPGA===================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("auto-upgrade to slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步SW_FPGA======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步SW_FPGA==================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA=====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA=====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("17 fail"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步SW_FPGA=====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S12 = "OK";
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 17 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽同步SW_FPGA======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S18 = "OK";
                                        }
                                        if (up18slot.Contains("upgraded all files successfully") || (S11 == S12 && S11 == S18))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步SW_FPGA====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot17 == "" && slot11 == "在位" && slot12 == "在位")
                                {
                                    string S11 = "1";
                                    string S12 = "2";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up18slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up18slot.Contains("auto-upgrade to slot 11"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到11槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步SW_FPGA======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步SW_FPGA到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步SW_FPGA==================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA=====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA=====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S11 = "OK";
                                        }
                                        if (up18slot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA======================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            S12 = "OK";
                                        }
                                        if (up18slot.Contains("upgraded all files successfully") || (S11 == S12))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "全部槽同步SW_FPGA====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot17 == "" && slot11 == "在位" && slot12 == "")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up112slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up112slot.Contains("auto-upgrade to slot 11"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到11槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽准备同步SW_FPGA=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up112slot.Contains("Failed upgraded slot 11"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up112slot.Contains("Auto-upgrade to slot 11 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽同步SW_FPGA=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot17 == "" && slot11 == "" && slot12 == "在位")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽在位=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    for (int c = 1; c <= XHCount; c++)
                                    {
                                        string up112slot = mysocket.ReceiveData(int.Parse(ts));
                                        if (up112slot.Contains("auto-upgrade to slot 12"))
                                        {
                                            toolStripStatusLabelzt.Text = "同步APP到12槽中";
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽准备同步SW_FPGA=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                        }
                                        if (up112slot.Contains("Failed upgraded slot 12"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                                            return;
                                        }
                                        if (up112slot.Contains("Auto-upgrade to slot 12 successful"))
                                        {
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽同步SW_FPGA=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                            break;
                                        }
                                        Thread.Sleep(XHTime);
                                    }
                                }
                                if (slot17 == "" && slot11 == "" && slot12 == "")
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "11槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "12槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "17槽不在位===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                    break;
                                }
                                break;
                            }
                            break;
                        }
                        if (download.Contains("failed"))
                        {
                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主用槽SW_FPGA写入=====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                            return;
                        }
                        Thread.Sleep(XHTime);
                    }
                    break;
                }
                if (command.Contains("failed"))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "主用槽SW_FPGA下载========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string jieshu = mysocket.ReceiveData(int.Parse(ts));
        }
        #endregion
        #region 下载 Fpga760s
        private void Fpga760s()
        {
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            toolStripStatusLabelzt.Text = "正在下载760S";
            mysocket.SendData("download ftp file /yaffs/sys/760s.fpga " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + com760s.Text);
            for (int i = 1; i <= XHCount; i++)
            {
                string ok = "Write to flash...";
                string fail = "fail";
                string box = mysocket.ReceiveData(int.Parse(ts));
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载760s===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    if (slot17 != "" && slot18 != "")
                    {
                        toolStripStatusLabelzt.Text = "正在同步760S";
                        string sync = "successful";
                        for (int p = 1; p <= XHCount; p++)
                        {

                            string syncotn = mysocket.ReceiveData(int.Parse(ts));
                            if (syncotn.Contains(sync))
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "同步760s===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                break;
                            }

                            Thread.Sleep(XHTime);
                        }
                    }
                    break;
                }

                if (box.Contains(fail))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载760s===============================================fail" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }

                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
        }
        #endregion
        #region 下载 Fpga760b
        private void Fpga760b()
        {
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            toolStripStatusLabelzt.Text = "正在下载760B";
            mysocket.SendData("download ftp file /yaffs/sys/760b.fpga " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + com760b.Text);
            for (int i = 1; i <= XHCount; i++)
            {
                string ok = "Write to flash...";
                string fail = "fail";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载760b===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    if (slot17 != "" && slot18 != "")
                    {
                        toolStripStatusLabelzt.Text = "正在同步760B";
                        string sync = "successful";
                        for (int p = 1; p <= XHCount; p++)
                        {
                            string syncotn = mysocket.ReceiveData(int.Parse(ts));
                            if (syncotn.Contains(sync))
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "同步760b===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                break;
                            }

                            Thread.Sleep(XHTime);
                        }
                    }
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载760b===============================================fail" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
        }
        #endregion
        #region 下载 Fpga760c
        private void Fpga760c()
        {
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            toolStripStatusLabelzt.Text = "正在下载760C";
            mysocket.SendData("download ftp file /yaffs/sys/760c.fpga " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + com760c.Text);
            for (int i = 1; i <= XHCount; i++)
            {
                string ok = "Write to flash...";
                string fail = "fail";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载760c===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    if (slot17 != "" && slot18 != "")
                    {
                        toolStripStatusLabelzt.Text = "正在同步760C";
                        string sync = "successful";
                        for (int p = 1; p <= XHCount; p++)
                        {
                            string syncotn = mysocket.ReceiveData(int.Parse(ts));
                            if (syncotn.Contains(sync))
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "同步760c===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                break;
                            }

                            Thread.Sleep(XHTime);
                        }
                    }
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载760c===============================================fail" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
        }
        #endregion
        #region 下载 Fpga760d
        private void Fpga760d()
        {
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            toolStripStatusLabelzt.Text = "正在下载760D";
            mysocket.SendData("download ftp file /yaffs/sys/760d.fpga " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + com760d.Text);
            for (int i = 1; i <= XHCount; i++)
            {
                string ok = "Write to flash...";
                string fail = "fail";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载760d===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    if (slot17 != "" && slot18 != "")
                    {
                        toolStripStatusLabelzt.Text = "正在同步760D";
                        string sync = "successful";
                        for (int p = 1; p <= XHCount; p++)
                        {
                            string syncotn = mysocket.ReceiveData(int.Parse(ts));
                            if (syncotn.Contains(sync))
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "同步760d===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                break;
                            }

                            Thread.Sleep(XHTime);
                        }
                    }
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载760d===============================================fail" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
        }
        #endregion
        #region 下载 Fpga760e
        private void Fpga760e()
        {
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            toolStripStatusLabelzt.Text = "正在下载760E";
            mysocket.SendData("download ftp file /yaffs/sys/760e.fpga " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + com760e.Text);
            for (int i = 1; i <= XHCount; i++)
            {
                string ok = "Write to flash...";
                string fail = "fail";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载760e===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    if (slot17 != "" && slot18 != "")
                    {
                        toolStripStatusLabelzt.Text = "正在同步760E";
                        string sync = "successful";
                        for (int p = 1; p <= XHCount; p++)
                        {
                            string syncotn = mysocket.ReceiveData(int.Parse(ts));
                            if (syncotn.Contains(sync))
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "同步760e===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                break;
                            }
                            Thread.Sleep(XHTime);
                        }
                    }
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载760e===============================================fail" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
        }
        #endregion
        #region 下载 OTN-Pack
        private void Fpga760f()
        {
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            toolStripStatusLabelzt.Text = "正在下载760F";
            mysocket.SendData("download ftp fpga " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comuxc.Text + " otn");
            for (int i = 1; i <= XHCount; i++)
            {
                string ok = "Write to flash...";
                string fail = "fail";
                string Error = "Error";
                string box = mysocket.ReceiveData(int.Parse(ts));
                if (box.Contains(Error))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载760F===========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "由于此版本不支持大于30Mb文件写入，请下载R19C07B035版本后的APP重启再次进行尝试下载，我们将在此版本支持。" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                    //mysocket.SendData("download ftp file /yaffs/sys/760f.fpga  " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comotnpack.Text);
                }
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载760F============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    Thread.Sleep(8000);
                    if (slot17 != "" && slot18 != "")
                    {
                        toolStripStatusLabelzt.Text = "正在同步760F";
                        string sync = "successful";
                        for (int p = 1; p <= XHCount; p++)
                        {
                            string syncotn = mysocket.ReceiveData(int.Parse(ts));
                            if (syncotn.Contains(sync))
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "同步760F============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                Thread.Sleep(8000);
                                break;
                            }
                            Thread.Sleep(XHTime);
                        }
                    }
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载760F============================================fail" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
        }
        #endregion
        #region 下载 Sysfile
        private void Sysfile()
        {
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            toolStripStatusLabelzt.Text = "正在下载sysfile";
            mysocket.SendData("download ftp sysfile " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comsysfile.Text);
            for (int i = 1; i <= XHCount; i++)
            {
                string ok = "Write to flash...";
                string fail = "fail";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载sysfile============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    if (slot17 != "" && slot18 != "" || slot11 != "" || slot12 != "")
                    {
                        toolStripStatusLabelzt.Text = "正在同步sysfile文件";
                        string sync = "successful";
                        for (int p = 1; p <= XHCount; p++)
                        {
                            string syncotn = mysocket.ReceiveData(int.Parse(ts));
                            if (syncotn.Contains(sync))
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "同步sysfile============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                                Thread.Sleep(5000);
                                break;
                            }
                            Thread.Sleep(XHTime);
                        }
                    }
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载sysfile=========================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
        }
        #endregion
        #region 下载 Flash
        private void DownloadFlash()
        {
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            toolStripStatusLabelzt.Text = "正在下载Flash";
            mysocket.SendData("download ftp flash " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comflash.Text);
            for (int i = 1; i <= 2 * XHCount; i++)
            {
                string ok = "100%";
                string fail = "fail";
                string downloadok = "Download file ...ok";
                string box = mysocket.ReceiveData(int.Parse(ts));
                if (box.Contains(downloadok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载Flash==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "写入Flash进度===========================================O%");
                }
                if (box.Contains("%"))
                {
                    toolStripStatusLabelzt.Text = "正在写入Flash";
                    string appRegex = ".*%";
                    Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
                    string jindu = r.Match(box).Groups[0].Value;
                    string strjinfu = jindu.Substring(0, jindu.Length - 1);
                    String str; //字符复制串变量
                    str = textDOS.Text; //获取文本百框中的文本赋与字符串变量
                                        //提取度去除最后一问个字符的子字答符串(参数：0(从零Index处开始)，str.Lenght-1(提取几个字符))
                    str = str.Substring(0, str.Length - 3);
                    textDOS.Text = str; //赋回已删除最后一个字符的字符串给textBox
                    textDOS.AppendText(box);
                    myProgressBarjindu.Value = int.Parse(strjinfu);
                    //labjindu.Text = jindu;
                }
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "写入Flash==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载Flash=============================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
        }
        #endregion
        #region 下载 Yaffs
        private void DownloadYaffs()
        {
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            toolStripStatusLabelzt.Text = "正在下载Yaffs";
            mysocket.SendData("download ftp yaffs " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comyaffs.Text);
            for (int i = 1; i <= 6 * XHCount; i++)
            {
                string ok = "100%";
                string fail = "fail";
                string downloadok = "Download file ...ok";
                string box = mysocket.ReceiveData(int.Parse(ts));
                if (box.Contains(downloadok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载Yaffs==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "写入Yaffs进度===========================================O%");
                }
                if (box.Contains("%"))
                {
                    toolStripStatusLabelzt.Text = "正在写入Yaffs";
                    string appRegex = ".*%";
                    Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
                    string jindu = r.Match(box).Groups[0].Value;
                    string strjinfu = jindu.Substring(0, jindu.Length - 1);
                    //String str; //字符复制串变量
                    //str = textDOS.Text; //获取文本百框中的文本赋与字符串变量
                    //                    //提取度去除最后一问个字符的子字答符串(参数：0(从零Index处开始)，str.Lenght-1(提取几个字符))
                    //str = str.Substring(0, str.Length - 4);
                    //textDOS.Text = str; //赋回已删除最后一个字符的字符串给textBox
                    //textDOS.AppendText(box);
                    myProgressBarjindu.Value = int.Parse(strjinfu);
                    //labjindu.Text = jindu;
                }
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载Yaffs==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载Yaffs=============================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
        }
        #endregion
        #region 下载 config
        private void Downlaodconfig()
        {
            toolStripStatusLabelzt.Text = "正在下载config文件";
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("download ftp file /flash/sys/conf_data.txt " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comconfig.Text);
            for (int i = 1; i <= XHCount; i++)
            {
                string ok = "ok";
                string fail = "fail";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载config=============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载config=================请检查FTP服务器IP或是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                if (box.Contains("User need password"))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载config========================请检查FTP户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
        }
        #endregion
        #region 下载 slotconfig
        private void Downloadslot()
        {
            toolStripStatusLabelzt.Text = "正在下载slotconfig文件";
            mysocket.SendData("download ftp file /flash/sys/slotconfig.bin " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comslotconfig.Text);
            for (int i = 1; i <= XHCount; i++)
            {
                string ok = "ok";
                string fail = "fail";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载slotconfig=========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载lsotconfig=========================================fail" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
        }
        #endregion
        #region 下载 db
        private void Downloaddb()
        {
            toolStripStatusLabelzt.Text = "正在下载db文件";
            mysocket.SendData("download ftp file /flash/sys/db.bin " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comdb.Text);
            for (int i = 1; i <= XHCount; i++)
            {
                string ok = "ok";
                string fail = "fail";
                string db = "db.bin";
                string box = mysocket.ReceiveData(int.Parse(ts));
                if (box.Contains(ok))
                {
                    for (int a = 1; a <= XHCount; a++)
                    {
                        string box2 = mysocket.ReceiveData(int.Parse(ts));
                        if (box2.Contains(db))
                        {
                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载db=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                            break;
                        }
                        Thread.Sleep(XHTime);
                    }
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "下载db=================================================fail" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
        }
        #endregion
        #region 备份文件 Backup
        private void Backup()
        {
            toolStripStatusLabelzt.Text = "正在备份config文件";
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp file /flash/sys/conf_data.txt " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_config.txt");
            for (int i = 1; i <= 10000; i++)
            {
                string ok = "ok";
                string fail = "fail";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份config=============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份config=================请检查FTP服务器IP或是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                if (box.Contains("User need password"))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份config=========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
            //Thread.Sleep(XHTime);
            toolStripStatusLabelzt.Text = "正在备份slotconfig文件";
            mysocket.SendData("upload ftp file /flash/sys/slotconfig.bin " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_slotconfig.bin");
            for (int i = 1; i <= 10000; i++)
            {
                string ok = "ok";
                string fail = "fail";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份slotconfig=========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份slotconfig=========================================fail" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
            //Thread.Sleep(XHTime);
            toolStripStatusLabelzt.Text = "正在备份db文件";
            mysocket.SendData("upload ftp file /flash/sys/db.bin " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_db.bin");
            for (int i = 1; i <= 10000; i++)
            {
                string ok = "ok";
                string fail = "fail";
                string db = "db.bin";
                string box = mysocket.ReceiveData(int.Parse(ts));
                if (box.Contains(ok))
                {
                    for (int a = 1; a <= XHCount; a++)
                    {
                        string box2 = mysocket.ReceiveData(int.Parse(ts));
                        if (box2.Contains(db))
                        {
                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份db=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                            break;
                        }
                        Thread.Sleep(XHTime);
                    }
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份db=================================================fail" + toolStripStatusLabeltime.Text + "\r\n");
                    return;
                }
                Thread.Sleep(XHTime);
            }
        }
        #endregion
        #region 升级后重启 Reboot
        private void Reboot()
        {
            mysocket.SendData("reboot");
            for (int a = 1; a <= XHCount; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("reboot"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            DialogResult dr = MessageBox.Show("已完成，是否重启GPN设备？", "提示", MessageBoxButtons.YesNo);
            if (dr == DialogResult.Yes)
            {
                mysocket.SendData("Y");
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "您选择重启设备=========================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                Thread.Sleep(XHTime);
                string command = mysocket.ReceiveData(int.Parse(ts));
                ButLogin.PerformClick();
                //户选择确认的操作
            }
            if (dr == DialogResult.No)
            {
                //户选择取消的操作
                mysocket.SendData("N");
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "您没有选择重启设备=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                Thread.Sleep(XHTime);
                string command = mysocket.ReceiveData(int.Parse(ts));
            }
        }
        #endregion
        #region ctrl+c 按钮
        private void butctrlc_Click(object sender, EventArgs e)
        {
            mysocket.SendDate("\x03");
            // mysocket.SendDate("ETX");
            // Thread.Sleep(XHTime);
            //textDOS.AppendText("\r\n"+"CTRL+C已发送");
            // textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") +" "+mysocket.ReceiveData(int.Parse(ts)));
            this.butsend.PerformClick();
        }
        #endregion
        #region ctrl+q按钮
        private void butctrlq_Click(object sender, EventArgs e)
        {
            mysocket.SendDate("\x011");
            // textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") +" "+"CTRL+Q已发送");
            this.butsend.PerformClick();
        }
        #endregion
        #region 上下键显示上次记忆字符串
        private void textcom_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.KeyCode == Keys.Up)
            {
                //textcom.Text = "";
                mysocket.SendDate("\x1b\x5b\x41");
                Thread.Sleep(XHTime);
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + mysocket.ReceiveData(int.Parse(ts)) + "\n");
                //text = 
                //this.butsend.Focus();
                //textcom.Text = com.ToString();
            }
            if (e.KeyCode == Keys.Down)
            {
                //textcom.Text = "";
                mysocket.SendDate("\x1b\x5b\x42");
                Thread.Sleep(XHTime);
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + mysocket.ReceiveData(int.Parse(ts)) + "\n");
                //this.butsend.Focus();
                //this.butguzhangsend.Focus();
                //textcom.Text = "";
            }
        }
        #endregion
        #region 连接后不停的发\x0
        private void timer2_Tick_1(object sender, EventArgs e)
        {
            if (linkup == "已连接")
            {
                mysocket.SendDate("\x0");
            }
        }
        #endregion
        #region 打开目录
        private void butapp_Click(object sender, EventArgs e)
        {

            FolderBrowserDialog path = new FolderBrowserDialog();
            //file.Multiselect = true;
            //MessageBox.Show("CTRL+A全选中会自动填写");
            path.SelectedPath = @"C:\";

            comconfig.Items.Clear();
            comslotconfig.Items.Clear();
            comdb.Items.Clear();
            comapp.Items.Clear();
            comapp2.Items.Clear();
            comnms.Items.Clear();
            comcode.Items.Clear();
            comcode2.Items.Clear();
            comcode3.Items.Clear();
            comcode4.Items.Clear();
            comsdn.Items.Clear();
            comsw.Items.Clear();
            com760s.Items.Clear();
            com760b.Items.Clear();
            com760c.Items.Clear();
            com760d.Items.Clear();
            com760e.Items.Clear();
            comuxc.Items.Clear();
            comsysfile.Items.Clear();
            comflash.Items.Clear();
            comyaffs.Items.Clear();
            com7610.Items.Clear();
            com7611.Items.Clear();
            com7612.Items.Clear();
            com7613.Items.Clear();
            com7614.Items.Clear();
            com7615.Items.Clear();
            com7616.Items.Clear();
            comvoss.Items.Clear();
            comrebootos.Items.Clear();
            comcpld.Items.Clear();


            //清除之前打开的历史  
            //获取文件路径，不带文件名
            // string filePath = file.FileName;
            // string FilePath = Path.GetDirectoryName(filePath);
            if (defaultfilePath != "")
            {
                //设置此次默认目录为上一次选中目录  
                path.SelectedPath = defaultfilePath;
            }
            if (path.ShowDialog() == DialogResult.OK)
            {
                defaultfilePath = path.SelectedPath;
                if (path.SelectedPath == @"C:\" || path.SelectedPath == @"D:\" || path.SelectedPath == @"E:\" || path.SelectedPath == @"F:\")
                {
                    tbxFtpRoot.Text = path.SelectedPath;
                }
                else
                {
                    tbxFtpRoot.Text = path.SelectedPath + @"\";
                }

            }
            Readfile(path.SelectedPath);
            //comapp.SelectedIndex = 0;
            //this.comapp.Text = file.SafeFileName;
        }
        private void Readfile(string path)
        {



            DirectoryInfo dir = new DirectoryInfo(path);
            if (dir == null)
            {
                MessageBox.Show("文件空，请重新选择文件夹！");
                return;
            }
            FileInfo[] fileInfo = dir.GetFiles();
            List<string> fileNames = new List<string>();
            foreach (FileInfo item in fileInfo)
            {
                fileNames.Add(item.Name);
            }
            foreach (string s in fileNames)
            {
                if (s.Contains(".bin") && !s.Contains("code") && !s.Contains("sysfile") && !s.Contains("db") && !s.Contains("slot") && !s.Contains("config") && !s.Contains(".fpga") && !s.Contains("Config") && !s.Contains("CONFIG") && !s.Contains("slotconfig") && !s.Contains("SlotConfig") && !s.Contains("SlotConfig") && !s.Contains("SLOTCONFIG") && !s.Contains("DB") && !s.Contains("Db"))
                {
                    comapp.Items.Add(s);
                    if (comapp.Text !="")
                    {
                        
                        comapp.SelectedIndex = comapp.Items.Count - 1;
                    }
                }
                if (s.Contains(".bin") && !s.Contains("code") && !s.Contains("sysfile") && !s.Contains("db") && !s.Contains("slot") && !s.Contains("config") && !s.Contains(".fpga") && !s.Contains("Config") && !s.Contains("CONFIG") && !s.Contains("slotconfig") && !s.Contains("SlotConfig") && !s.Contains("SlotConfig") && !s.Contains("SLOTCONFIG") && !s.Contains("DB") && !s.Contains("Db"))
                {
                    comapp2.Items.Add(s);
                    if (comapp2.Items.Count > 0)
                    {
                        comapp2.SelectedIndex = comapp2.Items.Count - 1;
                    }
                }
                if (s.Contains("code") || s.Contains("CODE") || s.Contains("CPE"))
                {
                    comcode.Items.Add(s);
                    if (comcode.Items.Count > 0)
                    {
                        comcode.SelectedIndex = comcode.Items.Count - 1;
                    }
                }
                if (s.Contains("CPE"))
                {
                    comcode2.Items.Add(s);
                    if (comcode2.Items.Count > 0)
                    {
                        comcode2.SelectedIndex = comcode2.Items.Count - 1;
                    }
                }
                if (s.Contains("CPE"))
                {
                    comcode3.Items.Add(s);
                    if (comcode3.Items.Count > 0)
                    {
                        comcode3.SelectedIndex = comcode3.Items.Count - 1;
                    }
                }
                if ( s.Contains("CPE"))
                {
                    comcode4.Items.Add(s);
                    if (comcode4.Items.Count > 0)
                    {
                        comcode4.SelectedIndex = comcode4.Items.Count - 1;
                    }
                }
                if (s.Contains("cc") || s.Contains("CC"))
                {
                    comsdn.Items.Add(s);
                    if (comsdn.Items.Count > 0)
                    {
                        comsdn.SelectedIndex = comsdn.Items.Count - 1;
                    }
                }
                if (s.Contains("NMS") || s.Contains("nms"))
                {
                    comnms.Items.Add(s);
                    if (comnms.Items.Count > 0)
                    {
                        comnms.SelectedIndex = comnms.Items.Count - 1;
                    }
                }
                if (s.Contains("SW") || s.Contains("sw"))
                {
                    comsw.Items.Add(s);
                    if (comsw.Items.Count > 0)
                    {
                        comsw.SelectedIndex = comsw.Items.Count - 1;
                    }
                }
                if ((s.Contains("config") || s.Contains("Config") || s.Contains("CONFIG")) && !s.Contains("slotconfig") && !s.Contains("SlotConfig") && !s.Contains("SlotConfig") && !s.Contains("SLOTCONFIG") && !s.Contains("DB") && !s.Contains("Db"))
                {
                    comconfig.Items.Add(s);
                    if (comconfig.Items.Count > 0)
                    {
                        comconfig.SelectedIndex = comconfig.Items.Count - 1;
                    }
                }
                if (s.Contains("db") || s.Contains("DB") || s.Contains("Db"))
                {
                    comdb.Items.Add(s);
                    if (comdb.Items.Count > 0)
                    {
                        comdb.SelectedIndex = comdb.Items.Count - 1;
                    }
                }
                if (s.Contains("slotconfig") || s.Contains("SlotConfig") || s.Contains("SLOTCONFIG"))
                {
                    comslotconfig.Items.Add(s);
                    if (comslotconfig.Items.Count > 0)
                    {
                        comslotconfig.SelectedIndex = comslotconfig.Items.Count - 1;
                    }
                }
                if (s.Contains("760s") || s.Contains("760S"))
                {
                    com760s.Items.Add(s);
                    if (com760s.Items.Count > 0)
                    {
                        com760s.SelectedIndex = com760s.Items.Count - 1;
                    }
                }
                if (s.Contains("760b") || s.Contains("760B"))
                {
                    com760b.Items.Add(s);
                    if (com760b.Items.Count > 0)
                    {
                        com760b.SelectedIndex = com760b.Items.Count - 1;
                    }
                }
                if (s.Contains("760c") || s.Contains("760C"))
                {
                    com760c.Items.Add(s);
                    if (com760c.Items.Count > 0)
                    {
                        com760c.SelectedIndex = com760c.Items.Count - 1;
                    }
                }
                if (s.Contains("760d") || s.Contains("760D"))
                {
                    com760d.Items.Add(s);
                    if (com760d.Items.Count > 0)
                    {
                        com760d.SelectedIndex = com760d.Items.Count - 1;
                    }
                }
                if (s.Contains("760e") || s.Contains("760E"))
                {
                    com760e.Items.Add(s);
                    if (com760e.Items.Count > 0)
                    {
                        com760e.SelectedIndex = com760e.Items.Count - 1;
                    }
                }
                if (s.Contains("uxc") || s.Contains("UXC"))
                {
                    comuxc.Items.Add(s);
                    if (comuxc.Items.Count > 0)
                    {
                        comuxc.SelectedIndex = comuxc.Items.Count - 1;
                    }
                }
                if (s.Contains("7610"))
                {
                    com7610.Items.Add(s);
                    if (com7610.Items.Count > 0)
                    {
                        com7610.SelectedIndex = com7610.Items.Count - 1;
                    }
                }
                if (s.Contains("7611"))
                {
                    com7611.Items.Add(s);
                    if (com7611.Items.Count > 0)
                    {
                        com7611.SelectedIndex = com7611.Items.Count - 1;
                    }
                }
                if (s.Contains("7612"))
                {
                    com7612.Items.Add(s);
                    if (com7612.Items.Count > 0)
                    {
                        com7612.SelectedIndex = com7612.Items.Count - 1;
                    }
                }
                if (s.Contains("7613"))
                {
                    com7613.Items.Add(s);
                    if (com7613.Items.Count > 0)
                    {
                        com7613.SelectedIndex = com7613.Items.Count - 1;
                    }
                }
                if (s.Contains("7614"))
                {
                    com7614.Items.Add(s);
                    if (com7614.Items.Count > 0)
                    {
                        com7614.SelectedIndex = com7614.Items.Count - 1;
                    }
                }
                if (s.Contains("OTN_SH")||s.Contains("7615"))
                {
                    com7615.Items.Add(s);
                    if (com7615.Items.Count > 0)
                    {
                        com7615.SelectedIndex = com7615.Items.Count - 1;
                    }
                }
                if (s.Contains("7616"))
                {
                    com7616.Items.Add(s);
                    if (com7616.Items.Count > 0)
                    {
                        com7616.SelectedIndex = com7616.Items.Count - 1;
                    }
                }
                if (s.Contains("sysfile") || s.Contains("Sysfile") || s.Contains("SYSFILE") || s.Contains("SysFile"))
                {
                    comsysfile.Items.Add(s);
                    if (comsysfile.Items.Count > 0)
                    {
                        comsysfile.SelectedIndex = comsysfile.Items.Count - 1;
                    }
                }
                if (s.Contains("voss") || s.Contains("VOSS") || s.Contains("Voss"))
                {
                    comvoss.Items.Add(s);
                    if (comvoss.Items.Count > 0)
                    {
                        comvoss.SelectedIndex = comvoss.Items.Count - 1;
                    }
                }
                if (s.Contains("rebootos") || s.Contains("Rebootos.sh") || s.Contains("REBOOTOS.SH") )
                {
                    comrebootos.Items.Add(s);
                    if (comrebootos.Items.Count > 0)
                    {
                        comrebootos.SelectedIndex = comrebootos.Items.Count - 1;
                    }
                }
                if (s.Contains("cpld") || s.Contains("Cpld") || s.Contains("CPLD") )
                {
                    comcpld.Items.Add(s);
                    if (comcpld.Items.Count > 0)
                    {
                        comcpld.SelectedIndex = comcpld.Items.Count - 1;
                    }
                }
                if (s.Contains("flash") || s.Contains("Flash") || s.Contains("FLASH"))
                {
                    comflash.Items.Add(s);
                    if (comflash.Items.Count > 0)
                    {
                        comflash.SelectedIndex = comflash.Items.Count - 1;
                    }
                }
                if (s.Contains("yaffs") || s.Contains("Yaffs") || s.Contains("YAFFS"))
                {
                    comyaffs.Items.Add(s);
                    if (comyaffs.Items.Count > 0)
                    {
                        comyaffs.SelectedIndex = comyaffs.Items.Count - 1;
                    }
                }
            }
        }
        #endregion
        #region 保存记录内容
        private void Savecom()
        {
            System.Windows.Forms.SaveFileDialog sfd = new System.Windows.Forms.SaveFileDialog();
            sfd.Title = "保存打印记录";
            //sfd.InitialDirectory = @"C:\";
            sfd.Filter = "文本文件| *.txt";
            sfd.FileName = comip.Text + "-" + DateTime.Now.ToString("yyyy-MM-dd") + "-" + "所有窗口的日志记录";
            if (sfd.ShowDialog() != DialogResult.OK)
            {
                return;
            }
            using (FileStream fsWrite = new FileStream(sfd.FileName, FileMode.OpenOrCreate, FileAccess.Write))
            {
                string saveString = "";
                for (int i = 0; i < lstboxStatus.Items.Count; i++)
                {
                    saveString += lstboxStatus.Items[i].ToString() + "\r\n";
                }
                string paichajieguo = richTextEnd.Text.Replace("\n", "\r\n");
                string jilu = toolStripStatusLabelver.Text
                    + "\r\n" + toolStripStatusLabelnms.Text
                    + "\r\n" + toolStripStatusLabelnms18.Text
                    + "\r\n" + toolStripStatusLabelswa11.Text
                    + "\r\n" + toolStripStatusLabelswa12.Text
                    + "\r\n" + comapp.Text + ":  " + checkapp.Checked
                    + "\r\n" + comcode.Text + ":  " + checkcode.Checked
                    + "\r\n" + comnms.Text + ":  " + checknms.Checked
                    + "\r\n" + comsw.Text + ":  " + checksw.Checked
                    + "\r\n" + com760s.Text + ":  " + check760s.Checked
                    + "\r\n" + com760b.Text + ":  " + check760b.Checked
                    + "\r\n" + com760c.Text + ":  " + check760c.Checked
                    + "\r\n" + com760d.Text + ":  " + check760d.Checked
                    + "\r\n" + com760e.Text + ":  " + check760e.Checked
                    + "\r\n" + comuxc.Text + ":  " + checkuxc.Checked
                    + "\r\n" + comsysfile.Text + ":  " + checksysfile.Checked
                    + "\r\n" + comflash.Text + ":  " + checkflash.Checked
                    + "\r\n" + comyaffs.Text + ":  " + checkyaffs.Checked
                    + "\r\n" + toolStripStatusLabeltime.Text
                    + "\r\n ==============================================================================================================="
                    + "\r\n" + textDOS.Text
                    + "\r\n ==============================================================================================================="
                    + "\r\n" + saveString
                    + "\r\n ==============================================================================================================="
                    + "\r\n" + textlog.Text
                    + "\r\n ==============================================================================================================="
                    + "\r\n" + paichajieguo.ToString();
                byte[] buffer = Encoding.Default.GetBytes(jilu);
                fsWrite.Write(buffer, 0, buffer.Length);
                MessageBox.Show("保存成功!");
            }
        }
        private void 保存ToolStripMenuItem_Click(object sender, EventArgs e)
        {

            Savecom();
        }
        #endregion
        #region ctrl+s快捷键保存
        private void GPN_KeyDown(object sender, KeyEventArgs e)
        {
            if (e.Control == true && e.KeyCode == Keys.S)
            {
                this.保存ToolStripMenuItem.PerformClick();
            }
            if (e.KeyCode == Keys.Down)
            {
                this.butsend.Focus();
                textcom.Text = "";
            }
            if (e.Control == true && e.KeyCode == Keys.C)
            {
                mysocket.SendDate("\x03");
                // Thread.Sleep(XHTime);
                //textDOS.AppendText("\r\n"+"CTRL+C已发送");
                this.butsend.PerformClick();
                butguzhangsend.PerformClick();
            }
            if (e.Control == true && e.KeyCode == Keys.Q)
            {
                mysocket.SendDate("\x011");
                // textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") +" "+"CTRL+Q已发送");
                this.butsend.PerformClick();
            }
            if (e.Control == true && e.KeyCode == Keys.Back)
            {
                //string msg = textDOS.Text;
                //textDOS.Text = msg.Substring(0, msg.Length - 1);
                //mysocket.SendDate("\b");
                MessageBox.Show("按下了back键");
            }
        }
        static int SubstringCount(string str, string substring)
        {
            if (str.Contains(substring))
            {
                string strReplaced = str.Replace(substring, "");
                return (str.Length - strReplaced.Length) / substring.Length;
            }
            return 0;
        }
        protected override bool ProcessCmdKey(ref Message msg, Keys keyData)
        {
            if (keyData == Keys.Tab)
            {
                // MessageBox.Show("抓住Tab ");
                mysocket.SendDate(textcom.Text + "\t");
                Thread.Sleep(XHTime);
                string stra = mysocket.ReceiveData(int.Parse(ts));
                string b = "\b";
                int a = SubstringCount(stra, b);
                if (textcom.Text != "")
                {
                    if (textcom.Text.Contains(" "))
                    {
                        string dos = textcom.Text;
                        string dos2 = dos.Substring(0, dos.Length - a);
                        string luanma = "\b";
                        string newSS = stra.Replace(luanma, "");
                        string newSw = newSS.Replace(dos, dos2);
                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + newSw);
                    }
                    else
                    {
                        string luanma = "\b";
                        string newSS = stra.Replace(luanma, "");
                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + newSS);
                    }
                }
                else
                {
                    string luanma = "\b";
                    string newSS = stra.Replace(luanma, "");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + newSS);
                }
                //string luanma = "\b";
                //string newSS = ss.Replace(luanma,"");
                textcom.Text = "";
                //this.butsend.PerformClick();
                return true;
            }
            return base.ProcessCmdKey(ref msg, keyData);
        }
        #endregion
        #region 耗时现显示
        System.Threading.Timer Mytimer;
        long TimeCount;
        delegate void SetValue();
        private void TimerUp(object state)
        {
            this.Invoke(new SetValue(ShowTime));
            TimeCount++;
        }
        public void ShowTime()
        {
            TimeSpan t = new TimeSpan(0, 0, (int)TimeCount);
            toolStripStatusLabeltime.Text = string.Format("{0:00}:{1:00}:{2:00}", t.Hours, t.Minutes, t.Seconds);
        }
        //开始计时  
        private void GPN_Load(object sender, EventArgs e)
        {

            Mytimer = new System.Threading.Timer(new TimerCallback(TimerUp), null, Timeout.Infinite, 1000);
            btnFtpServerStartStop.PerformClick();
            metroComreadoid.Text = "WALK";
            tbxFtpServerPort.Text = "21";

            //checkpssd.CheckedChanged = true;
            labelboard.Visible = false;
            labelslot.Visible = false;
            labelvcg.Visible = false;
            comboard.Visible = false;
            comslot.Visible = false;
            comvcg.Visible = false;
            butpaigu.Visible = false;
            butsyslog.Visible = false;
            labeleth.Visible = false;
            cometh.Visible = false;
            labelethboard.Visible = false;
            labelethslot.Visible = false;
            comethboard.Visible = false;
            comethslot.Visible = false;
            textcyclemingling.Visible = false;
            labcishu.Visible = false;
            comcishu.Visible = false;
            butCycleStart.Visible = false;
            butCycleSuspend.Visible = false;
            ComRDPType.Text = "tcp";
            ComVNCType.Text = "tcp";
           // this.WindowState = FormWindowState.Maximized;
            Process[] pro = Process.GetProcesses();
            int count = 0;
            foreach (var item in pro)
            {
                if (item.ProcessName == "frpc")
                {
                    count++;

                }
                if (item.ProcessName == "tvnserver")
                {
                    count++;

                }

            }
            if (count >= 3)
            {
                tabPageRemote.Text = "远程桌面共享：已启动";
                metroButStartVnc.Text = "停止桌面共享";
                Textsharp.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "VNC登录密码是：http://hunan128.com:88/otrs/customer.pl?Action=CustomerFAQZoom;ItemID=31" + " 谷歌浏览器登录获取" + "\r\n");
                Textsharp.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程共享模块已经启动============================================OK" + "\r\n");

                Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "请打开（Windows/Mac/iPhone/iPad/Android） VNC Viewer  远程桌面软件输入：" + TextServerAddr.Text + ":" + TextVNCRemotePort.Text + " 进行VNC连接" + "\r\n");
                Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "请打开（windows/Mac/iPad/iPhone/Android）     RD Client   远程桌面软件输入：" + TextServerAddr.Text + ":" + TextRDPRemotePort.Text + " 进行RDP连接" + "\r\n");
                //   Textsharp.AppendText("\r\n桌面共享已开启，无需重启启动！");
            }
            else
            {
                tabPageRemote.Text = "远程桌面共享：未启动";
                Textsharp.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "VNC登录密码是：http://hunan128.com:88/otrs/customer.pl?Action=CustomerFAQZoom;ItemID=31" + " 谷歌浏览器登录获取" + "\r\n");


            }
        }
        #endregion
        #region 声明ini变量
        /// <summary>
        /// 写入INI文件
        /// </summary>
        /// <param name="section">节点名称[如[TypeName]]</param>
        /// <param name="key">键</param>
        /// <param name="val">值</param>
        /// <param name="filepath">文件路径</param>
        /// <returns></returns>
        [DllImport("kernel32")]
        private static extern long WritePrivateProfileString(string section, string key, string val, string filepath);
        /// <summary>
        /// 读取INI文件
        /// </summary>
        /// <param name="section">节点名称</param>
        /// <param name="key">键</param>
        /// <param name="def">值</param>
        /// <param name="retval">stringbulider对象</param>
        /// <param name="size">字节大小</param>
        /// <param name="filePath">文件路径</param>
        /// <returns></returns>
        [DllImport("kernel32")]
        private static extern int GetPrivateProfileString(string section, string key, string def, StringBuilder retval, int size, string filePath);
        // private string strFilePath = Application.StartupPath + "\\Config.ini";//获取INI文件路径
        private string strFilePath = @"C:\gpn\Config.ini";
        private string frpcPath = @"C:\gpn\frpc.ini";
        private string strSec = ""; //INI文件名
        #endregion
        #region 设置ini文件内容

        private void Gpnsetini()
        {

            try
            {
                //根据INI文件名设置要写入INI文件的节点名称
                //此处的节点名称完全可以根据实际需要进行配置
                strSec = "Config";
                WritePrivateProfileString(strSec, "FTPip", comftpip.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "FTPport", tbxFtpServerPort.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "FTPuser", textftpusr.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "FTPpsd", textftppsd.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "FTPpath", tbxFtpRoot.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "GPNip", comip.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "GPNuser", textusr.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "GPNpsd", textpsd.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "ReadCommunity", textReadCommunity.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "WriteCommunity", textWriteCommunity.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "GPNpsden", textpsden.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "APP", comapp.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "APP2", comapp2.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "FPFA_CODE", comcode.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "FPFA_CODE2", comcode2.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "FPFA_CODE3", comcode3.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "FPFA_CODE4", comcode4.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "SDN", comsdn.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "NMS", comnms.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "SW", comsw.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "760S", com760s.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "760B", com760b.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "760C", com760c.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "760D", com760d.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "760E", com760e.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "UXC", comuxc.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "7610", com7610.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "7611", com7611.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "7612", com7612.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "7613", com7613.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "7614", com7614.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "7615", com7615.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "7616", com7616.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "sysfile", comsysfile.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "voss", comvoss.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "rebootos", comrebootos.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "cpld", comcpld.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "Flash", comflash.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "Yaffs", comyaffs.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "GPN7600EMS", comgpn76list.Text.Trim(), strFilePath);
                WritePrivateProfileString(strSec, "VNCUSER", TextVNCUser.Text.Trim(), strFilePath);
                int a = 0;
                bool zhixing;
                string ipadd = "";
                for (int i = 0; i < DGVSTATUS.Rows.Count; i++)
                {
                    ipadd = DGVSTATUS.Rows[i].Cells["ip地址"].Value.ToString();
                    a = int.Parse(DGVSTATUS.Rows[i].Cells["优先级"].Value.ToString());
                    zhixing = bool.Parse(DGVSTATUS.Rows[i].Cells["执行"].Value.ToString());
                    DGVSTATUS.Rows[i].Cells["优先级"].Value = a;
                    Gpnip user = new Gpnip();
                    // 登录时 如果没有Data.bin文件就创建、有就打开
                    FileStream fs = new FileStream(@"C:\gpn\gpnip.bin", FileMode.OpenOrCreate);
                    BinaryFormatter bf = new BinaryFormatter();
                    // 保存在实体类属性中
                    user.GpnIP = ipadd;
                    user.GpnPRY = a;
                    user.GpnZX = zhixing;
                    if (userss.ContainsKey(user.GpnIP))
                    {
                        //如果有清掉
                        userss.Remove(user.GpnIP);
                        // MessageBox.Show("ip已经存在，替换完成");
                    }
                    //添加用户信息到集合
                    userss.Add(user.GpnIP, user);
                    //写入文件
                    bf.Serialize(fs, userss);

                    fs.Close();
                    //   MySocket.WriteLogs("Logs", "软件窗口所有日志：", EmailBody);



                }


            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }
        }




        private void 设置ToolStripMenuItem_Click(object sender, EventArgs e)
        {
            Gpnsetini();
        }
        private string ContentValue(string Section, string key)
        {
            StringBuilder temp = new StringBuilder(1024);
            GetPrivateProfileString(Section, key, "", temp, 1024, strFilePath);
            return temp.ToString();
        }
        private string ContentValueFrpc(string Section, string key)
        {
            StringBuilder temp = new StringBuilder(1024);
            GetPrivateProfileString(Section, key, "", temp, 1024, frpcPath);
            return temp.ToString();
        }
        #endregion
        #region 退出窗口
        private void GPN_FormClosing(object sender, FormClosingEventArgs e)
        {
            try
            {
                DialogResult dr = MessageBox.Show("是否退出并保存？", "提示", MessageBoxButtons.YesNoCancel);
                if (dr == DialogResult.Yes)
                {
                    Gpnsetini();
                    ///////保存telnet 记录////////
                    Savecom();
                    //  导出前俩列ToolStripMenuItem.PerformClick();
                    if (metroButTrap.Text == "禁止Trap监听")
                    {
                        run = false;
                        trap.Abort();
                        socket.Close();
                    }
                    //socket.Shutdown(SocketShutdown.Both);
                    //    Thread.Sleep(10);
                    //socket.Close();
                    //户选择确认的操作
                }
                else if (dr == DialogResult.Cancel)
                {
                    e.Cancel = true;
                    //return;
                }
                if (dr == DialogResult.No)
                {
                    Gpnsetini();
                    //    导出前俩列ToolStripMenuItem.PerformClick();

                    if (metroButTrap.Text == "禁止Trap监听")
                    {
                        run = false;
                        trap.Abort();
                        socket.Close();
                    }

                }
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }
        }
        #endregion
        #region 显示密码
        private void Checkpssd_CheckedChanged(object sender, EventArgs e)
        {
            if (checkpssd.Checked)
            {
                textpsd.PasswordChar = (char)0;
                textpsden.PasswordChar = (char)0;
                textftppsd.PasswordChar = (char)0;
                textReadCommunity.PasswordChar = (char)0;
                textWriteCommunity.PasswordChar = (char)0;
            }
            else
            {
                textftppsd.PasswordChar = '*';
                textpsd.PasswordChar = '*';
                textpsden.PasswordChar = '*';
                textReadCommunity.PasswordChar = '*';
                textWriteCommunity.PasswordChar = '*';
            }
        }
        #endregion
        private void Butbatch_Click(object sender, EventArgs e)
        {

        }
        private void GPN_Paint(object sender, PaintEventArgs e)
        {
            Graphics g = e.Graphics;
            Color FColor = Color.White;
            Color TColor = Color.Green;
            if (this.ClientRectangle.Height != 0)
            {
                Brush b = new LinearGradientBrush(this.ClientRectangle, FColor, TColor, LinearGradientMode.Vertical);
                g.FillRectangle(b, this.ClientRectangle);
            }
        }
        private void GPN_Resize(object sender, EventArgs e)
        {
            this.Invalidate();//重绘窗体
        }
        private void 帮助ToolStripMenuItem_Click(object sender, EventArgs e)
        {

        }

        /// <summary>
        /// 一键导出入职主程序
        /// </summary>
        /// <param name="obj"></param>
        public void Syslog(object obj)
        {
            try
            {
                textguzhangmingling.Text = "screen lines 40";
                butguzhangsend.PerformClick();
                textcurrent.AppendText("\r\n" + "////////////////////////////////////////////////////////////////////版本信息//////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "show ver";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    //MessageBox.Show("进入循环");
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        break;
                    }
                    Thread.Sleep(XHTime / 3);
                }
                textcurrent.AppendText("\r\n" + "/////////////////////////////////////////////////////////////////////FPGA的SP版本/////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "grosadvdebug";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "show fpga";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        //MessageBox.Show("跳出循环");
                        textguzhangmingling.Text = "exit";
                        butguzhangsend.PerformClick();
                        break;
                    }
                    Thread.Sleep(XHTime / 3);
                }
                textcurrent.AppendText("\r\n" + "/////////////////////////////////////////////////////////////////////槽位信息//////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "show slot";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    //MessageBox.Show("进入循环");
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        break;
                    }
                    Thread.Sleep(XHTime / 3);
                }
                textcurrent.AppendText("\r\n" + "////////////////////////////////////////////////////////////////////配置文件信息//////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "show run";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    //MessageBox.Show("进入循环");
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        break;
                    }
                    Thread.Sleep(XHTime / 3);
                }
                textcurrent.AppendText("\r\n" + "////////////////////////////////////////////////////////////////////CPU内存利用率//////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "show system resource usage";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    //MessageBox.Show("进入循环");
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        break;
                    }
                    //Thread.Sleep(XHTime);
                }
                if (toolStripStatusLabelver.Text.Contains("R13"))
                {
                    textcurrent.AppendText("\r\n" + "////////////////////////////////////////////////////////////////////进程CPU利用率//////////////////////////////" + "\r\n");
                    textguzhangmingling.Text = "show task";
                    butguzhangsend.PerformClick();
                    for (int g = 0; g <= XHCount; g++)
                    {
                        //MessageBox.Show("进入循环");
                        if (textcurrent.Text.Contains("Ctrl+c"))
                        {
                            butguzhangsend.PerformClick();
                        }
                        else
                        {
                            break;
                        }
                        //Thread.Sleep(XHTime);
                    }
                }
                else
                {
                    textcurrent.AppendText("\r\n" + "////////////////////////////////////////////////////////////////////进程CPU利用率//////////////////////////////" + "\r\n");
                    textguzhangmingling.Text = "show task cpu";
                    butguzhangsend.PerformClick();
                    for (int g = 0; g <= XHCount; g++)
                    {
                        //MessageBox.Show("进入循环");
                        if (textcurrent.Text.Contains("Ctrl+c"))
                        {
                            butguzhangsend.PerformClick();
                        }
                        else
                        {
                            break;
                        }
                        //Thread.Sleep(XHTime);
                    }
                }
                textcurrent.AppendText("\r\n" + "////////////////////////////////////////////////////////////////////温度信息///////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "show temperature";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    //MessageBox.Show("进入循环");
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        break;
                    }
                    //Thread.Sleep(XHTime);
                }
                textcurrent.AppendText("\r\n" + "////////////////////////////////////////////////////////////////////存储器系统日志//////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "show nvram syslog";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    //MessageBox.Show("进入循环");
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        break;
                    }
                    Thread.Sleep(XHTime / 3);
                }
                textcurrent.AppendText("\r\n" + "////////////////////////////////////////////////////////////////////当前告警//////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "show current alarm";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    //MessageBox.Show("进入循环");
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        break;
                    }
                    //Thread.Sleep(XHTime);
                }
                textcurrent.AppendText("\r\n" + "////////////////////////////////////////////////////////////////////ARP地址表//////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "show arp all";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    //MessageBox.Show("进入循环");
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        break;
                    }
                    //Thread.Sleep(XHTime);
                }
                textcurrent.AppendText("\r\n" + "////////////////////////////////////////////////////////////////////MAC地址表//////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "show forward-entry";
                butguzhangsend.PerformClick();
                textcurrent.AppendText("\r\n" + "此处大约要等10S钟，请耐心等待......" + "\r\n");
                Thread.Sleep(10000);
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    //MessageBox.Show("进入循环");
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        break;
                    }
                    //Thread.Sleep(XHTime);
                }
                textcurrent.AppendText("\r\n" + "////////////////////////////////////////////////////////////////////接口状态信息//////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "show port-link";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    //MessageBox.Show("进入循环");
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        break;
                    }
                    //Thread.Sleep(XHTime);
                }
                textcurrent.AppendText("\r\n" + "////////////////////////////////////////////////////////////////////当前系统时间//////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "show time";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    //MessageBox.Show("进入循环");
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        break;
                    }
                    //Thread.Sleep(XHTime);
                }
                textcurrent.AppendText("\r\n" + "////////////////////////////////////////////////////////////////////设备启动时间//////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "show start time";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    //MessageBox.Show("进入循环");
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        break;
                    }
                    //Thread.Sleep(XHTime);
                }
                textcurrent.AppendText("\r\n" + "/////////////////////////////////////////////////////////////////////系统告警日志/////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "show alarm log";
                butguzhangsend.PerformClick();
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        //MessageBox.Show("跳出循环");
                        break;
                    }
                    Thread.Sleep(XHTime / 10);
                }
                textcurrent.AppendText("\r\n" + "/////////////////////////////////////////////////////////////////////内存队列信息/////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "grosadvdebug";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "show que";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        //MessageBox.Show("跳出循环");
                        textguzhangmingling.Text = "exit";
                        butguzhangsend.PerformClick();
                        break;
                    }
                }
                textcurrent.AppendText("\r\n" + "/////////////////////////////////////////////////////////////////////APP内部版本信息/////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "grosadvdebug";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "show debug-version";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        //MessageBox.Show("跳出循环");
                        textguzhangmingling.Text = "exit";
                        butguzhangsend.PerformClick();
                        break;
                    }
                }
                textcurrent.AppendText("\r\n" + "/////////////////////////////////////////////////////////////////////DCN-J2信息/////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "show running-config dcn-j2";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "show dcn-j2 summary";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        //MessageBox.Show("跳出循环");
                        break;
                    }
                }
                textcurrent.AppendText("\r\n" + "/////////////////////////////////////////////////////////////////////E1接口告警信息查询/////////////////////////////");
                textcurrent.AppendText("\r\n" + "/////////////////////////////////////////////////////////////////////告警优先看最左侧的，因为告警级别最高/////////////////////////////");
                textcurrent.AppendText("\r\n" + "/////////////////////////////////////////////////////////////////////AIS, 传输故障，业务未配置/////////////////////////////");
                textcurrent.AppendText("\r\n" + "/////////////////////////////////////////////////////////////////////RDI，对端接收有AIS告警/////////////////////////////");
                textcurrent.AppendText("\r\n" + "/////////////////////////////////////////////////////////////////////REI，对端接收有误码/////////////////////////////");
                textcurrent.AppendText("\r\n" + "/////////////////////////////////////////////////////////////////////TIM，告警不影响业务/////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "config msap";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "ioctl lpoh show 17/1";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "ioctl lpoh show 17/2";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "ioctl lpoh show 17/3";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "ioctl lpoh show 17/4";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "ioctl lpoh show 17/5";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "ioctl lpoh show 17/6";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "ioctl lpoh show 17/7";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "ioctl lpoh show 17/8";
                butguzhangsend.PerformClick();
                textcurrent.AppendText("\r\n" + "/////////////////////////////////////////////////////////////////////inner误码查询/////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "show vc4";
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        //MessageBox.Show("跳出循环");
                        textguzhangmingling.Text = "exit";
                        butguzhangsend.PerformClick();
                        break;
                    }
                }
                textlog.AppendText(textcurrent.Text);
                textcurrent.Text = "";
                butguzhangsend.PerformClick();
                this.保存ToolStripMenuItem.PerformClick();

            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }

        }
        /// <summary>
        /// 故障排查主程序
        /// </summary>
        /// <param name="obj"></param>
        public void GuZhangPaiCha(object obj)
        {
            try
            {


                textcurrent.Text = "当前窗口：";
                richTextEnd.Text = "故障排查结果：";
                textlog.Text = "故障排查日志：";
                textguzhangmingling.Text = "screen lines 40";
                butguzhangsend.PerformClick();
                string Tsvc12 = "";
                string Tsvc4 = "";
                string SDH = "";
                string VcgTxFrames1 = "";
                string VcgTxFrames2 = "";
                string VcgRxFrames1 = "";
                string VcgRxFrames2 = "";
                string MacTxFrames1 = "";
                string MacTxFrames2 = "";
                string MacRxFrames1 = "";
                string MacRxFrames2 = "";
                string EthOutFrames1 = "";
                string EthOutFrames2 = "";
                string EthInFrames1 = "";
                string EthInFrames2 = "";
                string Eos126vlanmismatchDropRx1 = "";
                string Eos126vlanmismatchDropRx2 = "";
                string EthInDiscardFrames1 = "";
                string EthOutDiscardFrames1 = "";
                string EthInCrcErrorPkts1 = "";
                string EthOutCrcErrorPkts1 = "";
                string EthInDiscardFrames2 = "";
                string EthOutDiscardFrames2 = "";
                string EthInCrcErrorPkts2 = "";
                string EthOutCrcErrorPkts2 = "";
                richTextEnd.AppendText("\r\n" + "板卡：" + comboard.Text + "\r\n" + "接口：" + comslot.Text + "/" + comvcg.Text + "\r\n");
                if (comboard.Text == "EOS-8FX" || comboard.Text == "EOS-8FE" || comboard.Text == "DMD-8GE" || comboard.Text == "EOS/P-126")
                {
                    textlog.AppendText("\r\n" + "///////////////////////////VCG接口信息/////////////////////////////////////////////" + "\r\n");
                    textguzhangmingling.Text = "interface vcg " + comslot.Text + "/" + comvcg.Text;
                    butguzhangsend.PerformClick();
                    if (textcurrent.Text.Contains("can not support vcg interface"))
                    {
                        richTextEnd.AppendText("VCG接口不存在，请配置后再试！" + "\r\n");
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                        butguzhangsend.PerformClick();
                        MessageBox.Show("VCG接口不存在，请配置后再试！");
                        return;
                    }
                    textguzhangmingling.Text = "show";
                    butguzhangsend.PerformClick();
                    for (int g = 0; g <= XHCount; g++)
                    {
                        if (textcurrent.Text.Contains("Ctrl+c"))
                        {
                            butguzhangsend.PerformClick();
                        }
                        else
                        {
                            if (textcurrent.Text.Contains("vc12,"))
                            {
                                richTextEnd.AppendText("业务级别：VC12" + "\r\n");
                                if (textcurrent.Text.Contains("nul:"))
                                {
                                    Regex Ts = new Regex(@"nul:\s*([\d\/\d\-\d\-\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string Ts0 = Ts.Match(textcurrent.Text).Groups[1].Value;
                                    Tsvc12 = Ts0.Replace("-", "/");
                                    Regex Port0 = new Regex(@"nul:\s*([\d\/\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    SDH = Port0.Match(textcurrent.Text).Groups[1].Value;
                                    richTextEnd.AppendText("上联接口：" + SDH.ToString() + "\r\n");
                                    richTextEnd.AppendText("上联时隙：" + Tsvc12.ToString() + "\r\n");
                                    if (Tsvc12.ToString() == "")
                                    {
                                        richTextEnd.AppendText("交叉时隙不存在，请配置时隙后再试！" + "\r\n");
                                        textlog.AppendText(textcurrent.Text);
                                        textcurrent.Text = "";
                                        textguzhangmingling.Text = "exit";
                                        butguzhangsend.PerformClick();
                                        MessageBox.Show("交叉时隙不存在，请配置时隙后再试！");
                                        return;
                                    }
                                }
                                if (textcurrent.Text.Contains("sdh:"))
                                {
                                    Regex Ts = new Regex(@"sdh:\s*([\d\/\d\-\d\-\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string Ts0 = Ts.Match(textcurrent.Text).Groups[1].Value;
                                    Tsvc12 = Ts0.Replace("-", "/");
                                    Regex Port0 = new Regex(@"sdh:\s*([\d\/\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    SDH = Port0.Match(textcurrent.Text).Groups[1].Value;
                                    richTextEnd.AppendText("上联接口：" + SDH.ToString() + "\r\n");
                                    richTextEnd.AppendText("上联时隙：" + Tsvc12.ToString() + "\r\n");
                                    if (Tsvc12.ToString() == "")
                                    {
                                        richTextEnd.AppendText("交叉时隙不存在，请配置时隙后再试！" + "\r\n");
                                        textlog.AppendText(textcurrent.Text);
                                        textcurrent.Text = "";
                                        textguzhangmingling.Text = "exit";
                                        butguzhangsend.PerformClick();
                                        MessageBox.Show("交叉时隙不存在，请配置时隙后再试！");
                                        return;
                                    }
                                }
                                if (textcurrent.Text.Contains("vcg:"))
                                {
                                    Regex Ts = new Regex(@"vcg:\s*([\d\/\d\-\d\-\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string Ts0 = Ts.Match(textcurrent.Text).Groups[1].Value;
                                    Tsvc12 = Ts0.Replace("-", "/");
                                    Regex Port0 = new Regex(@"vcg:\s*([\d\/\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    SDH = Port0.Match(textcurrent.Text).Groups[1].Value;
                                    richTextEnd.AppendText("上联接口：" + SDH.ToString() + "\r\n");
                                    richTextEnd.AppendText("上联时隙：" + Tsvc12.ToString() + "\r\n");
                                    if (Tsvc12.ToString() == "")
                                    {
                                        richTextEnd.AppendText("交叉时隙不存在，请配置时隙后再试！" + "\r\n");
                                        textlog.AppendText(textcurrent.Text);
                                        textcurrent.Text = "";
                                        textguzhangmingling.Text = "exit";
                                        butguzhangsend.PerformClick();
                                        MessageBox.Show("交叉时隙不存在，请配置时隙后再试！");
                                        return;
                                    }
                                }
                            }
                            if (textcurrent.Text.Contains("vc3,"))
                            {
                                richTextEnd.AppendText("业务级别：VC3" + "\r\n");
                                if (textcurrent.Text.Contains("nul:"))
                                {
                                    Regex Ts = new Regex(@"nul:\s*([\d\/\d\-\d\-\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string Ts0 = Ts.Match(textcurrent.Text).Groups[1].Value;
                                    Tsvc12 = Ts0.Replace("-", "/");
                                    Regex Port0 = new Regex(@"nul:\s*([\d\/\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    SDH = Port0.Match(textcurrent.Text).Groups[1].Value;
                                    richTextEnd.AppendText("上联接口：" + SDH.ToString() + "\r\n");
                                    richTextEnd.AppendText("上联时隙：" + Tsvc12.ToString() + "\r\n");
                                    if (Tsvc12.ToString() == "")
                                    {
                                        richTextEnd.AppendText("交叉时隙不存在，请配置时隙后再试！" + "\r\n");
                                        textlog.AppendText(textcurrent.Text);
                                        textcurrent.Text = "";
                                        textguzhangmingling.Text = "exit";
                                        butguzhangsend.PerformClick();
                                        MessageBox.Show("交叉时隙不存在，请配置时隙后再试！");
                                        return;
                                    }
                                }
                                if (textcurrent.Text.Contains("sdh:"))
                                {
                                    Regex Ts = new Regex(@"sdh:\s*([\d\/\d\-\d\-\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string Ts0 = Ts.Match(textcurrent.Text).Groups[1].Value;
                                    Tsvc12 = Ts0.Replace("-", "/");
                                    Regex Port0 = new Regex(@"sdh:\s*([\d\/\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    SDH = Port0.Match(textcurrent.Text).Groups[1].Value;
                                    richTextEnd.AppendText("上联接口：" + SDH.ToString() + "\r\n");
                                    richTextEnd.AppendText("上联时隙：" + Tsvc12.ToString() + "\r\n");
                                    if (Tsvc12.ToString() == "")
                                    {
                                        richTextEnd.AppendText("交叉时隙不存在，请配置时隙后再试！" + "\r\n");
                                        textlog.AppendText(textcurrent.Text);
                                        textcurrent.Text = "";
                                        textguzhangmingling.Text = "exit";
                                        butguzhangsend.PerformClick();
                                        MessageBox.Show("交叉时隙不存在，请配置时隙后再试！");
                                        return;
                                    }
                                }
                                if (textcurrent.Text.Contains("vcg:"))
                                {
                                    Regex Ts = new Regex(@"vcg:\s*([\d\/\d\-\d\-\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string Ts0 = Ts.Match(textcurrent.Text).Groups[1].Value;
                                    Tsvc12 = Ts0.Replace("-", "/");
                                    Regex Port0 = new Regex(@"vcg:\s*([\d\/\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    SDH = Port0.Match(textcurrent.Text).Groups[1].Value;
                                    richTextEnd.AppendText("上联接口：" + SDH.ToString() + "\r\n");
                                    richTextEnd.AppendText("上联时隙：" + Tsvc12.ToString() + "\r\n");
                                    if (Tsvc12.ToString() == "")
                                    {
                                        richTextEnd.AppendText("交叉时隙不存在，请配置时隙后再试！" + "\r\n");
                                        textlog.AppendText(textcurrent.Text);
                                        textcurrent.Text = "";
                                        textguzhangmingling.Text = "exit";
                                        butguzhangsend.PerformClick();
                                        MessageBox.Show("交叉时隙不存在，请配置时隙后再试！");
                                        return;
                                    }
                                }
                            }
                            if (textcurrent.Text.Contains("vc4,"))
                            {
                                richTextEnd.AppendText("业务级别：VC4" + "\r\n");
                                if (textcurrent.Text.Contains("nul:"))
                                {
                                    Regex Ts = new Regex(@"nul:\s*(([\d]+)\/\d\-\d+)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string Ts0 = Ts.Match(textcurrent.Text).Groups[1].Value;
                                    Tsvc4 = Ts0.Replace("-", "/");
                                    Regex Port0 = new Regex(@"nul:\s*([\d\/\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    SDH = Port0.Match(textcurrent.Text).Groups[1].Value;
                                    richTextEnd.AppendText("上联接口：" + SDH.ToString() + "\r\n");
                                    richTextEnd.AppendText("上联时隙：" + Tsvc4.ToString() + "\r\n");
                                    if (Tsvc4.ToString() == "")
                                    {
                                        richTextEnd.AppendText("交叉时隙不存在，请配置时隙后再试！" + "\r\n");
                                        textlog.AppendText(textcurrent.Text);
                                        textcurrent.Text = "";
                                        textguzhangmingling.Text = "exit";
                                        butguzhangsend.PerformClick();
                                        MessageBox.Show("交叉时隙不存在，请配置时隙后再试！");
                                        return;
                                    }
                                }
                                if (textcurrent.Text.Contains("sdh:"))
                                {
                                    Regex Ts = new Regex(@"sdh:\s*(([\d]+)\/\d\-\d+)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string Ts0 = Ts.Match(textcurrent.Text).Groups[1].Value;
                                    Tsvc4 = Ts0.Replace("-", "/");
                                    Regex Port0 = new Regex(@"sdh:\s*([\d\/\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    SDH = Port0.Match(textcurrent.Text).Groups[1].Value;
                                    richTextEnd.AppendText("上联接口：" + SDH.ToString() + "\r\n");
                                    richTextEnd.AppendText("上联时隙：" + Tsvc4.ToString() + "\r\n");
                                    if (Tsvc4.ToString() == "")
                                    {
                                        richTextEnd.AppendText("交叉时隙不存在，请配置时隙后再试！" + "\r\n");
                                        textlog.AppendText(textcurrent.Text);
                                        textcurrent.Text = "";
                                        textguzhangmingling.Text = "exit";
                                        butguzhangsend.PerformClick();
                                        MessageBox.Show("交叉时隙不存在，请配置时隙后再试！");
                                        return;
                                    }
                                }
                                if (textcurrent.Text.Contains("vcg:"))
                                {
                                    Regex Ts = new Regex(@"vcg:\s*(\d\/\d\-\d+)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string Ts0 = Ts.Match(textcurrent.Text).Groups[1].Value;
                                    Tsvc4 = Ts0.Replace("-", "/");
                                    Regex Port0 = new Regex(@"vcg:\s*([\d\/\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    SDH = Port0.Match(textcurrent.Text).Groups[1].Value;
                                    richTextEnd.AppendText("上联接口：" + SDH.ToString() + "\r\n");
                                    richTextEnd.AppendText("上联时隙：" + Tsvc4.ToString() + "\r\n");
                                    if (Tsvc4.ToString() == "")
                                    {
                                        richTextEnd.AppendText("交叉时隙不存在，请配置时隙后再试！" + "\r\n");
                                        textlog.AppendText(textcurrent.Text);
                                        textcurrent.Text = "";
                                        textguzhangmingling.Text = "exit";
                                        butguzhangsend.PerformClick();
                                        MessageBox.Show("交叉时隙不存在，请配置时隙后再试！");
                                        return;
                                    }
                                }
                            }
                            if (!textcurrent.Text.Contains("vc12,") && !textcurrent.Text.Contains("vc3,") && !textcurrent.Text.Contains("vc4,"))
                            {
                                richTextEnd.AppendText("交叉时隙不存在，请配置时隙后再试！" + "\r\n");
                                textlog.AppendText(textcurrent.Text);
                                textcurrent.Text = "";
                                textguzhangmingling.Text = "exit";
                                butguzhangsend.PerformClick();
                                MessageBox.Show("交叉时隙不存在，请配置时隙后再试！");
                                return;
                            }
                            Regex r = new Regex(@"LCAS:\s*([\w]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Lcas = r.Match(textcurrent.Text).Groups[1].Value;
                            richTextEnd.AppendText("LCAS状态：" + Lcas + "\r\n");
                            textlog.AppendText(textcurrent.Text);
                            textcurrent.Text = "";
                            break;
                        }
                    }
                    textlog.AppendText("\r\n" + "///////////////////////////VCG成员信息和告警查询//////////////////////////////////");
                    textlog.AppendText("\r\n" + "///////////////////////////AIS，传输故障，业务未配置//////////////////////////////");
                    textlog.AppendText("\r\n" + "///////////////////////////PLM，V5或者C2字节匹配//////////////////////////////////");
                    textlog.AppendText("\r\n" + "///////////////////////////RDI，对端EOS的VCG接收有AIS告警/////////////////////////");
                    textlog.AppendText("\r\n" + "///////////////////////////REI，对接EOS的VCG接收有误码////////////////////////////");
                    textlog.AppendText("\r\n" + "///////////////////////////RxEn状态，en、OK 是正常的，err、dnu、add是传输侧VCG故障");
                    textlog.AppendText("\r\n" + "///////////////////////////TxEn状态，en、OK 是正常的，err、dnu、add是我司设备VCG故障" + "\r\n");
                    textguzhangmingling.Text = "show current-state";
                    butguzhangsend.PerformClick();
                    Thread.Sleep(XHTime);
                    butguzhangsend.PerformClick();
                    butguzhangsend.PerformClick();
                    butguzhangsend.PerformClick();
                    textcurrent.Text = "";
                    textguzhangmingling.Text = "show current-state";
                    butguzhangsend.PerformClick();
                    Thread.Sleep(XHTime);
                    butguzhangsend.PerformClick();


                    for (int g = 0; g <= XHCount; g++)
                    {
                        //MessageBox.Show(g.ToString());
                        if (textcurrent.Text.Contains("Ctrl+c"))
                        {
                            butguzhangsend.PerformClick();
                            //MessageBox.Show("点击按钮");
                            Console.WriteLine(DateTime.Now.ToString("HH:mm:ss ") + g.ToString());
                            Debug.WriteLine(DateTime.Now.ToString("HH:mm:ss ") + g.ToString());
                            Trace.WriteLine(DateTime.Now.ToString("HH:mm:ss ") + g.ToString());
                        }
                        else
                        {
                            //MessageBox.Show("跳出循环");
                            if (textcurrent.Text.Contains("AIS") || textcurrent.Text.Contains("PLM") || textcurrent.Text.Contains("REI") || textcurrent.Text.Contains("RDI") || textcurrent.Text.Contains("add") || textcurrent.Text.Contains("err") || textcurrent.Text.Contains("dnu"))
                            {
                                if (textcurrent.Text.Contains("AIS"))
                                {
                                    richTextEnd.AppendText("VCG接口告警：NOK。存在AIS告警" + "\r\n");
                                }
                                if (textcurrent.Text.Contains("PLM") && !textcurrent.Text.Contains("AIS"))
                                {
                                    richTextEnd.AppendText("VCG接口告警：NOK。存在PLM告警" + "\r\n");
                                }
                                if (textcurrent.Text.Contains("RDI") && !textcurrent.Text.Contains("AIS"))
                                {
                                    richTextEnd.AppendText("VCG接口告警：NOK。存在RDI告警" + "\r\n");
                                }
                                if (textcurrent.Text.Contains("REI") && !textcurrent.Text.Contains("AIS"))
                                {
                                    richTextEnd.AppendText("VCG接口告警：NOK。存在REI告警" + "\r\n");
                                }
                                if (textcurrent.Text.Contains("add") || textcurrent.Text.Contains("err") || textcurrent.Text.Contains("dnu") && !textcurrent.Text.Contains("AIS"))
                                {
                                    richTextEnd.AppendText("VCG接口告警：NOK 。VCG状态存在add/err/dnu，请检查俩端LCAS状态是否匹配" + "\r\n");
                                }
                            }
                            else
                            {
                                richTextEnd.AppendText("VCG接口告警：OK" + "\r\n");
                            }
                            textguzhangmingling.Text = "exit";
                            butguzhangsend.PerformClick();
                            textlog.AppendText(textcurrent.Text);
                            textcurrent.Text = "";
                            butguzhangsend.PerformClick();
                            break;
                        }
                    }
                    if ((comboard.Text == "EOS-8FX") || (comboard.Text == "EOS-8FE"))
                    {
                        textguzhangmingling.Text = "interface msap-eth " + comslot.Text + "/" + comvcg.Text;
                        butguzhangsend.PerformClick();
                        textlog.AppendText("\r\n" + "/////////////////////////////MSAP-ETH接口状态信息/////////////////////////////" + "\r\n");
                        textguzhangmingling.Text = "show configuration";
                        butguzhangsend.PerformClick();
                        if (textcurrent.Text.Contains("100TX"))
                        {
                            richTextEnd.AppendText("接口模块：100M电接口，非SFP电模块" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("100FX"))
                        {
                            richTextEnd.AppendText("接口模块：100M光接口" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("1000FX"))
                        {
                            richTextEnd.AppendText("接口模块：1000M光接口" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("1000TX"))
                        {
                            richTextEnd.AppendText("接口模块：1000M电接口，非SFP电模块" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("AUTO"))
                        {
                            richTextEnd.AppendText("自协商：使能" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("100MFULL"))
                        {
                            richTextEnd.AppendText("自协商：禁止，100M全双工" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("10MFULL"))
                        {
                            richTextEnd.AppendText("自协商：禁止，10M全双工" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("1000MFULL"))
                        {
                            richTextEnd.AppendText("自协商：禁止，1000M全双工" + "\r\n");
                        }
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                        textguzhangmingling.Text = "show current";
                        butguzhangsend.PerformClick();
                        if (textcurrent.Text.Contains("up"))
                        {
                            richTextEnd.AppendText("接口Link状态：up" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("down"))
                        {
                            richTextEnd.AppendText("接口Link状态：NOK。实际是：down" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("10mFull"))
                        {
                            richTextEnd.AppendText("当前运行双工模块：10M全双工" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("10mHalf"))
                        {
                            richTextEnd.AppendText("当前运行双工模块：10M半双工" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("100mFull"))
                        {
                            richTextEnd.AppendText("当前运行双工模块：100M全双工" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("100mHalf"))
                        {
                            richTextEnd.AppendText("当前运行双工模块：100M半双工" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("1000mFull"))
                        {
                            richTextEnd.AppendText("当前运行双工模块：1000M全双工" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("1000mHalf"))
                        {
                            richTextEnd.AppendText("当前运行双工模块：1000M半双工" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("-   transparent"))
                        {
                            richTextEnd.AppendText("当前运行双工模块：不支持查询" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("no board inserted"))
                        {
                            richTextEnd.AppendText("检测到板卡未插入，请插入后再试！" + "\r\n");
                            textlog.AppendText(textcurrent.Text);
                            textcurrent.Text = "";
                            textguzhangmingling.Text = "exit";
                            butguzhangsend.PerformClick();
                            MessageBox.Show("检测到板卡未插入，请插入后再试！");
                            return;
                        }
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                        textlog.AppendText("\r\n" + "/////////////////////////////MSAP-SFP光模块信息/////////////////////////////" + "\r\n");
                        textguzhangmingling.Text = "show sfp";
                        butguzhangsend.PerformClick();
                        for (int g = 0; g <= XHCount; g++)
                        {
                            if (textcurrent.Text.Contains("Ctrl+c"))
                            {
                                butguzhangsend.PerformClick();
                            }
                            else
                            {
                                if (textcurrent.Text.Contains("LOS"))
                                {
                                    richTextEnd.AppendText("光模块收光：NOK。LOS请检查光纤" + "\r\n");
                                }
                                if (textcurrent.Text.Contains("OK"))
                                {
                                    //richTextEnd.AppendText("光模块收光：OK" + "\r\n");
                                    //MessageBox.Show(textcurrent.Text);
                                    Regex txpower = new Regex(@"Tx\s*Power:\s*([\-\d\.]+)\s*(dBm)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string TxPower = txpower.Match(textcurrent.Text).Groups[1].Value;
                                    Regex rxpower = new Regex(@"Rx\s*Power:\s*([\-\d\.]+)\s*(dBm)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string RxPower = rxpower.Match(textcurrent.Text).Groups[1].Value;
                                    Regex rate = new Regex(@"Rate:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string Rate = rate.Match(textcurrent.Text).Groups[1].Value;
                                    Regex wave = new Regex(@"Wave\s*length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string Wave = wave.Match(textcurrent.Text).Groups[1].Value;
                                    Regex supported = new Regex(@"Supported length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string Supported = supported.Match(textcurrent.Text).Groups[1].Value;
                                    //MessageBox.Show(RxPower.ToString());
                                    richTextEnd.AppendText("光模块发光：" + TxPower.ToString() + "\r\n");
                                    richTextEnd.AppendText("光模块收光：" + RxPower.ToString() + "\r\n");
                                    richTextEnd.AppendText("光模块速率：" + Rate.Replace("\r", "") + "\r\n");
                                    richTextEnd.AppendText("单双纤波长：" + Wave.Replace("\r", "") + "\r\n");
                                    richTextEnd.AppendText("光模块距离：" + Supported.Replace("\r", "") + "\r\n");
                                }
                                if (textcurrent.Text.Contains("SFP module is not inserted!"))
                                {
                                    richTextEnd.AppendText("光模块收光：NOK。光模块未插入" + "\r\n");
                                }
                                if (textcurrent.Text.Contains("NOT_SUPPORT"))
                                {
                                    richTextEnd.AppendText("光模块信息：非SFP模块或者电接口，不支持查询" + "\r\n");
                                }
                                textguzhangmingling.Text = "exit";
                                butguzhangsend.PerformClick();
                                textlog.AppendText(textcurrent.Text);
                                textcurrent.Text = "";
                                butguzhangsend.PerformClick();
                                break;
                            }
                            Thread.Sleep(XHTime);
                        }
                        //textlog.AppendText("\r\n" + "/////////////////////////////MSAP-ETH流量信息/////////////////////////////");
                        //textlog.AppendText("\r\n" + "/////////////////////////////Int方向，从客户侧来的流量/////////////////////////////");
                        //textlog.AppendText("\r\n" + "/////////////////////////////Out方向，从传输侧来的流量/////////////////////////////" + "\r\n");
                        //textguzhangmingling.Text = "show portpfm current";
                        //butguzhangsend.PerformClick();
                        //for (int g = 0; g <= 10; g++)
                        //{
                        //    if (textcurrent.Text.Contains("Current Perform Counters End"))
                        //    {
                        //        //MessageBox.Show("跳出循环");
                        //        textguzhangmingling.Text = "exit";
                        //        butguzhangsend.PerformClick();
                        //        textlog.AppendText(textcurrent.Text);
                        //        textcurrent.Text = "";
                        //        break;
                        //    }
                        //    else
                        //    {
                        //        butguzhangsend.PerformClick();
                        //    }
                        //    Thread.Sleep(XHTime);
                        //}
                    }
                    if (comboard.Text == "EOS-8FX" || comboard.Text == "EOS-8FE" || comboard.Text == "DMD-8GE")
                    {
                        textlog.AppendText("\r\n" + "/////////////////////////////VCG流量查询/////////////////////////////");
                        textlog.AppendText("\r\n" + "/////////////////////////////RX方向，从传输侧来的流量/////////////////////////////");
                        textlog.AppendText("\r\n" + "/////////////////////////////TX方向，从客户侧来的流量/////////////////////////////" + "\r\n");
                        textguzhangmingling.Text = "config msap";
                        butguzhangsend.PerformClick();
                        textguzhangmingling.Text = "rmon " + comslot.Text + " " + comvcg.Text;
                        butguzhangsend.PerformClick();
                        for (int g = 0; g <= XHCount; g++)
                        {
                            if (textcurrent.Text.Contains("Ctrl+c"))
                            {
                                butguzhangsend.PerformClick();
                            }
                            else
                            {
                                Regex r = new Regex(@"VCG[\s\S]*RX\s*Frames\s*([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                VcgRxFrames1 = r.Match(textcurrent.Text).Groups[1].Value;
                                //MessageBox.Show(RxPower.ToString());
                                //richTextEnd.AppendText("VCGRx1：" + VcgRxFrames1.ToString() + "\r\n");
                                Regex t = new Regex(@"VCG[\s\S]*TX\s*Frames\s*([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                VcgTxFrames1 = t.Match(textcurrent.Text).Groups[1].Value;
                                //MessageBox.Show(RxPower.ToString());
                                //richTextEnd.AppendText("VCGTx1：" + VcgTxFrames1.ToString() + "\r\n");
                                Regex r1 = new Regex(@"RX\s*Frames\s*([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                MacRxFrames1 = r1.Match(textcurrent.Text).Groups[1].Value;
                                //MessageBox.Show(RxPower.ToString());
                                //richTextEnd.AppendText("MacRx1：" + MacRxFrames1.ToString() + "\r\n");
                                Regex t1 = new Regex(@"TX\s*Frames\s*([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                MacTxFrames1 = t1.Match(textcurrent.Text).Groups[1].Value;
                                //MessageBox.Show(RxPower.ToString());
                                //richTextEnd.AppendText("MacTx1：" + MacTxFrames1.ToString() + "\r\n");
                                //MessageBox.Show("跳出循环");
                                textguzhangmingling.Text = "exit";
                                butguzhangsend.PerformClick();
                                textlog.AppendText(textcurrent.Text);
                                textcurrent.Text = "";
                                break;
                            }
                            Thread.Sleep(XHTime);
                        }
                        textcurrent.AppendText("\r\n" + "///////////////////////请等待中，统计第二次流量查询///////////////////////");
                        Thread.Sleep(XHTime);
                        textlog.AppendText("\r\n" + "/////////////////////////////VCG流量查询/////////////////////////////");
                        textlog.AppendText("\r\n" + "/////////////////////////////RX方向，从传输侧来的流量/////////////////////////////");
                        textlog.AppendText("\r\n" + "/////////////////////////////TX方向，从客户侧来的流量/////////////////////////////" + "\r\n");
                        textguzhangmingling.Text = "config msap";
                        butguzhangsend.PerformClick();
                        textguzhangmingling.Text = "rmon " + comslot.Text + " " + comvcg.Text;
                        butguzhangsend.PerformClick();
                        for (int g = 0; g <= XHCount; g++)
                        {
                            if (textcurrent.Text.Contains("Ctrl+c"))
                            {
                                butguzhangsend.PerformClick();
                            }
                            else
                            {
                                Regex r = new Regex(@"VCG[\s\S]*RX\s*Frames\s*([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                VcgRxFrames2 = r.Match(textcurrent.Text).Groups[1].Value;
                                //MessageBox.Show(RxPower.ToString());
                                //richTextEnd.AppendText("Rx2：" + VcgRxFrames2.ToString() + "\r\n");
                                Regex t = new Regex(@"VCG[\s\S]*TX\s*Frames\s*([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                VcgTxFrames2 = t.Match(textcurrent.Text).Groups[1].Value;
                                //MessageBox.Show(RxPower.ToString());
                                //richTextEnd.AppendText("Tx2：" + VcgTxFrames2.ToString() + "\r\n");
                                Regex r1 = new Regex(@"RX\s*Frames\s*([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                MacRxFrames2 = r1.Match(textcurrent.Text).Groups[1].Value;
                                //MessageBox.Show(RxPower.ToString());
                                //richTextEnd.AppendText("MacRx1：" + MacRxFrames2.ToString() + "\r\n");
                                Regex t1 = new Regex(@"TX\s*Frames\s*([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                MacTxFrames2 = t1.Match(textcurrent.Text).Groups[1].Value;
                                //MessageBox.Show(RxPower.ToString());
                                //richTextEnd.AppendText("MacTx1：" + MacTxFrames2.ToString() + "\r\n");
                                if (VcgRxFrames1 == VcgRxFrames2)
                                {
                                    richTextEnd.AppendText("VCG接口Rx流量：NOK。传输侧无流量" + "\r\n");
                                }
                                else
                                {
                                    richTextEnd.AppendText("VCG接口Rx流量：OK。传输侧流量正常" + "\r\n");
                                }
                                if (VcgTxFrames1 == VcgTxFrames2)
                                {
                                    richTextEnd.AppendText("VCG接口Tx流量：NOK。客户侧无流量" + "\r\n");
                                }
                                else
                                {
                                    richTextEnd.AppendText("VCG接口Tx流量：OK。客户侧流量正常" + "\r\n");
                                }
                                if (MacRxFrames1 == MacRxFrames2)
                                {
                                    richTextEnd.AppendText("Mac接口Rx流量：NOK。客户侧无流量" + "\r\n");
                                }
                                else
                                {
                                    richTextEnd.AppendText("Mac接口Rx流量：OK。客户侧流量正常" + "\r\n");
                                }
                                if (MacTxFrames1 == MacTxFrames2)
                                {
                                    richTextEnd.AppendText("Mac接口Tx流量：NOK。传输侧无流量" + "\r\n");
                                }
                                else
                                {
                                    richTextEnd.AppendText("Mac接口Tx流量：OK。传输侧流量正常" + "\r\n");
                                }
                                //MessageBox.Show("跳出循环");
                                textguzhangmingling.Text = "exit";
                                butguzhangsend.PerformClick();
                                textlog.AppendText(textcurrent.Text);
                                textcurrent.Text = "";
                                break;
                            }
                            Thread.Sleep(XHTime);
                        }
                    }
                    if (comboard.Text == "EOS-8FX" || comboard.Text == "EOS-8FE" || comboard.Text == "EOS/P-126")
                    {
                        textlog.AppendText("\r\n" + "/////////////////////////////VCG错包查询/////////////////////////////");
                        textguzhangmingling.Text = "grosadvdebug";
                        butguzhangsend.PerformClick();
                        textguzhangmingling.Text = "debug command enable";
                        butguzhangsend.PerformClick();
                        textguzhangmingling.Text = "exit";
                        butguzhangsend.PerformClick();
                        textguzhangmingling.Text = "config msap";
                        butguzhangsend.PerformClick();
                        if (comboard.Text == "EOS-8FX")
                        {
                            textlog.AppendText("\r\n" + "/////////////////////////////TX有计数增加，说明客户侧EOS8FX到1501S光路质量不好///////");
                            textlog.AppendText("\r\n" + "/////////////////////////////RX有计数增加，说明传输侧有误码或者VCG接口扰码不对应/////");
                            textguzhangmingling.Text = "eos8 vcg autofiforeset show " + comslot.Text;
                            butguzhangsend.PerformClick();
                        }
                        if (comboard.Text == "EOS-8FE")
                        {
                            textlog.AppendText("\r\n" + "/////////////////////////////TX有计数增加，说明客户侧EOS8FX到1501S光路质量不好///////");
                            textlog.AppendText("\r\n" + "/////////////////////////////RX有计数增加，说明传输侧有误码或者VCG接口扰码不对应/////");
                            textguzhangmingling.Text = "eos_8fe vcg autofiforeset show " + comslot.Text;
                            butguzhangsend.PerformClick();
                        }
                        if (comboard.Text == "EOS/P-126")
                        {
                            textlog.AppendText("\r\n" + "/////////////////////////////SDH到MAC方向，RX，从传输侧过来的流量/////////////////////");
                            textlog.AppendText("\r\n" + "/////////////////////////////MAC到SDH方向，RX，从客户侧过来的流量/////////////////////");
                            textguzhangmingling.Text = "eops126 gfprmon " + comslot.Text + " " + comvcg.Text + " sdram";
                            butguzhangsend.PerformClick();
                            Thread.Sleep(XHTime);
                            textlog.AppendText(textcurrent.Text);
                            textcurrent.Text = "";
                            textguzhangmingling.Text = "eops126 gfprmon " + comslot.Text + " " + comvcg.Text + " sdram";
                            butguzhangsend.PerformClick();
                            Thread.Sleep(XHTime);
                            textlog.AppendText(textcurrent.Text);
                            textcurrent.Text = "";
                            textguzhangmingling.Text = "eops126 gfprmon " + comslot.Text + " " + comvcg.Text + " sdram";
                            butguzhangsend.PerformClick();
                            Regex r = new Regex(@"MAC->SDH[\s\S]*Rx[\.]TotalFrames\s*=\s*[\[]([\[\d]+)[\]]*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            EthInFrames1 = r.Match(textcurrent.Text).Groups[1].Value;
                            //MessageBox.Show(RxPower.ToString());
                            //richTextEnd.AppendText("MAC->SDH.Rx流量：" + EthInFrames1.ToString() + "\r\n");
                            Regex t = new Regex(@"Rx[\.]TotalFrames\s*=\s*[\[]([\[\d]+)[\]]*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            VcgRxFrames1 = t.Match(textcurrent.Text).Groups[1].Value;
                            //MessageBox.Show(RxPower.ToString());
                            //richTextEnd.AppendText("SDH->MAC.Rx流量：" + VcgRxFrames1.ToString() + "\r\n");
                            Regex v = new Regex(@"Rx[\.]VlanMismatchDrop\s*=\s*[\[]([\[\d]+)[\]]*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            Eos126vlanmismatchDropRx1 = v.Match(textcurrent.Text).Groups[1].Value;
                            //MessageBox.Show(RxPower.ToString());
                            //richTextEnd.AppendText("SDH->MAC.Rx vlan不匹配，丢包数量：" + Eos126vlanmismatchDropRx1.ToString() + "\r\n");
                            //MessageBox.Show("跳出循环");
                            textlog.AppendText(textcurrent.Text);
                            textcurrent.Text = "";
                            textcurrent.AppendText("\r\n" + "///////////////////////请等待5秒，统计第二次流量查询///////////////////////");
                            Thread.Sleep(5000);
                            textguzhangmingling.Text = "eops126 gfprmon " + comslot.Text + " " + comvcg.Text + " sdram";
                            butguzhangsend.PerformClick();
                            Regex r1 = new Regex(@"MAC->SDH[\s\S]*Rx[\.]TotalFrames\s*=\s*[\[]([\[\d]+)[\]]*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            EthInFrames2 = r1.Match(textcurrent.Text).Groups[1].Value;
                            //MessageBox.Show(RxPower.ToString());
                            //richTextEnd.AppendText("MAC->SDH.Rx流量：" + EthInFrames2.ToString() + "\r\n");
                            Regex t1 = new Regex(@"Rx[\.]TotalFrames\s*=\s*[\[]([\[\d]+)[\]]*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            VcgRxFrames2 = t1.Match(textcurrent.Text).Groups[1].Value;
                            //MessageBox.Show(RxPower.ToString());
                            //richTextEnd.AppendText("SDH->MAC.Rx流量：" + VcgRxFrames2.ToString() + "\r\n");
                            Regex v1 = new Regex(@"Rx[\.]VlanMismatchDrop\s*=\s*[\[]([\[\d]+)[\]]*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            Eos126vlanmismatchDropRx2 = v1.Match(textcurrent.Text).Groups[1].Value;
                            //MessageBox.Show(RxPower.ToString());
                            //richTextEnd.AppendText("SDH->MAC.Rx vlan不匹配，丢包数量：" + Eos126vlanmismatchDropRx2.ToString() + "\r\n");
                            //MessageBox.Show("跳出循环");
                            if (EthInFrames1 == EthInFrames2)
                            {
                                richTextEnd.AppendText("交换Rx流量：NOK。客户侧无流量,检查4GE-BVLAN或AC流量配置是否OK" + "\r\n");
                            }
                            else
                            {
                                richTextEnd.AppendText("交换Rx流量：OK。客户侧流量正常" + "\r\n");
                            }
                            if (VcgRxFrames1 == VcgRxFrames2)
                            {
                                richTextEnd.AppendText("VCGRx流量：NOK。传输侧无流量，检查VCG接口告警，上联接口时隙告警，传输设备是否正常" + "\r\n");
                            }
                            else
                            {
                                richTextEnd.AppendText("VCGRx流量：OK。传输侧流量正常" + "\r\n");
                            }
                            if (Eos126vlanmismatchDropRx1 == Eos126vlanmismatchDropRx2)
                            {
                                //richTextEnd.AppendText("VCGVlan配置：OK。传输侧流量正常" + "\r\n");
                            }
                            else
                            {
                                richTextEnd.AppendText("VCGVlan配置：NOK。VCG接口VLAN丢包数量：" + Eos126vlanmismatchDropRx2 + "。SDH传输对端MSAP设备配置VLAN与我司VCG接口VLAN ID和模式必须匹配" + "\r\n");
                            }
                            textguzhangmingling.Text = "exit";
                            butguzhangsend.PerformClick();
                            textlog.AppendText(textcurrent.Text);
                            textcurrent.Text = "";
                        }
                    }
                    textlog.AppendText("\r\n" + "/////////////////////////////SDH上联口告警查询/////////////////////////////");
                    textlog.AppendText("\r\n" + "/////////////////////////////告警优先看最左侧的，因为告警级别最高//////////");
                    textlog.AppendText("\r\n" + "/////////////////////////////LOS，接口没有收光/////////////////////////////");
                    textlog.AppendText("\r\n" + "/////////////////////////////LOF，光模块不匹配，端口速率不匹配/////////////");
                    textlog.AppendText("\r\n" + "/////////////////////////////AIS, 传输故障，业务未配置/////////////////////");
                    textlog.AppendText("\r\n" + "/////////////////////////////RDI，对端EOS的VCG接收有AIS告警////////////////");
                    textlog.AppendText("\r\n" + "/////////////////////////////REI，对接EOS的VCG接收有误码///////////////////" + "\r\n");
                    textguzhangmingling.Text = "config msap";
                    butguzhangsend.PerformClick();
                    textguzhangmingling.Text = "ioctl soh show " + SDH.ToString();
                    butguzhangsend.PerformClick();
                    if (textcurrent.Text.Contains("LOS") || textcurrent.Text.Contains("LOF") || textcurrent.Text.Contains("AIS") || textcurrent.Text.Contains("PLM") || textcurrent.Text.Contains("REI") || textcurrent.Text.Contains("RDI") || textcurrent.Text.Contains("add") || textcurrent.Text.Contains("err") || textcurrent.Text.Contains("dnu"))
                    {
                        if (textcurrent.Text.Contains("AIS"))
                        {
                            richTextEnd.AppendText(SDH.ToString() + "上联接口告警：NOK。存在AIS告警，检查上联口的对端和落地MSAP的EOS接口是否配置业务" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("PLM") && !textcurrent.Text.Contains("AIS"))
                        {
                            richTextEnd.AppendText(SDH.ToString() + "上联接口告警：NOK。存在PLM告警" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("RDI") && !textcurrent.Text.Contains("AIS"))
                        {
                            richTextEnd.AppendText(SDH.ToString() + "上联接口告警：NOK。存在RDI告警" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("REI") && !textcurrent.Text.Contains("AIS"))
                        {
                            richTextEnd.AppendText(SDH.ToString() + "上联接口告警：NOK。存在REI告警" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("LOS"))
                        {
                            richTextEnd.AppendText(SDH.ToString() + "上联接口告警：NOK。存在LOS告警，检查光纤与光模块" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("LOF") && !textcurrent.Text.Contains("LOS"))
                        {
                            richTextEnd.AppendText(SDH.ToString() + "上联接口告警：NOK。存在LOF告警，请检查SDH接口速率模式，光模块速率即可" + "\r\n");
                        }
                    }
                    else
                    {
                        richTextEnd.AppendText(SDH.ToString() + "上联接口告警：OK" + "\r\n");
                    }
                    textlog.AppendText(textcurrent.Text);
                    textcurrent.Text = "";
                    if (Tsvc12 != "")
                    {
                        textguzhangmingling.Text = "ioctl lpoh show " + Tsvc12.ToString();
                        butguzhangsend.PerformClick();
                        if (textcurrent.Text.Contains("LOS") || textcurrent.Text.Contains("LOF") || textcurrent.Text.Contains("AIS") || textcurrent.Text.Contains("PLM") || textcurrent.Text.Contains("REI") || textcurrent.Text.Contains("RDI") || textcurrent.Text.Contains("add") || textcurrent.Text.Contains("err") || textcurrent.Text.Contains("dnu"))
                        {
                            if (textcurrent.Text.Contains("AIS"))
                            {
                                richTextEnd.AppendText(Tsvc12.ToString() + "上联时隙告警：NOK。存在AIS告警，检查上联口的对端和落地MSAP的EOS接口是否配置业务" + "\r\n");
                            }
                            if (textcurrent.Text.Contains("PLM") && !textcurrent.Text.Contains("AIS"))
                            {
                                richTextEnd.AppendText(Tsvc12.ToString() + "上联时隙告警：NOK。存在PLM告警" + "\r\n");
                            }
                            if (textcurrent.Text.Contains("RDI") && !textcurrent.Text.Contains("AIS"))
                            {
                                richTextEnd.AppendText(Tsvc12.ToString() + "上联时隙告警：NOK。存在RDI告警" + "\r\n");
                            }
                            if (textcurrent.Text.Contains("REI") && !textcurrent.Text.Contains("AIS"))
                            {
                                richTextEnd.AppendText(Tsvc12.ToString() + "上联时隙告警：NOK。存在REI告警" + "\r\n");
                            }
                            if (textcurrent.Text.Contains("LOS") && !textcurrent.Text.Contains("AIS"))
                            {
                                richTextEnd.AppendText(Tsvc12.ToString() + "上联时隙告警：NOK。存在LOS告警，检查光纤与光模块" + "\r\n");
                            }
                            if (textcurrent.Text.Contains("LOF") && !textcurrent.Text.Contains("AIS"))
                            {
                                richTextEnd.AppendText(Tsvc12.ToString() + "上联时隙告警：NOK。存在LOF告警，检查光模块速率与SDH接口速率是否与对端一致" + "\r\n");
                            }
                        }
                        else
                        {
                            richTextEnd.AppendText(Tsvc12.ToString() + "上联时隙告警：OK" + "\r\n");
                        }
                    }
                    if (Tsvc4 != "")
                    {
                        textguzhangmingling.Text = "ioctl hpoh show " + Tsvc4.ToString();
                        butguzhangsend.PerformClick();
                        if (textcurrent.Text.Contains("LOS") || textcurrent.Text.Contains("LOF") || textcurrent.Text.Contains("AIS") || textcurrent.Text.Contains("PLM") || textcurrent.Text.Contains("REI") || textcurrent.Text.Contains("LOP") || textcurrent.Text.Contains("RDI") || textcurrent.Text.Contains("add") || textcurrent.Text.Contains("err") || textcurrent.Text.Contains("dnu"))
                        {
                            if (textcurrent.Text.Contains("AIS"))
                            {
                                richTextEnd.AppendText(Tsvc4.ToString() + "上联时隙告警：NOK。存在AIS告警，检查上联口的对端和落地MSAP的EOS接口是否配置业务" + "\r\n");
                            }
                            if (textcurrent.Text.Contains("LOP"))
                            {
                                richTextEnd.AppendText(Tsvc4.ToString() + "上联时隙告警：NOK。存在LOP告警，检查上联口的对端和落地MSAP的EOS接口是否配置业务" + "\r\n");
                            }
                            if (textcurrent.Text.Contains("PLM") && !textcurrent.Text.Contains("AIS"))
                            {
                                richTextEnd.AppendText(Tsvc4.ToString() + "上联时隙告警：NOK。存在PLM告警" + "\r\n");
                            }
                            if (textcurrent.Text.Contains("RDI") && !textcurrent.Text.Contains("AIS"))
                            {
                                richTextEnd.AppendText(Tsvc4.ToString() + "上联时隙告警：NOK。存在RDI告警" + "\r\n");
                            }
                            if (textcurrent.Text.Contains("REI") && !textcurrent.Text.Contains("AIS"))
                            {
                                richTextEnd.AppendText(Tsvc4.ToString() + "上联时隙告警：NOK。存在REI告警" + "\r\n");
                            }
                            if (textcurrent.Text.Contains("LOS") && !textcurrent.Text.Contains("AIS"))
                            {
                                richTextEnd.AppendText(Tsvc4.ToString() + "上联时隙告警：NOK。存在LOS告警" + "\r\n");
                            }
                            if (textcurrent.Text.Contains("LOF") && !textcurrent.Text.Contains("AIS"))
                            {
                                richTextEnd.AppendText(Tsvc4.ToString() + "上联时隙告警：NOK。存在LOF告警，检查光模块速率与SDH接口速率是否与对端一致" + "\r\n");
                            }
                        }
                        else
                        {
                            richTextEnd.AppendText(Tsvc4.ToString() + "上联时隙告警：OK" + "\r\n");
                        }
                    }
                    textlog.AppendText("\r\n" + "/////////////////////////////上行SDH接口SFP光模块信息/////////////////////////////" + "\r\n");
                    string[] SDHSFP = SDH.Split('/');
                    string SDHslot = SDHSFP[0];
                    string SDHport = SDHSFP[1];
                    textguzhangmingling.Text = "ioctl sfp show " + SDHslot + " " + SDHport;
                    butguzhangsend.PerformClick();
                    for (int g = 0; g <= XHCount; g++)
                    {
                        if (textcurrent.Text.Contains("Ctrl+c"))
                        {
                            butguzhangsend.PerformClick();
                        }
                        else
                        {
                            if (textcurrent.Text.Contains("LOS"))
                            {
                                richTextEnd.AppendText(SDH.ToString() + "上联接口光模块收光：NOK。LOS请检查光纤" + "\r\n");
                            }
                            if (textcurrent.Text.Contains("OK"))
                            {
                                //richTextEnd.AppendText("光模块收光：OK" + "\r\n");
                                //MessageBox.Show(textcurrent.Text);
                                Regex txpower = new Regex(@"Tx\s*Power:\s*([\-\d\.]+)\s*(dBm)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                string TxPower = txpower.Match(textcurrent.Text).Groups[1].Value;
                                Regex rxpower = new Regex(@"Rx\s*Power:\s*([\-\d\.]+)\s*(dBm)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                string RxPower = rxpower.Match(textcurrent.Text).Groups[1].Value;
                                Regex rate = new Regex(@"Rate:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                string Rate = rate.Match(textcurrent.Text).Groups[1].Value;
                                Regex wave = new Regex(@"Wave\s*length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                string Wave = wave.Match(textcurrent.Text).Groups[1].Value;
                                Regex supported = new Regex(@"Supported length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                string Supported = supported.Match(textcurrent.Text).Groups[1].Value;
                                //MessageBox.Show(RxPower.ToString());
                                richTextEnd.AppendText(SDH.ToString() + "上联接口光模块发光：" + TxPower.ToString() + "\r\n");
                                richTextEnd.AppendText(SDH.ToString() + "上联接口光模块收光：" + RxPower.ToString() + "\r\n");
                                richTextEnd.AppendText(SDH.ToString() + "上联接口光模块速率：" + Rate.Replace("\r", "") + "\r\n");
                                richTextEnd.AppendText(SDH.ToString() + "上联接口单双纤波长：" + Wave.Replace("\r", "") + "\r\n");
                                richTextEnd.AppendText(SDH.ToString() + "上联接口光模块距离：" + Supported.Replace("\r", "") + "\r\n");
                            }
                            if (textcurrent.Text.Contains("SFP module is not inserted!"))
                            {
                                richTextEnd.AppendText(SDH.ToString() + "上联接口光模块收光：NOK。光模块未插入" + "\r\n");
                            }
                            if (textcurrent.Text.Contains("NOT_SUPPORT"))
                            {
                                richTextEnd.AppendText(SDH.ToString() + "上联接口光模块信息：非SFP模块或者电接口，不支持查询" + "\r\n");
                            }
                            if (textcurrent.Text.Contains("Board not inserted!"))
                            {
                                richTextEnd.AppendText(SDH.ToString() + "上联接口光模块收光：NOK。板卡未插入" + "\r\n");
                            }
                            textguzhangmingling.Text = "exit";
                            butguzhangsend.PerformClick();
                            textlog.AppendText(textcurrent.Text);
                            textcurrent.Text = "";
                            break;
                        }
                        Thread.Sleep(XHTime);
                    }
                    textlog.AppendText(textcurrent.Text);
                    textcurrent.Text = "";
                    if (comboard.Text == "DMD-8GE")
                    {
                        textlog.AppendText("\r\n" + "/////////////////////////////VCG驱动信息查询/////////////////////////////" + "\r\n");
                        textguzhangmingling.Text = "config msap";
                        butguzhangsend.PerformClick();
                        Thread.Sleep(XHTime);
                        textguzhangmingling.Text = "ioctl vcg info " + comslot.Text + " " + comvcg.Text;
                        butguzhangsend.PerformClick();
                        //MessageBox.Show("跳出循环");
                        for (int g = 0; g <= XHCount; g++)
                        {
                            if (textcurrent.Text.Contains("Ctrl+c"))
                            {
                                butguzhangsend.PerformClick();
                            }
                            else
                            {
                                Thread.Sleep(XHTime);
                                string[] VCGINFOFengGe = textcurrent.Text.Split(new string[] { "\r\n" }, StringSplitOptions.None);
                                string VCGinfo = VCGINFOFengGe[4];
                                textlog.AppendText(VCGinfo.ToString() + "\r\n");
                                VCGINFOFengGe = Regex.Split(VCGinfo, "\\s+", RegexOptions.IgnoreCase);
                                string MemberSum = VCGINFOFengGe[4];
                                string Protocol = VCGINFOFengGe[5];
                                string UNI = VCGINFOFengGe[7];
                                string L1MUX = VCGINFOFengGe[8];
                                string VLAN = VCGINFOFengGe[9];
                                string MPLS = VCGINFOFengGe[10];
                                string vlanacTxmode = VCGINFOFengGe[11];
                                string txVid = VCGINFOFengGe[12];
                                string vlanacRxmode = VCGINFOFengGe[14];
                                string rxVid = VCGINFOFengGe[15];
                                richTextEnd.AppendText("VCG绑定通道：" + MemberSum.ToString() + "\r\n");
                                richTextEnd.AppendText("VCG封装协议：" + Protocol.ToString() + "\r\n");
                                richTextEnd.AppendText("VCG绑定ETH接口：" + UNI.ToString() + "\r\n");
                                richTextEnd.AppendText("VCG接口模式：" + L1MUX.ToString() + "\r\n");
                                richTextEnd.AppendText("VCG匹配vlan号：" + VLAN.ToString() + "\r\n");
                                richTextEnd.AppendText("VCG匹配mpls标签：" + MPLS.ToString() + "\r\n");
                                richTextEnd.AppendText("VCG发送vlan动作：" + vlanacTxmode.ToString() + "\r\n");
                                richTextEnd.AppendText("VCG发送vlan号：" + txVid.ToString() + "\r\n");
                                richTextEnd.AppendText("VCG接收vlan动作：" + vlanacRxmode.ToString() + "\r\n");
                                richTextEnd.AppendText("VCG接收vlan号：" + rxVid.ToString() + "\r\n");
                                //MessageBox.Show("跳出循环");
                                Thread.Sleep(XHTime);
                                textguzhangmingling.Text = "exit";
                                butguzhangsend.PerformClick();
                                textlog.AppendText(textcurrent.Text);
                                textcurrent.Text = "";
                                break;

                            }
                            Thread.Sleep(XHTime);
                        }
                    }
                    if (comboard.Text == "DMD-8GE")
                    {
                        textlog.AppendText("\r\n" + "/////////////////////////////以太口流量信息查询////////////////////////////" + "\r\n");
                        textlog.AppendText("\r\n" + "/////////////////////////////Int，从客户侧过来的流量///////////////////////" + "\r\n");
                        textlog.AppendText("\r\n" + "/////////////////////////////Out, 从传输侧过来的流量///////////////////////" + "\r\n");
                        textguzhangmingling.Text = "interface ethernet " + comethslot.Text + "/" + cometh.Text;
                        butguzhangsend.PerformClick();
                        textlog.AppendText("\r\n" + "//////进入ETH接口" + "interface ethernet " + comethslot.Text + "/" + cometh.Text + "\r\n");
                        textguzhangmingling.Text = "show configuration";
                        butguzhangsend.PerformClick();
                        if (textcurrent.Text.Contains("Physical status is down"))
                        {
                            richTextEnd.AppendText("接口Link状态：NOK。实际是：down" + "\r\n");
                        }
                        else
                        {
                            richTextEnd.AppendText("接口Link状态：up" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("administrator status is down"))
                        {
                            richTextEnd.AppendText("接口管理状态：NOK。实际是：down，可能人为配置了shutdown,请进入所在接口undo shutdown 使能接口" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("AutoNegotiation enabled"))
                        {
                            richTextEnd.AppendText("自协商：使能" + "\r\n");
                        }
                        else
                        {
                            richTextEnd.AppendText("自协商：禁止" + "\r\n");
                        }
                        if (textcurrent.Text.Contains("Duplex full"))
                        {
                            richTextEnd.AppendText("双工模式：全双工" + "\r\n");
                        }
                        else
                        {
                            richTextEnd.AppendText("双工模式：NOK。实际是：半双工" + "\r\n");
                        }
                        Regex speed0 = new Regex(@"current\s*speed\s*([\d\w\s]+)(,)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string Speed = speed0.Match(textcurrent.Text).Groups[1].Value;
                        richTextEnd.AppendText("当前速率：" + Speed + "\r\n");
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                        textlog.AppendText("\r\n" + "/////////////////////////////MSAP-SFP光模块信息/////////////////////////////" + "\r\n");
                        textguzhangmingling.Text = "show sfp";
                        butguzhangsend.PerformClick();
                        for (int g = 0; g <= XHCount; g++)
                        {
                            if (textcurrent.Text.Contains("Ctrl+c"))
                            {
                                butguzhangsend.PerformClick();
                            }
                            else
                            {
                                if (textcurrent.Text.Contains("LOS"))
                                {
                                    richTextEnd.AppendText("光模块收光：NOK。LOS请检查光纤" + "\r\n");
                                }
                                if (textcurrent.Text.Contains("OK"))
                                {
                                    //richTextEnd.AppendText("光模块收光：OK" + "\r\n");
                                    //MessageBox.Show(textcurrent.Text);
                                    Regex txpower = new Regex(@"Tx\s*Power:\s*([\-\d\.]+)\s*(dBm)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string TxPower = txpower.Match(textcurrent.Text).Groups[1].Value;
                                    Regex rxpower = new Regex(@"Rx\s*Power:\s*([\-\d\.]+)\s*(dBm)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string RxPower = rxpower.Match(textcurrent.Text).Groups[1].Value;
                                    Regex rate = new Regex(@"Rate:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string Rate = rate.Match(textcurrent.Text).Groups[1].Value;
                                    Regex wave = new Regex(@"Wave\s*length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string Wave = wave.Match(textcurrent.Text).Groups[1].Value;
                                    Regex supported = new Regex(@"Supported length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                    string Supported = supported.Match(textcurrent.Text).Groups[1].Value;
                                    //MessageBox.Show(RxPower.ToString());
                                    richTextEnd.AppendText("光模块发光：" + TxPower.ToString() + "\r\n");
                                    richTextEnd.AppendText("光模块收光：" + RxPower.ToString() + "\r\n");
                                    richTextEnd.AppendText("光模块速率：" + Rate.Replace("\r", "") + "\r\n");
                                    richTextEnd.AppendText("单双纤波长：" + Wave.Replace("\r", "") + "\r\n");
                                    richTextEnd.AppendText("光模块距离：" + Supported.Replace("\r", "") + "\r\n");
                                }
                                if (textcurrent.Text.Contains("SFP module is not inserted!"))
                                {
                                    richTextEnd.AppendText("光模块收光：NOK。光模块未插入" + "\r\n");
                                }
                                textlog.AppendText(textcurrent.Text);
                                textcurrent.Text = "";
                                butguzhangsend.PerformClick();
                                break;
                            }
                            Thread.Sleep(XHTime);
                        }
                        textguzhangmingling.Text = "show statistics";
                        butguzhangsend.PerformClick();
                        for (int g = 0; g <= XHCount; g++)
                        {
                            if (textcurrent.Text.Contains("Ctrl+c"))
                            {
                                butguzhangsend.PerformClick();
                            }
                            else
                            {
                                Regex InRate = new Regex(@"In Rate\(Last\s*\d*Sec\):([\d]+)\s*(kbps)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                string InRate1 = InRate.Match(textcurrent.Text).Groups[1].Value;
                                double InRatekbps = double.Parse(InRate1);
                                double InRateMbps = Math.Round(InRatekbps / 1000, 2);
                                if (InRateMbps == 0)
                                {
                                    richTextEnd.AppendText("ETH接口I n带宽：NOK。客户侧实际带宽：" + InRateMbps.ToString() + "Mbps\r\n");
                                }
                                else
                                {
                                    richTextEnd.AppendText("ETH接口I n带宽：" + InRateMbps.ToString() + "Mbps\r\n");
                                }
                                Regex OutRate = new Regex(@"Out Rate\(Last\s*\d*Sec\):([\d]+)\s*(kbps)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                string OutRate1 = OutRate.Match(textcurrent.Text).Groups[1].Value;
                                double OutRatekbps = double.Parse(OutRate1);
                                double OutRateMbps = Math.Round(OutRatekbps / 1000, 2);
                                if (OutRateMbps == 0)
                                {
                                    richTextEnd.AppendText("ETH接口Out带宽：NOK。传输侧实际带宽：" + OutRateMbps.ToString() + "Mbps\r\n");
                                }
                                else
                                {
                                    richTextEnd.AppendText("ETH接口Out带宽：" + OutRateMbps.ToString() + "Mbps\r\n");
                                }
                                Regex r = new Regex(@"In\s*Unicast\s*Pkts\s*:([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                EthInFrames1 = r.Match(textcurrent.Text).Groups[1].Value;
                                //MessageBox.Show(RxPower.ToString());
                                //richTextEnd.AppendText("Rx1：" + RxFrames1.ToString() + "\r\n");
                                Regex t = new Regex(@"Out\s*Unicast\s*Pkts\s*:([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                EthOutFrames1 = t.Match(textcurrent.Text).Groups[1].Value;
                                //richTextEnd.AppendText("Tx1：" + TxFrames1.ToString() + "\r\n");
                                Regex ind = new Regex(@"In\s*Discard\s*Frames\s*:([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                EthInDiscardFrames1 = ind.Match(textcurrent.Text).Groups[1].Value;
                                Regex outd = new Regex(@"Out\s*Discard\s*Frames\s*:([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                EthOutDiscardFrames1 = outd.Match(textcurrent.Text).Groups[1].Value;
                                Regex inc = new Regex(@"In\s*CRC\s*Error\s*Pkts\s*:([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                EthInCrcErrorPkts1 = inc.Match(textcurrent.Text).Groups[1].Value;
                                Regex outc = new Regex(@"Out\s*CRC\s*Error\s*Pkts\s*:([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                EthOutCrcErrorPkts1 = outc.Match(textcurrent.Text).Groups[1].Value;
                                Regex Sec = new Regex(@"Last\s*([\d]+)(Sec)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                string LastSec = Sec.Match(textcurrent.Text).Groups[1].Value;
                                Debug.WriteLine(LastSec);
                                textguzhangmingling.Text = "exit";
                                butguzhangsend.PerformClick();
                                textlog.AppendText(textcurrent.Text);
                                textcurrent.Text = "";
                                int LastSec2 = (int.Parse(LastSec) + 5) * 1000;
                                textcurrent.AppendText("\r\n" + "///////////////////////请等待" + LastSec2 + "毫秒，统计第二次流量查询///////////////////////");
                                Thread.Sleep(LastSec2);
                                break;
                            }
                            Thread.Sleep(XHTime);
                        }
                    }
                    if (comboard.Text == "DMD-8GE")
                    {
                        textlog.AppendText("\r\n" + "/////////////////////////////以太口流量信息查询////////////////////////////" + "\r\n");
                        textlog.AppendText("\r\n" + "/////////////////////////////Int，从客户侧过来的流量///////////////////////" + "\r\n");
                        textlog.AppendText("\r\n" + "/////////////////////////////Out, 从传输侧过来的流量///////////////////////" + "\r\n");
                        textguzhangmingling.Text = "interface ethernet " + comethslot.Text + "/" + cometh.Text;
                        butguzhangsend.PerformClick();
                        textguzhangmingling.Text = "show configuration";
                        butguzhangsend.PerformClick();
                        textguzhangmingling.Text = "show statistics";
                        butguzhangsend.PerformClick();
                        for (int g = 0; g <= XHCount; g++)
                        {
                            if (textcurrent.Text.Contains("Ctrl+c"))
                            {
                                butguzhangsend.PerformClick();
                            }
                            else
                            {
                                Regex r = new Regex(@"In\s*Unicast\s*Pkts\s*:([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                EthInFrames2 = r.Match(textcurrent.Text).Groups[1].Value;
                                //MessageBox.Show(RxPower.ToString());
                                //richTextEnd.AppendText("Rx2：" + RxFrames2.ToString() + "\r\n");
                                Regex t = new Regex(@"Out\s*Unicast\s*Pkts\s*:([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                EthOutFrames2 = t.Match(textcurrent.Text).Groups[1].Value;
                                //richTextEnd.AppendText("Tx2：" + TxFrames2.ToString() + "\r\n");
                                if (EthInFrames1 == EthInFrames2)
                                {
                                    richTextEnd.AppendText("ETH接口I n流量：NOK。客户侧无单播流量" + "\r\n");
                                }
                                else
                                {
                                    richTextEnd.AppendText("ETH接口I n流量：OK。客户侧流量正常" + "\r\n");
                                }
                                if (EthOutFrames1 == EthOutFrames2)
                                {
                                    richTextEnd.AppendText("ETH接口Out流量：NOK。传输侧无单播流量" + "\r\n");
                                }
                                else
                                {
                                    richTextEnd.AppendText("ETH接口Out流量：OK。传输侧流量正常" + "\r\n");
                                }
                                Regex ind = new Regex(@"In\s*Discard\s*Frames\s*:([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                EthInDiscardFrames2 = ind.Match(textcurrent.Text).Groups[1].Value;
                                Regex outd = new Regex(@"Out\s*Discard\s*Frames\s*:([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                EthOutDiscardFrames2 = outd.Match(textcurrent.Text).Groups[1].Value;
                                Regex inc = new Regex(@"In\s*CRC\s*Error\s*Pkts\s*:([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                EthInCrcErrorPkts2 = inc.Match(textcurrent.Text).Groups[1].Value;
                                Regex outc = new Regex(@"Out\s*CRC\s*Error\s*Pkts\s*:([\d\,\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                EthOutCrcErrorPkts2 = outc.Match(textcurrent.Text).Groups[1].Value;
                                Int64 EthInDiscardFrames01 = Int64.Parse(EthInDiscardFrames1);
                                Int64 EthOutDiscardFrames01 = Int64.Parse(EthOutDiscardFrames1);
                                Int64 EthInDiscardFrames02 = Int64.Parse(EthInDiscardFrames2);
                                Int64 EthOutDiscardFrames02 = Int64.Parse(EthOutDiscardFrames2);
                                Int64 EthInCrcErrorPkts01 = Int64.Parse(EthInCrcErrorPkts1);
                                Int64 EthOutCrcErrorPkts01 = Int64.Parse(EthOutCrcErrorPkts1);
                                Int64 EthInCrcErrorPkts02 = Int64.Parse(EthInCrcErrorPkts2);
                                Int64 EthOutCrcErrorPkts02 = Int64.Parse(EthOutCrcErrorPkts2);
                                if (EthInDiscardFrames01 == EthInDiscardFrames02)
                                {
                                    richTextEnd.AppendText("ETH接口I n丢帧：OK。客户侧无丢帧" + "\r\n");
                                }
                                else
                                {
                                    Int64 InDis = EthInDiscardFrames02 - EthInDiscardFrames01;
                                    richTextEnd.AppendText("ETH接口I n丢帧：NOK。客户侧16秒累计丢帧数量：" + InDis.ToString() + "\r\n");
                                }
                                if (EthOutDiscardFrames01 == EthOutDiscardFrames02)
                                {
                                    richTextEnd.AppendText("ETH接口Out丢帧：OK。传输侧无丢帧" + "\r\n");
                                }
                                else
                                {
                                    Int64 OutDis = EthOutDiscardFrames02 - EthOutDiscardFrames01;
                                    richTextEnd.AppendText("ETH接口Out丢帧：NOK。传输侧16秒累计丢帧数量：" + OutDis.ToString() + "\r\n");
                                }
                                if (EthInCrcErrorPkts01 == EthInCrcErrorPkts02)
                                {
                                    richTextEnd.AppendText("ETH接口I n错包：OK。客户侧无CRC错包" + "\r\n");
                                }
                                else
                                {
                                    Int64 InCRC = EthInCrcErrorPkts02 - EthInCrcErrorPkts01;
                                    richTextEnd.AppendText("ETH接口I n错包：NOK。客户侧16秒累CRC错包数量：" + InCRC.ToString() + "\r\n");
                                }
                                if (EthOutCrcErrorPkts01 == EthOutCrcErrorPkts02)
                                {
                                    richTextEnd.AppendText("ETH接口Out错包：OK。传输侧无CRC错包" + "\r\n");
                                }
                                else
                                {
                                    Int64 OutCRC = EthOutCrcErrorPkts02 - EthOutCrcErrorPkts01;
                                    richTextEnd.AppendText("ETH接口Out错包：NOK。传输侧16秒累CRC错包数量：" + OutCRC.ToString() + "\r\n");
                                }
                                textguzhangmingling.Text = "exit";
                                butguzhangsend.PerformClick();
                                textlog.AppendText(textcurrent.Text);
                                textcurrent.Text = "";
                                break;
                            }
                            Thread.Sleep(XHTime);
                        }
                    }
                }
                butguzhangsend.PerformClick();
                ArrayList list = getIndexArray(richTextEnd.Text, "NOK");
                for (int i = 0; i < list.Count; i++)
                {
                    int index = (int)list[i];
                    richTextEnd.Select(index, "NOK".Length);
                    richTextEnd.SelectionColor = Color.Red;
                }
                if (richTextEnd.Text.Contains("NOK"))
                {
                    richTextEnd.AppendText("排查结果：存在故障，请排查NOK的项目，如果告警项目存在NOK，请环回所有时隙后，再次点击排查故障，确认是否为我司问题" + "\r\n");
                    MessageBox.Show("排查结果：存在故障，请排查NOK项！" + "\r\n" + "如果告警项目存在NOK，请环回所有时隙后，再次点击排查故障，确认是否为我司问题");
                }
                else
                {
                    richTextEnd.AppendText("排查结果：查无故障！" + "\r\n");
                    MessageBox.Show("排查结果：查无故障！");
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }
        }
        private ArrayList getIndexArray(String inputStr, String findStr)
        {
            ArrayList list = new ArrayList();
            int start = 0;
            while (start < inputStr.Length)
            {
                int index = inputStr.IndexOf(findStr, start);
                if (index >= 0)
                {
                    list.Add(index);
                    start = index + findStr.Length;
                }
                else
                {
                    break;
                }
            }
            return list;
        }
        private void Butsyslog_Click(object sender, EventArgs e)
        {
            Thread t = new Thread(Syslog);
            t.Start();
        }
        private void Butpaigu_Click(object sender, EventArgs e)
        {
            Thread t = new Thread(GuZhangPaiCha);
            t.Start();
        }
        #region 故障排查按钮
        private void Butguzhangsend_Click(object sender, EventArgs e)
        {
            if (mysocket.SendData(textguzhangmingling.Text))
            {
                if (textguzhangmingling.Text == "")
                {
                    Thread.Sleep(int.Parse(comguzhangjiange.Text));
                    string ctrlc = "Press any key to continue Ctrl+c to stop";
                    string DOS = textcurrent.Text;
                    if (DOS.Contains(ctrlc))
                    {
                        textcurrent.Text = DOS.Replace(ctrlc, "");
                        //MessageBox.Show("检测到了");
                    }
                    string str = "\r\n" + mysocket.ReceiveData(int.Parse(ts));
                    textcurrent.AppendText(str);
                }
                else
                {
                    com = textguzhangmingling.Text;
                    Thread.Sleep(int.Parse(comguzhangjiange.Text));
                    string ss = mysocket.ReceiveData(int.Parse(ts));
                    textcurrent.AppendText(ss);
                }
            }
            else
            {
                textcurrent.AppendText("\r\n" + "连接通信故障，请断开后，重新尝试！");

            }
            textguzhangmingling.Text = "";
            textcurrent.Focus();
            textcurrent.ScrollToCaret();
            textguzhangmingling.Focus();
        }
        #endregion
        #region Tab选项卡切换
        private void TabControlDOS_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (tabControlDOS.SelectedTab == tabPageGpn)
            {
                labelethboard.Visible = false;
                labelethslot.Visible = false;
                comethboard.Visible = false;
                comethslot.Visible = false;
                labelboard.Visible = false;
                labelslot.Visible = false;
                labelvcg.Visible = false;
                labeleth.Visible = false;
                cometh.Visible = false;
                comboard.Visible = false;
                comslot.Visible = false;
                comvcg.Visible = false;
                butpaigu.Visible = false;
                butsyslog.Visible = false;
                textcyclemingling.Visible = false;
                labcishu.Visible = false;
                comcishu.Visible = false;
                butCycleStart.Visible = false;
                butCycleSuspend.Visible = false;
            }
            if (tabControlDOS.SelectedTab == tabPageLog)
            {
                labelethboard.Visible = true;
                labelethslot.Visible = true;
                comethboard.Visible = true;
                comethslot.Visible = true;
                labelboard.Visible = true;
                labelslot.Visible = true;
                labelvcg.Visible = true;
                labeleth.Visible = true;
                cometh.Visible = true;
                comboard.Visible = true;
                comslot.Visible = true;
                comvcg.Visible = true;
                butpaigu.Visible = true;
                butsyslog.Visible = true;
                textcyclemingling.Visible = true;
                labcishu.Visible = true;
                comcishu.Visible = true;
                butCycleStart.Visible = true;
                butCycleSuspend.Visible = true;
            }
            if (tabControlDOS.SelectedTab == tabPageRemote)
            {
                timerYanshi.Interval = int.Parse(comjiangeshijian.Text);
                //timerYanshi.Start();
                //metroButYanshi.Text = "停止延时测试";
                Random rand = new Random();
                string vncuser = System.Environment.UserName;
                if (TextVNCUser.Text == "")
                {
                    TextVNCUser.Text = vncuser;
                }
                if (TextRDPRemotePort.Text == "")
                {
                    TextRDPRemotePort.Text = rand.Next(40000, 50000).ToString();
                }
                if (TextVNCRemotePort.Text == "")
                {
                    TextVNCRemotePort.Text = rand.Next(50001, 60000).ToString();
                }

                Process[] pro = Process.GetProcesses();
                int count = 0;
                foreach (var item in pro)
                {
                    if (item.ProcessName == "frpc")
                    {
                        count++;

                    }
                    if (item.ProcessName == "tvnserver")
                    {
                        count++;

                    }

                }
                if (count >= 3)
                {
                    tabPageRemote.Text = "远程桌面共享：已启动";
                    //   Textsharp.AppendText("\r\n桌面共享已开启，无需重启启动！");
                }
                else
                {
                    tabPageRemote.Text = "远程桌面共享：未启动";

                }


            }
        }
        #endregion
        #region 故障排查按钮向上按钮指令
        private void Textguzhangmingling_KeyUp(object sender, System.Windows.Forms.KeyEventArgs e)
        {
            if (e.KeyValue == 13)
            {
                butguzhangsend.PerformClick();
            }
            if (e.KeyCode == Keys.Up)
            {
                butguzhangsend.Focus();
                textguzhangmingling.Text = com.ToString();
            }
            if (e.KeyCode == Keys.Down)
            {
                butguzhangsend.Focus();
                textguzhangmingling.Text = "";
            }
        }
        #endregion
        #region 排查结果
        private void RichTextEnd_TextChanged(object sender, EventArgs e)
        {
            //将光标位置设置到当前内容的末尾
            richTextEnd.SelectionStart = richTextEnd.Text.Length;
            //滚动到光标位置
            richTextEnd.ScrollToCaret();
        }
        #endregion
        #region 循环执行命令
        bool stop = false;
        bool on_off = false;
        ManualResetEvent ma;
        Thread CycleThread;
        private void Cycle()
        {
            TimeCount = 0;
            Mytimer.Change(0, 1000);
            Control.CheckForIllegalCrossThreadCalls = false;
            // string netid = TextNeid.Text;
            for (int i = 1; i <= int.Parse(comcishu.Text); i++)
            {
                int zong = int.Parse(comcishu.Text);
                int shengyu = zong - i;
                labshengyucishu.Text = shengyu.ToString();
                //string netid = "3911065600";
                textcurrent.AppendText("\r\n循环第" + i.ToString() + "次准备开始！" + "\r\n");
                if (stop)
                {
                    textcurrent.AppendText("\r\n已经停止！");
                    return;
                }
                if (on_off)
                {
                    textcurrent.AppendText("暂停中！\r\n");
                    ma = new ManualResetEvent(false);
                    ma.WaitOne();
                }
                textguzhangmingling.Text = textcyclemingling.Text;
                butguzhangsend.PerformClick();
                textlog.AppendText(textcurrent.Text);
                textcurrent.Text = "";
                int time = int.Parse(comshijian.Text.Trim()) * 1000;
                Thread.Sleep(time);
            }
            Mytimer.Change(Timeout.Infinite, 1000);
            butCycleStart.Text = "开始";
            textcurrent.AppendText("\r\n循环执行结束！");
        }
        private void ButCycleSuspend_Click(object sender, EventArgs e)
        {
            if (butCycleSuspend.Text == "暂停")
            {
                on_off = true;
                butCycleSuspend.Text = "继续";
            }
            else
            {
                on_off = false;
                if (ma != null)
                {
                    ma.Set();
                }
                butCycleSuspend.Text = "暂停";
                textcurrent.AppendText("\r\n恢复运行！");
            }
        }
        private void ButCycleStart_Click(object sender, EventArgs e)
        {
            if (butCycleStart.Text == "开始")
            {
                stop = false;
                CycleThread = new Thread(Cycle)
                {
                    IsBackground = true
                };
                CycleThread.Start();
                butCycleStart.Text = "停止";
                textcurrent.AppendText("\r\n开始运行！");
            }
            else
            {
                stop = true;
                butCycleStart.Text = "开始";
                Mytimer.Change(Timeout.Infinite, 1000);
            }
        }
        #endregion
        #region 一键改制
        private void ExchangeBoard() {
            textcurrent.AppendText("\r\n" + "///////////////////////////改制开始,请等待20秒钟/////////////////////////////////////////" + "\r\n");
            textguzhangmingling.Text = "grosadvdebug";
            butguzhangsend.PerformClick();
            string mode = "";
            if (comotnboardmode.Text == "8AT2")
            {
                mode = "0";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text == "8AST2")
            {
                mode = "3";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text == "2XT2")
            {
                mode = "4";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text == "2GT1")
            {
                mode = "5";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text == "T10X")
            {
                mode = "6";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text == "8AT2-SDH")
            {
                mode = "8";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text == "V2-2XT2（8AT2改制）")
            {
                mode = "GPN7600-V2-2XT2";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type-redefine " + mode;
            }
            if (comotnboardmode.Text == "V2-8AT2（8GE改制）")
            {
                mode = "GPN7600-V2-8AT2";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type-redefine " + mode;
            }
            if (comotnboardmode.Text.Contains("EVOG-FE【8ge-32】"))
            {
                mode = "GPN7600-V2-EOSC-8GE";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + mode;
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info " + "PrEaGSA-EVOM";
            }
            if (comotnboardmode.Text.Contains("EVOG-GE【8ge-32】"))
            {
                mode = "GPN7600-V2-EOSC-8GE";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + mode;
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info " + "PrEaGSA-EVOG";
            }

            if (comotnboardmode.Text.Contains("EVOG-FE【otn-8ge】"))
            {
                mode = "GPN7600-V2-OTN-8GE";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + mode;
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info " + "PrEaGSA-EVOM";
            }
            if (comotnboardmode.Text.Contains("EVOG-GE【otn-8ge】"))
            {
                mode = "GPN7600-V2-OTN-8GE";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + mode;
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info " + "PrEaGSA-EVOG";
            }


            if (comotnboardmode.Text.Contains("AOOE"))
            {
                mode = "10";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + "GPN7600-V2-OTN-8AT2";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text.Contains("IVDS"))
            {
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + "GSA-IVDS";
            }
            if (comotnboardmode.Text.Contains("SOOE"))
            {
                mode = "11";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + "GPN7600-V2-OTN-8AT2";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text.Contains("AOQX"))
            {
                mode = "12";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + "GPN7600-V2-OTN-8AT2";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text.Contains("EOOG"))
            {
                mode = "15";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + "GPN7600-V2-OTN-8AT2";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text.Contains("EODX"))
            {
                mode = "16";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + "GPN7600-V2-OTN-8AT2";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text.Contains("OOOG-I"))
            {
                mode = "23";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + "GPN7600-V2-OTN-8AT2";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text.Contains("OOOE-I"))
            {
                mode = "22";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + "GPN7600-V2-OTN-8AT2";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text.Contains("UXDX-I"))
            {
                mode = "20";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + "GPN7600-V2-OTN-8AT2";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text.Contains("UCQX"))
            {
                mode = "GPN7600-UXC_SW";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + mode;
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info " + "PrEaGSA-UCQX";
            }
            if (comotnboardmode.Text.Contains("SDQE"))
            {
                mode = "GSA-SDQE";
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "config msap";
                butguzhangsend.PerformClick();
                if (comotnslot.Text == "5")
                {
                    textguzhangmingling.Text = "mm 0xf940000f 0x5a";
                    butguzhangsend.PerformClick();
                }
                if (comotnslot.Text == "6")
                {
                    textguzhangmingling.Text = "mm 0xf950000f 0x5a";
                    butguzhangsend.PerformClick();
                }
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "grosadvdebug";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + mode;
                //butguzhangsend.PerformClick();

                //textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " version V1.0B1";
                //butguzhangsend.PerformClick();
                //textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " date 2021-08-20";
                //butguzhangsend.PerformClick();
                //textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " sn " + textcyclemingling.Text;
                //butguzhangsend.PerformClick();
                //textguzhangmingling.Text = "show board-eeprom 5";

            }
            if (comotnboardmode.Text.Contains("UXQE-I"))
            {
                mode = "18";
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " type " + "GPN7600-V2-OTN-8AT2";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text.Contains("UCHX"))
            {
                mode = "24";
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "config msap";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "mm 0xf940000f 0x5a";
                butguzhangsend.PerformClick();

                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "grosadvdebug";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "board-eeprom 5 type GSA-SDQE";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom 5 ext-info PrEaGSA-UCHX";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text.Contains("UCOE"))
            {
                mode = "25";
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "config msap";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "mm 0xf940000f 0x5a";
                butguzhangsend.PerformClick();

                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "grosadvdebug";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "board-eeprom 5 type GSA-SDQE";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom 5 ext-info PrEaGSA-UCOE";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                textguzhangmingling.Text = "board-eeprom " + comotnslot.Text + " ext-info2 mode=" + mode;
            }
            if (comotnboardmode.Text.Contains("76-III机框类型-2562"))
            {
                textguzhangmingling.Text = "chassis-type 2562";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                butguzhangsend.PerformClick();
                textcurrent.AppendText("\r\n" + "///////////////////////////改制结束/////////////////////////////////////////////" + "\r\n");
                MessageBox.Show("重启后生效");


                return;
            }
            if (comotnboardmode.Text.Contains("76-III风扇"))
            {
                textguzhangmingling.Text = "board-eeprom 21 type GSA-FAN-III";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                butguzhangsend.PerformClick();

                textcurrent.AppendText("\r\n" + "///////////////////////////改制结束/////////////////////////////////////////////" + "\r\n");
                MessageBox.Show("重启后生效");



                return;
            }
            if (comotnboardmode.Text.Contains("76机框类型-2563"))
            {
                textguzhangmingling.Text = "chassis-type 2563";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                Thread.Sleep(3000);
                butguzhangsend.PerformClick();
                textcurrent.AppendText("\r\n" + "///////////////////////////改制结束/////////////////////////////////////////////" + "\r\n");
                MessageBox.Show("重启后生效");


                return;
            }


            butguzhangsend.PerformClick();
            Thread.Sleep(8000);
            butguzhangsend.PerformClick();
            textguzhangmingling.Text = "exit";
            butguzhangsend.PerformClick();
            textguzhangmingling.Text = "enable show boardname by e2-extinfo";
            butguzhangsend.PerformClick();
            Thread.Sleep(XHTime);
            //textguzhangmingling.Text = "reboot " + comotnslot.Text;
            //butguzhangsend.PerformClick();
            //textguzhangmingling.Text = "Y";
            //butguzhangsend.PerformClick();
            textcurrent.AppendText("\r\n" + "改制已结束，复位板卡后可生效，参考(config)#reboot 槽位号" + "\r\n");
            textcurrent.AppendText("\r\n" + "///////////////////////////改制结束/////////////////////////////////////////////" + "\r\n");
            butguzhangsend.PerformClick();
            // MessageBox.Show("");
        }
        private void butgaizhi_Click(object sender, EventArgs e)
        {
            CycleThread = new Thread(ExchangeBoard)
            {
                IsBackground = true
            };
            CycleThread.Start();

        }
        #endregion
        #region 卸载GPN7600EMS模块
        private void butuninstall_Click(object sender, EventArgs e)
        {


        }
        #endregion
        #region 检查GPN7600EMS软件是否存在
        private bool CheckGPN7600EMS()
        {
            RegistryKey uninstallNode = Registry.LocalMachine.OpenSubKey(@"SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall");
            foreach (string subKeyName in uninstallNode.GetSubKeyNames())
            {
                Microsoft.Win32.RegistryKey subKey = uninstallNode.OpenSubKey(subKeyName);
                object displayName = subKey.GetValue("DisplayName");
                if (displayName != null)
                {
                    if (displayName.ToString().Contains("GPN7600 EMS"))
                    {
                        return true;
                        // MessageBox.Show(displayName.ToString());  
                    }
                }
            }
            return false;
        }
        #endregion
        #region 安装GPN7600EMS模块
        private void butinstall_Click(object sender, EventArgs e)
        {

        }
        #endregion
        private void InstallGPN()
        {
            FileStream stream;
            string gpnname = comgpn76list.Text;
            string url = GPN7600EMSURL + gpnname;
            string strZipPath = @"C:\gpn\" + gpnname;
            string strUnZipPath = @"C:\gpn\";
            int percent = 0;
            stream = new FileStream(strZipPath, FileMode.Create);
            bool overWrite = true;
            try
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "GPN模块下载中==============================================OK" + "\r\n");
                HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);
                HttpWebResponse response = request.GetResponse() as HttpWebResponse;
                Stream responseStream = response.GetResponseStream();
                long totalDownloadedByte = 0;
                long totalBytes = response.ContentLength;
                byte[] bArr = new byte[1024];
                int size = responseStream.Read(bArr, 0, bArr.Length);
                while (size > 0)
                {
                    totalDownloadedByte = size + totalDownloadedByte;
                    stream.Write(bArr, 0, size);
                    size = responseStream.Read(bArr, 0, bArr.Length);
                    //p = (int)Math.Floor((double)100 / a);
                    percent = (int)Math.Floor((float)totalDownloadedByte / (float)totalBytes * 100);
                    // textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") +" "+percent.ToString() + "\r\n");
                    //labjindu.Text = percent.ToString() + "%";
                    myProgressBarjindu.Value = percent;
                    // System.Windows.Forms.Application.DoEvents();
                }
                stream.Close();
                responseStream.Close();
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "GPN模块下载成功============================================OK" + "\r\n");
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "GPN模块保存路径：" + strZipPath + "\r\n");

            }
            catch (Exception)
            {
                stream.Close();
                MessageBox.Show("无法进行下载，请检查下载链接！");
                //flag = false;       //返回false下载失败
            }
            try
            {
                ReadOptions options = new ReadOptions { StatusMessageWriter = System.Console.Out };
                using (ZipFile zip = ZipFile.Read(strZipPath, options))
                {
                    foreach (ZipEntry entry in zip)
                    {
                        if (string.IsNullOrEmpty(strUnZipPath))
                        {
                            strUnZipPath = strZipPath.Split('.').First();
                        }
                        if (overWrite)
                        {
                            entry.Extract(strUnZipPath, ExtractExistingFileAction.OverwriteSilently);//解压文件，如果已存在就覆盖
                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "GPN模块解压成功============================================OK" + "\r\n");
                        }
                    }
                    // zip.ExtractAll(@tbxFtpRoot.Text.Trim());
                }
            }
            catch (Exception)
            {
                MessageBox.Show("无法进行解压，请检查下载链接！");
                return;
            }
            System.Diagnostics.Process.Start(strUnZipPath + "setup.exe");
            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "GPN模块安装成功============================================OK" + "\r\n");
            // MessageBox.Show("GPN7600 EMS模块已安装成功！");
        }
        #region 获取GPN7600EMS软件目录
        private void gpnurlupdate()
        {
            try
            {
                string strCode;
                ArrayList alLinks;
                if (GPN7600EMSURL == "")
                {
                    MessageBox.Show("请输入网址");
                    return;
                }
                string strURL = GPN7600EMSURL;
                if (strURL.Substring(0, 7) != @"http://")
                {
                    //strURL = @"http://" + strURL;
                }

                Ping ping = new Ping();
                int timeout = 120;
                PingReply pingReply = ping.Send(GPN7600EMSURLIP, timeout);
                //判断请求是否超时

                //textDOS.AppendText("正在获取页面代码===========================================OK" + "\r\n");
                strCode = MyGpnSoftware.App.GetPageSource(strURL);
                //textDOS.AppendText("正在提取超链接=============================================OK" + "\r\n");
                alLinks = MyGpnSoftware.App.GetHyperLinks(strCode);
                //textDOS.AppendText("正在写入XML文件============================================OK" + "\r\n");
                MyGpnSoftware.App.WriteToXml(strURL, alLinks);
                //读取设定档百
                XmlDocument xmlDoc = new XmlDocument();
                xmlDoc.Load(@"C:\gpn\HyperLinks.xml");
                //取得节点专
                XmlNodeList node = xmlDoc.GetElementsByTagName("other");
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "获取网管版本" + "===============================================OK " + node.Count.ToString() + "个版本" + "\r\n");
                for (int i = 0; i < node.Count; i++)
                {
                    comgpn76list.Items.Add(node[i].InnerText);
                }
                //textDOS.AppendText("从网管服务器获取GPN76模块链接成功==========================OK" + "\r\n");
            }
            catch 
            {
                //   textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "GPN模块获取失败，请链接格林威尔VPN后，再次尝试！" + "\r\n");

            }

        }
        #endregion
        #region 获取各个文件的大小
        private void comapp_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comapp.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labapp.Text = lSize.ToString();
            }
        }
        private void comapp2_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comapp2.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labapp2.Text = lSize.ToString();
            }
        }
        private void comflash_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comflash.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labflash.Text = lSize.ToString();
            }
        }
        private void comcode_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comcode.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labcode.Text = lSize.ToString();
            }
        }
        private void comcode2_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comcode2.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labcode2.Text = lSize.ToString();
            }
        }
        private void comcode3_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comcode3.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labcode3.Text = lSize.ToString();
            }
        }
        private void comcode4_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comcode4.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labcode4.Text = lSize.ToString();
            }
        }
        private void comsdn_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comsdn.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labsdn.Text = lSize.ToString();
            }
        }
        private void comnms_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comnms.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labnms.Text = lSize.ToString();
            }
        }
        private void comsw_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comsw.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labsw.Text = lSize.ToString();
            }
        }
        private void com760s_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + com760s.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                lab760s.Text = lSize.ToString();
            }
        }
        private void com760b_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + com760b.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                lab760b.Text = lSize.ToString();
            }
        }
        private void com760c_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + com760c.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                lab760c.Text = lSize.ToString();
            }
        }
        private void com760d_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + com760d.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                lab760d.Text = lSize.ToString();
            }
        }
        private void com760e_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + com760e.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                lab760e.Text = lSize.ToString();
            }
        }
        private void comuxc_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comuxc.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labuxc.Text = lSize.ToString();
            }
        }
        private void com7610_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + com7610.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                lab7610.Text = lSize.ToString();
            }
        }
        private void com7611_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + com7611.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                lab7611.Text = lSize.ToString();
            }
        }
        private void com7612_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + com7612.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                lab7612.Text = lSize.ToString();
            }
        }
        private void com7613_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + com7613.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                lab7613.Text = lSize.ToString();
            }
        }

        private void com7614_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + com7614.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                lab7614.Text = lSize.ToString();
            }
        }
        private void com7615_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + com7615.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                lab7615.Text = lSize.ToString();
            }
        }
        private void com7616_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + com7616.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                lab7616.Text = lSize.ToString();
            }
        }
        private void comsysfile_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comsysfile.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labsysfile.Text = lSize.ToString();
            }
        }
        private void comvoss_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comvoss.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labvoss.Text = lSize.ToString();
            }
        }
        private void comrebootos_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comrebootos.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labrebootos.Text = lSize.ToString();
            }
        }
        private void comcplde_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comcpld.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labcpld.Text = lSize.ToString();
            }
        }
        private void comyaffs_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comyaffs.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labyaffs.Text = lSize.ToString();
            }
        }
        private void comconfig_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comconfig.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labconfig.Text = lSize.ToString();
            }
        }
        private void comslotconfig_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comslotconfig.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labslotconfig.Text = lSize.ToString();
            }
        }
        private void comdb_SelectedIndexChanged(object sender, EventArgs e)
        {
            long lSize = 0;
            string sFullName = @tbxFtpRoot.Text.Trim() + comdb.Text.Trim();
            if (File.Exists(sFullName))
            {
                lSize = new FileInfo(sFullName).Length;
                labdb.Text = lSize.ToString();
            }
        }
        #endregion

        #region 检查flash文件对比大小
        private void ConfigSize()
        {
            toolStripStatusLabelzt.Text = "检查Config大小中";
            mysocket.SendData("dosfs");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("dosfs"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            mysocket.SendData("cd /flash/sys");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("cd /flash/sys"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            mysocket.SendData("ll");
            Thread.Sleep(XHTime);
            string ver = "";
            string ver2 = "";
            for (int a = 0; a <= 5; a++)
            {
                ver2 = mysocket.ReceiveData(int.Parse(ts));
                ver = ver + ver2;
                if (ver2.Contains("Ctrl+c"))
                {
                    mysocket.SendDate("\r\n");
                }
                if (ver2.Contains("#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            //MessageBox.Show(ver);
            string appRegex = ".*conf_data.txt";
            Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
            string appsize1 = r.Match(ver).Groups[0].Value;
            if (appsize1 == "")
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查conf_data.txt文件大小超时，请检查文件是否存在，设备是否正常？==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("exit");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("(config)#"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                return;
            }
            string[] VCGINFOFengGe = Regex.Split(appsize1, "\\s+", RegexOptions.IgnoreCase);
            string Appsize = VCGINFOFengGe[4];
            if (UpLoadFile_Stop == false)
            {
                Filesize = long.Parse(Appsize);
            }
            else
            {
                if (Appsize == labconfig.Text)
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查conf_data.txt文件比对==============================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：conf_data.txt文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：conf_data.txt文件大小为： " + labconfig.Text + " 字节" + "\r\n");
                }
                else
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查conf_data.txt文件比对=============================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：conf_data.txt文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：conf_data.txt文件大小为： " + labconfig.Text + " 字节" + "\r\n");
                }
            }
            mysocket.SendData("exit");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("(config)#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            // MessageBox.Show(Appsize);
        }
        private void SlotconfigSize()
        {
            toolStripStatusLabelzt.Text = "检查Slotconfig大小中";
            mysocket.SendData("dosfs");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("dosfs"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string aaaa = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("cd /flash/sys");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("cd /flash/sys"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string bbbb = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("ll");
            Thread.Sleep(XHTime);
            string ver = "";
            string ver2 = "";
            for (int a = 0; a <= 5; a++)
            {
                ver2 = mysocket.ReceiveData(int.Parse(ts));
                ver = ver + ver2;
                if (ver2.Contains("Ctrl+c"))
                {
                    mysocket.SendDate("\r\n");
                }
                if (ver2.Contains("#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            //MessageBox.Show(ver);
            string appRegex = ".*slotconfig.bin";
            Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
            string appsize1 = r.Match(ver).Groups[0].Value;
            if (appsize1 == "")
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查slotconfig.bin文件大小超时，请检查文件是否存在，设备是否正常？==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("exit");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("(config)#"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                return;
            }
            string[] VCGINFOFengGe = Regex.Split(appsize1, "\\s+", RegexOptions.IgnoreCase);
            string Appsize = VCGINFOFengGe[4];
            if (UpLoadFile_Stop == false)
            {
                Filesize = long.Parse(Appsize);
            }
            else
            {
                if (Appsize == labslotconfig.Text)
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查slotconfig.bin文件比对=============================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：slotconfig.bin文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：slotconfig.bin文件大小为： " + labslotconfig.Text + " 字节" + "\r\n");
                }
                else
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查slotconfig.bin文件比对============================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：slotconfig.bin文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：slotconfig.bin文件大小为： " + labslotconfig.Text + " 字节" + "\r\n");
                }
            }
            mysocket.SendData("exit");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("(config)#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            // MessageBox.Show(Appsize);
        }
        private void DbSize()
        {
            toolStripStatusLabelzt.Text = "检查Db大小中";
            mysocket.SendData("dosfs");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("dosfs"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string aaaa = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("cd /flash/sys");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("cd /flash/sys"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string bbbb = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("ll");
            Thread.Sleep(XHTime);
            string ver = "";
            string ver2 = "";
            for (int a = 0; a <= 5; a++)
            {
                ver2 = mysocket.ReceiveData(int.Parse(ts));
                ver = ver + ver2;
                if (ver2.Contains("Ctrl+c"))
                {
                    mysocket.SendDate("\r\n");
                }
                if (ver2.Contains("#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            //MessageBox.Show(ver);
            string appRegex = ".*db.bin";
            Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
            string appsize1 = r.Match(ver).Groups[0].Value;
            if (appsize1 == "")
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查db.bin文件大小超时，请检查文件是否存在，设备是否正常？==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("exit");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("(config)#"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                return;
            }
            string[] VCGINFOFengGe = Regex.Split(appsize1, "\\s+", RegexOptions.IgnoreCase);
            string Appsize = VCGINFOFengGe[4];
            if (UpLoadFile_Stop == false)
            {
                Filesize = long.Parse(Appsize);
            }
            else
            {
                if (Appsize == labdb.Text)
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查db.bin文件比对=====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：db.bin文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：db.bin文件大小为： " + labdb.Text + " 字节" + "\r\n");
                }
                else
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查db.bin文件比对====================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：db.bin文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：db.bin文件大小为： " + labdb.Text + " 字节" + "\r\n");
                }
            }
            mysocket.SendData("exit");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("(config)#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            // MessageBox.Show(Appsize);
        }
        private void AppSize()
        {
            toolStripStatusLabelzt.Text = "检查APP大小中";
            mysocket.SendData("dosfs");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("dosfs"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string aaaa = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("cd /flash/sys");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("cd /flash/sys"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string bbbb = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("ll");
            Thread.Sleep(XHTime);
            string ver = "";
            string ver2 = "";
            for (int a = 0; a <= 5; a++)
            {
                ver2 = mysocket.ReceiveData(int.Parse(ts));
                ver = ver + ver2;
                if (ver2.Contains("Ctrl+c"))
                {
                    mysocket.SendDate("\r\n");
                }
                if (ver2.Contains("#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            //MessageBox.Show(ver);
            string appRegex = ".*app_code.bin";
            Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
            string appsize1 = r.Match(ver).Groups[0].Value;
            if (appsize1 == "")
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查app_code.bin文件大小超时，请检查文件是否存在，设备是否正常？==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("exit");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("(config)#"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                return;
            }
            string[] VCGINFOFengGe = Regex.Split(appsize1, "\\s+", RegexOptions.IgnoreCase);
            string Appsize = VCGINFOFengGe[4];
            if (UpLoadFile_Stop == false)
            {
                Filesize = long.Parse(Appsize);
            }
            else
            {
                if (Appsize == labapp.Text)
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查app_code.bin文件比对===============================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：app_code.bin文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：app_code.bin文件大小为： " + labapp.Text + " 字节" + "\r\n");
                }
                else
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查app_code.bin文件比对==============================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：app_code.bin文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：app_code.bin文件大小为： " + labapp.Text + " 字节" + "\r\n");
                }
            }
            mysocket.SendData("exit");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("(config)#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            // MessageBox.Show(Appsize);
        }
        private void NmsSize()
        {
            toolStripStatusLabelzt.Text = "检查NMS大小中";
            mysocket.SendData("dosfs");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("dosfs"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string aaaa = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("cd /flash/sys");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("cd /flash/sys"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string bbbb = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("ll");
            Thread.Sleep(XHTime);
            string ver = "";
            string ver2 = "";
            for (int a = 0; a <= 5; a++)
            {
                ver2 = mysocket.ReceiveData(int.Parse(ts));
                ver = ver + ver2;
                if (ver2.Contains("Ctrl+c"))
                {
                    mysocket.SendDate("\r\n");
                }
                if (ver2.Contains("#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            // MessageBox.Show(ver);
            string appRegex = ".* nms.fpga";
            Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
            string appsize1 = r.Match(ver).Groups[0].Value;
            if (appsize1 == "")
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查nms.fpga文件大小超时，请检查文件是否存在，设备是否正常？==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("exit");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("(config)#"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                return;
            }
            string[] VCGINFOFengGe = Regex.Split(appsize1, "\\s+", RegexOptions.IgnoreCase);
            string Appsize = VCGINFOFengGe[4];
            if (UpLoadFile_Stop == false)
            {
                Filesize = long.Parse(Appsize);
            }
            else
            {
                if (Appsize == labnms.Text)
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查nms.fpga文件比对===================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：nms.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：nms.fpga文件大小为： " + labnms.Text + " 字节" + "\r\n");
                }
                else
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查nms.fpga文件比对==================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：nms.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：nms.fpga文件大小为： " + labnms.Text + " 字节" + "\r\n");
                }
            }
            mysocket.SendData("exit");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("(config)#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            // MessageBox.Show(Appsize);
        }
        private void SwSize()
        {
            toolStripStatusLabelzt.Text = "检查SW大小中";
            mysocket.SendData("dosfs");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("dosfs"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string aaaa = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("cd /flash/sys");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("cd /flash/sys"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string bbbb = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("ll");
            Thread.Sleep(XHTime);
            string ver = "";
            string ver2 = "";
            for (int a = 0; a <= 5; a++)
            {
                ver2 = mysocket.ReceiveData(int.Parse(ts));
                ver = ver + ver2;
                if (ver2.Contains("Ctrl+c"))
                {
                    mysocket.SendDate("\r\n");
                }
                if (ver2.Contains("#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            //MessageBox.Show(ver);
            string appRegex = ".*sw.fpga";
            Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
            string appsize1 = r.Match(ver).Groups[0].Value;
            if (appsize1 == "")
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查sw.fpga文件大小超时，请检查文件是否存在，设备是否正常？==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("exit");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("(config)#"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                return;
            }
            string[] VCGINFOFengGe = Regex.Split(appsize1, "\\s+", RegexOptions.IgnoreCase);
            string Appsize = VCGINFOFengGe[4];
            if (UpLoadFile_Stop == false)
            {
                Filesize = long.Parse(Appsize);
            }
            else
            {
                if (Appsize == labsw.Text)
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查sw.fpga文件比对====================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：sw.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：sw.fpga文件大小为： " + labsw.Text + " 字节" + "\r\n");
                }
                else
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查sw.fpga文件比对===================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：sw.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：sw.fpga文件大小为： " + labsw.Text + " 字节" + "\r\n");
                }
            }
            mysocket.SendData("exit");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("(config)#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            // MessageBox.Show(Appsize);
        }
        private void CodeSize()
        {
            toolStripStatusLabelzt.Text = "检查CODE大小中";
            mysocket.SendData("dosfs");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("dosfs"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string aaaa = mysocket.ReceiveData(int.Parse(ts));
            if (toolStripStatusLabelver.Text.Contains("R13"))
            {
                mysocket.SendData("cd /flash/sys");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("cd /flash/sys"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
            }
            else
            {
                mysocket.SendData("cd /yaffs/sys");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("cd /yaffs/sys"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
            }
            string bbbb = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("ll");
            string ver = "";
            string ver2 = "";
            for (int a = 0; a <= 5; a++)
            {
                ver2 = mysocket.ReceiveData(int.Parse(ts));
                ver = ver + ver2;
                if (ver2.Contains("Ctrl+c"))
                {
                    mysocket.SendDate("\r\n");
                }
                if (ver2.Contains("#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            //MessageBox.Show(ver);
            string appRegex = ".*fpga_code.bin";
            Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
            string appsize1 = r.Match(ver).Groups[0].Value;
            if (appsize1 == "")
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查fpga_code.bin文件大小超时，请检查文件是否存在，设备是否正常？==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("exit");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("(config)#"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                return;
            }
            string[] VCGINFOFengGe = Regex.Split(appsize1, "\\s+", RegexOptions.IgnoreCase);
            string Appsize = VCGINFOFengGe[4];
            if (UpLoadFile_Stop == false)
            {
                Filesize = long.Parse(Appsize);
            }
            else
            {
                if (Appsize == labcode.Text)
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查fpga_code.bin文件比对==============================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：fpga_code.bin文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：fpga_code.bin文件大小为： " + labcode.Text + " 字节" + "\r\n");
                }
                else
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查fpga_code.bin文件比对=============================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：fpga_code.bin文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：fpga_code.bin文件大小为： " + labcode.Text + " 字节" + "\r\n");
                }
            }
            mysocket.SendData("exit");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("(config)#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            // MessageBox.Show(Appsize);
        }
        private void Fpga760sSize()
        {
            toolStripStatusLabelzt.Text = "检查FPGA760S大小中";
            mysocket.SendData("dosfs");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("dosfs"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string aaaa = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("cd /yaffs/sys");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("cd /yaffs/sys"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string bbbb = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("ll");
            Thread.Sleep(XHTime);
            string ver = "";
            string ver2 = "";
            for (int a = 0; a <= 5; a++)
            {
                ver2 = mysocket.ReceiveData(int.Parse(ts));
                ver = ver + ver2;
                if (ver2.Contains("Ctrl+c"))
                {
                    mysocket.SendDate("\r\n");
                }
                if (ver2.Contains("#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            //MessageBox.Show(ver);
            string appRegex = ".*760s.fpga";
            Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
            string appsize1 = r.Match(ver).Groups[0].Value;
            if (appsize1 == "")
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760s.fpga文件大小超时，请检查文件是否存在，设备是否正常？==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("exit");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("(config)#"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                return;
            }
            string[] VCGINFOFengGe = Regex.Split(appsize1, "\\s+", RegexOptions.IgnoreCase);
            string Appsize = VCGINFOFengGe[4];
            if (UpLoadFile_Stop == false)
            {
                Filesize = long.Parse(Appsize);
            }
            else
            {
                if (Appsize == lab760s.Text)
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760s.fpga文件比对==================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：760s.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：760s.fpga文件大小为： " + lab760s.Text + " 字节" + "\r\n");
                }
                else
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760s.fpga文件比对=================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：760s.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：760s.fpga文件大小为： " + lab760s.Text + " 字节" + "\r\n");
                }
            }
            mysocket.SendData("exit");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("(config)#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            // MessageBox.Show(Appsize);
        }
        private void Fpga760bSize()
        {
            toolStripStatusLabelzt.Text = "检查FPGA760B大小中";
            mysocket.SendData("dosfs");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("dosfs"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string aaaa = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("cd /yaffs/sys");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("cd /yaffs/sys"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string bbbb = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("ll");
            Thread.Sleep(XHTime);
            string ver = "";
            string ver2 = "";
            for (int a = 0; a <= 5; a++)
            {
                ver2 = mysocket.ReceiveData(int.Parse(ts));
                ver = ver + ver2;
                if (ver2.Contains("Ctrl+c"))
                {
                    mysocket.SendDate("\r\n");
                }
                if (ver2.Contains("#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            //MessageBox.Show(ver);
            string appRegex = ".*760b.fpga";
            Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
            string appsize1 = r.Match(ver).Groups[0].Value;
            if (appsize1 == "")
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760b.fpga文件大小超时，请检查文件是否存在，设备是否正常？==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("exit");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("(config)#"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                return;
            }
            string[] VCGINFOFengGe = Regex.Split(appsize1, "\\s+", RegexOptions.IgnoreCase);
            string Appsize = VCGINFOFengGe[4];
            if (UpLoadFile_Stop == false)
            {
                Filesize = long.Parse(Appsize);
            }
            else
            {
                if (Appsize == lab760b.Text)
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760b.fpga文件比对==================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：760b.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：760b.fpga文件大小为： " + lab760b.Text + " 字节" + "\r\n");
                }
                else
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760b.fpga文件比对=================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：760b.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：760b.fpga文件大小为： " + lab760b.Text + " 字节" + "\r\n");
                }
            }
            mysocket.SendData("exit");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("(config)#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            // MessageBox.Show(Appsize);
        }
        private void Fpga760cSize()
        {
            toolStripStatusLabelzt.Text = "检查FPGA760C大小中";
            mysocket.SendData("dosfs");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("dosfs"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string aaaa = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("cd /yaffs/sys");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("cd /yaffs/sys"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string bbbb = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("ll");
            Thread.Sleep(XHTime);
            string ver = "";
            string ver2 = "";
            for (int a = 0; a <= 5; a++)
            {
                ver2 = mysocket.ReceiveData(int.Parse(ts));
                ver = ver + ver2;
                if (ver2.Contains("Ctrl+c"))
                {
                    mysocket.SendDate("\r\n");
                }
                if (ver2.Contains("#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            //MessageBox.Show(ver);
            string appRegex = ".*760c.fpga";
            Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
            string appsize1 = r.Match(ver).Groups[0].Value;
            if (appsize1 == "")
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760c.fpga文件大小超时，请检查文件是否存在，设备是否正常？==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("exit");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("(config)#"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                return;
            }
            string[] VCGINFOFengGe = Regex.Split(appsize1, "\\s+", RegexOptions.IgnoreCase);
            string Appsize = VCGINFOFengGe[4];
            if (UpLoadFile_Stop == false)
            {
                Filesize = long.Parse(Appsize);
            }
            else
            {
                if (Appsize == lab760c.Text)
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760c.fpga文件比对==================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：760c.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：760c.fpga文件大小为： " + lab760c.Text + " 字节" + "\r\n");
                }
                else
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760c.fpga文件比对=================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：760c.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：760c.fpga文件大小为： " + lab760c.Text + " 字节" + "\r\n");
                }
            }
            mysocket.SendData("exit");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("(config)#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            // MessageBox.Show(Appsize);
        }
        private void Fpga760dSIze()
        {
            toolStripStatusLabelzt.Text = "检查FPGA760D大小中";
            mysocket.SendData("dosfs");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("dosfs"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string aaaa = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("cd /yaffs/sys");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("cd /yaffs/sys"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string bbbb = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("ll");
            Thread.Sleep(XHTime);
            string ver = "";
            string ver2 = "";
            for (int a = 0; a <= 5; a++)
            {
                ver2 = mysocket.ReceiveData(int.Parse(ts));
                ver = ver + ver2;
                if (ver2.Contains("Ctrl+c"))
                {
                    mysocket.SendDate("\r\n");
                }
                if (ver2.Contains("#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            //MessageBox.Show(ver);
            string appRegex = ".*760d.fpga";
            Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
            string appsize1 = r.Match(ver).Groups[0].Value;
            if (appsize1 == "")
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760d.fpga文件大小超时，请检查文件是否存在，设备是否正常？==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("exit");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("(config)#"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                return;
            }
            string[] VCGINFOFengGe = Regex.Split(appsize1, "\\s+", RegexOptions.IgnoreCase);
            string Appsize = VCGINFOFengGe[4];
            if (UpLoadFile_Stop == false)
            {
                Filesize = long.Parse(Appsize);
            }
            else
            {
                if (Appsize == lab760d.Text)
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760d.fpga文件比对==================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：760d.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：760d.fpga文件大小为： " + lab760d.Text + " 字节" + "\r\n");
                }
                else
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760d.fpga文件比对=================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：760d.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：760d.fpga文件大小为： " + lab760d.Text + " 字节" + "\r\n");
                }
            }
            mysocket.SendData("exit");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("(config)#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            // MessageBox.Show(Appsize);
        }
        private void Fpga760eSize()
        {
            toolStripStatusLabelzt.Text = "检查FPGA760E大小中";
            mysocket.SendData("dosfs");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("dosfs"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string aaaa = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("cd /yaffs/sys");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("cd /yaffs/sys"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string bbbb = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("ll");
            Thread.Sleep(XHTime);
            string ver = "";
            string ver2 = "";
            for (int a = 0; a <= 5; a++)
            {
                ver2 = mysocket.ReceiveData(int.Parse(ts));
                ver = ver + ver2;
                if (ver2.Contains("Ctrl+c"))
                {
                    mysocket.SendDate("\r\n");
                }
                if (ver2.Contains("#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            //MessageBox.Show(ver);
            string appRegex = ".*760e.fpga";
            Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
            string appsize1 = r.Match(ver).Groups[0].Value;
            if (appsize1 == "")
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760e.fpga文件大小超时，请检查文件是否存在，设备是否正常？==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("exit");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("(config)#"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                return;
            }
            string[] VCGINFOFengGe = Regex.Split(appsize1, "\\s+", RegexOptions.IgnoreCase);
            string Appsize = VCGINFOFengGe[4];
            if (UpLoadFile_Stop == false)
            {
                Filesize = long.Parse(Appsize);
            }
            else
            {
                if (Appsize == lab760e.Text)
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760e.fpga文件比对==================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：760e.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：760e.fpga文件大小为： " + lab760e.Text + " 字节" + "\r\n");
                }
                else
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760e.fpga文件比对=================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：760e.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：760e.fpga文件大小为： " + lab760e.Text + " 字节" + "\r\n");
                }
            }
            mysocket.SendData("exit");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("(config)#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            // MessageBox.Show(Appsize);
        }
        private void Fpga760fSize()
        {
            toolStripStatusLabelzt.Text = "检查760F大小中";
            mysocket.SendData("dosfs");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("dosfs"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string aaaa = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("cd /yaffs/sys");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("cd /yaffs/sys"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string bbbb = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("ll");
            Thread.Sleep(XHTime);
            string ver = "";
            string ver2 = "";
            for (int a = 0; a <= 5; a++)
            {
                ver2 = mysocket.ReceiveData(int.Parse(ts));
                ver = ver + ver2;
                if (ver2.Contains("Ctrl+c"))
                {
                    mysocket.SendDate("\r\n");
                }
                if (ver2.Contains("#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            //MessageBox.Show(ver);
            string appRegex = ".*760f.fpga";
            Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
            string appsize1 = r.Match(ver).Groups[0].Value;
            if (appsize1 == "")
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760f.fpga文件大小超时，请检查文件是否存在，设备是否正常？==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("exit");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("(config)#"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                return;
            }
            string[] VCGINFOFengGe = Regex.Split(appsize1, "\\s+", RegexOptions.IgnoreCase);
            string Appsize = VCGINFOFengGe[4];
            if (UpLoadFile_Stop == false)
            {
                Filesize = long.Parse(Appsize);
            }
            else
            {
                if (Appsize == labuxc.Text)
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760f.fpga文件比对===============================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：760f.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：760f.fpga文件大小为： " + labuxc.Text + " 字节" + "\r\n");
                }
                else
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查760f.fpga文件比对==============================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：760f.fpga文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：760f.fpga文件大小为： " + labuxc.Text + " 字节" + "\r\n");
                }
            }
            mysocket.SendData("exit");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("(config)#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            // MessageBox.Show(Appsize);
        }
        private void SysfileSize()
        {
            toolStripStatusLabelzt.Text = "检查sysfile大小中";
            mysocket.SendData("dosfs");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("dosfs"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string aaaa = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("cd /flash/sys");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("cd /flash/sys"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            string bbbb = mysocket.ReceiveData(int.Parse(ts));
            mysocket.SendData("ll");
            Thread.Sleep(XHTime);
            string ver = "";
            string ver2 = "";
            for (int a = 0; a <= 5; a++)
            {
                ver2 = mysocket.ReceiveData(int.Parse(ts));
                ver = ver + ver2;
                if (ver2.Contains("Ctrl+c"))
                {
                    mysocket.SendDate("\r\n");
                }
                if (ver2.Contains("#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            //MessageBox.Show(ver);
            string appRegex = ".*sysfile_ini.bin";
            Regex r = new Regex(appRegex, RegexOptions.IgnoreCase);
            string appsize1 = r.Match(ver).Groups[0].Value;
            if (appsize1 == "")
            {
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查sysfile_ini.bin文件大小超时，请检查文件是否存在，设备是否正常？==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                mysocket.SendData("exit");
                for (int a = 1; a <= 200; a++)
                {
                    string command = mysocket.ReceiveData(int.Parse(ts));
                    if (command.Contains("(config)#"))
                    {
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                return;
            }
            string[] VCGINFOFengGe = Regex.Split(appsize1, "\\s+", RegexOptions.IgnoreCase);
            string Appsize = VCGINFOFengGe[4];
            if (UpLoadFile_Stop == false)
            {
                Filesize = long.Parse(Appsize);
            }
            else
            {
                if (Appsize == labsysfile.Text)
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查sysfile_ini.bin文件比对============================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：sysfile_ini.bin文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：sysfile_ini.bin文件大小为： " + labsysfile.Text + " 字节" + "\r\n");
                }
                else
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "检查sysfile_ini.bin文件比对===========================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "设备：sysfile_ini.bin文件大小为： " + Appsize + " 字节" + "\r\n");
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "电脑：sysfile_ini.bin文件大小为： " + labsysfile.Text + " 字节" + "\r\n");
                }
            }
            mysocket.SendData("exit");
            for (int a = 1; a <= 200; a++)
            {
                string command = mysocket.ReceiveData(int.Parse(ts));
                if (command.Contains("(config)#"))
                {
                    break;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            // MessageBox.Show(Appsize);
        }
        #endregion      
        bool UpLoadFile_Stop = true;
        bool UpLoadFile_On_Off = false;
        ManualResetEvent UpLoadFilePause;
        private void UpLoadFile()
        {
            //立即开始计时，时间间隔1000毫秒
            try
            {
                if (devtype == "98" || devtype == "2859" || devtype == "2860" || devtype == "2861" || devtype == "2862" || devtype == "2863" || devtype == "2864" || devtype == "2865")
                {



                    TimeCount = 0;
                    Mytimer.Change(0, 1000);
                    Control.CheckForIllegalCrossThreadCalls = false;
                    uploading = true;
                    Testftpser();
                    if (UpLoadFile_Stop)
                    {
                        textDOS.AppendText(DateTime.Now.ToString("\r\n" + "yyyy-MM-dd HH:mm:ss") + " " + "上传备份已停止！");
                        return;
                    }
                    Uploadsave();
                    int a = 0;
                    int p = 0;
                    if (checkapp.Checked == true)
                    {
                        a++;
                    }
                    if (checkcode.Checked == true)
                    {
                        a++;
                    }
                    if (checknms.Checked == true)
                    {
                        a++;
                    }
                    if (checksw.Checked == true)
                    {
                        a++;
                    }
                    if (check760s.Checked == true)
                    {
                        a++;
                    }
                    if (check760b.Checked == true)
                    {
                        a++;
                    }
                    if (check760c.Checked == true)
                    {
                        a++;
                    }
                    if (check760d.Checked == true)
                    {
                        a++;
                    }
                    if (check760e.Checked == true)
                    {
                        a++;
                    }
                    if (checkuxc.Checked == true)
                    {
                        a++;
                    }
                    if (checksysfile.Checked == true)
                    {
                        a++;
                    }
                    if (checkflash.Checked == true)
                    {
                        a++;
                    }
                    if (checkyaffs.Checked == true)
                    {
                        a++;
                    }
                    if (checkconfig.Checked == true)
                    {
                        a++;
                    }
                    if (checkdb.Checked == true)
                    {
                        a++;
                    }
                    if (checkslotconfig.Checked == true)
                    {
                        a++;
                    }
                    int s = (int)Math.Floor((double)100 / a);
                    p = (int)Math.Floor((double)100 / a);
                    if (checkconfig.Checked == true)
                    {
                        ConfigSize();
                        UploadConfig();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            myProgressBarjindu.Value = p;
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    if (checkslotconfig.Checked == true)
                    {
                        SlotconfigSize();
                        UploadSlotConfig();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            myProgressBarjindu.Value = p;
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    if (checkdb.Checked == true)
                    {
                        DbSize();
                        UploadDb();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            myProgressBarjindu.Value = p;
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    if (checkapp.Checked == true)
                    {
                        AppSize();
                        UploadApp();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            myProgressBarjindu.Value = p;
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    if (checkcode.Checked == true)
                    {
                        CodeSize();
                        UploadCode();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    if (checknms.Checked == true)
                    {
                        NmsSize();
                        UploadNms();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            myProgressBarjindu.Value = p;
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    if (checksw.Checked == true)
                    {
                        SwSize();
                        UploadSw();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            myProgressBarjindu.Value = p;
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    if (check760s.Checked == true)
                    {
                        Fpga760sSize();
                        Upload760s();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            myProgressBarjindu.Value = p;
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    if (check760b.Checked == true)
                    {
                        Fpga760bSize();
                        Upload760b();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            myProgressBarjindu.Value = p;
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    if (check760c.Checked == true)
                    {
                        Fpga760cSize();
                        Upload760c();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            myProgressBarjindu.Value = p;
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    if (check760d.Checked == true)
                    {
                        Fpga760dSIze();
                        Upload760d();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            myProgressBarjindu.Value = p;
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    if (check760e.Checked == true)
                    {
                        Fpga760eSize();
                        Upload760e();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            myProgressBarjindu.Value = p;
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    if (checkuxc.Checked == true)
                    {
                        Fpga760fSize();
                        Upload760f();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            myProgressBarjindu.Value = p;
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    if (checksysfile.Checked == true)
                    {
                        SysfileSize();
                        UploadSysfile();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            myProgressBarjindu.Value = p;
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    if (checkflash.Checked == true)
                    {
                        Filesize = 33554432;
                        UploadFlash();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            myProgressBarjindu.Value = p;
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    if (checkyaffs.Checked == true)
                    {
                        Filesize = 553648128;
                        UploadYaffs();
                        if (s == p)
                        {
                            if (UpLoadFile_Stop)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                return;
                            }
                            if (UpLoadFile_On_Off)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                UpLoadFilePause = new ManualResetEvent(false);
                                UpLoadFilePause.WaitOne();
                            }
                            myProgressBarjindu.Value = p;
                            //toolStripStatusLabelbar.Text = p + "%";
                            System.Threading.Thread.Sleep(XHTime);
                            p = s + p;
                        }
                        else
                        {
                            if (p > 95 && p <= 100)
                            {
                                p = 100;
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                            }
                            else
                            {
                                if (UpLoadFile_Stop)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "已停止！\r\n");
                                    return;
                                }
                                if (UpLoadFile_On_Off)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "暂停中！\r\n");
                                    UpLoadFilePause = new ManualResetEvent(false);
                                    UpLoadFilePause.WaitOne();
                                }
                                myProgressBarjindu.Value = p;
                                //toolStripStatusLabelbar.Text = p + "%";
                                System.Threading.Thread.Sleep(XHTime);
                                p = s + p;
                            }
                        }
                    }
                    Thread.Sleep(XHTime);
                    string canyu = mysocket.ReceiveData(int.Parse(ts));
                    toolStripStatusLabelzt.Text = "已完成";
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份结束" + "================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    butsend.PerformClick();
                    UpLoadFile_Stop = true;
                    Mytimer.Change(Timeout.Infinite, 1000);
                }
                else
                {
                    textDOS.AppendText("\r\n" + "该设备不支持文件上传，请使用其方式！");
                    return;

                }
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }
        }
        private void UploadConfig()
        {
            toolStripStatusLabelzt.Text = "正在备份config文件";             //上传状态栏显示
            string strname = labconfigname.Text;                            //上传文件类型
            int xunhuantime = 10;                                           //循环时间
            int xunhuancishu = 1000;                                        //循环次数           
            string uploadfilename = " file /flash/sys/conf_data.txt ";      //上传文件名
            string uploadfilenamesave = "config.txt";                       //上传后命名
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp" + uploadfilename + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + uploadfilenamesave);
            for (int i = 1; i <= xunhuancishu; i++)
            {
                string ok = "ok";
                string serveron = "Fail to connect to server";
                string user = "User need password";
                string foundfile = "The specified file does not exist";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(serveron))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "==================请检查FTP服务器IP是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(user))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(foundfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "==========================设备内不存在该文件==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(xunhuantime);
            }
        }
        private void UploadSlotConfig()
        {
            toolStripStatusLabelzt.Text = "正在备份slotconfig文件";             //上传状态栏显示
            string strname = labslotname.Text;                            //上传文件类型
            int xunhuantime = 10;                                           //循环时间
            int xunhuancishu = 10000;                                        //循环次数           
            string uploadfilename = " file /flash/sys/slotconfig.bin ";      //上传文件名
            string uploadfilenamesave = "slotconfig.bin";                       //上传后命名
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp" + uploadfilename + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + uploadfilenamesave);
            for (int i = 1; i <= xunhuancishu; i++)
            {
                string ok = "ok";
                string failed = "Upload file ...failed";
                string serveron = "Fail to connect to server";
                string user = "User need password";
                string foundfile = "The specified file does not exist";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(failed))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=========================上传config文件失败==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(serveron))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "==================请检查FTP服务器IP是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(user))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(foundfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "==========================设备内不存在该文件==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(xunhuantime);
            }
        }
        private void UploadDb()
        {
            toolStripStatusLabelzt.Text = "正在备份db文件";             //上传状态栏显示
            string strname = labdbname.Text;                            //上传文件类型
            int xunhuantime = 10;                                           //循环时间
            int xunhuancishu = 10000;                                        //循环次数           
            string uploadfilename = " file /flash/sys/db.bin ";      //上传文件名
            string uploadfilenamesave = "db.bin";                       //上传后命名
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp" + uploadfilename + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + uploadfilenamesave);
            for (int i = 1; i <= xunhuancishu; i++)
            {
                string ok = "ok";
                string serveron = "Fail to connect to server";
                string user = "User need password";
                string foundfile = "The specified file does not exist";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(serveron))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=====================请检查FTP服务器IP是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(user))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(foundfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "============================设备内不存在该文件==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(xunhuantime);
            }
        }
        private void UploadApp()
        {
            toolStripStatusLabelzt.Text = "正在备份App文件";             //上传状态栏显示
            string strname = labappname.Text;                            //上传文件类型
            int xunhuantime = 10;                                           //循环时间
            int xunhuancishu = 10000;                                        //循环次数           
            string uploadfilename = " app ";      //上传文件名
            string uploadfilenamesave = version + ".bin gpn";                       //上传后命名
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp" + uploadfilename + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + uploadfilenamesave);
            for (int i = 1; i <= xunhuancishu; i++)
            {
                string ok = "ok";
                string serveron = "Fail to connect to server";
                string user = "User need password";
                string foundfile = "The specified file does not exist";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(serveron))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "====================请检查FTP服务器IP是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(user))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "==========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(foundfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===========================设备内不存在该文件==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(xunhuantime);
            }
        }
        private void UploadCode()
        {
            toolStripStatusLabelzt.Text = "正在备份fpga_code文件";             //上传状态栏显示
            string strname = labcodename.Text;                            //上传文件类型
            int xunhuantime = 10;                                           //循环时间
            int xunhuancishu = 10000;                                        //循环次数           
            string uploadfilename = " file /yaffs/sys/fpga_code.bin ";      //上传文件名
            string uploadfilename2 = " file /flash/sys/fpga_code.bin ";      //上传文件名
            string uploadfilenamesave = "fpga_code.bin";                       //上传后命名
            //textDOS.AppendText("已执行保存");
            if (toolStripStatusLabelver.Text.Contains("R13"))
            {
                mysocket.SendData("upload ftp" + uploadfilename2 + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + uploadfilenamesave);
            }
            else
            {
                mysocket.SendData("upload ftp" + uploadfilename + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + uploadfilenamesave);
            }
            for (int i = 1; i <= xunhuancishu; i++)
            {
                string ok = "ok";
                string serveron = "Fail to connect to server";
                string user = "User need password";
                string foundfile = "The specified file does not exist";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(serveron))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===================请检查FTP服务器IP是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(user))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(foundfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===========================设备内不存在该文件==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(xunhuantime);
            }
        }
        private void Upload760s()
        {
            toolStripStatusLabelzt.Text = "正在备份fpga760s文件";             //上传状态栏显示
            string strname = lab760sname.Text;                            //上传文件类型
            int xunhuantime = 10;                                           //循环时间
            int xunhuancishu = 10000;                                        //循环次数           
            string uploadfilename = " file /yaffs/sys/760s.fpga ";      //上传文件名
            string uploadfilenamesave = "760s.fpga";                       //上传后命名
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp" + uploadfilename + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + uploadfilenamesave);
            for (int i = 1; i <= xunhuancishu; i++)
            {
                string ok = "ok";
                string serveron = "Fail to connect to server";
                string user = "User need password";
                string foundfile = "The specified file does not exist";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(serveron))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===================请检查FTP服务器IP是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(user))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "==========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(foundfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===========================设备内不存在该文件==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(xunhuantime);
            }
        }
        private void Upload760b()
        {
            toolStripStatusLabelzt.Text = "正在备份fpga760b文件";             //上传状态栏显示
            string strname = lab760bname.Text;                            //上传文件类型
            int xunhuantime = 10;                                           //循环时间
            int xunhuancishu = 10000;                                        //循环次数           
            string uploadfilename = " file /yaffs/sys/760b.fpga ";      //上传文件名
            string uploadfilenamesave = "760b.fpga";                       //上传后命名
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp" + uploadfilename + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + uploadfilenamesave);
            for (int i = 1; i <= xunhuancishu; i++)
            {
                string ok = "ok";
                string serveron = "Fail to connect to server";
                string user = "User need password";
                string foundfile = "The specified file does not exist";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(serveron))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "====================请检查FTP服务器IP是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(user))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "==========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(foundfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===========================设备内不存在该文件==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(xunhuantime);
            }
        }
        private void Upload760c()
        {
            toolStripStatusLabelzt.Text = "正在备份fpga760c文件";             //上传状态栏显示
            string strname = lab760cname.Text;                            //上传文件类型
            int xunhuantime = 10;                                           //循环时间
            int xunhuancishu = 10000;                                        //循环次数           
            string uploadfilename = " file /yaffs/sys/760c.fpga ";      //上传文件名
            string uploadfilenamesave = "760c.fpga";                       //上传后命名
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp" + uploadfilename + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + uploadfilenamesave);
            for (int i = 1; i <= xunhuancishu; i++)
            {
                string ok = "ok";
                string serveron = "Fail to connect to server";
                string user = "User need password";
                string foundfile = "The specified file does not exist";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(serveron))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "====================请检查FTP服务器IP是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(user))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "==========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(foundfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===========================设备内不存在该文件==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(xunhuantime);
            }
        }
        private void Upload760d()
        {
            toolStripStatusLabelzt.Text = "正在备份fpga760d文件";             //上传状态栏显示
            string strname = lab760dname.Text;                            //上传文件类型
            int xunhuantime = 10;                                           //循环时间
            int xunhuancishu = 10000;                                        //循环次数           
            string uploadfilename = " file /yaffs/sys/760d.fpga ";      //上传文件名
            string uploadfilenamesave = "760d.fpga";                       //上传后命名
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp" + uploadfilename + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + uploadfilenamesave);
            for (int i = 1; i <= xunhuancishu; i++)
            {
                string ok = "ok";
                string serveron = "Fail to connect to server";
                string user = "User need password";
                string foundfile = "The specified file does not exist";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(serveron))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "====================请检查FTP服务器IP是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(user))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "==========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(foundfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===========================设备内不存在该文件==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(xunhuantime);
            }
        }
        private void Upload760e()
        {
            toolStripStatusLabelzt.Text = "正在备份fpga760e文件";             //上传状态栏显示
            string strname = lab760ename.Text;                            //上传文件类型
            int xunhuantime = 10;                                           //循环时间
            int xunhuancishu = 10000;                                        //循环次数           
            string uploadfilename = " file /yaffs/sys/760e.fpga ";      //上传文件名
            string uploadfilenamesave = "760e.fpga";                       //上传后命名
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp" + uploadfilename + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + uploadfilenamesave);
            for (int i = 1; i <= xunhuancishu; i++)
            {
                string ok = "ok";
                string serveron = "Fail to connect to server";
                string user = "User need password";
                string foundfile = "The specified file does not exist";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(serveron))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "====================请检查FTP服务器IP是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(user))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "==========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(foundfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===========================设备内不存在该文件==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(xunhuantime);
            }
        }
        private void Upload760f()
        {
            toolStripStatusLabelzt.Text = "正在备份760F文件";             //上传状态栏显示
            string strname = lab760uxcname.Text;                            //上传文件类型
            int xunhuantime = 10;                                           //循环时间
            int xunhuancishu = 10000;                                        //循环次数           
            string uploadfilename = " file /yaffs/sys/760f.fpga ";      //上传文件名
            string uploadfilenamesave = "760f.fpga";                       //上传后命名
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp" + uploadfilename + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + uploadfilenamesave);
            for (int i = 1; i <= xunhuancishu; i++)
            {
                string ok = "ok";
                string serveron = "Fail to connect to server";
                string user = "User need password";
                string foundfile = "The specified file does not exist";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(serveron))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=================请检查FTP服务器IP是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(user))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(foundfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=========================设备内不存在该文件==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(xunhuantime);
            }
        }
        private void UploadNms()
        {
            toolStripStatusLabelzt.Text = "正在备份Nms文件";             //上传状态栏显示
            string strname = labnmsname.Text;                            //上传文件类型
            int xunhuantime = 10;                                           //循环时间
            int xunhuancishu = 10000;                                        //循环次数           
            string uploadfilename = " file /flash/sys/nms.fpga ";      //上传文件名
            string uploadfilenamesave = "nms.fpga";                       //上传后命名
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp" + uploadfilename + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + uploadfilenamesave);
            for (int i = 1; i <= xunhuancishu; i++)
            {
                string ok = "ok";
                string serveron = "Fail to connect to server";
                string user = "User need password";
                string foundfile = "The specified file does not exist";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "================================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(serveron))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=====================请检查FTP服务器IP是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(user))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "===========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(foundfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "============================设备内不存在该文件==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(xunhuantime);
            }
        }
        private void UploadSw()
        {
            toolStripStatusLabelzt.Text = "正在备份Sw文件";             //上传状态栏显示
            string strname = labswname.Text;                            //上传文件类型
            int xunhuantime = 10;                                           //循环时间
            int xunhuancishu = 10000;                                        //循环次数           
            string uploadfilename = " file /flash/sys/sw.fpga ";      //上传文件名
            string uploadfilenamesave = "sw.fpga";                       //上传后命名
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp" + uploadfilename + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + uploadfilenamesave);
            for (int i = 1; i <= xunhuancishu; i++)
            {
                string ok = "ok";
                string serveron = "Fail to connect to server";
                string user = "User need password";
                string foundfile = "The specified file does not exist";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(serveron))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "==================请检查FTP服务器IP是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(user))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(foundfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "==========================设备内不存在该文件==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(xunhuantime);
            }
        }
        private void UploadSysfile()
        {
            toolStripStatusLabelzt.Text = "正在备份Sysfile文件";             //上传状态栏显示
            string strname = labsysfilename.Text;                            //上传文件类型
            int xunhuantime = 10;                                           //循环时间
            int xunhuancishu = 1000;                                        //循环次数           
            string uploadfilename = " sysfile ";                            //上传文件名
            string uploadfilenamesave = "sysfile_ini.bin";                       //上传后命名
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp" + uploadfilename + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + uploadfilenamesave);
            for (int i = 0; i <= xunhuancishu; i++)
            {
                string ok = "ok";
                string serveron = "Fail to connect to server";
                string user = "User need password";
                string foundfile = "The specified file does not exist";
                string uploadfile = "file ...failed";
                string box = mysocket.ReceiveData(int.Parse(ts)); ;
                if (box.Contains(ok))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(serveron))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=================请检查FTP服务器IP是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(user))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(foundfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=========================设备内不存在该文件==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(uploadfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "================================文件上传失败==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(xunhuantime);
            }
        }
        private void UploadNetid()
        {
            toolStripStatusLabelzt.Text = "正在备份Netid文件";             //上传状态栏显示
            string strname = "Netid";                            //上传文件类型
            int xunhuantime = 10;                                           //循环时间
            int xunhuancishu = 1000;                                        //循环次数           
            string uploadfilename = " file /flash/sys/netid.txt ";                            //上传文件名
            string uploadfilenamesave = "netid.txt";
            bool okstart = false;
            //上传后命名
            //textDOS.AppendText("已执行保存");
            mysocket.SendData("upload ftp" + uploadfilename + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd-HH-mm-ss") + "_" + uploadfilenamesave);
            for (int i = 0; i <= xunhuancishu; i++)
            {
                string ok = "ok";
                string serveron = "Fail to connect to server";
                string user = "User need password";
                string foundfile = "The specified file does not exist";
                string uploadfile = "file ...failed";
                string end = "Release ftp operational popedom!";
                string box = mysocket.ReceiveData(int.Parse(ts));
                if (box.Contains(ok) || okstart == true)
                {
                    okstart = true;
                    if (box.Contains(end))
                    {
                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                        break;
                    }
                }
                if (box.Contains(serveron))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=================请检查FTP服务器IP是否开启==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(user))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "========================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains(foundfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "=========================设备内不存在该文件==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(uploadfile))
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "备份" + strname + "================================文件上传失败==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                Thread.Sleep(xunhuantime);
            }
        }
        #region 上传 Flash
        private void UploadFlash()
        {
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            toolStripStatusLabelzt.Text = "正在上传Flash";
            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "上传Flash进度===========================================O%");
            mysocket.SendData("upload ftp flash " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_flash.bin gpn");
            for (int i = 1; i <= 10000; i++)
            {
                string ok = "100%";
                string fail = "fail";
                string box = mysocket.ReceiveData(int.Parse(ts));
                if (box.Contains("%"))
                {
                    String str; //字符复制串变量
                    str = textDOS.Text; //获取文本百框中的文本赋与字符串变量
                                        //提取度去除最后一问个字符的子字答符串(参数：0(从零Index处开始)，str.Lenght-1(提取几个字符))
                    str = str.Substring(0, str.Length - 4);
                    textDOS.Text = str; //赋回已删除最后一个字符的字符串给textBox
                    textDOS.AppendText(box);
                }
                if (box.Contains(ok))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "上传Flash ==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "上传Flash=============================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains("User need password"))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "上传Flash=======================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
        }
        #endregion
        #region 上传 Yaffs
        private void UploadYaffs()
        {
            Thread.Sleep(XHTime);
            string cccc = mysocket.ReceiveData(int.Parse(ts));
            toolStripStatusLabelzt.Text = "正在上传Yaffs";
            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "上传Yaffs文件大小约有528MB,大约需要20分钟，请耐心等待！" + toolStripStatusLabeltime.Text + "\r\n");
            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "上传Yaffs进度===========================================O%");
            mysocket.SendData("upload ftp yaffs " + comftpip.Text + " " + textftpusr.Text + " " + textftppsd.Text + " " + comip.Text + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_yaffs.bin");
            for (int i = 1; i <= 100000; i++)
            {
                string ok = "100%";
                string fail = "fail";
                string box = mysocket.ReceiveData(int.Parse(ts));
                if (box.Contains("%"))
                {
                    String str; //字符复制串变量
                    str = textDOS.Text; //获取文本百框中的文本赋与字符串变量
                                        //提取度去除最后一问个字符的子字答符串(参数：0(从零Index处开始)，str.Lenght-1(提取几个字符))
                    str = str.Substring(0, str.Length - 4);
                    textDOS.Text = str; //赋回已删除最后一个字符的字符串给textBox
                    textDOS.AppendText(box);
                }
                if (box.Contains(ok))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "上传Yaffs==============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains(fail))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "上传Yaffs=============================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                if (box.Contains("User need password"))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "上传Yaffs=======================请检查FTP用户名密码==NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
        }
        #endregion
        private void Uploadsave()
        {
            toolStripStatusLabelzt.Text = "正在保存配置";
            mysocket.SendData("save");
            for (int i = 1; i <= 20; i++)
            {
                string save = "successfully";
                string box = mysocket.ReceiveData(int.Parse(ts));
                if (box.Contains(save))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "保存配置===============================================OK" + toolStripStatusLabeltime.Text + "\r\n");
                    break;
                }
                if (box.Contains("erro"))
                {
                    textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "保存配置==============================================NOK" + toolStripStatusLabeltime.Text + "\r\n");
                    butCycleStart.Text = "⑤开始备份";
                    return;
                }
                Thread.Sleep(XHTime);
            }
            Thread.Sleep(XHTime);
            string box1 = mysocket.ReceiveData(int.Parse(ts));
        }
        private void Butotnpaigu_Click(object sender, EventArgs e)
        {
            Thread t = new Thread(OTNGuzhangpaicha);
            t.Start();
        }
        public void OTNGuzhangpaicha(object obj)
        {
            try
            {
                textcurrent.Text = "当前窗口：" + "\r\n";
                richTextEnd.Text = "故障排查结果：" + "\r\n";
                textlog.Text = "故障排查日志：" + "\r\n";
                butguzhangsend.PerformClick();
                if (!textcurrent.Text.Contains("#"))
                {
                    MessageBox.Show("检测发现：未运行在(config)#模式下，请断开后重新连接，再次尝试！");
                    return;
                }
                textguzhangmingling.Text = "screen lines 40";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "config otn";
                butguzhangsend.PerformClick();
                textlog.AppendText(textcurrent.Text);
                textcurrent.Text = "";
                string[,] dxc = null;
                int dxcrow = 0;
                int dxccol = 0;
                string dxctype = "";
                if (comDtype.Text == "any")
                {
                    dxctype = "client";
                }
                if (comDtype.Text == "sdh")
                {
                    dxctype = "vsdh";
                }
                if (comDtype.Text == "eth")
                {
                    dxctype = "veth";
                }
                if (comDtype.Text == "otu")
                {
                    dxctype = "client";
                }
                bool findts = false;

                string SDTS = comDtype.Text + " " + comDslot.Text + "/" + comDport.Text + "/" + comDts.Text;
                string SATS = "otu " + comSslot.Text + "/" + comSport.Text + "/" + comSts.Text;
                string SBTS = "otu " + comSBslot.Text + "/" + comSBport.Text + "/" + comSBts.Text;

                if (toolStripStatusLabeldevtype.Text.Contains("GPN800"))
                {
                    string s = (int.Parse(comSslot.Text) - 2).ToString("x");
                    textguzhangmingling.Text = "dm 0xf9" + s + "00100 10";
                    butguzhangsend.PerformClick();

                    dxc = FindDevType.StringToArray(textcurrent.Text);
                    dxcrow = dxc.GetLength(0);
                    dxccol = dxc.GetLength(1);
                    richTextEnd.AppendText("主用槽位FPGA查询：" + "\r\n");
                    richTextEnd.AppendText(comSslot.Text + "槽位FPGA类型：" + dxc[2, 1] + dxc[2, 2] + "\r\n");
                    richTextEnd.AppendText(comSslot.Text + "槽位FPGA版本：" + dxc[2, 4] + dxc[2, 6] + "\r\n");
                    richTextEnd.AppendText(comSslot.Text + "槽位FPGA时间：" + dxc[2, 7] + dxc[2, 8] + "-" + dxc[2, 9] + "-" + dxc[2, 10] + "\r\n");
                    textlog.AppendText(textcurrent.Text);
                    textcurrent.Text = "";
                }
                else
                {
                    if (comSNC.Text == "没有配置保护" || comSNC.Text == "OCH")
                    {
                        string s = (int.Parse(comSslot.Text) - 1).ToString("x");
                        textguzhangmingling.Text = "dm 0xf9" + s + "00100 10";
                        butguzhangsend.PerformClick();

                        dxc = FindDevType.StringToArray(textcurrent.Text);
                        dxcrow = dxc.GetLength(0);
                        dxccol = dxc.GetLength(1);
                        richTextEnd.AppendText("主用槽位FPGA查询：" + "\r\n");
                        richTextEnd.AppendText(comSslot.Text + "槽位FPGA类型：" + dxc[2, 1] + dxc[2, 2] + "\r\n");
                        richTextEnd.AppendText(comSslot.Text + "槽位FPGA版本：" + dxc[2, 4] + dxc[2, 6] + "\r\n");
                        richTextEnd.AppendText(comSslot.Text + "槽位FPGA时间：" + dxc[2, 7] + dxc[2, 8] + "-" + dxc[2, 9] + "-" + dxc[2, 10] + "\r\n");
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                        if (comSNC.Text == "OCH")
                        {
                            string sb = (int.Parse(comSBslot.Text) - 1).ToString("x");
                            textguzhangmingling.Text = "dm 0xf9" + sb + "00100 10";
                            butguzhangsend.PerformClick();

                            dxc = FindDevType.StringToArray(textcurrent.Text);
                            dxcrow = dxc.GetLength(0);
                            dxccol = dxc.GetLength(1);
                            richTextEnd.AppendText("备用槽位FPGA查询：" + "\r\n");
                            richTextEnd.AppendText(comSBslot.Text + "槽位FPGA类型：" + dxc[2, 1] + dxc[2, 2] + "\r\n");
                            richTextEnd.AppendText(comSBslot.Text + "槽位FPGA版本：" + dxc[2, 4] + dxc[2, 6] + "\r\n");
                            richTextEnd.AppendText(comSBslot.Text + "槽位FPGA时间：" + dxc[2, 7] + dxc[2, 8] + "-" + dxc[2, 9] + "-" + dxc[2, 10] + "\r\n");
                            textlog.AppendText(textcurrent.Text);
                            textcurrent.Text = "";
                        }
                        textguzhangmingling.Text = "show dxc";
                        butguzhangsend.PerformClick();
                        dxc = FindDevType.StringToArray(textcurrent.Text);
                        dxcrow = dxc.GetLength(0);
                        dxccol = dxc.GetLength(1);
                        for (int i = 0; i < dxcrow; i++)
                        {

                            if (dxc[i, 5] != null)
                            {
                                if (dxc[i, 5] == dxctype + "/" + comoduk.Text + "/" + comDslot.Text + "/" + comDport.Text + "/" + comDts.Text)
                                {
                                    if (dxc[i, 6] == "line" + "/" + comoduk.Text + "/" + comSslot.Text + "/" + comSport.Text + "/" + comSts.Text)
                                    {
                                        richTextEnd.AppendText("软件oduk交叉：" + "\r\n");
                                        richTextEnd.AppendText(SDTS + "源时隙：" + dxc[i, 5] + "\r\n");
                                        richTextEnd.AppendText(SATS + "宿时隙：" + dxc[i, 6] + "\r\n");
                                        findts = true;
                                        break;

                                    }
                                }
                            }

                            if (dxc[i, 6] != null)
                            {
                                if (dxc[i, 6] == dxctype + "/" + comoduk.Text + "/" + comDslot.Text + "/" + comDport.Text + "/" + comDts.Text)
                                {
                                    if (dxc[i, 5] == "line" + "/" + comoduk.Text + "/" + comSslot.Text + "/" + comSport.Text + "/" + comSts.Text)
                                    {
                                        richTextEnd.AppendText("软件oduk交叉：" + "\r\n");
                                        richTextEnd.AppendText(SATS + "源时隙：" + dxc[i, 5] + "\r\n");
                                        richTextEnd.AppendText(SDTS + "宿时隙：" + dxc[i, 6] + "\r\n");
                                        findts = true;
                                        break;

                                    }
                                }
                            }

                        }
                        if (findts == false)
                        {
                            richTextEnd.AppendText("软件oduk交叉：不存在或错误 NOK" + "\r\n");
                            richTextEnd.AppendText("您勾选源时隙：" + comSslot.Text + "/" + comSport.Text + "/" + comSts.Text + "\r\n");
                            richTextEnd.AppendText("您勾选宿时隙：" + comDtype.Text + " " + comoduk.Text + " " + comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "\r\n");
                        }
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                    }
                    else
                    {

                        string s = (int.Parse(comSslot.Text) - 1).ToString("x");
                        textguzhangmingling.Text = "dm 0xf9" + s + "00100 10";
                        butguzhangsend.PerformClick();

                        dxc = FindDevType.StringToArray(textcurrent.Text);
                        dxcrow = dxc.GetLength(0);
                        dxccol = dxc.GetLength(1);
                        richTextEnd.AppendText("主用槽位FPGA查询：" + "\r\n");
                        richTextEnd.AppendText(comSslot.Text + "槽位FPGA类型：" + dxc[2, 1] + dxc[2, 2] + "\r\n");
                        richTextEnd.AppendText(comSslot.Text + "槽位FPGA版本：" + dxc[2, 4] + dxc[2, 6] + "\r\n");
                        richTextEnd.AppendText(comSslot.Text + "槽位FPGA时间：" + dxc[2, 7] + dxc[2, 8] + "-" + dxc[2, 9] + "-" + dxc[2, 10] + "\r\n");
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                        string sb = (int.Parse(comSBslot.Text) - 1).ToString("x");
                        textguzhangmingling.Text = "dm 0xf9" + sb + "00100 10";
                        butguzhangsend.PerformClick();

                        dxc = FindDevType.StringToArray(textcurrent.Text);
                        dxcrow = dxc.GetLength(0);
                        dxccol = dxc.GetLength(1);
                        richTextEnd.AppendText("备用槽位FPGA查询：" + "\r\n");
                        richTextEnd.AppendText(comSBslot.Text + "槽位FPGA类型：" + dxc[2, 1] + dxc[2, 2] + "\r\n");
                        richTextEnd.AppendText(comSBslot.Text + "槽位FPGA版本：" + dxc[2, 4] + dxc[2, 6] + "\r\n");
                        richTextEnd.AppendText(comSBslot.Text + "槽位FPGA时间：" + dxc[2, 7] + dxc[2, 8] + "-" + dxc[2, 9] + "-" + dxc[2, 10] + "\r\n");
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";


                        textguzhangmingling.Text = "show dxc";
                        butguzhangsend.PerformClick();
                        dxc = FindDevType.StringToArray(textcurrent.Text);
                        dxcrow = dxc.GetLength(0);
                        dxccol = dxc.GetLength(1);

                        for (int i = 0; i < dxcrow; i++)
                        {

                            if (dxc[i, 5] != null)
                            {
                                if (dxc[i, 5] == dxctype + "/" + comoduk.Text + "/" + comDslot.Text + "/" + comDport.Text + "/" + comDts.Text)
                                {
                                    if (dxc[i, 6] == "line" + "/" + comoduk.Text + "/" + comSslot.Text + "/" + comSport.Text + "/" + comSts.Text)
                                    {
                                        if (dxc[i, 7] == "line" + "/" + comoduk.Text + "/" + comSBslot.Text + "/" + comSBport.Text + "/" + comSBts.Text)
                                        {
                                            richTextEnd.AppendText("软件oduk交叉：" + "\r\n");
                                            richTextEnd.AppendText(SDTS + "源时隙：" + dxc[i, 5] + "\r\n");
                                            richTextEnd.AppendText(SATS + "宿时隙：" + dxc[i, 6] + "\r\n");
                                            richTextEnd.AppendText(SBTS + "备时隙：" + dxc[i, 7] + "\r\n");
                                            findts = true;
                                            break;

                                        }

                                    }
                                }
                            }

                            if (dxc[i, 6] != null)
                            {
                                if (dxc[i, 6] == dxctype + "/" + comoduk.Text + "/" + comDslot.Text + "/" + comDport.Text + "/" + comDts.Text)
                                {
                                    if (dxc[i, 5] == "line" + "/" + comoduk.Text + "/" + comSslot.Text + "/" + comSport.Text + "/" + comSts.Text)
                                    {
                                        if (dxc[i, 7] == "line" + "/" + comoduk.Text + "/" + comSBslot.Text + "/" + comSBport.Text + "/" + comSBts.Text)
                                        {
                                            richTextEnd.AppendText("软件oduk交叉：" + "\r\n");
                                            richTextEnd.AppendText(SATS + "源时隙：" + dxc[i, 5] + "\r\n");
                                            richTextEnd.AppendText(SDTS + "宿时隙：" + dxc[i, 6] + "\r\n");
                                            richTextEnd.AppendText(SBTS + "备时隙：" + dxc[i, 7] + "\r\n");
                                            findts = true;
                                            break;

                                        }

                                    }
                                }
                            }


                        }
                        if (findts == false)
                        {
                            richTextEnd.AppendText("软件oduk交叉：不存在或错误 NOK" + "\r\n");
                            richTextEnd.AppendText("您勾选主用源时隙：" + comSslot.Text + "/" + comSport.Text + "/" + comSts.Text + "\r\n");
                            richTextEnd.AppendText("您勾选备用源时隙：" + comSBslot.Text + "/" + comSBport.Text + "/" + comSBts.Text + "\r\n");
                            richTextEnd.AppendText("您勾选业务宿时隙：" + comDtype.Text + " " + comoduk.Text + " " + comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "\r\n");
                        }
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";

                    }
                }


                if (comSslot.Text == comDslot.Text)
                {

                    textguzhangmingling.Text = "ioctl " + comoduk.Text + " dxc get " + comSslot.Text + " otu " + comSport.Text + "/" + comSts.Text;
                    butguzhangsend.PerformClick();

                    dxc = FindDevType.StringToArray(textcurrent.Text);

                    if (dxc[4, 1] != null && dxc[4, 2] != null && dxc[4, 3] != null)
                    {
                        string fpgatss = dxc[4, 1] + "/" + dxc[4, 2] + "/" + dxc[4, 3];
                        string fpgatsd = dxc[4, 4] + "/" + dxc[4, 5] + "/" + dxc[4, 6];


                        if (fpgatss.Equals("OTU" + "/" + comSport.Text + "/" + comSts.Text, StringComparison.OrdinalIgnoreCase))
                        {

                            if (fpgatsd.Equals(comDtype.Text + "/" + comDport.Text + "/" + comDts.Text, StringComparison.OrdinalIgnoreCase))
                            {

                                richTextEnd.AppendText(SATS + "源驱动交叉：" + "\r\n");
                                richTextEnd.AppendText("主用源时隙：" + fpgatsd + "\r\n");
                                richTextEnd.AppendText("主用宿时隙：" + fpgatss + "\r\n");

                            }
                            else
                            {
                                richTextEnd.AppendText(SATS + "源驱动交叉：不存在或错误 NOK" + "\r\n");
                            }
                        }
                        else
                        {
                            richTextEnd.AppendText(SATS + "源驱动交叉：不存在或错误 NOK" + "\r\n");
                        }
                    }
                    else
                    {
                        richTextEnd.AppendText(SATS + "源驱动交叉：不存在或错误 NOK" + "\r\n");
                    }
                    textlog.AppendText(textcurrent.Text);
                    textcurrent.Text = "";


                    if (comSNC.Text == "没有配置保护")
                    {
                        textguzhangmingling.Text = "ioctl " + comoduk.Text + " dxc get " + comDslot.Text + " " + comDtype.Text + " " + comDport.Text + "/" + comDts.Text;
                        butguzhangsend.PerformClick();
                        dxc = FindDevType.StringToArray(textcurrent.Text);



                        if (dxc[4, 1] != null && dxc[4, 2] != null && dxc[4, 3] != null)
                        {
                            string fpgatss = dxc[4, 1] + "/" + dxc[4, 2] + "/" + dxc[4, 3];
                            string fpgatsd = dxc[4, 4] + "/" + dxc[4, 5] + "/" + dxc[4, 6];
                            if (fpgatss.Equals(comDtype.Text + "/" + comDport.Text + "/" + comDts.Text, StringComparison.OrdinalIgnoreCase))
                            {
                                if (fpgatsd.Equals("OTU" + "/" + comSport.Text + "/" + comSts.Text, StringComparison.OrdinalIgnoreCase))
                                {
                                    richTextEnd.AppendText(SDTS + "宿驱动交叉：" + "\r\n");
                                    richTextEnd.AppendText("业务源时隙：" + fpgatsd + "\r\n");
                                    richTextEnd.AppendText("业务宿时隙：" + fpgatss + "\r\n");


                                }
                                else
                                {
                                    richTextEnd.AppendText(SDTS + "宿驱动交叉：不存在或错误 NOK" + "\r\n");
                                }
                            }
                            else
                            {
                                richTextEnd.AppendText(SDTS + "宿驱动交叉：不存在或错误 NOK" + "\r\n");
                            }
                        }
                        else
                        {
                            richTextEnd.AppendText(SDTS + "宿驱动交叉：不存在或错误 NOK" + "\r\n");

                        }


                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                    }
                    else
                    {

                        string fpgainnerd = "";

                        textguzhangmingling.Text = "ioctl " + comoduk.Text + " dxc get " + comDslot.Text + " " + comDtype.Text + " " + comDport.Text + "/" + comDts.Text;
                        butguzhangsend.PerformClick();

                        dxc = FindDevType.StringToArray(textcurrent.Text);

                        if (dxc[4, 4] != null && dxc[4, 5] != null && dxc[4, 6] != null)
                        {

                            string fpgatss = dxc[4, 1] + "/" + dxc[4, 2] + "/" + dxc[4, 3];
                            fpgainnerd = dxc[4, 4] + "/" + dxc[4, 5];

                            if (fpgatss.Equals(comDtype.Text + "/" + comDport.Text + "/" + comDts.Text, StringComparison.OrdinalIgnoreCase))
                            {


                                richTextEnd.AppendText(SDTS + "宿驱动inner交叉：" + "\r\n");
                                richTextEnd.AppendText("业务inner时隙：" + fpgainnerd + "\r\n");
                                richTextEnd.AppendText("业务源时隙：" + fpgatss + "\r\n");

                            }
                        }
                        else
                        {
                            richTextEnd.AppendText(SDTS + "宿驱动inner交叉：不存在或错误 NOK" + "\r\n");
                        }
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                        string fpgainners = "";
                        textguzhangmingling.Text = "ioctl " + comoduk.Text + " dxc get " + comSBslot.Text + " otu " + comSBport.Text + "/" + comSBts.Text;
                        butguzhangsend.PerformClick();

                        dxc = FindDevType.StringToArray(textcurrent.Text);

                        if (dxc[4, 1] != null && dxc[4, 2] != null && dxc[4, 3] != null)
                        {
                            string fpgatss = dxc[4, 1] + "/" + dxc[4, 2] + "/" + dxc[4, 3];
                            fpgainners = dxc[4, 5] + "/" + dxc[4, 6];

                            if (fpgatss.Equals("OTU" + "/" + comSBport.Text + "/" + comSBts.Text, StringComparison.OrdinalIgnoreCase))
                            {


                                richTextEnd.AppendText(SBTS + "备驱动交叉：" + "\r\n");
                                richTextEnd.AppendText("保护inner时隙：" + fpgainners + "\r\n");
                                richTextEnd.AppendText("保护宿时隙：" + fpgatss + "\r\n");

                            }
                        }
                        else
                        {
                            richTextEnd.AppendText(SBTS + "备驱动交叉：不存在或错误 NOK" + "\r\n");
                        }
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                        textguzhangmingling.Text = "ioctl " + comoduk.Text + " dxc get " + comSBslot.Text + " inner " + fpgainners;
                        butguzhangsend.PerformClick();

                        dxc = FindDevType.StringToArray(textcurrent.Text);

                        if (dxc[4, 1] != null && dxc[4, 2] != null && dxc[4, 3] != null)
                        {

                            string fpgatss = dxc[4, 4] + "/" + dxc[4, 5] + "/" + dxc[4, 6];
                            if (fpgainners != dxc[4, 2] + "/" + dxc[4, 3])
                            {
                                richTextEnd.AppendText(SBTS + "备驱动inner交叉：不一致 NOK" + "\r\n");
                            }


                            if (fpgatss.Equals("OTU" + "/" + comSBport.Text + "/" + comSBts.Text, StringComparison.OrdinalIgnoreCase))
                            {


                                richTextEnd.AppendText(SBTS + "备驱动inner交叉：" + "\r\n");
                                richTextEnd.AppendText("保护inner时隙：" + fpgainners + "\r\n");
                                richTextEnd.AppendText("保护源时隙：" + fpgatss + "\r\n");

                            }
                        }
                        else
                        {
                            richTextEnd.AppendText(SBTS + "备驱动inner交叉：不存在或错误 NOK" + "\r\n");
                        }
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                    }

                }
                if (comSslot.Text != comDslot.Text)
                {
                    string fpgainners = "";
                    textguzhangmingling.Text = "ioctl " + comoduk.Text + " dxc get " + comSslot.Text + " otu " + comSport.Text + "/" + comSts.Text;
                    butguzhangsend.PerformClick();

                    dxc = FindDevType.StringToArray(textcurrent.Text);

                    if (dxc[4, 1] != null && dxc[4, 2] != null && dxc[4, 3] != null)
                    {
                        string fpgatss = dxc[4, 1] + "/" + dxc[4, 2] + "/" + dxc[4, 3];
                        fpgainners = dxc[4, 5] + "/" + dxc[4, 6];


                        if (fpgatss.Equals("OTU" + "/" + comSport.Text + "/" + comSts.Text, StringComparison.OrdinalIgnoreCase))
                        {


                            richTextEnd.AppendText(SATS + "源驱动交叉：" + "\r\n");
                            richTextEnd.AppendText("inner时隙：" + fpgainners + "\r\n");
                            richTextEnd.AppendText("宿时隙：" + fpgatss + "\r\n");

                        }
                    }
                    else
                    {
                        richTextEnd.AppendText(SATS + "源驱动交叉：不存在或错误 NOK" + "\r\n");
                    }
                    textlog.AppendText(textcurrent.Text);
                    textcurrent.Text = "";
                    textguzhangmingling.Text = "ioctl " + comoduk.Text + " dxc get " + comSslot.Text + " inner " + fpgainners;
                    butguzhangsend.PerformClick();

                    dxc = FindDevType.StringToArray(textcurrent.Text);

                    if (dxc[4, 1] != null && dxc[4, 2] != null && dxc[4, 3] != null)
                    {

                        string fpgatss = dxc[4, 4] + "/" + dxc[4, 5] + "/" + dxc[4, 6];
                        if (fpgainners != dxc[4, 2] + "/" + dxc[4, 3])
                        {
                            richTextEnd.AppendText(SATS + "源驱动inner交叉：不一致 NOK" + "\r\n");
                        }


                        if (fpgatss.Equals("OTU" + "/" + comSport.Text + "/" + comSts.Text, StringComparison.OrdinalIgnoreCase))
                        {


                            richTextEnd.AppendText(SATS + "源驱动inner交叉：" + "\r\n");
                            richTextEnd.AppendText("inner时隙：" + fpgainners + "\r\n");
                            richTextEnd.AppendText("源时隙：" + fpgatss + "\r\n");

                        }
                    }
                    else
                    {
                        richTextEnd.AppendText(SATS + "源驱动inner交叉：不存在或错误 NOK" + "\r\n");
                    }
                    textlog.AppendText(textcurrent.Text);
                    textcurrent.Text = "";

                    string fpgainnerd = "";
                    textguzhangmingling.Text = "ioctl " + comoduk.Text + " dxc get " + comDslot.Text + " " + comDtype.Text + " " + comDport.Text + "/" + comDts.Text;
                    butguzhangsend.PerformClick();

                    dxc = FindDevType.StringToArray(textcurrent.Text);

                    if (dxc[4, 1] != null && dxc[4, 2] != null && dxc[4, 3] != null)
                    {
                        string fpgatss = dxc[4, 1] + "/" + dxc[4, 2] + "/" + dxc[4, 3];
                        fpgainnerd = dxc[4, 5] + "/" + dxc[4, 6];

                        if (fpgatss.Equals(comDtype.Text + "/" + comDport.Text + "/" + comDts.Text, StringComparison.OrdinalIgnoreCase))
                        {


                            richTextEnd.AppendText(SDTS + "宿驱动交叉：" + "\r\n");
                            richTextEnd.AppendText("inner时隙：" + fpgainnerd + "\r\n");
                            richTextEnd.AppendText("宿时隙：" + fpgatss + "\r\n");

                        }
                    }
                    else
                    {
                        richTextEnd.AppendText(SDTS + "宿驱动交叉：不存在或错误 NOK" + "\r\n");
                    }

                    textlog.AppendText(textcurrent.Text);
                    textcurrent.Text = "";
                    textguzhangmingling.Text = "ioctl " + comoduk.Text + " dxc get " + comDslot.Text + " inner " + fpgainnerd;
                    butguzhangsend.PerformClick();

                    dxc = FindDevType.StringToArray(textcurrent.Text);

                    if (dxc[4, 1] != null && dxc[4, 2] != null && dxc[4, 3] != null)
                    {

                        string fpgatss = dxc[4, 4] + "/" + dxc[4, 5] + "/" + dxc[4, 6];
                        if (fpgainnerd != dxc[4, 2] + "/" + dxc[4, 3])
                        {
                            richTextEnd.AppendText(SDTS + "宿驱动inner交叉：不一致 NOK" + "\r\n");
                        }
                        if (fpgainnerd != fpgainners)
                        {
                            richTextEnd.AppendText(SDTS + "宿驱动inner交叉：不一致 NOK" + "\r\n");
                        }

                        if (fpgatss.Equals(comDtype.Text + "/" + comDport.Text + "/" + comDts.Text, StringComparison.OrdinalIgnoreCase))
                        {


                            richTextEnd.AppendText(SDTS + "宿驱动inner交叉：" + "\r\n");
                            richTextEnd.AppendText("inner时隙：" + fpgainnerd + "\r\n");
                            richTextEnd.AppendText("源时隙：" + fpgatss + "\r\n");

                        }
                    }
                    else
                    {
                        richTextEnd.AppendText(SDTS + "宿驱动inner交叉：不存在或错误 NOK" + "\r\n");
                    }
                    textlog.AppendText(textcurrent.Text);
                    textcurrent.Text = "";

                }



                if (checklpg.Checked == true && comSNC.Text == "OCH")
                {
                    textlog.AppendText("\r\n" + "///////////////////////////保护组" + comSslot.Text + "/" + comSport.Text + "状态查询/////////////////////////////////////////////" + "\r\n");
                    richTextEnd.AppendText("保护组状态查询：" + "\r\n");
                    textguzhangmingling.Text = "show lpg";
                    butguzhangsend.PerformClick();
                    string lpggrop = ".*otn" + comSslot.Text + "/" + comSport.Text;
                    Regex lpggrop0 = new Regex(lpggrop, RegexOptions.IgnoreCase);
                    string lpggrop1 = lpggrop0.Match(textcurrent.Text).Groups[0].Value;
                    if (lpggrop1 == "")
                    {
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                        textguzhangmingling.Text = "exit";
                        butguzhangsend.PerformClick();
                        MessageBox.Show("保护组端口:" + comSslot.Text + "/" + comSport.Text + "  未找到，请重新输入！");
                        return;
                    }
                    string[] VCGINFOFengGe = Regex.Split(lpggrop1, "\\s+", RegexOptions.IgnoreCase);
                    string LpgID = VCGINFOFengGe[1];

                    bool WorkingAlarm = false;
                    bool ProtectAlarm = false;

                    textguzhangmingling.Text = "create lpg " + LpgID;
                    butguzhangsend.PerformClick();
                    textguzhangmingling.Text = "show";
                    butguzhangsend.PerformClick();
                    for (int g = 0; g <= XHCount; g++)
                    {
                        if (textcurrent.Text.Contains("Ctrl+c"))
                        {
                            butguzhangsend.PerformClick();
                        }
                        else
                        {
                            Regex protection = new Regex(@"protection\s*type:\s*([\w]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Protection = protection.Match(textcurrent.Text).Groups[1].Value;
                            if (Protection == "SNC")
                            {
                                textguzhangmingling.Text = "exit";
                                butguzhangsend.PerformClick();
                                textlog.AppendText(textcurrent.Text);
                                textcurrent.Text = "";
                                textguzhangmingling.Text = "exit";
                                butguzhangsend.PerformClick();
                                MessageBox.Show("当前为SNC保护，请重新选择光口后尝试");
                                return;
                            }
                            Regex monitor = new Regex(@"monitor\s*mode:\s*([\w\d\/\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Monitor = monitor.Match(textcurrent.Text).Groups[1].Value;
                            Regex working = new Regex(@"working\s*port:\s*([\d\-\w\/\(\)\ \+]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Working = working.Match(textcurrent.Text).Groups[1].Value;
                            Regex protect = new Regex(@"protect\s*port:\s*([\d\-\w\/\(\)\ \+]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Protect = protect.Match(textcurrent.Text).Groups[1].Value;
                            Regex service = new Regex(@"service\s*port:\s*([\d\-\w\/\(\)\ \+]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Service = service.Match(textcurrent.Text).Groups[1].Value;
                            Regex lpgstate = new Regex(@"lpg-state:\s*([\d\-\w\/\(\)\ \+\:]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string LpgState = lpgstate.Match(textcurrent.Text).Groups[1].Value;
                            Regex count = new Regex(@"switch\s*count:\s*([\d\-\w\/\(\)\ \+\:]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Count = count.Match(textcurrent.Text).Groups[1].Value;
                            if (Monitor.Contains("LOS") || Monitor.Contains("LOF") || Monitor.Contains("LOM") || Monitor.Contains("AIS") || Monitor.Contains("SSF"))
                            {
                                richTextEnd.AppendText("检测模式：" + Monitor + "  NOK" + "\r\n");
                            }
                            else
                            {
                                richTextEnd.AppendText("检测模式：" + Monitor + "\r\n");
                            }
                            if (Working.Contains("SF") || Working.Contains("SD"))
                            {
                                richTextEnd.AppendText("主用：" + Working + "  NOK" + "\r\n");
                                working = new Regex(@"working\s*port:\s*otn([\d\/\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                Working = working.Match(textcurrent.Text).Groups[1].Value;
                                WorkingAlarm = true;
                            }
                            else
                            {
                                richTextEnd.AppendText("主用：" + Working + "\r\n");
                            }
                            if (Protect.Contains("SF") || Protect.Contains("SD"))
                            {
                                richTextEnd.AppendText("备用：" + Protect + "  NOK" + "\r\n");
                                protect = new Regex(@"protect\s*port:\s*otn([\d\/\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                Protect = protect.Match(textcurrent.Text).Groups[1].Value;
                                ProtectAlarm = true;
                            }
                            else
                            {
                                richTextEnd.AppendText("备用：" + Protect + "\r\n");
                            }
                            //richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "宿：" + Service + "\r\n");
                            richTextEnd.AppendText("倒换原因：" + LpgState + "\r\n");
                            richTextEnd.AppendText("倒换次数：" + Count + "\r\n");
                            textguzhangmingling.Text = "exit";
                            butguzhangsend.PerformClick();
                            if (WorkingAlarm == true)
                            {
                                textlog.AppendText("\r\n" + "///////////////////////////主用OTU接口告警查询/////////////////////////////////////////////" + "\r\n");
                                textguzhangmingling.Text = "ioctl otu show " + Working;
                                richTextEnd.AppendText("主用线路OTU接口告警查询：" + "\r\n");
                                butguzhangsend.PerformClick();
                                for (int h = 0; h <= 1000; h++)
                                {
                                    if (textcurrent.Text.Contains("Ctrl+c"))
                                    {
                                        butguzhangsend.PerformClick();
                                    }
                                    else
                                    {

                                        break;
                                    }
                                }
                                textcurrent.Text = "";
                                Thread.Sleep(XHTime);
                                textguzhangmingling.Text = "ioctl otu show " + Working;
                                butguzhangsend.PerformClick();
                                for (int h = 0; h <= 1000; h++)
                                {
                                    if (textcurrent.Text.Contains("Ctrl+c"))
                                    {
                                        butguzhangsend.PerformClick();
                                    }
                                    else
                                    {
                                        Regex alarm = new Regex(@"Alarm\s*Status:\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                        string AlarmStatus = alarm.Match(textcurrent.Text).Groups[1].Value;
                                        Regex pttx = new Regex(@"PT\s*Tx:\s*([\w\d\.]+)\s*(Rx)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                        string PtTx = pttx.Match(textcurrent.Text).Groups[1].Value;
                                        Regex ptrx = new Regex(@"Rx:\s*([\w\d\.]+)\s*(Exp)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                        string PtRx = ptrx.Match(textcurrent.Text).Groups[1].Value;
                                        Regex ptexp = new Regex(@"Exp:\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                        string PtExp = ptexp.Match(textcurrent.Text).Groups[1].Value;
                                        if (AlarmStatus.Contains("LOS") || AlarmStatus.Contains("LOF") || AlarmStatus.Contains("LOM") || AlarmStatus.Contains("AIS") || AlarmStatus.Contains("SSF"))
                                        {
                                            richTextEnd.AppendText(Working + "告警：" + AlarmStatus + "  NOK" + "\r\n");
                                            textlog.AppendText(textcurrent.Text);
                                            textcurrent.Text = "";
                                            textlog.AppendText("\r\n" + "/////////////////////////////主用OTU接口SFP光模块信息/////////////////////////////" + "\r\n");
                                            textguzhangmingling.Text = "interface otn " + Working;
                                            butguzhangsend.PerformClick();
                                            textguzhangmingling.Text = "show sfp";
                                            butguzhangsend.PerformClick();
                                            Thread.Sleep(XHTime);
                                            butguzhangsend.PerformClick();
                                            Thread.Sleep(XHTime);
                                            butguzhangsend.PerformClick();
                                            for (int r = 0; r <= 1000; r++)
                                            {
                                                if (textcurrent.Text.Contains("Ctrl+c"))
                                                {
                                                    butguzhangsend.PerformClick();
                                                }
                                                else
                                                {
                                                    if (textcurrent.Text.Contains("LOS"))
                                                    {
                                                        richTextEnd.AppendText("光模块状态：LOS  NOK" + "\r\n");
                                                    }
                                                    if (textcurrent.Text.Contains("invalid information"))
                                                    {
                                                        richTextEnd.AppendText("光模块状态：无效  NOK" + "\r\n");
                                                    }
                                                    if (textcurrent.Text.Contains("SFP"))
                                                    {
                                                        //richTextEnd.AppendText("光模块收光：OK" + "\r\n");
                                                        //MessageBox.Show(textcurrent.Text);
                                                        Regex txpower = new Regex(@"Tx\s*Power:\s*([\-\d\.\w]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                                        string TxPower = txpower.Match(textcurrent.Text).Groups[1].Value;
                                                        Regex rxpower = new Regex(@"Rx\s*Power:\s*([\-\d\.\w]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                                        string RxPower = rxpower.Match(textcurrent.Text).Groups[1].Value;
                                                        Regex rate = new Regex(@"Rate:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                                        string Rate = rate.Match(textcurrent.Text).Groups[1].Value;
                                                        Regex wave = new Regex(@"Wave\s*length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                                        string Wave = wave.Match(textcurrent.Text).Groups[1].Value;
                                                        Regex supported = new Regex(@"Supported length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                                        string Supported = supported.Match(textcurrent.Text).Groups[1].Value;
                                                        //MessageBox.Show(RxPower.ToString());
                                                        richTextEnd.AppendText("光模块发光：" + TxPower.ToString() + "\r\n");
                                                        richTextEnd.AppendText("光模块收光：" + RxPower.ToString() + "\r\n");
                                                        richTextEnd.AppendText("光模块速率：" + Rate.Replace("\r", "") + "\r\n");
                                                        //richTextEnd.AppendText("单双纤波长：" + Wave.Replace("\r", "") + "\r\n");
                                                        //richTextEnd.AppendText("光模块距离：" + Supported.Replace("\r", "") + "\r\n");
                                                    }
                                                    if (textcurrent.Text.Contains("SFP module is not inserted!"))
                                                    {
                                                        richTextEnd.AppendText("光模块状态：NOK。光模块未插入" + "\r\n");
                                                    }
                                                    textlog.AppendText(textcurrent.Text);
                                                    textcurrent.Text = "";
                                                    butguzhangsend.PerformClick();
                                                    textguzhangmingling.Text = "exit";
                                                    butguzhangsend.PerformClick();
                                                    break;
                                                }
                                                Thread.Sleep(XHTime);
                                            }
                                        }
                                        else
                                        {
                                            richTextEnd.AppendText(Working + "告警：" + AlarmStatus + "\r\n");
                                        }
                                        richTextEnd.AppendText(Working + "PT-T x：" + PtTx + "\r\n");
                                        richTextEnd.AppendText(Working + "PT-Exp：" + PtExp + "\r\n");
                                        richTextEnd.AppendText(Working + "PT-R x：" + PtRx + "\r\n");
                                        textlog.AppendText(textcurrent.Text);
                                        textcurrent.Text = "";
                                        break;
                                    }
                                    Thread.Sleep(XHTime);
                                }
                            }
                            if (ProtectAlarm == true)
                            {
                                textlog.AppendText("\r\n" + "///////////////////////////备用OTU接口告警查询/////////////////////////////////////////////" + "\r\n");
                                richTextEnd.AppendText("备用线路OTU接口告警查询：" + "\r\n");
                                textguzhangmingling.Text = "ioctl otu show " + Protect;
                                butguzhangsend.PerformClick();
                                for (int h = 0; h <= 1000; h++)
                                {
                                    if (textcurrent.Text.Contains("Ctrl+c"))
                                    {
                                        butguzhangsend.PerformClick();
                                    }
                                    else
                                    {

                                        break;
                                    }
                                }
                                textcurrent.Text = "";
                                Thread.Sleep(XHTime);
                                textguzhangmingling.Text = "ioctl otu show " + Protect;
                                butguzhangsend.PerformClick();
                                for (int y = 0; y <= 1000; y++)
                                {
                                    if (textcurrent.Text.Contains("Ctrl+c"))
                                    {
                                        butguzhangsend.PerformClick();
                                    }
                                    else
                                    {
                                        Regex alarm = new Regex(@"Alarm\s*Status:\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                        string AlarmStatus = alarm.Match(textcurrent.Text).Groups[1].Value;
                                        Regex pttx = new Regex(@"PT\s*Tx:\s*([\w\d\.]+)\s*(Rx)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                        string PtTx = pttx.Match(textcurrent.Text).Groups[1].Value;
                                        Regex ptrx = new Regex(@"Rx:\s*([\w\d\.]+)\s*(Exp)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                        string PtRx = ptrx.Match(textcurrent.Text).Groups[1].Value;
                                        Regex ptexp = new Regex(@"Exp:\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                        string PtExp = ptexp.Match(textcurrent.Text).Groups[1].Value;
                                        if (AlarmStatus.Contains("LOS") || AlarmStatus.Contains("LOF") || AlarmStatus.Contains("LOM") || AlarmStatus.Contains("AIS") || AlarmStatus.Contains("SSF"))
                                        {
                                            richTextEnd.AppendText(Protect + "告警：" + AlarmStatus + "  NOK" + "\r\n");
                                            textlog.AppendText(textcurrent.Text);
                                            textcurrent.Text = "";
                                            textlog.AppendText("\r\n" + "/////////////////////////////备用OTU接口SFP光模块信息/////////////////////////////" + "\r\n");
                                            textguzhangmingling.Text = "interface otn " + Protect;
                                            butguzhangsend.PerformClick();
                                            textguzhangmingling.Text = "show sfp";
                                            butguzhangsend.PerformClick();
                                            Thread.Sleep(XHTime);
                                            butguzhangsend.PerformClick();
                                            Thread.Sleep(XHTime);
                                            butguzhangsend.PerformClick();
                                            for (int r = 0; r <= 1000; r++)
                                            {
                                                if (textcurrent.Text.Contains("Ctrl+c"))
                                                {
                                                    butguzhangsend.PerformClick();
                                                }
                                                else
                                                {
                                                    if (textcurrent.Text.Contains("LOS"))
                                                    {
                                                        richTextEnd.AppendText("光模块状态：LOS  NOK" + "\r\n");
                                                    }
                                                    if (textcurrent.Text.Contains("invalid information"))
                                                    {
                                                        richTextEnd.AppendText("光模块状态：无效  NOK" + "\r\n");
                                                    }
                                                    if (textcurrent.Text.Contains("SFP"))
                                                    {
                                                        //richTextEnd.AppendText("光模块收光：OK" + "\r\n");
                                                        //MessageBox.Show(textcurrent.Text);
                                                        Regex txpower = new Regex(@"Tx\s*Power:\s*([\-\d\.\w]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                                        string TxPower = txpower.Match(textcurrent.Text).Groups[1].Value;
                                                        Regex rxpower = new Regex(@"Rx\s*Power:\s*([\-\d\.\w]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                                        string RxPower = rxpower.Match(textcurrent.Text).Groups[1].Value;
                                                        Regex rate = new Regex(@"Rate:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                                        string Rate = rate.Match(textcurrent.Text).Groups[1].Value;
                                                        Regex wave = new Regex(@"Wave\s*length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                                        string Wave = wave.Match(textcurrent.Text).Groups[1].Value;
                                                        Regex supported = new Regex(@"Supported length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                                        string Supported = supported.Match(textcurrent.Text).Groups[1].Value;
                                                        //MessageBox.Show(RxPower.ToString());
                                                        richTextEnd.AppendText("光模块发光：" + TxPower.ToString() + "\r\n");
                                                        richTextEnd.AppendText("光模块收光：" + RxPower.ToString() + "\r\n");
                                                        richTextEnd.AppendText("光模块速率：" + Rate.Replace("\r", "") + "\r\n");
                                                        //richTextEnd.AppendText("单双纤波长：" + Wave.Replace("\r", "") + "\r\n");
                                                        //richTextEnd.AppendText("光模块距离：" + Supported.Replace("\r", "") + "\r\n");
                                                    }
                                                    if (textcurrent.Text.Contains("SFP module is not inserted!"))
                                                    {
                                                        richTextEnd.AppendText("光模块状态：NOK。光模块未插入" + "\r\n");
                                                    }
                                                    textlog.AppendText(textcurrent.Text);
                                                    textcurrent.Text = "";
                                                    butguzhangsend.PerformClick();
                                                    textguzhangmingling.Text = "exit";
                                                    butguzhangsend.PerformClick();
                                                    break;
                                                }
                                                Thread.Sleep(XHTime);
                                            }
                                        }
                                        else
                                        {
                                            richTextEnd.AppendText(Protect + "告警：" + AlarmStatus + "\r\n");
                                        }
                                        richTextEnd.AppendText(Protect + "PT-T x：" + PtTx + "\r\n");
                                        richTextEnd.AppendText(Protect + "PT-Exp：" + PtExp + "\r\n");
                                        richTextEnd.AppendText(Protect + "PT-R x：" + PtRx + "\r\n");
                                        textlog.AppendText(textcurrent.Text);
                                        textcurrent.Text = "";
                                        break;
                                    }
                                    Thread.Sleep(XHTime);
                                }
                            }
                            textlog.AppendText(textcurrent.Text);
                            textcurrent.Text = "";
                            textguzhangmingling.Text = "exit";
                            butguzhangsend.PerformClick();
                            ArrayList list1 = getIndexArray(richTextEnd.Text, "NOK");
                            for (int i = 0; i < list1.Count; i++)
                            {
                                int index = (int)list1[i];
                                richTextEnd.Select(index, "NOK".Length);
                                richTextEnd.SelectionColor = Color.Red;
                            }
                            if (richTextEnd.Text.Contains("NOK"))
                            {
                                richTextEnd.AppendText("排查结果：存在故障！" + "\r\n");
                                MessageBox.Show("排查结果：存在故障，请排查NOK项！" + "\r\n" + "请将OTN光口尾纤环回或者配置光口系统侧环回，再次点击排查故障，确认是否为我司问题");
                            }
                            else
                            {
                                richTextEnd.AppendText("排查结果：查无故障！" + "\r\n");
                                MessageBox.Show("排查结果：查无故障！");
                            }
                            return;
                        }
                        Thread.Sleep(XHTime);
                    }
                }
                textlog.AppendText("\r\n" + "///////////////////////////主用OTU接口告警查询/////////////////////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "ioctl otu show " + comSslot.Text + "/" + comSport.Text;
                richTextEnd.AppendText("主用线路OTU接口告警查询：" + "\r\n");
                butguzhangsend.PerformClick();
                for (int h = 0; h <= 1000; h++)
                {
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {

                        break;
                    }
                }
                textcurrent.Text = "";
                Thread.Sleep(XHTime);
                textguzhangmingling.Text = "ioctl otu show " + comSslot.Text + "/" + comSport.Text;
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        Regex alarm = new Regex(@"Alarm\s*Status:\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string AlarmStatus = alarm.Match(textcurrent.Text).Groups[1].Value;
                        Regex pttx = new Regex(@"PT\s*Tx:\s*([\w\d\.]+)\s*(Rx)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string PtTx = pttx.Match(textcurrent.Text).Groups[1].Value;
                        Regex ptrx = new Regex(@"Rx:\s*([\w\d\.]+)\s*(Exp)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string PtRx = ptrx.Match(textcurrent.Text).Groups[1].Value;
                        Regex ptexp = new Regex(@"Exp:\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string PtExp = ptexp.Match(textcurrent.Text).Groups[1].Value;
                        if (AlarmStatus.Contains("LOS") || AlarmStatus.Contains("LOF") || AlarmStatus.Contains("LOM") || AlarmStatus.Contains("AIS") || AlarmStatus.Contains("SSF"))
                        {
                            richTextEnd.AppendText(comSslot.Text + "/" + comSport.Text + "告警：" + AlarmStatus + "  NOK" + "\r\n");
                            textlog.AppendText(textcurrent.Text);
                            textcurrent.Text = "";
                            textlog.AppendText("\r\n" + "/////////////////////////////主用OTU接口SFP光模块信息/////////////////////////////" + "\r\n");
                            textguzhangmingling.Text = "interface otn " + comSslot.Text + "/" + comSport.Text;
                            butguzhangsend.PerformClick();
                            textguzhangmingling.Text = "show sfp";
                            butguzhangsend.PerformClick();
                            Thread.Sleep(XHTime);
                            butguzhangsend.PerformClick();
                            Thread.Sleep(XHTime);
                            butguzhangsend.PerformClick();
                            for (int r = 0; r <= 1000; r++)
                            {
                                if (textcurrent.Text.Contains("Ctrl+c"))
                                {
                                    butguzhangsend.PerformClick();
                                }
                                else
                                {
                                    if (textcurrent.Text.Contains("LOS"))
                                    {
                                        richTextEnd.AppendText("光模块收光：LOS  NOK" + "\r\n");
                                    }
                                    if (textcurrent.Text.Contains("invalid information"))
                                    {
                                        richTextEnd.AppendText("光模块收光：无效  NOK" + "\r\n");
                                    }
                                    if (textcurrent.Text.Contains("SFP"))
                                    {
                                        //richTextEnd.AppendText("光模块收光：OK" + "\r\n");
                                        //MessageBox.Show(textcurrent.Text);
                                        Regex txpower = new Regex(@"Tx\s*Power:\s*([\-\d\.\w]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                        string TxPower = txpower.Match(textcurrent.Text).Groups[1].Value;
                                        Regex rxpower = new Regex(@"Rx\s*Power:\s*([\-\d\.\w]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                        string RxPower = rxpower.Match(textcurrent.Text).Groups[1].Value;
                                        Regex rate = new Regex(@"Rate:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                        string Rate = rate.Match(textcurrent.Text).Groups[1].Value;
                                        Regex wave = new Regex(@"Wave\s*length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                        string Wave = wave.Match(textcurrent.Text).Groups[1].Value;
                                        Regex supported = new Regex(@"Supported length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                        string Supported = supported.Match(textcurrent.Text).Groups[1].Value;
                                        //MessageBox.Show(RxPower.ToString());
                                        richTextEnd.AppendText("光模块发光：" + TxPower.ToString() + "\r\n");
                                        richTextEnd.AppendText("光模块收光：" + RxPower.ToString() + "\r\n");
                                        richTextEnd.AppendText("光模块速率：" + Rate.Replace("\r", "") + "\r\n");
                                        //richTextEnd.AppendText("单双纤波长：" + Wave.Replace("\r", "") + "\r\n");
                                        //richTextEnd.AppendText("光模块距离：" + Supported.Replace("\r", "") + "\r\n");
                                    }
                                    if (textcurrent.Text.Contains("SFP module is not inserted!"))
                                    {
                                        richTextEnd.AppendText("光模块收光：NOK。光模块未插入" + "\r\n");
                                    }
                                    textlog.AppendText(textcurrent.Text);
                                    textcurrent.Text = "";
                                    butguzhangsend.PerformClick();
                                    textguzhangmingling.Text = "exit";
                                    butguzhangsend.PerformClick();
                                    break;
                                }
                                Thread.Sleep(XHTime);
                            }
                        }
                        else
                        {
                            richTextEnd.AppendText(comSslot.Text + "/" + comSport.Text + "告警：" + AlarmStatus + "\r\n");
                        }
                        richTextEnd.AppendText(comSslot.Text + "/" + comSport.Text + "PT-T x：" + PtTx + "\r\n");
                        richTextEnd.AppendText(comSslot.Text + "/" + comSport.Text + "PT-Exp：" + PtExp + "\r\n");
                        richTextEnd.AppendText(comSslot.Text + "/" + comSport.Text + "PT-R x：" + PtRx + "\r\n");
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                Thread.Sleep(XHTime);
                if (comSNC.Text != "没有配置保护")
                {
                    textlog.AppendText("\r\n" + "///////////////////////////备用OTU接口告警查询/////////////////////////////////////////////" + "\r\n");
                    textguzhangmingling.Text = "ioctl otu show " + comSBslot.Text + "/" + comSBport.Text;
                    richTextEnd.AppendText("备用线路OTU接口告警查询：" + "\r\n");
                    butguzhangsend.PerformClick();
                    for (int h = 0; h <= 1000; h++)
                    {
                        if (textcurrent.Text.Contains("Ctrl+c"))
                        {
                            butguzhangsend.PerformClick();
                        }
                        else
                        {

                            break;
                        }
                    }
                    textcurrent.Text = "";
                    Thread.Sleep(XHTime);
                    textguzhangmingling.Text = "ioctl otu show " + comSBslot.Text + "/" + comSBport.Text;
                    butguzhangsend.PerformClick();
                    for (int g = 0; g <= XHCount; g++)
                    {
                        if (textcurrent.Text.Contains("Ctrl+c"))
                        {
                            butguzhangsend.PerformClick();
                        }
                        else
                        {
                            Regex alarm = new Regex(@"Alarm\s*Status:\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string AlarmStatus = alarm.Match(textcurrent.Text).Groups[1].Value;
                            Regex pttx = new Regex(@"PT\s*Tx:\s*([\w\d\.]+)\s*(Rx)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string PtTx = pttx.Match(textcurrent.Text).Groups[1].Value;
                            Regex ptrx = new Regex(@"Rx:\s*([\w\d\.]+)\s*(Exp)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string PtRx = ptrx.Match(textcurrent.Text).Groups[1].Value;
                            Regex ptexp = new Regex(@"Exp:\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string PtExp = ptexp.Match(textcurrent.Text).Groups[1].Value;
                            if (AlarmStatus.Contains("LOS") || AlarmStatus.Contains("LOF") || AlarmStatus.Contains("LOM") || AlarmStatus.Contains("AIS") || AlarmStatus.Contains("SSF"))
                            {
                                richTextEnd.AppendText(comSBslot.Text + "/" + comSBport.Text + "告警：" + AlarmStatus + "  NOK" + "\r\n");
                                textlog.AppendText(textcurrent.Text);
                                textcurrent.Text = "";
                                textlog.AppendText("\r\n" + "/////////////////////////////备用OTU接口SFP光模块信息/////////////////////////////" + "\r\n");
                                textguzhangmingling.Text = "interface otn " + comSBslot.Text + "/" + comSBport.Text;
                                butguzhangsend.PerformClick();
                                textguzhangmingling.Text = "show sfp";
                                butguzhangsend.PerformClick();
                                Thread.Sleep(XHTime);
                                butguzhangsend.PerformClick();
                                Thread.Sleep(XHTime);
                                butguzhangsend.PerformClick();
                                for (int r = 0; r <= 1000; r++)
                                {
                                    if (textcurrent.Text.Contains("Ctrl+c"))
                                    {
                                        butguzhangsend.PerformClick();
                                    }
                                    else
                                    {
                                        if (textcurrent.Text.Contains("LOS"))
                                        {
                                            richTextEnd.AppendText("光模块收光：LOS  NOK" + "\r\n");
                                        }
                                        if (textcurrent.Text.Contains("invalid information"))
                                        {
                                            richTextEnd.AppendText("光模块收光：无效  NOK" + "\r\n");
                                        }
                                        if (textcurrent.Text.Contains("SFP"))
                                        {
                                            //richTextEnd.AppendText("光模块收光：OK" + "\r\n");
                                            //MessageBox.Show(textcurrent.Text);
                                            Regex txpower = new Regex(@"Tx\s*Power:\s*([\-\d\.\w]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                            string TxPower = txpower.Match(textcurrent.Text).Groups[1].Value;
                                            Regex rxpower = new Regex(@"Rx\s*Power:\s*([\-\d\.\w]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                            string RxPower = rxpower.Match(textcurrent.Text).Groups[1].Value;
                                            Regex rate = new Regex(@"Rate:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                            string Rate = rate.Match(textcurrent.Text).Groups[1].Value;
                                            Regex wave = new Regex(@"Wave\s*length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                            string Wave = wave.Match(textcurrent.Text).Groups[1].Value;
                                            Regex supported = new Regex(@"Supported length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                            string Supported = supported.Match(textcurrent.Text).Groups[1].Value;
                                            //MessageBox.Show(RxPower.ToString());
                                            richTextEnd.AppendText("光模块发光：" + TxPower.ToString() + "\r\n");
                                            richTextEnd.AppendText("光模块收光：" + RxPower.ToString() + "\r\n");
                                            richTextEnd.AppendText("光模块速率：" + Rate.Replace("\r", "") + "\r\n");
                                            //richTextEnd.AppendText("单双纤波长：" + Wave.Replace("\r", "") + "\r\n");
                                            //richTextEnd.AppendText("光模块距离：" + Supported.Replace("\r", "") + "\r\n");
                                        }
                                        if (textcurrent.Text.Contains("SFP module is not inserted!"))
                                        {
                                            richTextEnd.AppendText("光模块收光：NOK。光模块未插入" + "\r\n");
                                        }
                                        textlog.AppendText(textcurrent.Text);
                                        textcurrent.Text = "";
                                        butguzhangsend.PerformClick();
                                        textguzhangmingling.Text = "exit";
                                        butguzhangsend.PerformClick();
                                        break;
                                    }
                                    Thread.Sleep(XHTime);
                                }
                            }
                            else
                            {
                                richTextEnd.AppendText(comSBslot.Text + "/" + comSBport.Text + "告警：" + AlarmStatus + "\r\n");
                            }
                            richTextEnd.AppendText(comSBslot.Text + "/" + comSBport.Text + "PT-T x：" + PtTx + "\r\n");
                            richTextEnd.AppendText(comSBslot.Text + "/" + comSBport.Text + "PT-Exp：" + PtExp + "\r\n");
                            richTextEnd.AppendText(comSBslot.Text + "/" + comSBport.Text + "PT-R x：" + PtRx + "\r\n");
                            textlog.AppendText(textcurrent.Text);
                            textcurrent.Text = "";
                            break;
                        }
                        Thread.Sleep(XHTime);
                    }
                }
                Thread.Sleep(XHTime);
                textlog.AppendText("\r\n" + "///////////////////////////主用ODUK时隙告警查询/////////////////////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "ioctl " + comoduk.Text + " show " + comSslot.Text + " otu " + comSport.Text + "/" + comSts.Text;
                richTextEnd.AppendText("主用线路" + comoduk.Text + "时隙告警查询：" + "\r\n");
                butguzhangsend.PerformClick();
                for (int h = 0; h <= 1000; h++)
                {
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {

                        break;
                    }
                }
                textcurrent.Text = "";
                Thread.Sleep(XHTime);
                textguzhangmingling.Text = "ioctl " + comoduk.Text + " show " + comSslot.Text + " otu " + comSport.Text + "/" + comSts.Text;
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        Regex alarm = new Regex(@"Alarm\s*Status:\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string AlarmStatus = alarm.Match(textcurrent.Text).Groups[1].Value;
                        Regex pttx = new Regex(@"Tx\s*=\s*([\w\d\.]+)\s*(,)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string PtTx = pttx.Match(textcurrent.Text).Groups[1].Value;
                        Regex ptrx = new Regex(@"Rx\s*=\s*([\w\d\.]+)\s*(,)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string PtRx = ptrx.Match(textcurrent.Text).Groups[1].Value;
                        Regex ptexp = new Regex(@"Exp\s*=\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string PtExp = ptexp.Match(textcurrent.Text).Groups[1].Value;
                        if (AlarmStatus.Contains("LOS") || AlarmStatus.Contains("LOF") || AlarmStatus.Contains("LOM") || AlarmStatus.Contains("AIS") || AlarmStatus.Contains("SSF"))
                        {
                            richTextEnd.AppendText(comSslot.Text + "/" + comSport.Text + "/" + comSts.Text + "告警：" + AlarmStatus + "  NOK" + "\r\n");
                        }
                        else
                        {
                            richTextEnd.AppendText(comSslot.Text + "/" + comSport.Text + "/" + comSts.Text + "告警：" + AlarmStatus + "\r\n");
                        }
                        richTextEnd.AppendText(comSslot.Text + "/" + comSport.Text + "/" + comSts.Text + "PT-T x：" + PtTx + "\r\n");
                        richTextEnd.AppendText(comSslot.Text + "/" + comSport.Text + "/" + comSts.Text + "PT-Exp：" + PtExp + "\r\n");
                        richTextEnd.AppendText(comSslot.Text + "/" + comSport.Text + "/" + comSts.Text + "PT-R x：" + PtRx + "\r\n");
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                Thread.Sleep(XHTime);
                if (comSNC.Text == "SNC-S")
                {
                    Thread.Sleep(XHTime);
                    textlog.AppendText("\r\n" + "///////////////////////////主用TCM时隙告警查询/////////////////////////////////////////////" + "\r\n");
                    textguzhangmingling.Text = "ioctl tcm show " + comoduk.Text + " otu " + comSslot.Text + "/" + comSport.Text + "/" + comSts.Text + "/" + comtcm.Text;
                    richTextEnd.AppendText("主用线路TCM时隙告警查询：" + "\r\n");
                    butguzhangsend.PerformClick();
                    for (int h = 0; h <= 1000; h++)
                    {
                        if (textcurrent.Text.Contains("Ctrl+c"))
                        {
                            butguzhangsend.PerformClick();
                        }
                        else
                        {

                            break;
                        }
                    }
                    textcurrent.Text = "";
                    Thread.Sleep(XHTime);
                    textguzhangmingling.Text = "ioctl tcm show " + comoduk.Text + " otu " + comSslot.Text + "/" + comSport.Text + "/" + comSts.Text + "/" + comtcm.Text;
                    butguzhangsend.PerformClick();
                    for (int g = 0; g <= XHCount; g++)
                    {
                        if (textcurrent.Text.Contains("Ctrl+c"))
                        {
                            butguzhangsend.PerformClick();
                        }
                        else
                        {
                            Regex alarm = new Regex(@"TCM\s*Status:\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string AlarmStatus = alarm.Match(textcurrent.Text).Groups[1].Value;
                            if (AlarmStatus.Contains("OCI") || AlarmStatus.Contains("AIS") || AlarmStatus.Contains("LCK") || AlarmStatus.Contains("LTC"))
                            {
                                richTextEnd.AppendText(comSslot.Text + "/" + comSport.Text + "/" + comSts.Text + "/" + comtcm.Text + "告警：" + AlarmStatus + "  NOK" + "\r\n");
                            }
                            else
                            {
                                richTextEnd.AppendText(comSslot.Text + "/" + comSport.Text + "/" + comSts.Text + "/" + comtcm.Text + "告警：" + AlarmStatus + "\r\n");
                            }
                            textlog.AppendText(textcurrent.Text);
                            textcurrent.Text = "";
                            break;
                        }
                        Thread.Sleep(XHTime);
                    }
                    Thread.Sleep(XHTime);
                }
                if (comSNC.Text != "没有配置保护")
                {
                    textlog.AppendText("\r\n" + "///////////////////////////备用ODUK时隙告警查询/////////////////////////////////////////////" + "\r\n");
                    textguzhangmingling.Text = "ioctl " + comoduk.Text + " show " + comSBslot.Text + " otu " + comSBport.Text + "/" + comSBts.Text;
                    richTextEnd.AppendText("备用线路" + comoduk.Text + "时隙告警查询：" + "\r\n");
                    butguzhangsend.PerformClick();
                    for (int h = 0; h <= 1000; h++)
                    {
                        if (textcurrent.Text.Contains("Ctrl+c"))
                        {
                            butguzhangsend.PerformClick();
                        }
                        else
                        {

                            break;
                        }
                    }
                    textcurrent.Text = "";
                    Thread.Sleep(XHTime);
                    textguzhangmingling.Text = "ioctl " + comoduk.Text + " show " + comSBslot.Text + " otu " + comSBport.Text + "/" + comSBts.Text;
                    butguzhangsend.PerformClick();
                    for (int g = 0; g <= XHCount; g++)
                    {
                        if (textcurrent.Text.Contains("Ctrl+c"))
                        {
                            butguzhangsend.PerformClick();
                        }
                        else
                        {
                            Regex alarm = new Regex(@"Alarm\s*Status:\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string AlarmStatus = alarm.Match(textcurrent.Text).Groups[1].Value;
                            Regex pttx = new Regex(@"Tx\s*=\s*([\w\d\.]+)\s*(,)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string PtTx = pttx.Match(textcurrent.Text).Groups[1].Value;
                            Regex ptrx = new Regex(@"Rx\s*=\s*([\w\d\.]+)\s*(,)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string PtRx = ptrx.Match(textcurrent.Text).Groups[1].Value;
                            Regex ptexp = new Regex(@"Exp\s*=\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string PtExp = ptexp.Match(textcurrent.Text).Groups[1].Value;
                            if (AlarmStatus.Contains("LOS") || AlarmStatus.Contains("LOF") || AlarmStatus.Contains("LOM") || AlarmStatus.Contains("AIS") || AlarmStatus.Contains("SSF"))
                            {
                                richTextEnd.AppendText(comSBslot.Text + "/" + comSBport.Text + "/" + comSBts.Text + "告警：" + AlarmStatus + "  NOK" + "\r\n");
                            }
                            else
                            {
                                richTextEnd.AppendText(comSBslot.Text + "/" + comSBport.Text + "/" + comSBts.Text + "告警：" + AlarmStatus + "\r\n");
                            }
                            richTextEnd.AppendText(comSBslot.Text + "/" + comSBport.Text + "/" + comSBts.Text + "PT-T x：" + PtTx + "\r\n");
                            richTextEnd.AppendText(comSBslot.Text + "/" + comSBport.Text + "/" + comSBts.Text + "PT-Exp：" + PtExp + "\r\n");
                            richTextEnd.AppendText(comSBslot.Text + "/" + comSBport.Text + "/" + comSBts.Text + "PT-R x：" + PtRx + "\r\n");
                            textlog.AppendText(textcurrent.Text);
                            textcurrent.Text = "";
                            break;
                        }
                        Thread.Sleep(XHTime);
                    }
                    if (comSNC.Text == "SNC-S")
                    {
                        Thread.Sleep(XHTime);
                        textlog.AppendText("\r\n" + "///////////////////////////备用TCM时隙告警查询/////////////////////////////////////////////" + "\r\n");
                        textguzhangmingling.Text = "ioctl tcm show " + comoduk.Text + " otu " + comSBslot.Text + "/" + comSBport.Text + "/" + comSBts.Text + "/" + comtcm.Text;
                        richTextEnd.AppendText("备用线路TCM时隙告警查询：" + "\r\n");
                        butguzhangsend.PerformClick();
                        for (int h = 0; h <= 1000; h++)
                        {
                            if (textcurrent.Text.Contains("Ctrl+c"))
                            {
                                butguzhangsend.PerformClick();
                            }
                            else
                            {

                                break;
                            }
                        }
                        textcurrent.Text = "";
                        Thread.Sleep(XHTime);
                        textguzhangmingling.Text = "ioctl tcm show " + comoduk.Text + " otu " + comSBslot.Text + "/" + comSBport.Text + "/" + comSBts.Text + "/" + comtcm.Text;
                        butguzhangsend.PerformClick();
                        for (int g = 0; g <= XHCount; g++)
                        {
                            if (textcurrent.Text.Contains("Ctrl+c"))
                            {
                                butguzhangsend.PerformClick();
                            }
                            else
                            {
                                Regex alarm = new Regex(@"TCM\s*Status:\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                string AlarmStatus = alarm.Match(textcurrent.Text).Groups[1].Value;
                                if (AlarmStatus.Contains("OCI") || AlarmStatus.Contains("AIS") || AlarmStatus.Contains("LCK") || AlarmStatus.Contains("LTC"))
                                {
                                    richTextEnd.AppendText(comSBslot.Text + "/" + comSBport.Text + "/" + comSBts.Text + "/" + comtcm.Text + "告警：" + AlarmStatus + "  NOK" + "\r\n");
                                }
                                else
                                {
                                    richTextEnd.AppendText(comSBslot.Text + "/" + comSBport.Text + "/" + comSBts.Text + "/" + comtcm.Text + "告警：" + AlarmStatus + "\r\n");
                                }
                                textlog.AppendText(textcurrent.Text);
                                textcurrent.Text = "";
                                break;
                            }
                            Thread.Sleep(XHTime);
                        }
                        Thread.Sleep(XHTime);
                    }
                }
                Thread.Sleep(XHTime);
                textlog.AppendText("\r\n" + "///////////////////////////业务" + comDtype.Text + "接口告警查询/////////////////////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "ioctl " + comDtype.Text + " show " + comDslot.Text + "/" + comDport.Text;
                richTextEnd.AppendText("业务线路" + comDtype.Text + "接口告警查询：" + "\r\n");
                butguzhangsend.PerformClick();
                for (int h = 0; h <= 1000; h++)
                {
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {

                        break;
                    }
                }
                textcurrent.Text = "";
                Thread.Sleep(XHTime);
                textguzhangmingling.Text = "ioctl " + comDtype.Text + " show " + comDslot.Text + "/" + comDport.Text;
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        Regex alarm = new Regex(@"Alarm\s*Status:\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string AlarmStatus = alarm.Match(textcurrent.Text).Groups[1].Value;
                        Regex pttx = new Regex(@"PT\s*Tx:\s*([\w\d\.]+)\s*(Rx)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string PtTx = pttx.Match(textcurrent.Text).Groups[1].Value;
                        Regex ptrx = new Regex(@"Rx:\s*([\w\d\.]+)\s*(Exp)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string PtRx = ptrx.Match(textcurrent.Text).Groups[1].Value;
                        Regex ptexp = new Regex(@"Exp:\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string PtExp = ptexp.Match(textcurrent.Text).Groups[1].Value;
                        if (AlarmStatus.Contains("LOS") || AlarmStatus.Contains("LOF") || AlarmStatus.Contains("LOM") || AlarmStatus.Contains("AIS") || AlarmStatus.Contains("SSF"))
                        {
                            richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "告警：" + AlarmStatus + "  NOK" + "\r\n");
                            if (comDtype.Text == "any")
                            {
                                textlog.AppendText(textcurrent.Text);
                                textcurrent.Text = "";
                                textlog.AppendText("\r\n" + "/////////////////////////////业务" + comDtype.Text + "接口SFP光模块信息/////////////////////////////" + "\r\n");
                                textguzhangmingling.Text = "interface any " + comDslot.Text + "/" + comDport.Text;
                                butguzhangsend.PerformClick();
                                textguzhangmingling.Text = "show sfp";
                                butguzhangsend.PerformClick();
                                Thread.Sleep(XHTime);
                                butguzhangsend.PerformClick();
                                Thread.Sleep(XHTime);
                                butguzhangsend.PerformClick();
                                for (int r = 0; r <= 100; r++)
                                {
                                    if (textcurrent.Text.Contains("Ctrl+c"))
                                    {
                                        butguzhangsend.PerformClick();
                                    }
                                    else
                                    {
                                        if (textcurrent.Text.Contains("LOS"))
                                        {
                                            richTextEnd.AppendText("光模块收光：LOS  NOK" + "\r\n");
                                        }
                                        if (textcurrent.Text.Contains("invalid information"))
                                        {
                                            richTextEnd.AppendText("光模块收光：无效  NOK" + "\r\n");
                                        }
                                        if (textcurrent.Text.Contains("SFP"))
                                        {
                                            //richTextEnd.AppendText("光模块收光：OK" + "\r\n");
                                            //MessageBox.Show(textcurrent.Text);
                                            Regex txpower = new Regex(@"Tx\s*Power:\s*([\-\d\.\w]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                            string TxPower = txpower.Match(textcurrent.Text).Groups[1].Value;
                                            Regex rxpower = new Regex(@"Rx\s*Power:\s*([\-\d\.\w]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                            string RxPower = rxpower.Match(textcurrent.Text).Groups[1].Value;
                                            Regex rate = new Regex(@"Rate:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                            string Rate = rate.Match(textcurrent.Text).Groups[1].Value;
                                            Regex wave = new Regex(@"Wave\s*length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                            string Wave = wave.Match(textcurrent.Text).Groups[1].Value;
                                            Regex supported = new Regex(@"Supported length:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                            string Supported = supported.Match(textcurrent.Text).Groups[1].Value;
                                            //MessageBox.Show(RxPower.ToString());
                                            richTextEnd.AppendText("光模块发光：" + TxPower.ToString() + "\r\n");
                                            richTextEnd.AppendText("光模块收光：" + RxPower.ToString() + "\r\n");
                                            richTextEnd.AppendText("光模块速率：" + Rate.Replace("\r", "") + "\r\n");
                                            //richTextEnd.AppendText("单双纤波长：" + Wave.Replace("\r", "") + "\r\n");
                                            //richTextEnd.AppendText("光模块距离：" + Supported.Replace("\r", "") + "\r\n");
                                        }
                                        if (textcurrent.Text.Contains("SFP module is not inserted!"))
                                        {
                                            richTextEnd.AppendText("光模块收光：NOK。光模块未插入" + "\r\n");
                                        }
                                        textlog.AppendText(textcurrent.Text);
                                        textcurrent.Text = "";
                                        butguzhangsend.PerformClick();
                                        textguzhangmingling.Text = "exit";
                                        butguzhangsend.PerformClick();
                                        break;
                                    }
                                    Thread.Sleep(XHTime);
                                }
                            }
                        }
                        else
                        {
                            richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "告警：" + AlarmStatus + "\r\n");
                        }
                        richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "PT-T x：" + PtTx + "\r\n");
                        richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "PT-Exp：" + PtExp + "\r\n");
                        richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "PT-R x：" + PtRx + "\r\n");
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                        break;
                    }
                }
                Thread.Sleep(XHTime);
                textlog.AppendText("\r\n" + "///////////////////////////业务" + comDtype.Text + "时隙告警查询/////////////////////////////////////////////" + "\r\n");
                textguzhangmingling.Text = "ioctl " + comoduk.Text + " show " + comDslot.Text + " " + comDtype.Text + " " + comDport.Text + "/" + comDts.Text;
                richTextEnd.AppendText("业务线路" + comoduk.Text + "时隙告警查询：" + "\r\n");
                butguzhangsend.PerformClick();
                for (int h = 0; h <= 1000; h++)
                {
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {

                        break;
                    }
                }
                textcurrent.Text = "";
                Thread.Sleep(XHTime);
                textguzhangmingling.Text = "ioctl " + comoduk.Text + " show " + comDslot.Text + " " + comDtype.Text + " " + comDport.Text + "/" + comDts.Text;
                butguzhangsend.PerformClick();
                for (int g = 0; g <= XHCount; g++)
                {
                    if (textcurrent.Text.Contains("Ctrl+c"))
                    {
                        butguzhangsend.PerformClick();
                    }
                    else
                    {
                        Regex alarm = new Regex(@"Alarm\s*Status:\s*([\w\d\|\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string AlarmStatus = alarm.Match(textcurrent.Text).Groups[1].Value;
                        Regex pttx = new Regex(@"Tx\s*=\s*([\d\w]+)*(h)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string PtTx = pttx.Match(textcurrent.Text).Groups[1].Value;
                        Regex ptrx = new Regex(@"Rx\s*=\s*([\d\w]+)*(h)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string PtRx = ptrx.Match(textcurrent.Text).Groups[1].Value;
                        Regex ptexp = new Regex(@"Exp\s*=\s*([\d\w]+)*(h)*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                        string PtExp = ptexp.Match(textcurrent.Text).Groups[1].Value;
                        if (AlarmStatus.Contains("LOS") || AlarmStatus.Contains("LOF") || AlarmStatus.Contains("LOM") || AlarmStatus.Contains("AIS") || AlarmStatus.Contains("SSF"))
                        {
                            richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "告警：" + AlarmStatus + "  NOK" + "\r\n");
                        }
                        else
                        {
                            richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "告警：" + AlarmStatus + "\r\n");
                        }
                        richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "PT-T x：" + PtTx + "\r\n");
                        richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "PT-Exp：" + PtExp + "\r\n");
                        richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "PT-R x：" + PtRx + "\r\n");
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                        break;
                    }
                    Thread.Sleep(XHTime);
                }
                Thread.Sleep(XHTime);
                if (comSNC.Text == "SNC-I" || comSNC.Text == "SNC-N" || comSNC.Text == "SNC-S")
                {
                    textlog.AppendText("\r\n" + "///////////////////////////保护组" + comSslot.Text + "/" + comSport.Text + "/" + comSts.Text + "状态查询/////////////////////////////////////////////" + "\r\n");
                    richTextEnd.AppendText("保护组状态查询：" + "\r\n");
                    textguzhangmingling.Text = "show lpg";
                    butguzhangsend.PerformClick();
                    string lpggrop = ".*line-" + comoduk.Text + "-" + comSslot.Text + "/" + comSport.Text + "/" + comSts.Text;
                    Regex lpggrop0 = new Regex(lpggrop, RegexOptions.IgnoreCase);
                    string lpggrop1 = lpggrop0.Match(textcurrent.Text).Groups[0].Value;
                    if (lpggrop1 == "")
                    {
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                        textguzhangmingling.Text = "exit";
                        butguzhangsend.PerformClick();
                        MessageBox.Show("保护组端口:" + comSslot.Text + "/" + comSport.Text + "  未找到，请重新输入！");
                        return;
                    }
                    string[] VCGINFOFengGe = Regex.Split(lpggrop1, "\\s+", RegexOptions.IgnoreCase);
                    string LpgID = VCGINFOFengGe[1];

                    textguzhangmingling.Text = "create lpg " + LpgID;
                    butguzhangsend.PerformClick();
                    textguzhangmingling.Text = "show";
                    butguzhangsend.PerformClick();
                    for (int g = 0; g <= XHCount; g++)
                    {
                        if (textcurrent.Text.Contains("Ctrl+c"))
                        {
                            butguzhangsend.PerformClick();
                        }
                        else
                        {
                            Regex monitor = new Regex(@"monitor\s*mode:\s*([\w\d\/\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Monitor = monitor.Match(textcurrent.Text).Groups[1].Value;
                            Regex working = new Regex(@"working\s*port:\s*([\d\-\w\/\(\)\ \+]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Working = working.Match(textcurrent.Text).Groups[1].Value;
                            Regex protect = new Regex(@"protect\s*port:\s*([\d\-\w\/\(\)\ \+]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Protect = protect.Match(textcurrent.Text).Groups[1].Value;
                            Regex service = new Regex(@"service\s*port:\s*([\d\-\w\/\(\)\ \+]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Service = service.Match(textcurrent.Text).Groups[1].Value;
                            Regex lpgstate = new Regex(@"lpg-state:\s*([\d\-\w\/\(\)\ \+\:]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string LpgState = lpgstate.Match(textcurrent.Text).Groups[1].Value;
                            Regex count = new Regex(@"switch\s*count:\s*([\d\-\w\/\(\)\ \+\:]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Count = count.Match(textcurrent.Text).Groups[1].Value;
                            if (Monitor.Contains("LOS") || Monitor.Contains("LOF") || Monitor.Contains("LOM") || Monitor.Contains("AIS") || Monitor.Contains("SSF"))
                            {
                                richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "检测模式：" + Monitor + "  NOK" + "\r\n");
                            }
                            else
                            {
                                richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "检测模式：" + Monitor + "\r\n");
                            }
                            if (Working.Contains("SF") || Working.Contains("SD"))
                            {
                                richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "主用：" + Working + "  NOK" + "\r\n");
                            }
                            else
                            {
                                richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "主用：" + Working + "\r\n");
                            }
                            if (Protect.Contains("SF") || Protect.Contains("SD"))
                            {
                                richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "备用：" + Protect + "  NOK" + "\r\n");
                            }
                            else
                            {
                                richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "备用：" + Protect + "\r\n");
                            }
                            richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "宿：" + Service + "\r\n");
                            richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "倒换原因：" + LpgState + "\r\n");
                            richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "倒换次数：" + Count + "\r\n");
                            textlog.AppendText(textcurrent.Text);
                            textcurrent.Text = "";
                            textguzhangmingling.Text = "exit";
                            butguzhangsend.PerformClick();
                            break;
                        }
                        Thread.Sleep(XHTime);
                    }
                }
                if (comSNC.Text == "OCH")
                {
                    textlog.AppendText("\r\n" + "///////////////////////////保护组" + comSslot.Text + "/" + comSport.Text + "状态查询/////////////////////////////////////////////" + "\r\n");
                    richTextEnd.AppendText("保护组状态查询：" + "\r\n");
                    textguzhangmingling.Text = "show lpg";
                    butguzhangsend.PerformClick();
                    string lpggrop = ".*otn" + comSslot.Text + "/" + comSport.Text;
                    Regex lpggrop0 = new Regex(lpggrop, RegexOptions.IgnoreCase);
                    string lpggrop1 = lpggrop0.Match(textcurrent.Text).Groups[0].Value;
                    if (lpggrop1 == "")
                    {
                        textlog.AppendText(textcurrent.Text);
                        textcurrent.Text = "";
                        textguzhangmingling.Text = "exit";
                        butguzhangsend.PerformClick();
                        MessageBox.Show("保护组端口:" + comSslot.Text + "/" + comSport.Text + "  未找到，请重新输入！");
                        return;
                    }
                    string[] VCGINFOFengGe = Regex.Split(lpggrop1, "\\s+", RegexOptions.IgnoreCase);
                    string LpgID = VCGINFOFengGe[1];

                    textlog.AppendText(textcurrent.Text);
                    textcurrent.Text = "";

                    textguzhangmingling.Text = "create lpg " + LpgID;
                    butguzhangsend.PerformClick();
                    textguzhangmingling.Text = "show";
                    butguzhangsend.PerformClick();
                    for (int g = 0; g <= XHCount; g++)
                    {
                        if (textcurrent.Text.Contains("Ctrl+c"))
                        {
                            butguzhangsend.PerformClick();
                        }
                        else
                        {
                            Regex protection = new Regex(@"protection\s*type:\s*([\w]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Protection = protection.Match(textcurrent.Text).Groups[1].Value;
                            if (Protection == "SNC")
                            {
                                textguzhangmingling.Text = "exit";
                                butguzhangsend.PerformClick();
                                textlog.AppendText(textcurrent.Text);
                                textcurrent.Text = "";
                                textguzhangmingling.Text = "exit";
                                butguzhangsend.PerformClick();
                                MessageBox.Show("当前为SNC保护，请重新选择光口后尝试");
                                return;
                            }
                            Regex monitor = new Regex(@"monitor\s*mode:\s*([\w\d\/\.]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Monitor = monitor.Match(textcurrent.Text).Groups[1].Value;
                            Regex working = new Regex(@"working\s*port:\s*([\d\-\w\/\(\)\ \+]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Working = working.Match(textcurrent.Text).Groups[1].Value;
                            Regex protect = new Regex(@"protect\s*port:\s*([\d\-\w\/\(\)\ \+]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Protect = protect.Match(textcurrent.Text).Groups[1].Value;
                            Regex service = new Regex(@"service\s*port:\s*([\d\-\w\/\(\)\ \+]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Service = service.Match(textcurrent.Text).Groups[1].Value;
                            Regex lpgstate = new Regex(@"lpg-state:\s*([\d\-\w\/\(\)\ \+\:]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string LpgState = lpgstate.Match(textcurrent.Text).Groups[1].Value;
                            Regex count = new Regex(@"switch\s*count:\s*([\d\-\w\/\(\)\ \+\:]+)\s*( )*", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                            string Count = count.Match(textcurrent.Text).Groups[1].Value;
                            if (Monitor.Contains("LOS") || Monitor.Contains("LOF") || Monitor.Contains("LOM") || Monitor.Contains("AIS") || Monitor.Contains("SSF"))
                            {
                                richTextEnd.AppendText("检测模式：" + Monitor + "  NOK" + "\r\n");
                            }
                            else
                            {
                                richTextEnd.AppendText("检测模式：" + Monitor + "\r\n");
                            }
                            if (Working.Contains("SF") || Working.Contains("SD"))
                            {
                                richTextEnd.AppendText("主用：" + Working + "  NOK" + "\r\n");
                                working = new Regex(@"working\s*port:\s*otn([\d\/\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                Working = working.Match(textcurrent.Text).Groups[1].Value;
                            }
                            else
                            {
                                richTextEnd.AppendText("主用：" + Working + "\r\n");
                            }
                            if (Protect.Contains("SF") || Protect.Contains("SD"))
                            {
                                richTextEnd.AppendText("备用：" + Protect + "  NOK" + "\r\n");
                                protect = new Regex(@"protect\s*port:\s*otn([\d\/\d]+)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                                Protect = protect.Match(textcurrent.Text).Groups[1].Value;
                            }
                            else
                            {
                                richTextEnd.AppendText("备用：" + Protect + "\r\n");
                            }
                            //richTextEnd.AppendText(comDslot.Text + "/" + comDport.Text + "/" + comDts.Text + "宿：" + Service + "\r\n");
                            richTextEnd.AppendText("倒换原因：" + LpgState + "\r\n");
                            richTextEnd.AppendText("倒换次数：" + Count + "\r\n");
                            break;
                        }
                    }
                    textlog.AppendText(textcurrent.Text);
                    textcurrent.Text = "";
                    textguzhangmingling.Text = "exit";
                    butguzhangsend.PerformClick();
                }

                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                ArrayList list = getIndexArray(richTextEnd.Text, "NOK");
                for (int i = 0; i < list.Count; i++)
                {
                    int index = (int)list[i];
                    richTextEnd.Select(index, "NOK".Length);
                    richTextEnd.SelectionColor = Color.Red;
                }
                if (richTextEnd.Text.Contains("NOK"))
                {
                    richTextEnd.AppendText("排查结果：存在故障！" + "\r\n");
                    MessageBox.Show("排查结果：存在故障，请排查NOK项！" + "\r\n" + "如果告警项目存在NOK，请环回所有时隙或上联光接口，再次点击排查故障，确认是否为我司问题");
                }
                else
                {
                    richTextEnd.AppendText("排查结果：查无故障！" + "\r\n");
                    MessageBox.Show("排查结果：查无故障！");
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }
        }
        private void Butotnfast_Click(object sender, EventArgs e)
        {
            if (butotnfast.Text == "OTN保护增强使能")
            {
                butguzhangsend.PerformClick();
                if (!textcurrent.Text.Contains("#"))
                {
                    MessageBox.Show("检测发现：未运行在(config)#模式下，请断开后重新连接，再次尝试！");
                    return;
                }
                textguzhangmingling.Text = "config otn";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "config fast-monitor enable";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                richTextEnd.AppendText("OTN增强保护倒换已开启！" + "\r\n");
                butotnfast.Text = "OTN保护增强禁止";
                MessageBox.Show("OTN增强保护倒换已开启！");
            }
            else
            {
                butguzhangsend.PerformClick();
                if (!textcurrent.Text.Contains("#"))
                {
                    MessageBox.Show("检测发现：未运行在(config)#模式下，请断开后重新连接，再次尝试！");
                    return;
                }
                textguzhangmingling.Text = "config otn";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "config fast-monitor disable";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                richTextEnd.AppendText("OTN保护增强倒换已禁止！" + "\r\n");
                butotnfast.Text = "OTN保护增强使能";
                MessageBox.Show("OTN保护增强倒换已禁止！");
            }
        }
        private void Butsdhfast_Click(object sender, EventArgs e)
        {
            if (butsdhfast.Text == "SDH保护增强使能")
            {
                butguzhangsend.PerformClick();
                if (!textcurrent.Text.Contains("#"))
                {
                    MessageBox.Show("检测发现：未运行在(config)#模式下，请断开后重新连接，再次尝试！");
                    return;
                }
                textguzhangmingling.Text = "config msap";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "psm switchtimer";
                butguzhangsend.PerformClick();
                if (textcurrent.Text.Contains("1000"))
                {
                    textguzhangmingling.Text = "psm switchtimer";
                    butguzhangsend.PerformClick();
                }
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                butsdhfast.Text = "SDH保护增强禁止";
                richTextEnd.AppendText("SDH增强保护倒换已使能！" + "\r\n");
                MessageBox.Show("SDH增强保护倒换已使能！");
            }
            else
            {
                butguzhangsend.PerformClick();
                if (!textcurrent.Text.Contains("#"))
                {
                    MessageBox.Show("检测发现：未运行在(config)#模式下，请断开后重新连接，再次尝试！");
                    return;
                }
                textguzhangmingling.Text = "config msap";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "psm switchtimer";
                butguzhangsend.PerformClick();
                if (!textcurrent.Text.Contains("1000"))
                {
                    textguzhangmingling.Text = "psm switchtimer";
                    butguzhangsend.PerformClick();
                }
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                butsdhfast.Text = "SDH保护增强使能";
                richTextEnd.AppendText("SDH增强保护倒换已禁止！" + "\r\n");
                MessageBox.Show("SDH增强保护倒换已禁止！");
            }
        }
        private void butTim_Click(object sender, EventArgs e)
        {
            butguzhangsend.PerformClick();
            if (!textcurrent.Text.Contains("#"))
            {
                MessageBox.Show("检测发现：未运行在(config)#模式下，请断开后重新连接，再次尝试！");
                return;
            }
            textguzhangmingling.Text = "config otn";
            butguzhangsend.PerformClick();
            textguzhangmingling.Text = "show lpg";
            butguzhangsend.PerformClick();
            string lpggrop = ".*line-" + comoduk.Text + "-" + comSslot.Text + "/" + comSport.Text + "/" + comSts.Text;
            Regex lpggrop0 = new Regex(lpggrop, RegexOptions.IgnoreCase);
            string lpggrop1 = lpggrop0.Match(textcurrent.Text).Groups[0].Value;
            if (lpggrop1 == "")
            {
                textlog.AppendText(textcurrent.Text);
                textcurrent.Text = "";
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                MessageBox.Show("保护组端口:" + comSslot.Text + "/" + comSport.Text + "  未找到，请重新输入！");
                return;
            }
            string[] VCGINFOFengGe = Regex.Split(lpggrop1, "\\s+", RegexOptions.IgnoreCase);
            string LpgID = VCGINFOFengGe[1];
            //string lpgname = "lpg" + comlpgID.Text;
            //string[] lpghangshu = textcurrent.Text.Split(new string[] { "\r\n" }, StringSplitOptions.None);
            //string LpgHang = "";
            //string[] lpgidnem = new string[] { "" };
            //string MemberSum = "";
            //bool Lpgidfind = false;
            //for (int a = 0; a < lpghangshu.Length; a++)
            //{
            //    LpgHang = lpghangshu[a];
            //    lpgidnem = Regex.Split(LpgHang, "\\s+", RegexOptions.IgnoreCase);
            //    if (lpgidnem.Length > 1)
            //    {
            //        MemberSum = lpgidnem[1];
            //        if (MemberSum == comlpgID.Text)
            //        {
            //            richTextEnd.AppendText("保护组ID：" + MemberSum + "\r\n");
            //            textlog.AppendText(textcurrent.Text);
            //            textcurrent.Text = "";
            //            Lpgidfind = true;
            //            break;
            //        }
            //    }
            //}
            //if (Lpgidfind == false)
            //{
            //    textlog.AppendText(textcurrent.Text);
            //    textcurrent.Text = "";
            //    textguzhangmingling.Text = "exit";
            //    butguzhangsend.PerformClick();
            //    MessageBox.Show("保护组ID:" + comlpgID.Text + " 未找到，请重新输入！");
            //    return;
            //}
            textguzhangmingling.Text = "create lpg " + LpgID;
            butguzhangsend.PerformClick();
            textguzhangmingling.Text = "tim-trigger disable";
            butguzhangsend.PerformClick();
            textguzhangmingling.Text = "exit";
            butguzhangsend.PerformClick();
            textlog.AppendText(textcurrent.Text);
            textcurrent.Text = "";
            textguzhangmingling.Text = "exit";
            butguzhangsend.PerformClick();
            richTextEnd.AppendText("保护组ID:" + LpgID + " TIM告警检测已关闭！" + "\r\n");
            MessageBox.Show("保护组ID:" + LpgID + " TIM告警检测已关闭！");
        }
        private void butyingcang_Click(object sender, EventArgs e)
        {
            if (butyingcang.Text == "隐藏")
            {
                labgaizhislot.Visible = false;
                labgaizhitype.Visible = false;
                comotnboardmode.Visible = false;
                comotnslot.Visible = false;
                butgaizhi.Visible = false;
                butotnfast.Visible = false;
                butsdhfast.Visible = false;
                butyingcang.Text = "显示";
            }
            else
            {
                labgaizhislot.Visible = true;
                labgaizhitype.Visible = true;
                comotnboardmode.Visible = true;
                comotnslot.Visible = true;
                butgaizhi.Visible = true;
                butotnfast.Visible = true;
                butsdhfast.Visible = true;
                butyingcang.Text = "隐藏";
            }
        }
        private void Checklpg_CheckedChanged(object sender, EventArgs e)
        {
            if (checklpg.Checked)
            {
                comSNC.Text = "OCH";
            }
            else
            {
                comSNC.Text = "SNC-N";
            }
        }
        private void butoptoff_Click(object sender, EventArgs e)
        {
            // MessageBox.Show("激光器关断和开启只对源光口作用，请选择光口为源光口！");
            if (butoptoff.Text == "主用激光器关断")
            {
                butguzhangsend.PerformClick();
                if (!textcurrent.Text.Contains("#"))
                {
                    MessageBox.Show("检测发现：未运行在(config)#模式下，请断开后重新连接，再次尝试！");
                    return;
                }
                textguzhangmingling.Text = "config otn";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "interface otn " + comSslot.Text + "/" + comSport.Text;
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "optical disable";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                richTextEnd.AppendText(comSslot.Text + "/" + comSport.Text + "激光器已关断！" + "\r\n");
                butoptoff.Text = "主用激光器开启";
                //MessageBox.Show(comSslot.Text + "/" + comSport.Text + "激光器已关断！");
            }
            else
            {
                butguzhangsend.PerformClick();
                if (!textcurrent.Text.Contains("#"))
                {
                    MessageBox.Show("检测发现：未运行在(config)#模式下，请断开后重新连接，再次尝试！");
                    return;
                }
                textguzhangmingling.Text = "config otn";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "interface otn " + comSslot.Text + "/" + comSport.Text;
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "optical enable";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                richTextEnd.AppendText(comSslot.Text + "/" + comSport.Text + "激光器已开启！" + "\r\n");
                butoptoff.Text = "主用激光器关断";
                //MessageBox.Show(comSslot.Text + "/" + comSport.Text + "激光器已开启！");
            }

        }
        private void 日志LToolStripMenuItem_Click(object sender, EventArgs e)
        {
            System.Diagnostics.Process.Start("notepad.exe", @"C:\gpn\Logs\" + DateTime.Now.ToString("yyyyMMdd") + "\\" + comip.Text + "-" + DateTime.Now.ToString("yyyyMMdd") + ".txt");
        }
        private void 问题反馈ToolStripMenuItem_Click(object sender, EventArgs e)
        {
            string saveString = "";
            for (int i = 0; i < lstboxStatus.Items.Count; i++)
            {
                saveString += lstboxStatus.Items[i].ToString() + "\r\n";
            }
            string paichajieguo = richTextEnd.Text.Replace("\n", "\r\n");
            string EmailBody = toolStripStatusLabelver.Text
                    + "\r\n" + toolStripStatusLabelnms.Text
                    + "\r\n" + toolStripStatusLabelnms18.Text
                    + "\r\n" + toolStripStatusLabelswa11.Text
                    + "\r\n" + toolStripStatusLabelswa12.Text
                    + "\r\n" + comapp.Text + ":  " + checkapp.Checked
                    + "\r\n" + comcode.Text + ":  " + checkcode.Checked
                    + "\r\n" + comnms.Text + ":  " + checknms.Checked
                    + "\r\n" + comsw.Text + ":  " + checksw.Checked
                    + "\r\n" + com760s.Text + ":  " + check760s.Checked
                    + "\r\n" + com760b.Text + ":  " + check760b.Checked
                    + "\r\n" + com760c.Text + ":  " + check760c.Checked
                    + "\r\n" + com760d.Text + ":  " + check760d.Checked
                    + "\r\n" + com760e.Text + ":  " + check760e.Checked
                    + "\r\n" + comuxc.Text + ":  " + checkuxc.Checked
                    + "\r\n" + comsysfile.Text + ":  " + checksysfile.Checked
                    + "\r\n" + comflash.Text + ":  " + checkflash.Checked
                    + "\r\n" + comyaffs.Text + ":  " + checkyaffs.Checked
                    + "\r\n" + toolStripStatusLabeltime.Text
                    + "\r\n ==============================================================================================================="
                    + "\r\n" + textDOS.Text
                    + "\r\n ==============================================================================================================="
                    + "\r\n" + paichajieguo.ToString()
                    + "\r\n ==============================================================================================================="
                    + "\r\n" + textlog.Text
                    + "\r\n ==============================================================================================================="
                    + "\r\n" + saveString;
            string pLocalFilePath = @"C:\gpn\Logs\" + DateTime.Now.ToString("yyyyMMdd") + "\\" + comip.Text + "-" + DateTime.Now.ToString("yyyyMMdd") + ".txt";//要复制的文件路径
            if (File.Exists(pLocalFilePath))//必须判断要复制的文件是否存在
            {
                MySocket.WriteLogs("Logs", "软件窗口所有日志：", EmailBody);
            }
            Req Req = new Req
            {
                ShebeiIp = comip.Text
            };
            //实例化窗体
            Req.ShowDialog();// 将窗体显示出来
        }

        private void metroButton1_Click(object sender, EventArgs e)
        {
            if (metroComreadoid.Text == "GET")
            {

                // SNMP团体名称 
                OctetString community = new OctetString(metroTextReadCommunity.Text);
                //定义代理参数类 
                AgentParameters param = new AgentParameters(community);
                //将SNMP版本设置为1（或2） 
                param.Version = SnmpVersion.Ver2;
                param.DisableReplySourceCheck = true;
                //构造代理地址对象
                //这里很容易使用IpAddress类，因为
                //如果不
                //解析为IP地址，它将尝试解析构造函数参数
                IpAddress agent = new IpAddress(metroTextgpnip.Text);
                IPAddress send = new IPAddress(agent);
                //构建目标 
                UdpTarget target = new UdpTarget(send, 161, 2000, 1);
                UdpTransport h = new UdpTransport(true);

                //  用于所有请求PDU级 
                Pdu pdu = new Pdu(PduType.Get);
                pdu.VbList.Add(metroTextoid.Text);   //11槽位主备状态
                //SnmpAsyncResponse result = null;

                SnmpPacket result = null;
                try
                {
                    result = target.Request(pdu, param);
                }
                catch (SnmpException ex)
                {
                    MessageBox.Show(ex.Message);
                }
                //SnmpV1Packet result = (SnmpV1Packet)target.Request(pdu, param);
                //如果结果为null，则座席未回复或我们无法解析回复。
                if (result != null)
                {
                    //其他的ErrorStatus然后0是通过返回一个错误
                    //代理-见SnmpConstants为错误定义
                    if (result.Pdu.ErrorStatus != 0)
                    {
                        //代理报告与所述请求的错误 
                        MessageBox.Show(String.Format("SNMP回复错误！错误代码：{0}，错误索引：第 {1} 行 \r\n",
                                FindDevType.FindErrorCode(result.Pdu.ErrorStatus),
                                result.Pdu.ErrorIndex));
                        return;
                    }
                    else
                    {

                        //返回变量的返回顺序与添加
                        //到VbList

                        ListViewItem item = lv2.Items.Add((lv2.Items.Count + 1) + "");
                        item.SubItems.Add(metroTextgpnip.Text);
                        item.SubItems.Add(metroTextReadCommunity.Text);
                        item.SubItems.Add(result.Pdu.VbList.Count.ToString());
                        item.SubItems.Add(result.Pdu.VbList[0].Oid.ToString());
                        item.SubItems.Add(SnmpConstants.GetTypeName(result.Pdu.VbList[0].Value.Type));
                        item.SubItems.Add(String.Join("", Regex.Split(result.Pdu.VbList[0].Value.ToString(), "\\s+", RegexOptions.IgnoreCase)));
                        string[] hex = Regex.Split(result.Pdu.VbList[0].Value.ToString(), "\\s+", RegexOptions.IgnoreCase);
                        if ((hex.Length >= 8) && (hex[0] == "07") || (hex[0] == "08"))
                        {
                            string a = hex[0];
                            string b = hex[1];
                            string year = int.Parse(a + b, NumberStyles.HexNumber).ToString();
                            string month = int.Parse(hex[2], NumberStyles.HexNumber).ToString();
                            string day = int.Parse(hex[3], NumberStyles.HexNumber).ToString();
                            string hour = int.Parse(hex[4], NumberStyles.HexNumber).ToString();
                            string min = int.Parse(hex[5], NumberStyles.HexNumber).ToString();
                            string sed = int.Parse(hex[6], NumberStyles.HexNumber).ToString();
                            string mil = int.Parse(hex[7], NumberStyles.HexNumber).ToString();
                            item.SubItems.Add(year + "-" + month + "-" + day + "," + hour + ":" + min + ":" + sed + ":" + mil);

                        }
                        item.EnsureVisible();


                        //MessageBox.Show("ssss");
                        //toolStripStatusLabelnms.ForeColor = Color.DarkGreen;

                    }

                }

                //这是调用Snmp类的方法
                //string R = Snmp.Get(metroTextgpnip.Text, metroTextReadCommunity.Text, 2000, 2, metroTextoid.Text);
                //ListViewItem item = lv2.Items.Add((lv2.Items.Count + 1) + "");
                //item.SubItems.Add(metroTextgpnip.Text);
                //item.SubItems.Add(metroTextReadCommunity.Text);
                //item.SubItems.Add("1");
                //item.SubItems.Add(metroTextoid.Text);
                //item.SubItems.Add("未查询");
                //item.SubItems.Add(R);
                //string[] hex = Regex.Split(R, "\\s+", RegexOptions.IgnoreCase);
                //if ((hex.Length >= 8) && (hex[0] == "07") || (hex[0] == "08"))
                //{
                //    string a = hex[0];
                //    string b = hex[1];
                //    string year = int.Parse(a + b, NumberStyles.HexNumber).ToString();
                //    string month = int.Parse(hex[2], NumberStyles.HexNumber).ToString();
                //    string day = int.Parse(hex[3], NumberStyles.HexNumber).ToString();
                //    string hour = int.Parse(hex[4], NumberStyles.HexNumber).ToString();
                //    string min = int.Parse(hex[5], NumberStyles.HexNumber).ToString();
                //    string sed = int.Parse(hex[6], NumberStyles.HexNumber).ToString();
                //    string mil = int.Parse(hex[7], NumberStyles.HexNumber).ToString();
                //    item.SubItems.Add(year + "-" + month + "-" + day + "," + hour + ":" + min + ":" + sed + ":" + mil);

                //}
                //item.EnsureVisible();
            }
            if (metroComreadoid.Text == "WALK")
            {

                this.lv2.Items.Clear();
                List<string[]> array = Snmp.Arry(metroTextgpnip.Text, metroTextReadCommunity.Text, 2000, 2, metroTextoid.Text);
                lv2.BeginUpdate();
                foreach (var row in array)
                {
                    ListViewItem item = new ListViewItem((lv2.Items.Count + 1).ToString());
                    item.SubItems.AddRange(row);
                    lv2.Items.Add(item);
                }
                lv2.EndUpdate();


                //    this.lv2.Items.Clear();  //只移除所有的项。
                //    // SNMP community name
                //    OctetString community = new OctetString(metroTextReadCommunity.Text);
                //    // Define agent parameters class
                //    AgentParameters param = new AgentParameters(SnmpVersion.Ver2, community, true);
                //    // Set SNMP version to 2 (GET-BULK only works with SNMP ver 2 and 3)
                //    // Construct the agent address object
                //    // IpAddress class is easy to use here because
                //    //  it will try to resolve constructor parameter if it doesn't
                //    //  parse to an IP address
                //    IpAddress agent = new IpAddress(metroTextgpnip.Text);
                //    // Construct target
                //    UdpTarget target = new UdpTarget((IPAddress)agent, 161, 2000, 1);
                //    // Define Oid that is the root of the MIB
                //    //  tree you wish to retrieve
                //    Oid rootOid = new Oid(metroTextoid.Text); // ifDescr
                //                                              // This Oid represents last Oid returned by
                //                                              //  the SNMP agent
                //    Oid lastOid = (Oid)rootOid.Clone();
                //    // Pdu class used for all requests
                //    Pdu pdu = new Pdu(PduType.GetBulk);
                //    // In this example, set NonRepeaters value to 0
                //    pdu.NonRepeaters = 0;
                //    // MaxRepetitions tells the agent how many Oid/Value pairs to return
                //    // in the response.
                //    pdu.MaxRepetitions = 5;
                //    // Loop through results
                //    while (lastOid != null)
                //    {
                //        // When Pdu class is first constructed, RequestId is set to 0
                //        // and during encoding id will be set to the random value
                //        // for subsequent requests, id will be set to a value that
                //        // needs to be incremented to have unique request ids for each
                //        // packet
                //        if (pdu.RequestId != 0)
                //        {
                //            pdu.RequestId += 1;
                //        }
                //        // Clear Oids from the Pdu class.
                //        pdu.VbList.Clear();
                //        // Initialize request PDU with the last retrieved Oid
                //        pdu.VbList.Add(lastOid);
                //        // Make SNMP request
                //        SnmpPacket result = null;
                //        try
                //        {
                //            result = target.Request(pdu, param);
                //        }
                //        catch (SnmpException ex)
                //        {
                //            MessageBox.Show(ex.Message);
                //            return;
                //        }
                //        // You should catch exceptions in the Request if using in real application.
                //        // If result is null then agent didn't reply or we couldn't parse the reply.
                //        if (result != null)
                //        {
                //            // ErrorStatus other then 0 is an error returned by
                //            // the Agent - see SnmpConstants for error definitions
                //            if (result.Pdu.ErrorStatus != 0)
                //            {
                //                // agent reported an error with the request
                //                MessageBox.Show(String.Format("SNMP回复错误！错误代码：{0}，错误索引：第 {1} 行 \r\n",
                //                    FindDevType.FindErrorCode(result.Pdu.ErrorStatus),
                //                    result.Pdu.ErrorIndex));
                //                lastOid = null;
                //                break;
                //            }
                //            else
                //            {
                //                // Walk through returned variable bindings
                //                foreach (Vb v in result.Pdu.VbList)
                //                {
                //                    // Check that retrieved Oid is "child" of the root OID
                //                    if (rootOid.IsRootOf(v.Oid))
                //                    {
                //                        //Console.WriteLine("{0} ({1}): {2}",
                //                        //    v.Oid.ToString(),
                //                        //    SnmpConstants.GetTypeName(v.Value.Type),
                //                        //    v.Value.ToString());

                //                        ListViewItem item = lv2.Items.Add((lv2.Items.Count + 1) + "");
                //                        item.SubItems.Add(metroTextgpnip.Text);
                //                        item.SubItems.Add(metroTextReadCommunity.Text);
                //                        item.SubItems.Add(result.Pdu.VbList.Count.ToString());
                //                        item.SubItems.Add(v.Oid.ToString());
                //                        item.SubItems.Add(SnmpConstants.GetTypeName(v.Value.Type));
                //                        item.SubItems.Add(v.Value.ToString());
                //                        string[] hex = Regex.Split(result.Pdu.VbList[0].Value.ToString(), "\\s+", RegexOptions.IgnoreCase);
                //                        if ((hex.Length >= 8) && (hex[0] == "07") || (hex[0] == "08"))
                //                        {
                //                            string a = hex[0];
                //                            string b = hex[1];
                //                            string year = int.Parse(a + b, NumberStyles.HexNumber).ToString();
                //                            string month = int.Parse(hex[2], NumberStyles.HexNumber).ToString();
                //                            string day = int.Parse(hex[3], NumberStyles.HexNumber).ToString();
                //                            string hour = int.Parse(hex[4], NumberStyles.HexNumber).ToString();
                //                            string min = int.Parse(hex[5], NumberStyles.HexNumber).ToString();
                //                            string sed = int.Parse(hex[6], NumberStyles.HexNumber).ToString();
                //                            string mil = int.Parse(hex[7], NumberStyles.HexNumber).ToString();
                //                            item.SubItems.Add(year + "-" + month + "-" + day + "," + hour + ":" + min + ":" + sed + ":" + mil);

                //                        }
                //                        item.EnsureVisible();


                //                        if (v.Value.Type == SnmpConstants.SMI_ENDOFMIBVIEW)
                //                            lastOid = null;
                //                        else
                //                            lastOid = v.Oid;
                //                    }
                //                    else
                //                    {
                //                        // we have reached the end of the requested
                //                        // MIB tree. Set lastOid to null and exit loop
                //                        lastOid = null;
                //                    }
                //                }
                //            }
                //        }
                //        else
                //        {
                //            MessageBox.Show("No response received from SNMP agent.");
                //        }
                //    }
                //    target.Close();
            }


        }
        private void comip_Leave(object sender, EventArgs e)
        {
            if (comip.Text == "")
            {
                comip.Text = "请输入设备ip地址";
            }
        }
        private void comip_Click(object sender, EventArgs e)
        {
            if (comip.Text == "请输入设备ip地址")
            {
                comip.Text = "";
            }
        }
        private void textcom_Click(object sender, EventArgs e)
        {
            if (textcom.Text == "请输入命令行查询")
            {
                textcom.Text = "";
            }
        }

        private void butoptbackoff_Click(object sender, EventArgs e)
        {
            //MessageBox.Show("激光器关断和开启只对源光口作用，请选择光口为源光口！");
            if (butoptbackoff.Text == "备用激光器关断")
            {
                butguzhangsend.PerformClick();
                if (!textcurrent.Text.Contains("#"))
                {
                    MessageBox.Show("检测发现：未运行在(config)#模式下，请断开后重新连接，再次尝试！");
                    return;
                }
                textguzhangmingling.Text = "config otn";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "interface otn " + comSBslot.Text + "/" + comSBport.Text;
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "optical disable";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                richTextEnd.AppendText(comSBslot.Text + "/" + comSBport.Text + "激光器已关断！" + "\r\n");
                butoptbackoff.Text = "备用激光器开启";
                // MessageBox.Show(comSBslot.Text + "/" + comSBport.Text + "激光器已关断！");
            }
            else
            {
                butguzhangsend.PerformClick();
                if (!textcurrent.Text.Contains("#"))
                {
                    MessageBox.Show("检测发现：未运行在(config)#模式下，请断开后重新连接，再次尝试！");
                    return;
                }
                textguzhangmingling.Text = "config otn";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "interface otn " + comSBslot.Text + "/" + comSBport.Text;
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "optical enable";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                textguzhangmingling.Text = "exit";
                butguzhangsend.PerformClick();
                richTextEnd.AppendText(comSBslot.Text + "/" + comSBport.Text + "激光器已开启！" + "\r\n");
                butoptbackoff.Text = "备用激光器关断";
                //MessageBox.Show(comSBslot.Text + "/" + comSBport.Text + "激光器已开启！");
            }
        }


        private void timer1_Tick(object sender, EventArgs e)
        {
            //MessageBox.Show("");
            try
            {
                if (devtype == "")
                {
                    return;
                }
                // SNMP团体名称 
                OctetString community = new OctetString(textReadCommunity.Text);
                //定义代理参数类 
                AgentParameters param = new AgentParameters(SnmpVersion.Ver2, community, true);
                //将SNMP版本设置为1（或2） 
                //构造代理地址对象
                //这里很容易使用IpAddress类，因为
                //如果不
                //解析为IP地址，它将尝试解析构造函数参数
                IpAddress agent = new IpAddress(comip.Text);
                IPAddress send = new IPAddress(agent);
                //构建目标 
                UdpTarget target = new UdpTarget(send, 161, 2000, 1);
                //  用于所有请求PDU级 
                Pdu pdu = new Pdu(PduType.Get);
                if (slot17 == "ACTIVE")
                {
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.23.1.17");  //17槽位CPU利用率
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.26.1.17");  //17槽位内存利用率
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.20.1.17");  //17槽位温度
                }
                if (slot18 == "ACTIVE")
                {
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.23.1.18");  //18槽位CPU利用率
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.26.1.18");  //18槽位内存利用率
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.20.1.18");  //18槽位温度
                }
                if (devtype != "98" && devtype != "103" && devtype != "104" && devtype != "106" && devtype != "107"
                    && devtype != "108" && devtype != "109" && devtype != "110" && devtype != "111" && devtype != "112")
                {
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.23.1.1");  //1槽位CPU利用率
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.26.1.1");  //1槽位内存利用率
                    pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.20.1.1");  //1槽位温度
                }



                SnmpPacket result = null;
                try
                {
                    result = target.Request(pdu, param);

                }
                catch 
                {
                    timer1.Stop();

                    textDOS.AppendText("没有收到SNMP请求后的响应！");
                }
                //SnmpV1Packet result = (SnmpV1Packet)target.Request(pdu, param);
                //如果结果为null，则座席未回复或我们无法解析回复。
                if (result != null)
                {
                    //其他的ErrorStatus然后0是通过返回一个错误
                    //代理-见SnmpConstants为错误定义
                    if (result.Pdu.ErrorStatus != 0)
                    {
                        //代理报告与所述请求的错误 
                        textDOS.Text += string.Format("\r\n" + "SNMP回复错误！错误代码：{0}，错误索引：第{1}项 \r\n",
                                FindDevType.FindErrorCode(result.Pdu.ErrorStatus),
                                result.Pdu.ErrorIndex);
                    }
                    else
                    {

                        //返回变量的返回顺序与添加
                        //到VbList
                        try
                        {
                            toolStripStatusLabelcpu.Text = "CPU:" + result.Pdu.VbList[0].Value.ToString() + "%";
                            toolStripStatusLabelmem.Text = "内存:" + result.Pdu.VbList[1].Value.ToString() + "%";
                            toolStripStatusLabeltem.Text = "温度:" + result.Pdu.VbList[2].Value.ToString() + "°C";
                            int cpu = int.Parse(result.Pdu.VbList[0].Value.ToString());
                            int mem = int.Parse(result.Pdu.VbList[1].Value.ToString());
                            int tem = int.Parse(result.Pdu.VbList[2].Value.ToString());
                            if (cpu <= 75)
                            {
                                toolStripStatusLabelcpu.ForeColor = Color.DarkGreen;

                            }
                            else
                            {
                                toolStripStatusLabelcpu.ForeColor = Color.Red;
                            }
                            if (mem <= 75)
                            {
                                toolStripStatusLabelmem.ForeColor = Color.DarkGreen;

                            }
                            else
                            {
                                toolStripStatusLabelmem.ForeColor = Color.Red;
                            }
                            if (tem <= 75)
                            {
                                toolStripStatusLabeltem.ForeColor = Color.DarkGreen;

                            }
                            else
                            {
                                toolStripStatusLabeltem.ForeColor = Color.Red;
                            }
                        }
                        catch (Exception ex)
                        {
                            timer1.Stop();

                            textDOS.AppendText(ex.Message);
                        }



                    }
                }
                else
                {
                    textDOS.AppendText("\r\n" + "没有收到来自SNMP代理的响应！");
                }

                target.Close();
            }
            catch (SnmpException ex)
            {
                timer1.Stop();

                textDOS.AppendText(ex.Message);
            }
        }

        private void metroButoidclear_Click(object sender, EventArgs e)
        {

            this.lv2.Items.Clear();  //只移除所有的项。
        }

        private void metroButset_Click(object sender, EventArgs e)
        {
            string WriteType = "";
            // SNMP团体名称 
            OctetString community = new OctetString(metroTextReadCommunity.Text);
            //定义代理参数类 
            AgentParameters param = new AgentParameters(SnmpVersion.Ver2, community, true);
            //将SNMP版本设置为1（或2） 
            //构造代理地址对象
            //这里很容易使用IpAddress类，因为
            //如果不
            //解析为IP地址，它将尝试解析构造函数参数
            IpAddress agent = new IpAddress(metroTextgpnip.Text);
            IPAddress send = new IPAddress(agent);
            //构建目标 
            UdpTarget target = new UdpTarget(send, 161, 2000, 1);
            //  用于所有请求PDU级 
            Pdu pdu = new Pdu(PduType.Get);
            pdu.VbList.Add(metroTextoid.Text);   //11槽位主备状态


            SnmpPacket result = null;
            try
            {
                result = target.Request(pdu, param);
            }
            catch 
            {
                // MessageBox.Show(ex.Message);
            }
            //SnmpV1Packet result = (SnmpV1Packet)target.Request(pdu, param);
            //如果结果为null，则座席未回复或我们无法解析回复。
            if (result != null)
            {
                //其他的ErrorStatus然后0是通过返回一个错误
                //代理-见SnmpConstants为错误定义
                if (result.Pdu.ErrorStatus != 0)
                {
                    //代理报告与所述请求的错误 
                    MessageBox.Show(String.Format("SNMP回复错误！错误代码：{0}，错误索引：第{1}行\r\n",
                            FindDevType.FindErrorCode(result.Pdu.ErrorStatus),
                            result.Pdu.ErrorIndex));

                    return;
                }
                else
                {

                    //返回变量的返回顺序与添加
                    //到VbList

                    //toolStripStatusLabelver.Text = "APP:" + result.Pdu.VbList[4].Value.ToString();
                    WriteType = SnmpConstants.GetTypeName(result.Pdu.VbList[0].Value.Type);




                    //MessageBox.Show("ssss");
                    //toolStripStatusLabelnms.ForeColor = Color.DarkGreen;

                }
            }
            else
            {
                WriteType = "Integer32";
                MessageBox.Show("请求后未收到回复");
            }
            target.Close();








            // Prepare target
            target = new UdpTarget((IPAddress)new IpAddress(metroTextgpnip.Text));
            // Create a SET PDU
            pdu = new Pdu(PduType.Set);

            // Set sysLocation.0 to a new string
            if (WriteType == "OctetString")
            {
                pdu.VbList.Add(new Oid(metroTextoid.Text), new OctetString(metroTextvalue.Text));

            }
            if (WriteType == "Integer32")
            {
                pdu.VbList.Add(new Oid(metroTextoid.Text), new Integer32(metroTextvalue.Text));
            }
            if (WriteType == "UInteger32")
            {
                pdu.VbList.Add(new Oid(metroTextoid.Text), new UInteger32(metroTextvalue.Text));
            }
            if (WriteType == "Gauge32")
            {
                pdu.VbList.Add(new Oid(metroTextoid.Text), new Gauge32(metroTextvalue.Text));
            }
            if (WriteType == "TimeTicks")
            {
                pdu.VbList.Add(new Oid(metroTextoid.Text), new TimeTicks(metroTextvalue.Text));
            }
            if (WriteType == "IpAddress")
            {
                pdu.VbList.Add(new Oid(metroTextoid.Text), new IpAddress(metroTextvalue.Text));
            }
            AgentParameters aparam = aparam = new AgentParameters(SnmpVersion.Ver2, new OctetString(metroTextSetCommunity.Text), true);


            // Response packet
            SnmpV2Packet response;
            try
            {
                // Send request and wait for response
                response = target.Request(pdu, aparam) as SnmpV2Packet;
            }
            catch 
            {
                // If exception happens, it will be returned here
                MessageBox.Show("请求后未收到回复");
                target.Close();
                return;
            }
            // Make sure we received a response
            if (response == null)
            {
                MessageBox.Show("发送错误的SNMP请求");
            }
            else
            {
                // Check if we received an SNMP error from the agent
                if (response.Pdu.ErrorStatus != 0)
                {
                    MessageBox.Show(String.Format("SNMP回复错误！错误代码:{0}，错误索引：第{1}行\r\n",
                        FindDevType.FindErrorCode(response.Pdu.ErrorStatus), response.Pdu.ErrorIndex));
                }
                else
                {
                    // Everything is ok. Agent will return the new value for the OID we changed
                    ListViewItem item = lv2.Items.Add((lv2.Items.Count + 1) + "");
                    item.SubItems.Add(metroTextgpnip.Text);
                    item.SubItems.Add(metroTextSetCommunity.Text);
                    item.SubItems.Add(result.Pdu.VbList.Count.ToString());
                    item.SubItems.Add(response.Pdu[0].Oid.ToString());
                    item.SubItems.Add(SnmpConstants.GetTypeName(response.Pdu[0].Value.Type));
                    item.SubItems.Add(response.Pdu[0].Value.ToString());
                    item.EnsureVisible();
                    target.Close();

                }
            }
        }
        Thread trap;
        bool run = false;
        private void metroButTrap_Click(object sender, EventArgs e)
        {

            if (metroButTrap.Text == "使能Trap监听")
            {
                IPGlobalProperties ipProperties = IPGlobalProperties.GetIPGlobalProperties();
                IPEndPoint[] ipEndPoints = ipProperties.GetActiveUdpListeners();
                foreach (IPEndPoint endPoint in ipEndPoints)
                {
                    int A = 162;
                    if (endPoint.Port == A)
                    {
                        MessageBox.Show(A + "号端口已占用，请关闭其它SNMP软件后，再次尝试！");
                        return;
                    }
                }




                trap = new Thread(Trap);
                run = true;
                trap.Start();
                metroButTrap.Text = "禁止Trap监听";
            }
            else
            {
                run = false;
                metroButTrap.Text = "使能Trap监听";
                trap.Abort();
                //socket.Shutdown(SocketShutdown.Both);
                //    Thread.Sleep(10);
                socket.Close();
                MessageBox.Show("关闭");
                //

            }


        }
        Socket socket; //目标socket
        //EndPoint ep; //客户端
        IPEndPoint ipep; //侦听端口

        private void Trap()
        {

            if (run == true)
            {
                ipep = new IPEndPoint(IPAddress.Any, 162);
                //定义套接字类型,在主线程中定义
                socket = new Socket(AddressFamily.InterNetwork, SocketType.Dgram, ProtocolType.Udp);
                //服务端需要绑定ip
                try
                {
                    socket.Bind(ipep);
                }
                catch 
                {

                }
            }
            //定义侦听端口,侦听任何IP

            int inlen = -1;
            while (run)
            {
                byte[] indata = new byte[16 * 1024];
                // 16KB receive buffer int inlen = 0;
                IPEndPoint peer = new IPEndPoint(IPAddress.Any, 0);
                EndPoint inep = peer;
                try
                {
                    inlen = socket.ReceiveFrom(indata, ref inep);
                }
                catch 
                {
                    // MessageBox.Show("Exception {0}", ex.Message);
                    inlen = -1;
                }
                if (inlen > 0)
                {
                    // Check protocol version int
                    int ver = SnmpPacket.GetProtocolVersion(indata, inlen);
                    if (ver == (int)SnmpVersion.Ver1)
                    {
                        // Parse SNMP Version 1 TRAP packet
                        //SnmpV1TrapPacket pkt = new SnmpV1TrapPacket();
                        //pkt.decode(indata, inlen);
                        //metroTextBox1.AppendText(string.Format("** SNMP Version 1 TRAP received from {0}:", inep.ToString()));
                        //metroTextBox1.AppendText(string.Format("*** Trap generic: {0}", pkt.Pdu.Generic));
                        //metroTextBox1.AppendText(string.Format("*** Trap specific: {0}", pkt.Pdu.Specific));
                        //metroTextBox1.AppendText(string.Format("*** Agent address: {0}", pkt.Pdu.AgentAddress.ToString()));
                        //metroTextBox1.AppendText(string.Format("*** Timestamp: {0}", pkt.Pdu.TimeStamp.ToString()));
                        //metroTextBox1.AppendText(string.Format("*** VarBind count: {0}", pkt.Pdu.VbList.Count));
                        //metroTextBox1.AppendText("*** VarBind content:");
                        //foreach (Vb v in pkt.Pdu.VbList)
                        //{
                        //    metroTextBox1.AppendText(string.Format("**** {0} {1}: {2}", v.Oid.ToString(), SnmpConstants.GetTypeName(v.Value.Type), v.Value.ToString()));
                        //}
                        //metroTextBox1.AppendText("** End of SNMP Version 1 TRAP data.");
                    }
                    else
                    {
                        // Parse SNMP Version 2 TRAP packet
                        SnmpV2Packet pkt = new SnmpV2Packet();
                        pkt.decode(indata, inlen);
                        if (pkt.Pdu.Type != PduType.V2Trap)
                        {
                            MessageBox.Show("*** NOT an SNMPv2 trap ****" + "\r\n");
                        }
                        else
                        {

                            foreach (Vb v in pkt.Pdu.VbList)
                            {
                                if (metroCheckfilter.Checked == false)
                                {
                                    ListViewItem item = lv2.Items.Add((lv2.Items.Count + 1) + "");
                                    item.SubItems.Add(inep.ToString());
                                    item.SubItems.Add(pkt.Community.ToString());
                                    item.SubItems.Add(pkt.Pdu.VbList.Count.ToString());
                                    item.SubItems.Add(v.Oid.ToString());
                                    item.SubItems.Add(SnmpConstants.GetTypeName(v.Value.Type));
                                    item.SubItems.Add(v.Value.ToString());

                                    string[] hex = Regex.Split(v.Value.ToString(), "\\s+", RegexOptions.IgnoreCase);
                                    if ((hex.Length >= 8) && (hex[0] == "07") || (hex[0] == "08"))
                                    {
                                        string a = hex[0];
                                        string b = hex[1];
                                        string year = int.Parse(a + b, NumberStyles.HexNumber).ToString();
                                        string month = int.Parse(hex[2], NumberStyles.HexNumber).ToString();
                                        string day = int.Parse(hex[3], NumberStyles.HexNumber).ToString();
                                        string hour = int.Parse(hex[4], NumberStyles.HexNumber).ToString();
                                        string min = int.Parse(hex[5], NumberStyles.HexNumber).ToString();
                                        string sed = int.Parse(hex[6], NumberStyles.HexNumber).ToString();
                                        string mil = int.Parse(hex[7], NumberStyles.HexNumber).ToString();
                                        item.SubItems.Add(year + "-" + month + "-" + day + "," + hour + ":" + min + ":" + sed + ":" + mil);

                                    }

                                    item.EnsureVisible();
                                }
                                else
                                {
                                    if (inep.ToString().Contains(metroTextfilterip.Text))
                                    {
                                        ListViewItem item = lv2.Items.Add((lv2.Items.Count + 1) + "");
                                        item.SubItems.Add(inep.ToString());
                                        item.SubItems.Add(pkt.Community.ToString());
                                        item.SubItems.Add(pkt.Pdu.VbList.Count.ToString());
                                        item.SubItems.Add(v.Oid.ToString());
                                        item.SubItems.Add(SnmpConstants.GetTypeName(v.Value.Type));
                                        item.SubItems.Add(v.Value.ToString());
                                        string[] hex = Regex.Split(v.Value.ToString(), "\\s+", RegexOptions.IgnoreCase);
                                        if ((hex.Length >= 8) && (hex[0] == "07") || (hex[0] == "08"))
                                        {
                                            string a = hex[0];
                                            string b = hex[1];
                                            string year = int.Parse(a + b, NumberStyles.HexNumber).ToString();
                                            string month = int.Parse(hex[2], NumberStyles.HexNumber).ToString();
                                            string day = int.Parse(hex[3], NumberStyles.HexNumber).ToString();
                                            string hour = int.Parse(hex[4], NumberStyles.HexNumber).ToString();
                                            string min = int.Parse(hex[5], NumberStyles.HexNumber).ToString();
                                            string sed = int.Parse(hex[6], NumberStyles.HexNumber).ToString();
                                            string mil = int.Parse(hex[7], NumberStyles.HexNumber).ToString();
                                            item.SubItems.Add(year + "-" + month + "-" + day + "," + hour + ":" + min + ":" + sed + ":" + mil);

                                        }
                                        item.EnsureVisible();
                                    }
                                }






                            }
                            //metroTextBox1.AppendText("** End of SNMP Version 2 TRAP data." + "\r\n");
                        }
                    }
                }
                else
                {
                    if (inlen == 0)
                        MessageBox.Show("Zero length packet received.");
                }
            }



        }

        private void 关于软件OToolStripMenuItem_Click(object sender, EventArgs e)
        {
            About About = new About();//实例化窗体
            About.ShowDialog();// 将窗体显示出来
        }

        private void 关于ToolStripMenuItem_Click(object sender, EventArgs e)
        {
            //Help Help = new Help();//实例化窗体
            //Help.ShowDialog();// 将窗体显示出来
        }

        private void metroButConSql_Click(object sender, EventArgs e)
        {
            String connetStr = "server=dx.hunan128.com;port=3306;user=mib;password=Hunan7420716.; database=mib;charset=utf8;";
            // server=127.0.0.1/localhost 代表本机，端口号port默认是3306可以不写
            MySqlConnection conn = new MySqlConnection(connetStr);
            try
            {
                conn.Open();//打开通道，建立连接，可能出现异常,使用try catch语句
                            // MessageBox.Show("已经建立连接");
                            //在这里使用代码对数据库进行增删查改
                            //设置查询命令
                string sql = "select distinct table_class from mib;";
                MySqlCommand cmd = new MySqlCommand(sql, conn);
                //查询结果读取器
                MySqlDataReader reader = cmd.ExecuteReader();
                metroComTableClass.Items.Clear();
                while (reader.Read())
                {

                    metroComTableClass.Items.Add(reader[0].ToString());



                }
                metroComTableClass.SelectedIndex = metroComTableClass.Items.Count - 1;
            }
            catch (MySqlException ex)
            {
                MessageBox.Show(ex.Message);
            }
            finally
            {
                conn.Close();
            }
        }

        private void metroComTableClass_SelectedIndexChanged(object sender, EventArgs e)
        {
            String connetStr = "server=dx.hunan128.com;port=3306;user=mib;password=Hunan7420716.; database=mib;charset=utf8;";
            // server=127.0.0.1/localhost 代表本机，端口号port默认是3306可以不写
            MySqlConnection conn = new MySqlConnection(connetStr);
            try
            {
                conn.Open();//打开通道，建立连接，可能出现异常,使用try catch语句
                            // MessageBox.Show("已经建立连接");
                            //在这里使用代码对数据库进行增删查改
                            //设置查询命令
                string sql = "SELECT mib.table_name from mib WHERE table_class = '" + metroComTableClass.Text + "' GROUP BY table_name";
                MySqlCommand cmd = new MySqlCommand(sql, conn);
                //查询结果读取器
                MySqlDataReader reader = cmd.ExecuteReader();
                // MessageBox.Show(reader[0].ToString());
                metroComTableName.Items.Clear();
                while (reader.Read())
                {

                    metroComTableName.Items.Add(reader[0].ToString());



                }
                metroComTableName.SelectedIndex = metroComTableName.Items.Count - 1;
            }
            catch (MySqlException ex)
            {
                MessageBox.Show(ex.Message);
            }
            finally
            {
                conn.Close();
            }
        }

        private void metroComTableName_SelectedIndexChanged(object sender, EventArgs e)
        {
            String connetStr = "server=dx.hunan128.com;port=3306;user=mib;password=Hunan7420716.; database=mib;charset=utf8;";
            // server=127.0.0.1/localhost 代表本机，端口号port默认是3306可以不写
            MySqlConnection conn = new MySqlConnection(connetStr);
            try
            {
                conn.Open();//打开通道，建立连接，可能出现异常,使用try catch语句
                //MessageBox.Show("已经建立连接");
                //在这里使用代码对数据库进行增删查改
                //设置查询命令
                string sql = "SELECT mib.name from mib WHERE table_name = '" + metroComTableName.Text + "' GROUP BY name";
                MySqlCommand cmd = new MySqlCommand(sql, conn);
                //查询结果读取器
                MySqlDataReader reader = cmd.ExecuteReader();
                metroComOidName.Items.Clear();
                // MessageBox.Show(reader[0].ToString());
                while (reader.Read())
                {

                    metroComOidName.Items.Add(reader[0].ToString());



                }
                metroComOidName.SelectedIndex = metroComOidName.Items.Count - 1;
            }
            catch (MySqlException ex)
            {
                MessageBox.Show(ex.Message);
            }
            finally
            {
                conn.Close();
            }
        }

        private void metroComOidName_SelectedIndexChanged(object sender, EventArgs e)
        {
            String connetStr = "server=dx.hunan128.com;port=3306;user=mib;password=Hunan7420716.; database=mib;charset=utf8;";
            // server=127.0.0.1/localhost 代表本机，端口号port默认是3306可以不写
            MySqlConnection conn = new MySqlConnection(connetStr);
            try
            {
                conn.Open();//打开通道，建立连接，可能出现异常,使用try catch语句
                //MessageBox.Show("已经建立连接");
                //在这里使用代码对数据库进行增删查改
                //设置查询命令
                string SQLoid = "SELECT mib.oid, mib.type, mib.permission, mib.value, mib.note  from mib WHERE name = '" + metroComOidName.Text + "'";
                MySqlCommand oid = new MySqlCommand(SQLoid, conn);
                //查询结果读取器
                MySqlDataReader readeroid = oid.ExecuteReader();
                metroTextoid.Text = "";
                metroTextOidType.Text = "";
                metroTextOidPermission.Text = "";
                metroTextOidValue.Text = "";
                metroTextOidNote.Text = "";
                // MessageBox.Show(reader[0].ToString());
                while (readeroid.Read())
                {

                    metroTextoid.AppendText(readeroid[0].ToString());
                    metroTextOidType.AppendText(readeroid[1].ToString());
                    metroTextOidPermission.AppendText(readeroid[2].ToString());
                    metroTextOidValue.AppendText(readeroid[3].ToString());
                    metroTextOidNote.AppendText(readeroid[4].ToString());


                }

            }
            catch (MySqlException ex)
            {
                MessageBox.Show(ex.Message);
            }
            finally
            {
                conn.Close();
            }
        }

        private void metroButselect_Click(object sender, EventArgs e)
        {
            //        MessageBox.Show("支持了三方FTP工具，请先启动第三方FTP工具,然后点击批量升级。否则会出现卡死的情况，得重新关闭软件在打开！"
            //+ "\r\n" + "注意事项：FTP用户名：admin密码：admin必须一样，APP文件必须和升级的文件名一致");
            Batch batchfrm = new Batch
            {
                FTPIP = comftpip.Text,
                FTPUSR = textftpusr.Text,
                FTPPSD = textftppsd.Text,
                GPNUSR = textusr.Text,
                GPNPSD = textpsd.Text,
                GPNPSDEN = textpsden.Text,
                yanshi = ts,
                app = comapp.Text
            };//实例化窗体
            batchfrm.ShowDialog();// 将窗体显示出来
        }

        private void textDOS_TextChanged(object sender, EventArgs e)
        {

        }
        private void datagridviewcreat()
        {

            if (checkapp.Checked == true)
            {
                if (DGVSTATUS.Columns["APP"] == null)
                {

                    this.DGVSTATUS.Columns.Add("APP", "APP");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("APP");
                    this.DGVSTATUS.Columns.Add("APP", "APP");
                }
                this.DGVSTATUS.Columns["APP"].FillWeight = 50;
                DGVSTATUS.Columns["APP"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checkapp2.Checked == true)
            {
                if (DGVSTATUS.Columns["APP2"] == null)
                {

                    this.DGVSTATUS.Columns.Add("APP2", "APP2");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("APP2");
                    this.DGVSTATUS.Columns.Add("APP2", "APP2");
                }
                this.DGVSTATUS.Columns["APP2"].FillWeight = 50;
                DGVSTATUS.Columns["APP2"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checkcode.Checked == true)
            {
                if (DGVSTATUS.Columns["CODE"] == null)
                {

                    this.DGVSTATUS.Columns.Add("CODE", "CODE");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("CODE");
                    this.DGVSTATUS.Columns.Add("CODE", "CODE");
                }
                this.DGVSTATUS.Columns["CODE"].FillWeight = 50;
                DGVSTATUS.Columns["CODE"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checkcode2.Checked == true)
            {
                if (DGVSTATUS.Columns["CODE2"] == null)
                {

                    this.DGVSTATUS.Columns.Add("CODE2", "CODE2");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("CODE2");
                    this.DGVSTATUS.Columns.Add("CODE2", "CODE2");
                }
                this.DGVSTATUS.Columns["CODE2"].FillWeight = 50;
                DGVSTATUS.Columns["CODE2"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checkcode3.Checked == true)
            {
                if (DGVSTATUS.Columns["CODE3"] == null)
                {

                    this.DGVSTATUS.Columns.Add("CODE3", "CODE3");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("CODE3");
                    this.DGVSTATUS.Columns.Add("CODE3", "CODE3");
                }
                this.DGVSTATUS.Columns["CODE3"].FillWeight = 50;
                DGVSTATUS.Columns["CODE3"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checkcode4.Checked == true)
            {
                if (DGVSTATUS.Columns["CODE4"] == null)
                {

                    this.DGVSTATUS.Columns.Add("CODE4", "CODE4");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("CODE4");
                    this.DGVSTATUS.Columns.Add("CODE4", "CODE4");
                }
                this.DGVSTATUS.Columns["CODE4"].FillWeight = 50;
                DGVSTATUS.Columns["CODE4"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checksdn.Checked == true)
            {
                if (DGVSTATUS.Columns["SDN"] == null)
                {

                    this.DGVSTATUS.Columns.Add("SDN", "SDN");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("SDN");
                    this.DGVSTATUS.Columns.Add("SDN", "SDN");
                }
                this.DGVSTATUS.Columns["SDN"].FillWeight = 50;
                DGVSTATUS.Columns["SDN"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checknms.Checked == true)
            {
                if (DGVSTATUS.Columns["NMS"] == null)
                {

                    this.DGVSTATUS.Columns.Add("NMS", "NMS");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("NMS");
                    this.DGVSTATUS.Columns.Add("NMS", "NMS");
                }
                this.DGVSTATUS.Columns["NMS"].FillWeight = 50;
                DGVSTATUS.Columns["NMS"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checksw.Checked == true)
            {
                if (DGVSTATUS.Columns["SW"] == null)
                {

                    this.DGVSTATUS.Columns.Add("SW", "SW");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("SW");
                    this.DGVSTATUS.Columns.Add("SW", "SW");
                }
                this.DGVSTATUS.Columns["SW"].FillWeight = 50;
                DGVSTATUS.Columns["SW"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (check760s.Checked == true)
            {
                if (DGVSTATUS.Columns["760S"] == null)
                {

                    this.DGVSTATUS.Columns.Add("760S", "760S");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("760S");
                    this.DGVSTATUS.Columns.Add("760S", "760S");
                }
                this.DGVSTATUS.Columns["760S"].FillWeight = 50;
                DGVSTATUS.Columns["760S"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (check760b.Checked == true)
            {
                if (DGVSTATUS.Columns["760B"] == null)
                {

                    this.DGVSTATUS.Columns.Add("760B", "760B");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("760B");
                    this.DGVSTATUS.Columns.Add("760B", "760B");
                }
                this.DGVSTATUS.Columns["760B"].FillWeight = 50;
                DGVSTATUS.Columns["760B"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (check760c.Checked == true)
            {
                if (DGVSTATUS.Columns["760C"] == null)
                {

                    this.DGVSTATUS.Columns.Add("760C", "760C");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("760C");
                    this.DGVSTATUS.Columns.Add("760C", "760C");
                }
                this.DGVSTATUS.Columns["760C"].FillWeight = 50;
                DGVSTATUS.Columns["760C"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (check760d.Checked == true)
            {
                if (DGVSTATUS.Columns["760D"] == null)
                {

                    this.DGVSTATUS.Columns.Add("760D", "760D");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("760D");
                    this.DGVSTATUS.Columns.Add("760D", "760D");
                }
                this.DGVSTATUS.Columns["760D"].FillWeight = 50;
                DGVSTATUS.Columns["760D"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (check760e.Checked == true)
            {
                if (DGVSTATUS.Columns["760E"] == null)
                {

                    this.DGVSTATUS.Columns.Add("760E", "760E");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("760E");
                    this.DGVSTATUS.Columns.Add("760E", "760E");
                }
                this.DGVSTATUS.Columns["760E"].FillWeight = 50;
                DGVSTATUS.Columns["760E"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checkuxc.Checked == true)
            {
                if (DGVSTATUS.Columns["UXC"] == null)
                {

                    this.DGVSTATUS.Columns.Add("UXC", "UXC");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("UXC");
                    this.DGVSTATUS.Columns.Add("UXC", "UXC");
                }
                this.DGVSTATUS.Columns["UXC"].FillWeight = 50;
                DGVSTATUS.Columns["UXC"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (check7610.Checked == true)
            {
                if (DGVSTATUS.Columns["7610"] == null)
                {

                    this.DGVSTATUS.Columns.Add("7610", "7610");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("7610");
                    this.DGVSTATUS.Columns.Add("7610", "7610");
                }
                this.DGVSTATUS.Columns["7610"].FillWeight = 50;
                DGVSTATUS.Columns["7610"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (check7611.Checked == true)
            {
                if (DGVSTATUS.Columns["7611"] == null)
                {

                    this.DGVSTATUS.Columns.Add("7611", "7611");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("7611");
                    this.DGVSTATUS.Columns.Add("7611", "7611");
                }
                this.DGVSTATUS.Columns["7611"].FillWeight = 50;
                DGVSTATUS.Columns["7611"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (check7612.Checked == true)
            {
                if (DGVSTATUS.Columns["7612"] == null)
                {

                    this.DGVSTATUS.Columns.Add("7612", "7612");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("7612");
                    this.DGVSTATUS.Columns.Add("7612", "7612");
                }
                this.DGVSTATUS.Columns["7612"].FillWeight = 50;
                DGVSTATUS.Columns["7612"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (check7613.Checked == true)
            {
                if (DGVSTATUS.Columns["7613"] == null)
                {

                    this.DGVSTATUS.Columns.Add("7613", "7613");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("7613");
                    this.DGVSTATUS.Columns.Add("7613", "7613");
                }
                this.DGVSTATUS.Columns["7613"].FillWeight = 50;
                DGVSTATUS.Columns["7613"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (check7614.Checked == true)
            {
                if (DGVSTATUS.Columns["7614"] == null)
                {

                    this.DGVSTATUS.Columns.Add("7614", "7614");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("7614");
                    this.DGVSTATUS.Columns.Add("7614", "7614");
                }
                this.DGVSTATUS.Columns["7614"].FillWeight = 50;
                DGVSTATUS.Columns["7614"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (check7615.Checked == true)
            {
                if (DGVSTATUS.Columns["7615"] == null)
                {

                    this.DGVSTATUS.Columns.Add("7615", "7615");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("7615");
                    this.DGVSTATUS.Columns.Add("7615", "7615");
                }
                this.DGVSTATUS.Columns["7615"].FillWeight = 50;
                DGVSTATUS.Columns["7615"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (check7616.Checked == true)
            {
                if (DGVSTATUS.Columns["7616"] == null)
                {

                    this.DGVSTATUS.Columns.Add("7616", "7616");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("7616");
                    this.DGVSTATUS.Columns.Add("7616", "7616");
                }
                this.DGVSTATUS.Columns["7616"].FillWeight = 50;
                DGVSTATUS.Columns["7616"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checksysfile.Checked == true)
            {
                if (DGVSTATUS.Columns["SysFile"] == null)
                {

                    this.DGVSTATUS.Columns.Add("SysFile", "SysFile");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("SysFile");
                    this.DGVSTATUS.Columns.Add("SysFile", "SysFile");
                }
                this.DGVSTATUS.Columns["SysFile"].FillWeight = 50;
                DGVSTATUS.Columns["SysFile"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checkvoss.Checked == true)
            {
                if (DGVSTATUS.Columns["VOSS"] == null)
                {

                    this.DGVSTATUS.Columns.Add("VOSS", "VOSS");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("VOSS");
                    this.DGVSTATUS.Columns.Add("VOSS", "VOSS");
                }
                this.DGVSTATUS.Columns["VOSS"].FillWeight = 50;
                DGVSTATUS.Columns["VOSS"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checkrebootos.Checked == true)
            {
                if (DGVSTATUS.Columns["REBOOTOS"] == null)
                {

                    this.DGVSTATUS.Columns.Add("REBOOTOS", "REBOOTOS");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("REBOOTOS");
                    this.DGVSTATUS.Columns.Add("REBOOTOS", "REBOOTOS");
                }
                this.DGVSTATUS.Columns["REBOOTOS"].FillWeight = 50;
                DGVSTATUS.Columns["REBOOTOS"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checkcpld.Checked == true)
            {
                if (DGVSTATUS.Columns["CPLD"] == null)
                {

                    this.DGVSTATUS.Columns.Add("CPLD", "CPLD");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("CPLD");
                    this.DGVSTATUS.Columns.Add("CPLD", "CPLD");
                }
                this.DGVSTATUS.Columns["CPLD"].FillWeight = 50;
                DGVSTATUS.Columns["CPLD"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checkflash.Checked == true)
            {
                if (DGVSTATUS.Columns["FLASH"] == null)
                {

                    this.DGVSTATUS.Columns.Add("FLASH", "FLASH");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("FLASH");
                    this.DGVSTATUS.Columns.Add("FLASH", "FLASH");
                }
                this.DGVSTATUS.Columns["FLASH"].FillWeight = 50;
                DGVSTATUS.Columns["FLASH"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checkyaffs.Checked == true)
            {
                if (DGVSTATUS.Columns["YAFFS"] == null)
                {

                    this.DGVSTATUS.Columns.Add("YAFFS", "YAFFS");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("YAFFS");
                    this.DGVSTATUS.Columns.Add("YAFFS", "YAFFS");
                }
                this.DGVSTATUS.Columns["YAFFS"].FillWeight = 50;
                DGVSTATUS.Columns["YAFFS"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checkconfig.Checked == true)
            {
                if (DGVSTATUS.Columns["Config"] == null)
                {

                    this.DGVSTATUS.Columns.Add("Config", "Config");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("Config");
                    this.DGVSTATUS.Columns.Add("Config", "Config");
                }
                this.DGVSTATUS.Columns["Config"].FillWeight = 50;
                DGVSTATUS.Columns["Config"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checkdb.Checked == true)
            {
                if (DGVSTATUS.Columns["Db"] == null)
                {

                    this.DGVSTATUS.Columns.Add("Db", "Db");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("Db");
                    this.DGVSTATUS.Columns.Add("Db", "Db");
                }
                this.DGVSTATUS.Columns["Db"].FillWeight = 50;
                DGVSTATUS.Columns["Db"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }
            if (checkslotconfig.Checked == true)
            {
                if (DGVSTATUS.Columns["SlotConfig"] == null)
                {

                    this.DGVSTATUS.Columns.Add("SlotConfig", "SlotConfig");
                }
                else
                {
                    this.DGVSTATUS.Columns.Remove("SlotConfig");
                    this.DGVSTATUS.Columns.Add("SlotConfig", "SlotConfig");
                }
                this.DGVSTATUS.Columns["SlotConfig"].FillWeight = 50;
                DGVSTATUS.Columns["SlotConfig"].SortMode = DataGridViewColumnSortMode.NotSortable;
            }



        }

        private void buttbatchdownload_Click(object sender, EventArgs e)
        {
            LoadCountsum = 0;
            LoadCountany = 0;


            if (buttbatchdownload.Text == "批量下载")
            {



                if (FtpPortEnable == false || FtpStatusEnable == false)
                {
                    MessageBox.Show("请先③启动FTP服务器,进行后续操作！");
                    return;
                }
                string shengjiip = "";

                for (int i = 0; i < DGVSTATUS.Rows.Count; i++)
                {
                    if ((bool)DGVSTATUS.Rows[i].Cells["执行"].EditedFormattedValue == true)
                    {
                        int c = 1;
                        LoadCountsum = LoadCountsum + c;
                        string asd = DGVSTATUS.Rows[i].Cells["ip地址"].Value.ToString();
                        shengjiip = shengjiip + asd + "\r\n";     //设备IP地址
                    }


                }
                DialogResult dr = MessageBox.Show("是否确认 升级如下设备？\r\n" + shengjiip + "\r\n一共：" + LoadCountsum.ToString() + "台设备", "提示", MessageBoxButtons.YesNo);
                if (dr == DialogResult.Yes)
                {
                    DialogResult dr1 = MessageBox.Show("是否确认保存数据config/slot/db？", "提示", MessageBoxButtons.YesNo);
                    if (dr1 == DialogResult.Yes)
                    {
                        save = true;
                    }
                    if (dr1 == DialogResult.No)
                    {
                        save = false;
                    }
                    // DGVSTATUS.DataSource = null;
                    //DGVSTATUS.Rows.Clear();
                    ftpCtrlFlagID = "2";
                    int i = DGVSTATUS.ColumnCount;
                    //MessageBox.Show(i.ToString());
                    for (int a = 9; a < i; a++)
                    {
                        // MessageBox.Show(a.ToString());
                        DGVSTATUS.Columns.RemoveAt(9);


                    }
                    DGVSTATUS.Refresh();
                    // DGVSTATUS.Columns.Clear();
                    //DataGridViewCreeatGuding();
                    datagridviewcreat();
                    string task = "BatchDownload";
                    ParameterizedThreadStart p = new ParameterizedThreadStart(Xianchengchi);
                    Thread t = new Thread(p);
                    t.Start(task);

                    buttbatchdownload.Text = "批量重启";
                }
                if (dr == DialogResult.No)
                {
                    buttbatchdownload.Text = "批量重启";
                }


            }
            else
            {
                string chognqiip = "";

                for (int i = 0; i < DGVSTATUS.Rows.Count; i++)
                {
                    if ((bool)DGVSTATUS.Rows[i].Cells["重启"].EditedFormattedValue == true)
                    {
                        string asd = DGVSTATUS.Rows[i].Cells["ip地址"].Value.ToString();
                        chognqiip = chognqiip + asd + "\r\n";     //设备IP地址
                    }


                }
                DialogResult dr = MessageBox.Show("是否重启 勾选的设备？\r\n" + chognqiip, "提示", MessageBoxButtons.YesNo);
                if (dr == DialogResult.Yes)
                {
                    int a = 0;
                    for (int i = 0; i < DGVSTATUS.Rows.Count; i++)
                    {
                        a = int.Parse(DGVSTATUS.Rows[i].Cells["优先级"].Value.ToString());
                        DGVSTATUS.Rows[i].Cells["优先级"].Value = a;

                    }
                    DGVSTATUS.Sort(DGVSTATUS.Columns["优先级"], ListSortDirection.Ascending);
                    //对重启优先级进行排序
                    if (DGVSTATUS.Columns["重启设备"] == null)
                    {

                        this.DGVSTATUS.Columns.Add("重启设备", "重启设备");
                    }
                    else
                    {
                        this.DGVSTATUS.Columns.Remove("重启设备");
                        this.DGVSTATUS.Columns.Add("重启设备", "重启设备");
                    }
                    string task = "reboot";
                    ParameterizedThreadStart p = new ParameterizedThreadStart(Xianchengchi);
                    Thread t = new Thread(p);
                    t.Start(task);
                    buttbatchdownload.Text = "批量下载";
                }
                if (dr == DialogResult.No)
                {
                    buttbatchdownload.Text = "批量下载";
                }
            }


        }
        private void Xianchengchi(object obj)
        {
            //int i = 1;
            ThreadPool.SetMinThreads(5, 5);
            ThreadPool.SetMaxThreads(50, 50);
            for (int i = 0; i < DGVSTATUS.Rows.Count; i++)
            {
                if (obj.ToString() == "BatchDownload" && (bool)DGVSTATUS.Rows[i].Cells["执行"].EditedFormattedValue == true)
                {
                    ThreadPool.QueueUserWorkItem(new WaitCallback(MibFtpTransentFile), i.ToString());
                }
                if (obj.ToString() == "reboot" && (bool)DGVSTATUS.Rows[i].Cells["重启"].EditedFormattedValue == true)
                {
                    ThreadPool.QueueUserWorkItem(new WaitCallback(MibReboot), i.ToString());
                }
                if (obj.ToString() == "checkfile" && (bool)DGVSTATUS.Rows[i].Cells["执行"].EditedFormattedValue == true)
                {
                    ThreadPool.QueueUserWorkItem(new WaitCallback(Checkfile), i.ToString());
                }
            }
        }
        private void MibReboot(object obj)
        {
            int i = int.Parse(obj.ToString());
            string gpnip = DGVSTATUS.Rows[i].Cells["ip地址"].Value.ToString();
            string Rebootoid = "1.3.6.1.4.1.10072.6.2.1.1.1.14.1";
            string readcommunity = textReadCommunity.Text;      //读团体
            string writecommunity = textWriteCommunity.Text;    //写团体
            int pingcunt = 5;
            Ping ping = new Ping();
            PingReply pingReply = ping.Send(gpnip, 120);
            bool link = false;
            //判断请求是否超时
            for (int but = 0; but < pingcunt; but++)
            {

                pingReply = ping.Send(gpnip, 120);
                if (pingReply.Status == IPStatus.Success)
                {
                    link = true;
                    DGVSTATUS.Rows[i].Cells["ping"].Value = "OK";
                    DGVSTATUS.Rows[i].Cells["ping"].Style.BackColor = Color.GreenYellow;

                    break;
                }
                Thread.Sleep(XHTime / 3);
            }
            if (link == false)
            {
                DGVSTATUS.Rows[i].Cells["ping"].Value = "NOK";
                
                DGVSTATUS.Rows[i].Cells["ping"].Style.BackColor = Color.Yellow;
                return;
            }

            // Prepare target
            UdpTarget target = new UdpTarget((IPAddress)new IpAddress(gpnip), 161, 2000, 2);
            // Create a SET PDU
            Pdu pdu = new Pdu(PduType.Set);
            // Set sysLocation.0 to a new string
            pdu.VbList.Add(new Oid(Rebootoid), new Integer32(2));
            AgentParameters aparam = new AgentParameters(SnmpVersion.Ver2, new OctetString(writecommunity), true);
            SnmpV2Packet response = null;

            try
            {
                // Send request and wait for response
                response = target.Request(pdu, aparam) as SnmpV2Packet;
            }
            catch
            {
                DGVSTATUS.Rows[i].Cells["重启设备"].Value = "OK";
                DGVSTATUS.Rows[i].Cells["重启设备"].Style.BackColor = Color.GreenYellow;
            }
            DGVSTATUS.Rows[i].Cells["重启设备"].Value = "OK";
            DGVSTATUS.Rows[i].Cells["重启设备"].Style.BackColor = Color.GreenYellow;



        }
        private void MibFtpTransentFile(object obj)
        {

            MySocket mysocketftp = new MySocket();

            int i = int.Parse(obj.ToString());
            string ftpServerIP = comftpip.Text;     //FTP服务器IP
            string ftpUserName = textftpusr.Text;   //FTP用户名
            string ftpPassWord = textftppsd.Text;   //FTP密码
            string ftpFileName = comcode.Text;                //FTP服务器文件名称
           // string ftpLoadStatus = "";              //执行操作状态
            string ftpLoadFile = "";                //文件类型
            string ftpDeviceFileName = "";          //自定义文件名称
            string gpnip = DGVSTATUS.Rows[i].Cells["ip地址"].Value.ToString();       //设备IP地址
            string readcommunity = textReadCommunity.Text;      //读团体
            string writecommunity = textWriteCommunity.Text;    //写团体
            int pingcunt = 10;
           // string dcnautooid = "1.3.6.1.4.1.10072.6.2.6.8.0";
            string saveoid = "1.3.6.1.4.1.10072.6.62.1.1.3.0";
            //string snmpip = "1.3.6.1.4.1.10072.6.2.6.8.0";
            string ftpipoid = "1.3.6.1.4.1.10072.2.12.2.1.0";
            string ftpiusernameoid = "1.3.6.1.4.1.10072.2.12.2.2.0";
            string ftppassdwordoid = "1.3.6.1.4.1.10072.2.12.2.3.0";
            string ftpfilenameoid = "1.3.6.1.4.1.10072.2.12.2.5.0";
            string ftpctrlflagoid = "1.3.6.1.4.1.10072.2.12.2.6.0";
            string ftploadstatusoid = "1.3.6.1.4.1.10072.2.12.2.7.0";
            string ftploadfileoid = "1.3.6.1.4.1.10072.2.12.2.11.0";
            string ftpdevicefilenameoid = "1.3.6.1.4.1.10072.2.12.2.12.0";
            string appversionoid = "1.3.6.1.4.1.10072.6.2.1.1.1.8.1";
            string fpgaoid = "1.3.6.1.4.1.10072.6.2.1.1.1.7.1";
            // pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.6.1.11");   //11槽位主备状态
            //  pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.6.1.12");   //12槽位主备状态
            //  pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.6.1.17");   //17槽位主备状态
            //  pdu.VbList.Add("1.3.6.1.4.1.10072.6.2.2.1.1.6.1.18");   //18槽位主备状态
            string slot11oid = "1.3.6.1.4.1.10072.6.2.2.1.1.8.1.11";
            string slot11type = "1.3.6.1.4.1.10072.6.2.2.1.1.4.1.11";
            string slot12type = "1.3.6.1.4.1.10072.6.2.2.1.1.4.1.12";
            string slot17type = "1.3.6.1.4.1.10072.6.2.2.1.1.4.1.17";
            string slot18type = "1.3.6.1.4.1.10072.6.2.2.1.1.4.1.18";
            string slot12oid = "1.3.6.1.4.1.10072.6.2.2.1.1.8.1.12";
            string slot17oid = "1.3.6.1.4.1.10072.6.2.2.1.1.8.1.17";
            string slot18oid = "1.3.6.1.4.1.10072.6.2.2.1.1.8.1.18";
            string devtype = "1.3.6.1.4.1.10072.6.2.1.1.1.2.1"; //设备型号
            string RuningUxcSwStr = "";
            string RuningNmsStr = "";
            string UxcSwNmsTypeStr = "";
            int RuningUxcSwStrCount = 0;
            int RuningNmsStrCount = 0;
            int UxcTypeStrCount = 0;
            int SwTypeStrCount = 0;
            int NmsTypeStrCount = 0;
            
            Ping ping = new Ping();
            PingReply pingReply = ping.Send(gpnip, 2000);
            bool link = false;
            //判断请求是否超时
            for (int but = 0; but < pingcunt; but++)
            {

                pingReply = ping.Send(gpnip, 2000);
                if (pingReply.Status == IPStatus.Success)
                {
                    link = true;
                    DGVSTATUS.Rows[i].Cells["ping"].Value = "OK";
                    DGVSTATUS.Rows[i].Cells["ping"].Style.BackColor = Color.GreenYellow;

                    break;
                }
                Thread.Sleep(XHTime / 3);
            }
            if (link == false)
            {
                DGVSTATUS.Rows[i].Cells["ping"].Value = "NOK";
                
                DGVSTATUS.Rows[i].Cells["ping"].Style.BackColor = Color.Yellow;
                lock (PiLiangShengJi)
                {
                    LoadCountany++;
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 累计完成设备数量：" + LoadCountany.ToString() + "\r\n");

                }
                return;
            }

            Pdu pdu = new Pdu(PduType.Set);
            AgentParameters aparam = new AgentParameters(SnmpVersion.Ver2, new OctetString(writecommunity), true);
            SnmpV2Packet response = null;
            UdpTarget target = new UdpTarget((IPAddress)new IpAddress(gpnip), 161, 10000, 1);

            if (save == true)
            {
                // Prepare target                // Create a SET PDU

                // Set sysLocation.0 to a new string
                pdu.VbList.Add(new Oid(saveoid), new Integer32(2));


                try
                {
                    // Send request and wait for response
                    response = target.Request(pdu, aparam) as SnmpV2Packet;
                }
                catch
                {
                    // If exception happens, it will be returned here
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " save " + "请求后未收到回复" + "\r\n");
                    lock (PiLiangShengJi)
                    {
                        LoadCountany++;
                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 累计完成设备数量：" + LoadCountany.ToString() + "\r\n");

                    }
                    DGVSTATUS.Rows[i].Cells["保存"].Value = "请求超时";
                    DGVSTATUS.Rows[i].Cells["保存"].Style.BackColor = Color.Yellow;
                    
                    return;

                }
                // Make sure we received a response
                if (response == null)
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " save " + "发送错误的SNMP请求" + "\r\n");
                    lock (PiLiangShengJi)
                    {
                        LoadCountany++;
                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 累计完成设备数量：" + LoadCountany.ToString() + "\r\n");

                    }
                    DGVSTATUS.Rows[i].Cells["保存"].Value = "返回null";
                    DGVSTATUS.Rows[i].Cells["保存"].Style.BackColor = Color.Yellow;
                    
                    return;

                }
                else
                {
                    // Check if we received an SNMP error from the agent
                    if (response.Pdu.ErrorStatus != 0)
                    {
                        textDOS.AppendText(String.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " save " + "SNMP回复错误！错误码 {0} 错误索引：第 {1} 行\r\n",
                        FindDevType.FindErrorCode(response.Pdu.ErrorStatus), response.Pdu.ErrorIndex));

                        lock (PiLiangShengJi)
                        {
                            LoadCountany++;
                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 累计完成设备数量：" + LoadCountany.ToString() + "\r\n");

                        }
                        DGVSTATUS.Rows[i].Cells["保存"].Value = FindDevType.FindErrorCode(response.Pdu.ErrorStatus);
                        DGVSTATUS.Rows[i].Cells["保存"].Style.BackColor = Color.Yellow;
                        
                        return;
                    }
                    else
                    {
                        for (int a = 0; a <= XHCount; a++)
                        {
                            pdu.Reset();
                            pdu = new Pdu(PduType.Get);
                            pdu.VbList.Add(saveoid);
                            pdu.VbList.Add(appversionoid);
                            pdu.VbList.Add(fpgaoid);
                            pdu.VbList.Add(slot11oid);
                            pdu.VbList.Add(slot12oid);
                            pdu.VbList.Add(slot17oid);
                            pdu.VbList.Add(slot18oid);
                            pdu.VbList.Add(slot11type);
                            pdu.VbList.Add(slot12type);
                            pdu.VbList.Add(slot17type);
                            pdu.VbList.Add(slot18type);
                            pdu.VbList.Add(devtype);
                            aparam = new AgentParameters(SnmpVersion.Ver2, new OctetString(readcommunity), true);
                            SnmpPacket result = null;
                            try
                            {
                                result = target.Request(pdu, aparam);
                            }
                            catch (SnmpException ex)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " save " + ex.Message + "\r\n");
                                DGVSTATUS.Rows[i].Cells["保存"].Value = "请求超时";
                                DGVSTATUS.Rows[i].Cells["保存"].Style.BackColor = Color.Yellow;
                                
                                break;

                            }
                            if (result != null)
                            {
                                if (result.Pdu.ErrorStatus != 0)
                                {
                                    textDOS.AppendText(String.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " save " + "SNMP回复错误！错误代码：{0} 错误索引：第 {1} 行\r\n", FindDevType.FindErrorCode(result.Pdu.ErrorStatus), result.Pdu.ErrorIndex));
                                    DGVSTATUS.Rows[i].Cells["保存"].Value = FindDevType.FindErrorCode(result.Pdu.ErrorStatus);
                                    DGVSTATUS.Rows[i].Cells["保存"].Style.BackColor = Color.Yellow;
                                    
                                    break;
                                }
                                else
                                {
                                    if (result.Pdu.VbList[0].Value.ToString() == "1")
                                    {

                                        DGVSTATUS.Rows[i].Cells["保存"].Value = "成功";
                                        DGVSTATUS.Rows[i].Cells["保存"].Style.BackColor = Color.GreenYellow;
                                        DGVSTATUS.Rows[i].Cells["当前版本"].Value = "" + result.Pdu.VbList[1].Value.ToString() + "/" + result.Pdu.VbList[2].Value.ToString();
                                        DGVSTATUS.Rows[i].Cells["设备类型"].Value = FindDevType.Finddevtype(result.Pdu.VbList[11].Value.ToString());
                                        RuningUxcSwStr = result.Pdu.VbList[3].Value.ToString() + "/" + result.Pdu.VbList[4].Value.ToString();
                                        RuningNmsStr = result.Pdu.VbList[5].Value.ToString() + "/" + result.Pdu.VbList[6].Value.ToString();
                                        UxcSwNmsTypeStr = result.Pdu.VbList[7].Value.ToString() + "/" + result.Pdu.VbList[8].Value.ToString() + "/" + result.Pdu.VbList[9].Value.ToString() + "/" + result.Pdu.VbList[10].Value.ToString();
                                        textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 板卡运行状态11/12槽位 4-running 1-null ：" + RuningUxcSwStr + "\r\n"));
                                        textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 板卡运行状态17/18槽位 4-running 1-null ：" + RuningNmsStr + "\r\n"));
                                        textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 板卡运行型号11/12/17/18槽位 257-uxc 1-null 168-nms ：" + UxcSwNmsTypeStr + "\r\n"));
                                        RuningUxcSwStrCount = RuningUxcSwStr.Split(new char[] { '4' }).Length - 1;
                                        RuningNmsStrCount = RuningNmsStr.Split(new char[] { '4' }).Length - 1;
                                        UxcTypeStrCount = UxcSwNmsTypeStr.Split(new string[] { "257" }, StringSplitOptions.None).Length - 1;
                                        SwTypeStrCount = UxcSwNmsTypeStr.Split(new string[] { "47" }, StringSplitOptions.None).Length - 1;
                                        SwTypeStrCount = UxcSwNmsTypeStr.Split(new string[] { "93" }, StringSplitOptions.None).Length - 1;
                                        SwTypeStrCount = UxcSwNmsTypeStr.Split(new string[] { "196" }, StringSplitOptions.None).Length - 1;
                                        SwTypeStrCount = UxcSwNmsTypeStr.Split(new string[] { "207" }, StringSplitOptions.None).Length - 1;
                                        NmsTypeStrCount = UxcSwNmsTypeStr.Split(new string[] { "168" }, StringSplitOptions.None).Length - 1;
                                        Thread.Sleep(3 * XHTime);

                                        break;
                                    }
                                    if (result.Pdu.VbList[0].Value.ToString() == "3")
                                    {
                                        DGVSTATUS.Rows[i].Cells["保存"].Value = "清空";
                                    }
                                    if (result.Pdu.VbList[0].Value.ToString() == "4")
                                    {
                                        DGVSTATUS.Rows[i].Cells["保存"].Value = "执行中";
                                    }
                                    if (result.Pdu.VbList[0].Value.ToString() == "5")
                                    {
                                        DGVSTATUS.Rows[i].Cells["保存"].Value = "禁止";
                                        DGVSTATUS.Rows[i].Cells["保存"].Style.BackColor = Color.Yellow;
                                    }
                                    if (result.Pdu.VbList[0].Value.ToString() == "6")
                                    {
                                        DGVSTATUS.Rows[i].Cells["保存"].Value = "失败";
                                        DGVSTATUS.Rows[i].Cells["保存"].Style.BackColor = Color.Yellow;

                                    }

                                }
                            }
                            Thread.Sleep(3 * XHTime);
                        }
                    }
                }
            }
            if (save == false)
            {
                DGVSTATUS.Rows[i].Cells["保存"].Value = "不执行";
                DGVSTATUS.Rows[i].Cells["保存"].Style.BackColor = Color.GreenYellow;
                // Prepare target
                // Create a SET PDU


                pdu.Reset();
                pdu = new Pdu(PduType.Get);
                pdu.VbList.Add(saveoid);
                pdu.VbList.Add(appversionoid);
                pdu.VbList.Add(fpgaoid);
                pdu.VbList.Add(slot11oid);
                pdu.VbList.Add(slot12oid);
                pdu.VbList.Add(slot17oid);
                pdu.VbList.Add(slot18oid);
                pdu.VbList.Add(slot11type);
                pdu.VbList.Add(slot12type);
                pdu.VbList.Add(slot17type);
                pdu.VbList.Add(slot18type);
                pdu.VbList.Add(devtype);
                aparam = new AgentParameters(SnmpVersion.Ver2, new OctetString(readcommunity), true);
                SnmpPacket result = null;
                try
                {
                    result = target.Request(pdu, aparam);
                }
                catch (SnmpException ex)
                {
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " save " + ex.Message + "\r\n");
                    DGVSTATUS.Rows[i].Cells["当前版本"].Value = "请求超时";
                    DGVSTATUS.Rows[i].Cells["当前版本"].Style.BackColor = Color.Yellow;
                    

                }
                if (result != null)
                {
                    if (result.Pdu.ErrorStatus != 0)
                    {
                        textDOS.AppendText(String.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " save " + "SNMP回复错误！错误代码：{0} 错误索引：第 {1} 行\r\n", FindDevType.FindErrorCode(result.Pdu.ErrorStatus), result.Pdu.ErrorIndex));
                        DGVSTATUS.Rows[i].Cells["当前版本"].Value = FindDevType.FindErrorCode(result.Pdu.ErrorStatus);
                        DGVSTATUS.Rows[i].Cells["当前版本"].Style.BackColor = Color.Yellow;
                        
                    }
                    else
                    {



                        DGVSTATUS.Rows[i].Cells["当前版本"].Value = "" + result.Pdu.VbList[1].Value.ToString() + "/" + result.Pdu.VbList[2].Value.ToString();
                        RuningUxcSwStr = result.Pdu.VbList[3].Value.ToString() + "/" + result.Pdu.VbList[4].Value.ToString();
                        RuningNmsStr = result.Pdu.VbList[5].Value.ToString() + "/" + result.Pdu.VbList[6].Value.ToString();
                        DGVSTATUS.Rows[i].Cells["设备类型"].Value = FindDevType.Finddevtype(result.Pdu.VbList[11].Value.ToString());
                        UxcSwNmsTypeStr = result.Pdu.VbList[7].Value.ToString() + "/" + result.Pdu.VbList[8].Value.ToString() + "/" + result.Pdu.VbList[9].Value.ToString() + "/" + result.Pdu.VbList[10].Value.ToString();
                        textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 板卡运行状态11/12槽位 4-running 1-null ：" + RuningUxcSwStr + "\r\n"));
                        textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 板卡运行状态17/18槽位 4-running 1-null ：" + RuningNmsStr + "\r\n"));
                        textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 板卡运行型号11/12/17/18槽位 257-uxc 1-null 168-nms ：" + UxcSwNmsTypeStr + "\r\n"));
                        RuningUxcSwStrCount = RuningUxcSwStr.Split(new char[] { '4' }).Length - 1;
                        RuningNmsStrCount = RuningNmsStr.Split(new char[] { '4' }).Length - 1;
                        UxcTypeStrCount = UxcSwNmsTypeStr.Split(new string[] { "257" }, StringSplitOptions.None).Length - 1;
                        SwTypeStrCount = UxcSwNmsTypeStr.Split(new string[] { "47" }, StringSplitOptions.None).Length - 1;
                        SwTypeStrCount = UxcSwNmsTypeStr.Split(new string[] { "93" }, StringSplitOptions.None).Length - 1;
                        SwTypeStrCount = UxcSwNmsTypeStr.Split(new string[] { "196" }, StringSplitOptions.None).Length - 1;
                        SwTypeStrCount = UxcSwNmsTypeStr.Split(new string[] { "207" }, StringSplitOptions.None).Length - 1;
                        NmsTypeStrCount = UxcSwNmsTypeStr.Split(new string[] { "168" }, StringSplitOptions.None).Length - 1;
                        Thread.Sleep(3 * XHTime);

                    }
                }


            }




            int colunms = DGVSTATUS.ColumnCount;
            string[,] array = new string[,] {
                { "APP",        "2",comapp.Text,        ""                              },
                { "CODE",       "7",comcode.Text,       ""                              },
                { "CODE2",      "14",comcode2.Text,     "/flash/sys/fpga_code2.bin"     },
                { "CODE3",      "14",comcode3.Text,     "/flash/sys/fpga_code3.bin"     },
                { "CODE4",      "14",comcode4.Text,     "/flash/sys/fpga_code4.bin"     },
                { "SDN",        "21",comsdn.Text,       ""                              },
                { "NMS",        "6",comnms.Text,        ""                              },
                { "SW",         "5",comsw.Text,         ""                              },
                { "Config" ,    "11",comconfig.Text,    ""                              },
                { "Db",         "12",comdb.Text,        ""                              },
                { "SlotConfig", "18",comslotconfig.Text,""                              },
                { "FLASH",      "15",comflash.Text,     ""                              },
                { "SysFile",    "13",comsysfile.Text,   ""                              },
              //{ "OTNPACK",    "20",com760f.Text,      ""                              },
                { "YAFFS",      "",comyaffs.Text,       ""                              },
                { "760S",       "14",com760s.Text,      "/yaffs/sys/760s.fpga"          },
                { "760B",       "14",com760b.Text,      "/yaffs/sys/760b.fpga"          },
                { "760C",       "14",com760c.Text,      "/yaffs/sys/760c.fpga"          },
                { "760D",       "14",com760d.Text,      "/yaffs/sys/760d.fpga"          },
                { "760E",       "14",com760e.Text,      "/yaffs/sys/760e.fpga"          },
                { "UXC",        "14",comuxc.Text,       "/yaffs/sys/uxc_a.fpga"         },
                { "7610",       "14",com7610.Text,      "/yaffs/sys/7610.fpga"          },
                { "7611",       "14",com7611.Text,      "/yaffs/sys/7611.fpga"          },
                { "7612",       "14",com7612.Text,      "/yaffs/sys/7612.fpga"          },
                { "7613",       "14",com7613.Text,      "/yaffs/sys/7613.fpga"          },
                { "7614",       "14",com7614.Text,      "/yaffs/sys/7614.fpga"          },
                { "7615",       "14",com7615.Text,      "/yaffs/sys/7615.fpga"          },
                { "7616",       "14",com7616.Text,      "/yaffs/sys/7616.fpga"          },
                { "APP2",       "14",comapp2.Text,      "/flash/sys/app_code_backup2.bin"},
                { "VOSS",       "14",comvoss.Text,      "/flash/sys/voss.sh"            },
                { "REBOOTOS",   "14",comrebootos.Text,  "/flash/sys/rebootos.sh"        },
                { "CPLD",       "14",comcpld.Text,      "/flash/sys/nms.cpld"           },
            };
            int row = array.GetLength(0);
            for (int c = 8; c < colunms; c++)
            {
                string header = DGVSTATUS.Columns[c].HeaderText;

                for (int d = 0; d < row; d++)
                {

                    if (array[d, 0].ToString() == header)
                    {

                        if (ftpCtrlFlagID == "2")
                        {

                            ftpFileName = array[d, 2].ToString();
                            textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 开始下载 文件类型：{0} 文件加载码：{1} 文件名称：{2} 下载路径：{3}\r\n", array[d, 0].ToString(), array[d, 1].ToString(), array[d, 2].ToString(), array[d, 3].ToString()));


                        }
                        else
                        {

                            ftpFileName = gpnip + "_" + DateTime.Now.ToString("yyyy-MM-dd") + "_" + header + ".bin";
                            textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 开始上传 文件类型：{0} 文件加载码：{1} 文件名称：{2} 上传路径：{3}\r\n", array[d, 0].ToString(), array[d, 1].ToString(), ftpFileName, array[d, 3].ToString()));

                        }

                        ftpLoadFile = array[d, 1].ToString();
                        ftpDeviceFileName = array[d, 3].ToString();




                        pdu.Reset();
                        pdu = new Pdu(PduType.Set);
                        pdu.VbList.Add(new Oid(ftpipoid), new IpAddress(ftpServerIP));
                        pdu.VbList.Add(new Oid(ftpiusernameoid), new OctetString(ftpUserName));
                        pdu.VbList.Add(new Oid(ftppassdwordoid), new OctetString(ftpPassWord));
                        pdu.VbList.Add(new Oid(ftpfilenameoid), new OctetString(ftpFileName));
                        pdu.VbList.Add(new Oid(ftploadfileoid), new Integer32(ftpLoadFile));
                        pdu.VbList.Add(new Oid(ftpdevicefilenameoid), new OctetString(ftpDeviceFileName));
                        aparam = new AgentParameters(SnmpVersion.Ver2, new OctetString(writecommunity), true);
                        response = null;

                        try
                        {
                            // Send request and wait for response
                            response = target.Request(pdu, aparam) as SnmpV2Packet;
                        }

                        catch
                        {
                            // If exception happens, it will be returned here
                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " " + header + " 请求后未收到回复" + "\r\n");
                            DGVSTATUS.Rows[i].Cells[header].Value = "请求超时";
                            DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.Yellow;
                            
                            break;
                        }

                        // Make sure we received a response
                        if (response == null)
                        {
                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " " + header + " 发送错误的SNMP请求" + "\r\n");
                            DGVSTATUS.Rows[i].Cells[header].Value = "返回null";
                            DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.Yellow;
                            
                            break;
                        }
                        else
                        {
                            // Check if we received an SNMP error from the agent
                            if (response.Pdu.ErrorStatus != 0)
                            {
                                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " " + header + String.Format(" SNMP回复错误！错误代码{0} 错误索引：第{1}行\r\n", FindDevType.FindErrorCode(response.Pdu.ErrorStatus), response.Pdu.ErrorIndex));
                                DGVSTATUS.Rows[i].Cells[header].Value = FindDevType.FindErrorCode(response.Pdu.ErrorStatus);
                                DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.Yellow;
                                
                                break;
                            }
                            else
                            {
                                Thread.Sleep(2 * XHTime);
                                pdu.Reset();
                                pdu.VbList.Add(new Oid(ftpctrlflagoid), new Integer32(ftpCtrlFlagID));
                                aparam = new AgentParameters(SnmpVersion.Ver2, new OctetString(writecommunity), true);
                                try
                                {
                                    response = target.Request(pdu, aparam) as SnmpV2Packet;
                                }

                                catch
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " " + header + " 请求后未收到回复" + "\r\n");
                                    DGVSTATUS.Rows[i].Cells[header].Value = "请求超时";
                                    DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.Yellow;
                                    
                                    break;
                                }
                                if (response == null)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " " + header + " 发送错误的SNMP请求" + "\r\n");
                                    DGVSTATUS.Rows[i].Cells[header].Value = "返回null";
                                    DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.Yellow;
                                    
                                    break;

                                }
                                else
                                {
                                    // Check if we received an SNMP error from the agent
                                    if (response.Pdu.ErrorStatus != 0)
                                    {
                                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " " + header + String.Format(" SNMP回复错误！错误码 {0} 错误索引：第 {1} 行\r\n", FindDevType.FindErrorCode(response.Pdu.ErrorStatus), response.Pdu.ErrorIndex));
                                        DGVSTATUS.Rows[i].Cells[header].Value = FindDevType.FindErrorCode(response.Pdu.ErrorStatus);
                                        DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.Yellow;
                                        
                                        break;
                                    }
                                    else
                                    {
                                        if (ftpCtrlFlagID == "2")
                                        {
                                            DGVSTATUS.Rows[i].Cells["操作"].Value = "下载";
                                        }
                                        if (ftpCtrlFlagID == "3")
                                        {
                                            DGVSTATUS.Rows[i].Cells["操作"].Value = "上载";
                                        }
                                        if (ftpCtrlFlagID == "1")
                                        {
                                            DGVSTATUS.Rows[i].Cells["操作"].Value = "未操作";
                                        }
                                    }
                                }

                            }
                        }
                        Thread.Sleep(3 * XHTime);
                        int ex = 0;
                        int DownUpCount = 0;
                        for (int a = 0; a <= XHCount; a++)
                        {

                            pdu.Reset();
                            pdu = new Pdu(PduType.Get);
                            pdu.VbList.Add(ftploadstatusoid);
                            aparam = new AgentParameters(SnmpVersion.Ver2, new OctetString(readcommunity), true);
                            SnmpPacket result = null;
                            //try
                            //{
                            //    result = target.Request(pdu, aparam);
                            //}
                            //catch
                            //{
                            //    ex++;
                            //    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " " + header + " 请求后未收到回复第"+ ex + "次"+ "\r\n");
                            //    DGVSTATUS.Rows[i].Cells[header].Value = "请求超时"+ex+"次";

                            //    if (ex == 30) {
                            //        DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.Yellow;
                            //        break;
                            //    }
                            //}


                            for (int t = 0; t <= 30; t++)
                            {
                                try
                                {
                                    result = target.Request(pdu, aparam);
                                    if (result != null)
                                    {
                                        break;
                                    }

                                }
                                catch
                                {
                                    ex++;
                                    DGVSTATUS.Rows[i].Cells[header].Value = "请求超时" + ex + "次";
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " " + header + " 请求后未收到回复第" + ex + "次" + "\r\n");
                                    Thread.Sleep(5 * XHTime);
                                }


                            }
                            if (ex == 40)
                            {
                                break;
                            }
                            if (result != null)
                            {
                                if (result.Pdu.ErrorStatus != 0)
                                {
                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " " + header + String.Format(" SNMP回复错误！错误码 {0} 错误索引：第 {1} 行\r\n", FindDevType.FindErrorCode(result.Pdu.ErrorStatus), result.Pdu.ErrorIndex));
                                    DGVSTATUS.Rows[i].Cells[header].Value = FindDevType.FindErrorCode(response.Pdu.ErrorStatus);
                                    DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.Yellow;
                                    

                                    break;
                                }
                                else
                                {
                                    if (result.Pdu.VbList[0].Value.ToString() == "1")
                                    {


                                        if (header.Contains("APP") && NmsTypeStrCount == 2 && ftpCtrlFlagID == "2" && SwTypeStrCount == 0)
                                        {
                                            DGVSTATUS.Rows[i].Cells[header].Value = "同步中240";

                                            if (DGVSTATUS.ColumnCount > 10)
                                            {
                                                textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 主要影响APP同步升级的板卡有：" + NmsTypeStrCount.ToString() + "块" +
"需要等待4分钟后继续执行其他操作\r\n"));
                                                Thread.Sleep(240 * XHTime);
                                            }
                                        }
                                        if (header.Contains("APP") && NmsTypeStrCount == 1 && ftpCtrlFlagID == "2" && SwTypeStrCount > 0)
                                        {
                                            DGVSTATUS.Rows[i].Cells[header].Value = "同步中240";

                                            if (DGVSTATUS.ColumnCount > 10)
                                            {
                                                textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 主要影响APP同步升级的板卡有：" + NmsTypeStrCount.ToString() + "块" +
"需要等待4分钟后继续执行其他操作\r\n"));
                                                Thread.Sleep(240 * XHTime);
                                            }
                                        }
                                        if (header.Contains("APP") && NmsTypeStrCount == 2 && ftpCtrlFlagID == "2" && SwTypeStrCount > 0)
                                        {
                                            DGVSTATUS.Rows[i].Cells[header].Value = "同步中480";

                                            if (DGVSTATUS.ColumnCount > 10)
                                            {
                                                textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 主要影响APP同步升级的板卡有：" + (NmsTypeStrCount+SwTypeStrCount).ToString() + "块" +
"需要等待8分钟后继续执行其他操作\r\n"));
                                                Thread.Sleep(480 * XHTime);
                                            }
                                        }
                                        if (header == "CODE" && NmsTypeStrCount == 2 && ftpCtrlFlagID == "2" )
                                        {
                                            DGVSTATUS.Rows[i].Cells[header].Value = "同步中60";
                                            if (DGVSTATUS.ColumnCount > 10)
                                            {
                                                textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 主要影响CODE同步升级的板卡有：" + NmsTypeStrCount.ToString() + "块" +
"需要等待1分钟后继续执行其他操作\r\n"));
                                                Thread.Sleep(60 * XHTime);
                                            }
                                        }
                                        if (header == "NMS" && NmsTypeStrCount == 2 && ftpCtrlFlagID == "2")
                                        {
                                            DGVSTATUS.Rows[i].Cells[header].Value = "同步中40";
                                            if (DGVSTATUS.ColumnCount > 10)
                                            {
                                                textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 主要影响NMS同步升级的板卡有：" + NmsTypeStrCount.ToString() + "块" +
"需要等待40秒后继续执行其他操作\r\n"));
                                                Thread.Sleep(40 * XHTime);
                                            }
                                        }
                                        if (header.Contains("760") && NmsTypeStrCount == 2 && ftpCtrlFlagID == "2")
                                        {
                                            DGVSTATUS.Rows[i].Cells[header].Value = "同步中20";
                                            if (DGVSTATUS.ColumnCount > 10)
                                            {
                                                textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 主要影响OTN同步升级的板卡有：" + NmsTypeStrCount.ToString() + "块" +
"需要等待20秒后继续执行其他操作\r\n"));
                                                Thread.Sleep(20 * XHTime);
                                            }
                                        }
                                        if (header.Contains("761") && NmsTypeStrCount == 2 && ftpCtrlFlagID == "2")
                                        {
                                            DGVSTATUS.Rows[i].Cells[header].Value = "同步中20";
                                            if (DGVSTATUS.ColumnCount > 10)
                                            {
                                                textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 主要影响OTN同步升级的板卡有：" + NmsTypeStrCount.ToString() + "块" +
"需要等待20秒后继续执行其他操作\r\n"));
                                                Thread.Sleep(20 * XHTime);
                                            }
                                        }
                                        if (header.Contains("UXC") && NmsTypeStrCount == 2 && ftpCtrlFlagID == "2")
                                        {
                                            DGVSTATUS.Rows[i].Cells[header].Value = "同步中20";
                                            if (DGVSTATUS.ColumnCount > 10)
                                            {
                                                textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 主要影响OTN同步升级的板卡有：" + NmsTypeStrCount.ToString() + "块" +
"需要等待20秒后继续执行其他操作\r\n"));
                                                Thread.Sleep(20 * XHTime);
                                            }
                                        }

                                        if (header == "SW" && NmsTypeStrCount == 2 && ftpCtrlFlagID == "2")
                                        {
                                            DGVSTATUS.Rows[i].Cells[header].Value = "同步中20";
                                            if (DGVSTATUS.ColumnCount > 10)
                                            {
                                                textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 主要影响SW同步升级的板卡有：" + NmsTypeStrCount.ToString() + "块" +
"需要等待20秒后继续执行其他操作\r\n"));
                                                Thread.Sleep(20 * XHTime);
                                            }
                                        }
                                        if (header == "SysFile" && NmsTypeStrCount == 2 && ftpCtrlFlagID == "2")
                                        {
                                            DGVSTATUS.Rows[i].Cells[header].Value = "同步中20";

                                            if (DGVSTATUS.ColumnCount > 10)
                                            {
                                                textDOS.AppendText(string.Format(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 主要影响Sysfile同步升级的板卡有：" + NmsTypeStrCount.ToString() + "块" +
"需要等待20秒后继续执行其他操作\r\n"));
                                                Thread.Sleep(20 * XHTime);
                                            }
                                        }

                                        DGVSTATUS.Rows[i].Cells[header].Value = "成功" + DownUpCount +"秒";
                                        DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.GreenYellow;
                                        
                                        break;
                                    }
                                    if (result.Pdu.VbList[0].Value.ToString() == "2")
                                    {
                                        DownUpCount = DownUpCount +3;
                                
                                        DGVSTATUS.Rows[i].Cells[header].Value = "下载中" + DownUpCount + "秒";
                                    }
                                    if (result.Pdu.VbList[0].Value.ToString() == "3")
                                    {
                                        DownUpCount = DownUpCount + 3;
                                        DGVSTATUS.Rows[i].Cells[header].Value = "上载中" + DownUpCount + "秒";
                                    }
                                    if (result.Pdu.VbList[0].Value.ToString() == "4")
                                    {
                                        DGVSTATUS.Rows[i].Cells[header].Value = "FTP服务器错误";
                                        DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.Yellow;
                                        break;
                                    }
                                    if (result.Pdu.VbList[0].Value.ToString() == "5")
                                    {
                                        DGVSTATUS.Rows[i].Cells[header].Value = "文件名错误";
                                        DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.Yellow;
                                        break;
                                    }

                                    if (result.Pdu.VbList[0].Value.ToString() == "6")
                                    {
                                        DGVSTATUS.Rows[i].Cells[header].Value = "其他错误";
                                        DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.Yellow;
                                        break;
                                    }

                                }
                            }
                            Thread.Sleep(3 * XHTime);
                        }

                    }

                }


                Thread.Sleep(3 * XHTime);

            }

            for (int C = 8; C < DGVSTATUS.ColumnCount; C++)
            {
                if (DGVSTATUS.Rows[i].Cells[C].Value.ToString().Contains("成功"))
                {
                    DGVSTATUS.Rows[i].Cells["ip地址"].Style.BackColor = Color.GreenYellow;
                    DGVSTATUS.Rows[i].Cells["操作"].Style.BackColor = Color.GreenYellow;

                    if (ftpCtrlFlagID == "2")
                    {
                        DGVSTATUS.Rows[i].Cells["重启"].Value = true;
                        DGVSTATUS.Rows[i].Cells["重启"].Style.BackColor = Color.GreenYellow;

                    }

                }
                else if (DGVSTATUS.Rows[i].Cells["操作"].Value != null)
                {
                    DGVSTATUS.Rows[i].Cells["ip地址"].Style.BackColor = Color.Yellow;
                    DGVSTATUS.Rows[i].Cells["操作"].Style.BackColor = Color.Yellow;
                    if (ftpCtrlFlagID == "2")
                    {
                        DGVSTATUS.Rows[i].Cells["重启"].Value = false;
                        DGVSTATUS.Rows[i].Cells["重启"].Style.BackColor = Color.Yellow;

                    }
                }
            }



            lock (PiLiangShengJi)
            {
                LoadCountany++;
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 累计完成设备数量：" + LoadCountany.ToString() + "\r\n");
                if (LoadCountsum == LoadCountany)
                {

                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "执行完成！一共执行：" + LoadCountany.ToString() + "台设备" + "\r\n");
                    MessageBox.Show("执行完成！一共执行：" + LoadCountany.ToString() + "台设备");
                    LoadCountsum = 0;
                    LoadCountany = 0;

                }
            }







        }

        private void buttAddIp_Click(object sender, EventArgs e)
        {
            int index = DGVSTATUS.Rows.Add();
            DGVSTATUS.Rows[index].Cells["ip地址"].Value = comip.Text;
            DGVSTATUS.Rows[index].Cells["优先级"].Value = 1;
            DGVSTATUS.RowsDefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
        }

        private void buttbatchupload_Click(object sender, EventArgs e)
        {
            if (FtpPortEnable == false || FtpStatusEnable == false)
            {
                MessageBox.Show("请先③启动FTP服务器,进行后续操作！");
                return;
            }

            LoadCountsum = 0;
            LoadCountany = 0;
            string shengjiip = "";

            for (int i = 0; i < DGVSTATUS.Rows.Count; i++)
            {
                if ((bool)DGVSTATUS.Rows[i].Cells["执行"].EditedFormattedValue == true)
                {
                    int c = 1;
                    LoadCountsum = LoadCountsum + c;
                    string asd = DGVSTATUS.Rows[i].Cells["ip地址"].Value.ToString();
                    shengjiip = shengjiip + asd + "\r\n";     //设备IP地址
                }


            }
            DialogResult dr = MessageBox.Show("是否确认 上载如下设备？\r\n" + shengjiip + "\r\n一共：" + LoadCountsum.ToString() + "台设备", "提示", MessageBoxButtons.YesNo);
            if (dr == DialogResult.Yes)
            {
                DialogResult dr1 = MessageBox.Show("是否确认保存数据config/slot/db？", "提示", MessageBoxButtons.YesNo);
                if (dr1 == DialogResult.Yes)
                {
                    save = true;
                }
                if (dr1 == DialogResult.No)
                {
                    save = false;
                }
                // DGVSTATUS.DataSource = null;
                //DGVSTATUS.Rows.Clear();
                ftpCtrlFlagID = "3";
                int i = DGVSTATUS.ColumnCount;
                //MessageBox.Show(i.ToString());
                for (int a = 9; a < i; a++)
                {
                    // MessageBox.Show(a.ToString());
                    DGVSTATUS.Columns.RemoveAt(9);


                }
                DGVSTATUS.Refresh();
                // DGVSTATUS.Columns.Clear();
                //DataGridViewCreeatGuding();
                datagridviewcreat();
                string task = "BatchDownload";
                ParameterizedThreadStart p = new ParameterizedThreadStart(Xianchengchi);
                Thread t = new Thread(p);
                t.Start(task);
            }
            if (dr == DialogResult.No)
            {
                //  buttbatchdownload.Text = "批量重启";
            }




        }


        private void del_Click(object sender, EventArgs e)
        {


            try
            {
                Gpnip user = new Gpnip();
                // 登录时 如果没有Data.bin文件就创建、有就打开
                FileStream fs = new FileStream(@"C:\gpn\gpnip.bin", FileMode.OpenOrCreate);
                BinaryFormatter bf = new BinaryFormatter();
                // 保存在实体类属性中
                string gpnip = DGVSTATUS.Rows[DGVSTATUS.CurrentCell.RowIndex].Cells["ip地址"].Value.ToString();       //设备IP地址
                user.GpnIP = gpnip;
                //保存密码选中状态

                if (MessageBox.Show("正在删除当前ip:" + gpnip + "，是否删除？", "提示", MessageBoxButtons.OKCancel) == DialogResult.OK)
                {
                    userss.Remove(user.GpnIP);
                    try
                    {
                        if (DGVSTATUS != null && DGVSTATUS.CurrentCell != null && DGVSTATUS.CurrentCell.RowIndex != -1)
                        {
                            DGVSTATUS.Rows.RemoveAt(DGVSTATUS.CurrentCell.RowIndex);
                        }
                    }
                    catch
                    {
                        MessageBox.Show("空白行无法删除");
                    }
                }
                //写入文件
                bf.Serialize(fs, userss);
                //关闭
                fs.Close();
            }
            catch
            {
                MessageBox.Show("空白行无法删除");
            }




        }

        private void add_Click(object sender, EventArgs e)
        {


            int index = DGVSTATUS.Rows.Add();
            DGVSTATUS.Rows[index].Cells["ip地址"].Value = comip.Text;
            DGVSTATUS.Rows[index].Cells["执行"].Value = true;
            DGVSTATUS.RowsDefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;

            int[] array = new int[DGVSTATUS.Rows.Count];
            int aa = 0;
            for (int i = 0; i < DGVSTATUS.Rows.Count - 1; i++, aa++)
            {
                array[i] = int.Parse(DGVSTATUS.Rows[aa].Cells[2].Value.ToString());

            }
            int temp = 0;
            int index1 = 0;

            for (int i = 0; i < array.Length; i++)
            {
                if (temp < array[i])    //如果用<= 则找bai到的是最大du值(多个中zhi的最后一个) <则是多个中的第一dao个
                {
                    temp = array[i];
                    index1 = i;
                }
            }
            DGVSTATUS.Rows[index].Cells["优先级"].Value = temp + 1;


            Gpnip user = new Gpnip();
            // 登录时 如果没有Data.bin文件就创建、有就打开
            FileStream fs = new FileStream(@"C:\gpn\gpnip.bin", FileMode.OpenOrCreate);
            BinaryFormatter bf = new BinaryFormatter();
            // 保存在实体类属性中
            user.GpnIP = comip.Text;
            user.GpnPRY = temp + 1;
            user.GpnZX = true;
            if (userss.ContainsKey(user.GpnIP))
            {
                //如果有清掉
                userss.Remove(user.GpnIP);
                // MessageBox.Show("ip已经存在，替换完成");
            }
            //添加用户信息到集合
            userss.Add(user.GpnIP, user);
            //写入文件
            bf.Serialize(fs, userss);

            fs.Close();





        }



        private void butbatchip_Click(object sender, EventArgs e)
        {



            int index = DGVSTATUS.Rows.Add();
            DGVSTATUS.Rows[index].Cells["ip地址"].Value = comip.Text;
            DGVSTATUS.Rows[index].Cells["执行"].Value = true;
            DGVSTATUS.RowsDefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;

            int[] array = new int[DGVSTATUS.Rows.Count];
            int aa = 0;
            for (int i = 0; i < DGVSTATUS.Rows.Count - 1; i++, aa++)
            {
                array[i] = int.Parse(DGVSTATUS.Rows[aa].Cells["优先级"].Value.ToString());

            }
            int temp = 0;
            int index1 = 0;

            for (int i = 0; i < array.Length; i++)
            {
                if (temp < array[i])    //如果用<= 则找bai到的是最大du值(多个中zhi的最后一个) <则是多个中的第一dao个
                {
                    temp = array[i];
                    index1 = i;
                }
            }
            DGVSTATUS.Rows[index].Cells["优先级"].Value = temp + 1;


            Gpnip user = new Gpnip();
            // 登录时 如果没有Data.bin文件就创建、有就打开
            FileStream fs = new FileStream(@"C:\gpn\gpnip.bin", FileMode.OpenOrCreate);
            BinaryFormatter bf = new BinaryFormatter();
            // 保存在实体类属性中
            user.GpnIP = comip.Text;
            user.GpnPRY = temp + 1;
            user.GpnZX = true;
            if (userss.ContainsKey(user.GpnIP))
            {
                //如果有清掉
                userss.Remove(user.GpnIP);
                // MessageBox.Show("ip已经存在，替换完成");
            }
            //添加用户信息到集合
            userss.Add(user.GpnIP, user);
            //写入文件
            bf.Serialize(fs, userss);

            fs.Close();
        }

        private void button1_Click(object sender, EventArgs e)
        {
            //  ToStringArray(DGVSTATUS, false);
            //  textDOS.AppendText(ToStringArray(DGVSTATUS, false) + "\r\n");
            object[,] abc = FindDevType.Orderby(ToStringArray(DGVSTATUS, false), new int[] { 2 }, 0);
            for (int i = 0; i < DGVSTATUS.Rows.Count; i++)
            {
                textDOS.AppendText(string.Format(abc[i, 2] + "\r\n"));
            }


        }
        public object[,] ToStringArray(DataGridView dataGridView, bool includeColumnText)
        {
            #region 实现...
            object[,] arrReturn = null;
            int rowsCount = dataGridView.Rows.Count;
            int colsCount = 3;
            if (rowsCount > 0)
            {
                //最后一行是供输入的行时，不用读数据。
                if (dataGridView.Rows[rowsCount - 1].IsNewRow)
                {
                    rowsCount--;
                }
            }
            int i = 0;
            //包括列标题
            if (includeColumnText)
            {
                rowsCount++;
                arrReturn = new object[rowsCount, colsCount];
                for (i = 0; i < colsCount; i++)
                {
                    arrReturn[0, i] = dataGridView.Columns[i].HeaderText;
                }
                i = 1;
            }
            else
            {
                arrReturn = new object[rowsCount, colsCount];
            }
            //读取单元格数据
            int rowIndex = 0;
            for (; i < rowsCount; i++, rowIndex++)
            {
                for (int j = 0; j < colsCount; j++)
                {
                    if (j == 2)
                    {
                        arrReturn[i, j] = int.Parse(dataGridView.Rows[rowIndex].Cells[j].Value.ToString());
                    }
                    else
                    {
                        arrReturn[i, j] = dataGridView.Rows[rowIndex].Cells[j].Value.ToString();
                    }

                    // textDOS.AppendText(string.Format(arrReturn[i, j] + "\r\n"));
                }
            }
            return arrReturn;
            #endregion 实现
        }

        private void DGVSTATUS_EditingControlShowing(object sender, DataGridViewEditingControlShowingEventArgs e)
        {

            if (this.DGVSTATUS.CurrentCell.ColumnIndex == 2)
            {
                e.Control.KeyPress += new KeyPressEventHandler(TextBoxDec_KeyPress);

            }
        }
        private void TextBoxDec_KeyPress(object sender, KeyPressEventArgs e)
        {
            if (e.KeyChar != 8 && !Char.IsDigit(e.KeyChar) && e.KeyChar != '.')
            {
                e.Handled = true;
            }
        }






        private void metroButStartVnc_Click(object sender, EventArgs e)
        {
            if (metroButStartVnc.Text == "开始桌面共享")
            {

                if (TextVNCUser.Text == "")
                {

                    MessageBox.Show("请填写英文用户名后再次尝试！");
                    return;
                }


                if (File.Exists(frpcPath))//读取时先要判读INI文件是否存在
                {
                    File.Delete(frpcPath);
                }

                Textsharp.AppendText("\r\n");

                Thread FrpcSave = new Thread(FrpcIni);
                FrpcSave.Start();
                Thread start = new Thread(StartVnc);
                start.Start();
                metroButStartVnc.Text = "停止桌面共享";
            }
            else
            {
                Textsharp.AppendText("\r\n");
                Thread stop = new Thread(StopVnc);
                stop.Start();
                metroButStartVnc.Text = "开始桌面共享";

            }



        }

        private void FrpcIni()
        {

            try
            {
                //根据INI文件名设置要写入INI文件的节点名称
                //此处的节点名称完全可以根据实际需要进行配置
                strSec = "common";
                WritePrivateProfileString(strSec, "server_addr", TextServerAddr.Text.Trim(), frpcPath);
                WritePrivateProfileString(strSec, "server_port", TextServerPort.Text.Trim(), frpcPath);
                WritePrivateProfileString(strSec, "token", TextToken.Text.Trim(), frpcPath);
                strSec = TextVNCUser.Text + "RDP";
                WritePrivateProfileString(strSec, "type", ComRDPType.Text.Trim(), frpcPath);
                WritePrivateProfileString(strSec, "local_ip", "127.0.0.1", frpcPath);
                WritePrivateProfileString(strSec, "local_port", TextRDPLocalPort.Text.Trim(), frpcPath);
                WritePrivateProfileString(strSec, "remote_port", TextRDPRemotePort.Text.Trim(), frpcPath);
                WritePrivateProfileString(strSec, "use_compression", "true", frpcPath);
                strSec = TextVNCUser.Text + "VNC";
                WritePrivateProfileString(strSec, "type", ComVNCType.Text.Trim(), frpcPath);
                WritePrivateProfileString(strSec, "local_ip", "127.0.0.1", frpcPath);
                WritePrivateProfileString(strSec, "local_port", TextVNCLocalPort.Text.Trim(), frpcPath);
                WritePrivateProfileString(strSec, "remote_port", TextVNCRemotePort.Text.Trim(), frpcPath);
                WritePrivateProfileString(strSec, "use_compression", "true", frpcPath);





            }
            catch (Exception ex)
            {
                MessageBox.Show(ex.Message);
            }
        }


        private void StopVnc()
        {
            string strZipPath = @"C:\gpn\" + "frpc_stop.bat";
            if (File.Exists(strZipPath))//读取时先要判读INI文件是否存在
            {
                System.Diagnostics.Process.Start(strZipPath);
                Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程共享模块停止成功============================================OK" + "\r\n");
                tabPageRemote.Text = "远程桌面共享：未启动";

                return;
            }
            FileStream stream;
            //string gpnname = comgpn76list.Text;
            string url = "http://dx.hunan128.com:92/ftp/vnc/frpc_stop.bat";
            //string strZipPath = @"C:\gpn\" + "frpc_start.exe";
            //   string strUnZipPath = @"C:\gpn\";
            int percent = 0;
            stream = new FileStream(strZipPath, FileMode.Create);
            // bool overWrite = true;
            try
            {
                Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程共享模块下载中==============================================OK" + "\r\n");
                HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);
                HttpWebResponse response = request.GetResponse() as HttpWebResponse;
                Stream responseStream = response.GetResponseStream();
                long totalDownloadedByte = 0;
                long totalBytes = response.ContentLength;
                byte[] bArr = new byte[1024];
                int size = responseStream.Read(bArr, 0, bArr.Length);
                while (size > 0)
                {
                    totalDownloadedByte = size + totalDownloadedByte;
                    stream.Write(bArr, 0, size);
                    size = responseStream.Read(bArr, 0, bArr.Length);
                    //p = (int)Math.Floor((double)100 / a);
                    percent = (int)Math.Floor((float)totalDownloadedByte / (float)totalBytes * 100);
                    // textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") +" "+percent.ToString() + "\r\n");
                    //labjindu.Text = percent.ToString() + "%";
                    myProgressBarjindu.Value = percent;
                    // System.Windows.Forms.Application.DoEvents();
                }
                stream.Close();
                responseStream.Close();
                Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程共享模块成功============================================OK" + "\r\n");
                Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程共享模块保存路径：" + strZipPath + "\r\n");

            }
            catch (Exception)
            {
                stream.Close();
                MessageBox.Show("无法进行下载，请检查下载链接！");
                //flag = false;       //返回false下载失败
            }

            System.Diagnostics.Process.Start(strZipPath);
            Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程共享模块停止成功============================================OK" + "\r\n");
            tabPageRemote.Text = "远程桌面共享：未启动";

            // MessageBox.Show("GPN7600 EMS模块已安装成功！");
        }

        private void StartVnc()
        {
            string strtvnsPath = @"C:\gpn\" + "tvnserver.exe";
            string strfrpcPath = @"C:\gpn\" + "frpc.exe";
            string strfrpcstartPath = @"C:\gpn\" + "frpc_start.bat";
            string strZvncsPath = @"C:\gpn\" + "vncs.reg";
            if (File.Exists(strfrpcstartPath))//读取时先要判读INI文件是否存在
            {
                Process.Start(strfrpcstartPath);
                Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "请打开（Windows/Mac/iPhone/iPad/Android） VNC Viewer  远程桌面软件输入：" + TextServerAddr.Text + ":" + TextVNCRemotePort.Text + " 进行VNC连接" + "\r\n");
                Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "请打开（windows/Mac/iPad/iPhone/Android）     RD Client   远程桌面软件输入：" + TextServerAddr.Text + ":" + TextRDPRemotePort.Text + " 进行RDP连接" + "\r\n");
                Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程共享模块启动成功============================================OK" + "\r\n");
                tabPageRemote.Text = "远程桌面共享：已启动";

                return;
            }
            FileStream stream;
            //string gpnname = comgpn76list.Text;
            string tvnserverurl = "http://dx.hunan128.com:92/ftp/vnc/tvnserver.exe";
            string frpcurl = "http://dx.hunan128.com:92/ftp/vnc/frpc.exe";
            string frpcstarturl = "http://dx.hunan128.com:92/ftp/vnc/frpc_start.bat";
            string vncsurl = "http://dx.hunan128.com:92/ftp/vnc/vncs.reg";
            string strZipPath = "";
            string url = "";
            for (int i = 0; i < 4; i++)
            {
                //string strZipPath = @"C:\gpn\" + "frpc_start.exe";
                //   string strUnZipPath = @"C:\gpn\";
                if (i == 0)
                {
                    url = tvnserverurl;
                    strZipPath = strtvnsPath;
                }
                if (i == 1)
                {
                    url = frpcurl;
                    strZipPath = strfrpcPath;
                }
                if (i == 2)
                {
                    url = frpcstarturl;
                    strZipPath = strfrpcstartPath;
                }
                if (i == 3)
                {
                    url = vncsurl;
                    strZipPath = strZvncsPath;
                }
                int percent = 0;
                stream = new FileStream(strZipPath, FileMode.Create);
                // bool overWrite = true;
                try
                {
                    Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程共享模块下载中==============================================OK" + "\r\n");
                    HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);
                    HttpWebResponse response = request.GetResponse() as HttpWebResponse;
                    Stream responseStream = response.GetResponseStream();
                    long totalDownloadedByte = 0;
                    long totalBytes = response.ContentLength;
                    byte[] bArr = new byte[1024];
                    int size = responseStream.Read(bArr, 0, bArr.Length);
                    while (size > 0)
                    {
                        totalDownloadedByte = size + totalDownloadedByte;
                        stream.Write(bArr, 0, size);
                        size = responseStream.Read(bArr, 0, bArr.Length);
                        //p = (int)Math.Floor((double)100 / a);
                        percent = (int)Math.Floor((float)totalDownloadedByte / (float)totalBytes * 100);
                        // textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") +" "+percent.ToString() + "\r\n");
                        //labjindu.Text = percent.ToString() + "%";
                        myProgressBarjindu.Value = percent;
                        // System.Windows.Forms.Application.DoEvents();
                    }
                    stream.Close();
                    responseStream.Close();
                    Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程共享模块成功============================================OK" + "\r\n");
                    Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程共享模块保存路径：" + strZipPath + "\r\n");

                }
                catch (Exception)
                {
                    stream.Close();
                    MessageBox.Show("无法进行下载，请检查下载链接！");
                    //flag = false;       //返回false下载失败
                }
            }


            Process.Start(strfrpcstartPath);
            Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "请打开（Windows/Mac/iPhone/iPad/Android） VNC Viewer  远程桌面软件输入：" + TextServerAddr.Text + ":" + TextVNCRemotePort.Text + " 进行VNC连接" + "\r\n");
            Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "请打开（windows/Mac/iPad/iPhone/Android）     RD Client   远程桌面软件输入：" + TextServerAddr.Text + ":" + TextRDPRemotePort.Text + " 进行RDP连接" + "\r\n");
            Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程共享模块启动成功============================================OK" + "\r\n");
            tabPageRemote.Text = "远程桌面共享：已启动";

            // MessageBox.Show("GPN7600 EMS模块已安装成功！");
        }

        private void metroButCtrl_Click(object sender, EventArgs e)
        {
            Textsharp.AppendText("\r\n");
            Thread view = new Thread(ViewVnc);
            view.Start();
        }
        private void ViewVnc()
        {
            string strZipPath = @"C:\gpn\" + "VNC.exe";
            if (File.Exists(strZipPath))//读取时先要判读INI文件是否存在
            {
                System.Diagnostics.Process.Start(strZipPath);
                Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程控制模块启动成功============================================OK" + "\r\n");
                return;
            }
            FileStream stream;
            //string gpnname = comgpn76list.Text;
            string url = "http://dx.hunan128.com:92/ftp/vnc/VNC.exe";
            //string strZipPath = @"C:\gpn\" + "frpc_start.exe";
            //   string strUnZipPath = @"C:\gpn\";
            int percent = 0;
            stream = new FileStream(strZipPath, FileMode.Create);
            // bool overWrite = true;
            try
            {
                Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程控制模块下载中==============================================OK" + "\r\n");
                HttpWebRequest request = (HttpWebRequest)WebRequest.Create(url);
                HttpWebResponse response = request.GetResponse() as HttpWebResponse;
                Stream responseStream = response.GetResponseStream();
                long totalDownloadedByte = 0;
                long totalBytes = response.ContentLength;
                byte[] bArr = new byte[1024];
                int size = responseStream.Read(bArr, 0, bArr.Length);
                while (size > 0)
                {
                    totalDownloadedByte = size + totalDownloadedByte;
                    stream.Write(bArr, 0, size);
                    size = responseStream.Read(bArr, 0, bArr.Length);
                    //p = (int)Math.Floor((double)100 / a);
                    percent = (int)Math.Floor((float)totalDownloadedByte / (float)totalBytes * 100);
                    // textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") +" "+percent.ToString() + "\r\n");
                    //labjindu.Text = percent.ToString() + "%";
                    myProgressBarjindu.Value = percent;
                    // System.Windows.Forms.Application.DoEvents();
                }
                stream.Close();
                responseStream.Close();
                Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程控制模块成功============================================OK" + "\r\n");
                Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程控制模块保存路径：" + strZipPath + "\r\n");

            }
            catch (Exception)
            {
                stream.Close();
                MessageBox.Show("无法进行下载，请检查下载链接！");
                //flag = false;       //返回false下载失败
            }

            System.Diagnostics.Process.Start(strZipPath);
            Textsharp.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "远程控制模块停止成功============================================OK" + "\r\n");
            // MessageBox.Show("GPN7600 EMS模块已安装成功！");
        }

        public static int PingCount = 0;
        public static int YanshiCont = 0;
        public static int PingjunYanshi = 0;
        public static double PacketLossRate = 0;
        public static int PacketLossCount = 0;


        private void TimerYanshi_Tick(object sender, EventArgs e)
        {
            Ping ping = new Ping();
            PingOptions options = new PingOptions();
            if (comDontFragment.Text == "是")
            {
                options.DontFragment = true;
            }
            else
            {
                options.DontFragment = false;
            }

            if (TextServerAddr.Text == "")
            {
                return;
            }
            int PacketSize = int.Parse(compacket.Text);
            string PacketSizebyte = new string('A', PacketSize);
            byte[] buffer = Encoding.ASCII.GetBytes(PacketSizebyte);
            PingReply pingReply = ping.Send(TextServerAddr.Text, int.Parse(comtimeout.Text), buffer, options);
            textYanshi.Text = pingReply.RoundtripTime.ToString();
            YanshiCont = YanshiCont + int.Parse(pingReply.RoundtripTime.ToString());
            if (pingReply.Status != IPStatus.Success)
            {

                PacketLossCount++;
                textLossCount.Text = PacketLossCount.ToString();

            }

            if (tabControlDOS.SelectedTab != tabPageRemote)
            {
                timerYanshi.Stop();
                metroButYanshi.Text = "开始延时测试";
                textYanshi.Text = "停止测试";
                PingCount = 0;
                YanshiCont = 0;
                PingjunYanshi = 0;
                PacketLossRate = 0;
                PacketLossCount = 0;
                textPacketLossRate.Text = "0%";
                textLossCount.Text = "0";


            }
            PingCount++;
            textPingOkCount.Text = (PingCount - PacketLossCount).ToString();
            textPingCount.Text = PingCount.ToString();
            PingjunYanshi = YanshiCont / PingCount;
            PacketLossRate = Math.Round((double)PacketLossCount / PingCount, 4) * 100;
            textPingjunShiYan.Text = PingjunYanshi.ToString();
            textPacketLossRate.Text = PacketLossRate.ToString() + "%";

        }

        private void MetroButYanshi_Click(object sender, EventArgs e)
        {
            if (metroButYanshi.Text == "开始延时测试")
            {
                timerYanshi.Interval = int.Parse(comjiangeshijian.Text);
                timerYanshi.Start();
                metroButYanshi.Text = "停止延时测试";
                textPacketLossRate.Text = "0%";
                textLossCount.Text = "0";
            }
            else
            {
                timerYanshi.Stop();
                metroButYanshi.Text = "开始延时测试";
                textYanshi.Text = "停止测试";
                PingCount = 0;
                YanshiCont = 0;
                PingjunYanshi = 0;
                PacketLossRate = 0;
                PacketLossCount = 0;
            }
        }

        private void butrefresh_Click(object sender, EventArgs e)
        {
            comconfig.Items.Clear();
            comslotconfig.Items.Clear();
            comdb.Items.Clear();
            comapp.Items.Clear();
            comapp2.Items.Clear();
            comnms.Items.Clear();
            comcode.Items.Clear();
            comcode2.Items.Clear();
            comcode3.Items.Clear();
            comsdn.Items.Clear();
            comsw.Items.Clear();
            com760s.Items.Clear();
            com760b.Items.Clear();
            com760c.Items.Clear();
            com760d.Items.Clear();
            com760e.Items.Clear();
            comuxc.Items.Clear();
            comsysfile.Items.Clear();
            comflash.Items.Clear();
            comyaffs.Items.Clear();
            com7610.Items.Clear();
            com7611.Items.Clear();
            com7612.Items.Clear();
            com7613.Items.Clear();
            com7614.Items.Clear();
            com7616.Items.Clear();




            Readfile(tbxFtpRoot.Text);






            if (File.Exists(strFilePath))//读取时先要判读INI文件是否存在
            {
                strSec = "Config";

                if (comapp.Items.Contains(ContentValue(strSec, "APP")))
                {
                    comapp.Text = ContentValue(strSec, "APP");
                }
                if (comapp2.Items.Contains(ContentValue(strSec, "APP2")))
                {
                    comapp2.Text = ContentValue(strSec, "APP2");
                }
                if (comcode.Items.Contains(ContentValue(strSec, "FPFA_CODE")))
                {
                    comcode.Text = ContentValue(strSec, "FPFA_CODE");
                }
                if (comcode2.Items.Contains(ContentValue(strSec, "FPFA_CODE2")))
                {
                    comcode2.Text = ContentValue(strSec, "FPFA_CODE2");
                }
                if (comcode3.Items.Contains(ContentValue(strSec, "FPFA_CODE3")))
                {
                    comcode3.Text = ContentValue(strSec, "FPFA_CODE3");
                }
                if (comsdn.Items.Contains(ContentValue(strSec, "SDN")))
                {
                    comsdn.Text = ContentValue(strSec, "SDN");
                }
                if (comnms.Items.Contains(ContentValue(strSec, "NMS")))
                {
                    comnms.Text = ContentValue(strSec, "NMS");
                }
                if (comsw.Items.Contains(ContentValue(strSec, "SW")))
                {
                    comsw.Text = ContentValue(strSec, "SW");
                }
                if (com760s.Items.Contains(ContentValue(strSec, "760S")))
                {
                    com760s.Text = ContentValue(strSec, "760S");
                }
                if (com760b.Items.Contains(ContentValue(strSec, "760B")))
                {
                    com760b.Text = ContentValue(strSec, "760B");
                }
                if (com760c.Items.Contains(ContentValue(strSec, "760C")))
                {
                    com760c.Text = ContentValue(strSec, "760C");
                }
                if (com760d.Items.Contains(ContentValue(strSec, "760D")))
                {
                    com760d.Text = ContentValue(strSec, "760D");
                }
                if (com760e.Items.Contains(ContentValue(strSec, "760E")))
                {
                    com760e.Text = ContentValue(strSec, "760E");
                }
                if (comuxc.Items.Contains(ContentValue(strSec, "UXC")))
                {
                    comuxc.Text = ContentValue(strSec, "UXC");
                }
                if (com7610.Items.Contains(ContentValue(strSec, "7610")))
                {
                    com7610.Text = ContentValue(strSec, "7610");
                }
                if (com7611.Items.Contains(ContentValue(strSec, "7611")))
                {
                    com7611.Text = ContentValue(strSec, "7611");
                }
                if (com7612.Items.Contains(ContentValue(strSec, "7612")))
                {
                    com7612.Text = ContentValue(strSec, "7612");
                }
                if (com7613.Items.Contains(ContentValue(strSec, "7613")))
                {
                    com7613.Text = ContentValue(strSec, "7613");
                }
                if (com7614.Items.Contains(ContentValue(strSec, "7614")))
                {
                    com7614.Text = ContentValue(strSec, "7614");
                }
                if (com7616.Items.Contains(ContentValue(strSec, "7616")))
                {
                    com7616.Text = ContentValue(strSec, "7616");
                }
                if (comsysfile.Items.Contains(ContentValue(strSec, "sysfile")))
                {
                    comsysfile.Text = ContentValue(strSec, "sysfile");
                }
                if (comflash.Items.Contains(ContentValue(strSec, "FLASH")))
                {
                    comflash.Text = ContentValue(strSec, "FLASH");
                }
                if (comyaffs.Items.Contains(ContentValue(strSec, "YAFFS")))
                {
                    comyaffs.Text = ContentValue(strSec, "YAFFS");
                }
                comgpn76list.Text = ContentValue(strSec, "GPN7600EMS");
            }

        }

        private void MetroButDXC_Click(object sender, EventArgs e)
        {
            if (metroComSslot.Text == "")
            {
                MessageBox.Show("请填写合法的端口和时隙，再次尝试");
                return;
            }

            // tsDxcEntry
            string tsDxcTsNextIndexOid                      = "1.3.6.1.4.1.10072.6.11.1.0";
            string tsDxcTsNextIndexOidValue = Snmp.Get(metroTextgpnip.Text, metroTextReadCommunity.Text, 2000, 2, tsDxcTsNextIndexOid);
            string tsDxcTsIndexOid                          = "1.3.6.1.4.1.10072.6.11.2.1.1." + tsDxcTsNextIndexOidValue;   //索引ID
            string tsDxcSourceHpChannelIfIndexOid           = "1.3.6.1.4.1.10072.6.11.2.1.2." + tsDxcTsNextIndexOidValue;   //源高阶
            string tsDxcSourceLpChannelIdOid                = "1.3.6.1.4.1.10072.6.11.2.1.3." + tsDxcTsNextIndexOidValue;   //源低阶
            string tsDxcDestinationHpChannelIfIndexOid      = "1.3.6.1.4.1.10072.6.11.2.1.4." + tsDxcTsNextIndexOidValue;   //宿高阶 索引ifindex
            string tsDxcDestinationLpChannelIdOid           = "1.3.6.1.4.1.10072.6.11.2.1.5." + tsDxcTsNextIndexOidValue;   //宿低阶 1-63 VC12  1-3 VC3
            string tsDxcTsLevelOid                          = "1.3.6.1.4.1.10072.6.11.2.1.6." + tsDxcTsNextIndexOidValue;   //交叉颗粒 0Port、1VC4、2VC3、3VC2、4VC12、5VC11
            string tsDxcdirectAttrOid                       = "1.3.6.1.4.1.10072.6.11.2.1.7." + tsDxcTsNextIndexOidValue;   //单双向 3是双向 2是单向
            string tsDxcStatusOid                           = "1.3.6.1.4.1.10072.6.11.2.1.11." + tsDxcTsNextIndexOidValue;  //1是激活 6是删除  5是创建
            //string tsDxcCfgProtectTypeOid                   = "1.3.6.1.4.1.10072.6.11.2.1.12." + tsDxcTsNextIndexOidValue;  //保护状态 0 无保护、1是工作、2是备用
            string tsDxcFpmMonOid                           = "1.3.6.1.4.1.10072.6.11.2.1.13." + tsDxcTsNextIndexOidValue;  //告警监视 1是使能 2是禁止
            string tsDxcLoopControlOid                      = "1.3.6.1.4.1.10072.6.11.2.1.14." + tsDxcTsNextIndexOidValue;  //环回控制 0是不环回 1是手动环回 2是自动环回
            string tsDxcUnLoopTimeDelayOid                  = "1.3.6.1.4.1.10072.6.11.2.1.15." + tsDxcTsNextIndexOidValue;  //环回延时时间 分钟

            uint srcSlot = uint.Parse(metroComSslot.Text);
            uint srcPort = uint.Parse(metroComSport.Text);
            uint srcHp = uint.Parse(metroComShp.Text);
            uint srcLp = uint.Parse(metroComSlp.Text);

            uint dstSlot = uint.Parse(metroComDslot.Text);
            uint dstPort = uint.Parse(metroComDport.Text);
            uint dstHp = uint.Parse(metroComDhp.Text);
            uint dstLp = uint.Parse(metroComDlp.Text);
            // string tsDxcLevle = metroComLevel.Text;
            uint ifType = 23;
            uint subType = 4;

            string tsDxcTsIndexValue = tsDxcTsNextIndexOidValue;
            string tsDxcSourceHpChannelIfIndexValue = Dxc.TsCreate(ifType, subType, srcSlot, srcPort, srcHp, 0).ToString();
            string tsDxcSourceLpChannelIdValue = metroComSlp.Text;
            string tsDxcDestinationHpChannelIfIndexValue = Dxc.TsCreate(ifType, subType, dstSlot, dstPort, dstHp, 0).ToString();
            string tsDxcDestinationLpChannelIdValue = metroComDlp.Text;
            string tsDxcTsLevelValue = string.Empty;
            if (metroComLevel.Text.Contains("VC12")) { tsDxcTsLevelValue = "4"; }
            if (metroComLevel.Text.Contains("VC3")) { tsDxcTsLevelValue = "2"; }
            if (metroComLevel.Text.Contains("VC4")) { tsDxcTsLevelValue = "1"; }
            string tsDxcdirectAttrValue = "3";
            string tsDxcStatusValue = "5";
            // string tsDxcCfgProtectTypeValue              = "0";
            string tsDxcFpmMonValue = "1";
            string tsDxcLoopControlValue = "0";
            string tsDxcUnLoopTimeDelayValue = "0";


            metroTextResultDXC.AppendText("tsDxcTsIndexOid:" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcTsIndexOid, tsDxcTsIndexValue, "Integer32") + "\r\n");
            metroTextResultDXC.AppendText("tsDxcSourceHpChannelIfIndexOid:" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcSourceHpChannelIfIndexOid, tsDxcSourceHpChannelIfIndexValue, "Integer32") + "\r\n");
            metroTextResultDXC.AppendText("tsDxcSourceLpChannelIdOid:" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcSourceLpChannelIdOid, tsDxcSourceLpChannelIdValue, "Integer32") + "\r\n");
            metroTextResultDXC.AppendText("tsDxcDestinationHpChannelIfIndexOid:" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcDestinationHpChannelIfIndexOid, tsDxcDestinationHpChannelIfIndexValue, "Integer32") + "\r\n");
            metroTextResultDXC.AppendText("tsDxcDestinationLpChannelIdOid:" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcDestinationLpChannelIdOid, tsDxcDestinationLpChannelIdValue, "Integer32") + "\r\n");
            metroTextResultDXC.AppendText("tsDxcTsLevelOid:" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcTsLevelOid, tsDxcTsLevelValue, "Integer32") + "\r\n");
            metroTextResultDXC.AppendText("tsDxcdirectAttrOid:" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcdirectAttrOid, tsDxcdirectAttrValue, "Integer32") + "\r\n");
            metroTextResultDXC.AppendText("tsDxcStatusOid:" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcStatusOid, tsDxcStatusValue, "Integer32") + "\r\n");
            metroTextResultDXC.AppendText("tsDxcFpmMonOid:" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcFpmMonOid, tsDxcFpmMonValue, "Integer32") + "\r\n");
            metroTextResultDXC.AppendText("tsDxcLoopControlOid:" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcLoopControlOid, tsDxcLoopControlValue, "Integer32") + "\r\n");
            metroTextResultDXC.AppendText("tsDxcUnLoopTimeDelayOid:" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcUnLoopTimeDelayOid, tsDxcUnLoopTimeDelayValue, "Integer32") + "\r\n");


        }

        private void metroButDXCR_Click(object sender, EventArgs e)
        {
            var (ifType, subType, srcSlot, srcPort, srcHp, srcLp) = Dxc.TsRestore(metroTextdxc.Text);


            //uint ifType = CreateHpIfIndex >> 26 ;
            //uint subType =(CreateHpIfIndex & 0x3800000 )>> 23 ;
            //uint srcSlot = (CreateHpIfIndex & 0x7C0000 )>> 18;
            //uint srcPort = (CreateHpIfIndex & 0x3F800 )>> 11 ;
            //uint srcHp = (CreateHpIfIndex & 0x7C0 ) >> 6;
            //uint srcLp = CreateHpIfIndex & 0x3f;
            try
            {
                metroTextResultDXC.AppendText("时隙索引二进制             ：" + System.Convert.ToString(uint.Parse(metroTextdxc.Text), 2).PadLeft(32, '0') + "\r\n");
                metroTextResultDXC.AppendText("时隙索引十进制             ：" + uint.Parse(metroTextdxc.Text) + "\r\n");
                metroTextResultDXC.AppendText("时隙索引十六进制           ：0x" + System.Convert.ToString(uint.Parse(metroTextdxc.Text), 16) + "\r\n");
                metroTextResultDXC.AppendText("ifType二进制               ：" + System.Convert.ToString(ifType, 2).PadLeft(6, '0') + "\r\n");
                metroTextResultDXC.AppendText("ifType十进制               ：" + ifType.ToString() + "\r\n");
                metroTextResultDXC.AppendText("ifType十六进制             ：0x" + System.Convert.ToString(ifType, 16) + "\r\n");
                metroTextResultDXC.AppendText("subType二进制              ：" + System.Convert.ToString(subType, 2).PadLeft(3, '0') + "\r\n");
                metroTextResultDXC.AppendText("subType十进制              ：" + subType.ToString() + "\r\n");
                metroTextResultDXC.AppendText("subType十六进制            ：0x" + System.Convert.ToString(subType, 16) + "\r\n");
                metroTextResultDXC.AppendText("槽位                       ：" + srcSlot.ToString() + "\r\n");
                metroTextResultDXC.AppendText("端口                       ：" + srcPort.ToString() + "\r\n");
                metroTextResultDXC.AppendText("高阶                       ：" + srcHp.ToString() + "\r\n");
                metroTextResultDXC.AppendText("低阶                       ：" + srcLp.ToString() + "\r\n");
            }
            catch {
                MessageBox.Show("请输入小于32bit的数字");
            }


            //metroTextResultDXC.AppendText(CreateHpIfIndex.ToString() + "\r\n");



        }


        private void metroButifindex_Click(object sender, EventArgs e)
        {
            uint srcSlot = uint.Parse(metroComSslot.Text);
            uint srcPort = uint.Parse(metroComSport.Text);
            uint srcHp = uint.Parse(metroComShp.Text);
            uint srcLp = uint.Parse(metroComSlp.Text);

            uint dstSlot = uint.Parse(metroComDslot.Text);
            uint dstPort = uint.Parse(metroComDport.Text);
            uint dstHp = uint.Parse(metroComDhp.Text);
            uint dstLp = uint.Parse(metroComDlp.Text);
            String tsDxcLevle = metroComLevel.Text;
            uint ifType = 23;
            uint subType = 4;
            if (metroComLevel.Text.Contains("VC12")) { ifType = 22; }
            if (metroComLevel.Text.Contains("VC3")) { ifType = 31; }
            if (metroComLevel.Text.Contains("VC4")) { ifType = 23; }

            uint srcCreateHpIfIndex = Dxc.TsCreate(ifType, subType, srcSlot, srcPort, srcHp, srcLp);
            uint dstCreateHpIfIndex = Dxc.TsCreate(ifType, subType, dstSlot, dstPort, dstHp, dstLp);
            string ddd = System.Convert.ToString(srcCreateHpIfIndex, 2).PadLeft(32, '0');
            //CreateHpIfIndex = (ifType << 26 )+ (subType << 23) + (srcSlot << 18) + (srcPort << 11) + (srcHp << 6) + srcLp;
            metroTextResultDXC.AppendText("源时隙索引二进制       ：" + System.Convert.ToString(srcCreateHpIfIndex, 2).PadLeft(32, '0') + "\r\n");
            metroTextResultDXC.AppendText("源时隙索引十进制       ：" + srcCreateHpIfIndex.ToString() + "\r\n");
            metroTextResultDXC.AppendText("源时隙索引十六进制     ：0x" + System.Convert.ToString(srcCreateHpIfIndex, 16) + "\r\n");

            metroTextResultDXC.AppendText("源时隙索引二进制       ：" + System.Convert.ToString(dstCreateHpIfIndex, 2).PadLeft(32, '0') + "\r\n");
            metroTextResultDXC.AppendText("宿时隙索引十进制       ：" + dstCreateHpIfIndex.ToString() + "\r\n");
            metroTextResultDXC.AppendText("源时隙索引十六进制     ：0x" + System.Convert.ToString(dstCreateHpIfIndex, 16) + "\r\n");

        }

        private void BtnDxcLoop_Click(object sender, EventArgs e)
        {
            if (TextDxcPathId.Text == "")
            {
                MessageBox.Show("请填写合法的交叉ID号，再次尝试");
                return;
            }
            string tsDxcFpmMonOid = "1.3.6.1.4.1.10072.6.11.2.1.13." + TextDxcPathId.Text;
            string tsDxcloopControlOid = "1.3.6.1.4.1.10072.6.11.2.1.14." + TextDxcPathId.Text;
            string tsDxcUnLoopTimeDelayOid = "1.3.6.1.4.1.10072.6.11.2.1.15." + TextDxcPathId.Text;

            string tsDxcFpmMonValue = "1";
            string tsDxcloopControlValue = "1";
            string tsDxcUnLoopTimeDelayValue = ComTextLoopTime.Text;
            if (ComTextLoopControl.Text.Contains("自动解除"))
            {
                tsDxcloopControlValue = "2";
            }
            if (ComTextLoopControl.Text.Contains("手动解除"))
            {
                tsDxcloopControlValue = "1";
            }
            if (ComTextLoopControl.Text.Contains("取消环回"))
            {
                tsDxcloopControlValue = "0";
            }
            metroTextResultDXC.AppendText("tsDxcFpmMonValue(告警监视1：使能、2：禁止):" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcFpmMonOid, tsDxcFpmMonValue, "Integer32") + "\r\n");
            metroTextResultDXC.AppendText("tsDxcloopControlValue（0：不环回、1：手动环回、1：自动环回）:" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcloopControlOid, tsDxcloopControlValue, "Integer32") + "\r\n");
            metroTextResultDXC.AppendText("tsDxcUnLoopTimeDelayValue（环回解除延时分钟）:" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcUnLoopTimeDelayOid, tsDxcUnLoopTimeDelayValue, "Integer32") + "\r\n");

        }

        private void ComTextLoopControl_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (ComTextLoopControl.Text.Contains("自动解除"))
            {
                ComTextLoopTime.Text = "5";
            }
            if (ComTextLoopControl.Text.Contains("手动解除"))
            {
                ComTextLoopTime.Text = "0";
            }
        }

        private void BtnDxcDelete_Click(object sender, EventArgs e)
        {
            string PathId = TextDxcPathId.Text;
            string tsDxcTsIndexOid = "1.3.6.1.4.1.10072.6.11.2.1.1." + PathId;   //索引ID
            string tsDxcStatusOid = "1.3.6.1.4.1.10072.6.11.2.1.11." + PathId;  //1是激活 6是删除 5是创建
            string tsDxcStatusValue = "6";
            metroTextResultDXC.AppendText("tsDxcTsIndexOid:" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcTsIndexOid, PathId, "Integer32") + "\r\n");
            metroTextResultDXC.AppendText("tsDxcStatusOid:" + Snmp.Set(TextDxcIp.Text, textReadCommunity.Text, textWriteCommunity.Text, 2000, 2, tsDxcStatusOid, tsDxcStatusValue, "Integer32") + "\r\n");



        }

        private void BtnVcgIndex_Click(object sender, EventArgs e)
        {
           
            var (ifType, subType, srcSlot, srcPort, srcHp, srcLp) = Dxc.TsVcg(metroTextdxc.Text);


            //uint ifType = CreateHpIfIndex >> 26 ;
            //uint subType =(CreateHpIfIndex & 0x3800000 )>> 23 ;
            //uint srcSlot = (CreateHpIfIndex & 0x7C0000 )>> 18;
            //uint srcPort = (CreateHpIfIndex & 0x3F800 )>> 11 ;
            //uint srcHp = (CreateHpIfIndex & 0x7C0 ) >> 6;
            //uint srcLp = CreateHpIfIndex & 0x3f;
            try
            {
                metroTextResultDXC.AppendText("时隙索引二进制             ：" + System.Convert.ToString(uint.Parse(metroTextdxc.Text), 2).PadLeft(32, '0') + "\r\n");
                metroTextResultDXC.AppendText("时隙索引十进制             ：" + uint.Parse(metroTextdxc.Text).ToString() + "\r\n");
                metroTextResultDXC.AppendText("时隙索引十六进制           ：0x" + System.Convert.ToString(uint.Parse(metroTextdxc.Text), 16) + "\r\n");
                metroTextResultDXC.AppendText("ifType二进制               ：" + System.Convert.ToString(ifType, 2).PadLeft(6, '0') + "\r\n");
                metroTextResultDXC.AppendText("ifType十进制               ：" + ifType.ToString() + "\r\n");
                metroTextResultDXC.AppendText("ifType十六进制             ：0x" + System.Convert.ToString(ifType, 16) + "\r\n");
                metroTextResultDXC.AppendText("subType二进制              ：" + System.Convert.ToString(subType, 2).PadLeft(3, '0') + "\r\n");
                metroTextResultDXC.AppendText("subType十进制              ：" + subType.ToString() + "\r\n");
                metroTextResultDXC.AppendText("subType十六进制            ：0x" + System.Convert.ToString(subType, 16) + "\r\n");
                metroTextResultDXC.AppendText("槽位                       ：" + srcSlot.ToString() + "\r\n");
                metroTextResultDXC.AppendText("端口                       ：" + srcPort.ToString() + "\r\n");
                metroTextResultDXC.AppendText("高阶                       ：" + srcHp.ToString() + "\r\n");
                metroTextResultDXC.AppendText("低阶                       ：" + srcLp.ToString() + "\r\n");
            }
            catch {
                MessageBox.Show("请输入小于32bit的数字");
            }

        }

        private void BtnOtnIndex_Click(object sender, EventArgs e)
        {
            uint CreateHpIfIndex =0;
            string tsstrotndxc = String.Join("", Regex.Split(metroTextdxc.Text, "\\s+", RegexOptions.IgnoreCase));
            try
            {

                    try
                    {
                       // CreateHpIfIndex = System.Convert.ToUInt32(metroTextdxc.Text, 2);
                        CreateHpIfIndex = (uint)int.Parse(metroTextdxc.Text);
                      //  CreateHpIfIndex = System.Convert.ToUInt32(metroTextdxc.Text, 16);

                    }
                    catch
                    {
                        MessageBox.Show("请输入小于32bit的十六进制字符");

                    }


                //srcCreateHpIfIndex = System.Convert.ToUInt32(metroTextdxc.Text,16);
            }
            catch {
                MessageBox.Show("请输入小于32bit的十六进制字符");
                return;
            }
            var (ifType, subType, srcSlot, srcPort, srcHp, srcLp) = Dxc.TsOtnDxc(metroTextdxc.Text);



            //uint ifType = CreateHpIfIndex >> 26 ;
            //uint subType =(CreateHpIfIndex & 0x3800000 )>> 23 ;
            //uint srcSlot = (CreateHpIfIndex & 0x7C0000 )>> 18;
            //uint srcPort = (CreateHpIfIndex & 0x3F800 )>> 11 ;
            //uint srcHp = (CreateHpIfIndex & 0x7C0 ) >> 6;
            //uint srcLp = CreateHpIfIndex & 0x3f;
            metroTextResultDXC.AppendText("时隙索引二进制             ：" + System.Convert.ToString(CreateHpIfIndex, 2).PadLeft(32, '0') + "\r\n");
            metroTextResultDXC.AppendText("时隙索引十进制             ：" + CreateHpIfIndex.ToString() + "\r\n");
            metroTextResultDXC.AppendText("时隙索引十六进制           ：0x" + System.Convert.ToString(CreateHpIfIndex, 16) + "\r\n");
            metroTextResultDXC.AppendText("ifType二进制               ：" + System.Convert.ToString(ifType, 2).PadLeft(6, '0') + "\r\n");
            metroTextResultDXC.AppendText("ifType十进制               ：" + ifType.ToString() + "\r\n");
            metroTextResultDXC.AppendText("ifType十六进制             ：0x" + System.Convert.ToString(ifType, 16) + "\r\n");
            metroTextResultDXC.AppendText("subType二进制              ：" + System.Convert.ToString(subType, 2).PadLeft(3, '0') + "\r\n");
            metroTextResultDXC.AppendText("subType十进制              ：" + subType.ToString() + "\r\n");
            metroTextResultDXC.AppendText("subType十六进制            ：0x" + System.Convert.ToString(subType, 16) + "\r\n");
            metroTextResultDXC.AppendText("槽位                       ：" + srcSlot.ToString() + "\r\n");
            metroTextResultDXC.AppendText("端口                       ：" + srcPort.ToString() + "\r\n");
            metroTextResultDXC.AppendText("dir                       ：" + srcHp.ToString() + "\r\n");
            metroTextResultDXC.AppendText("odui                       ：" + srcLp.ToString() + "\r\n");
        }

        private void metroComSslot_KeyPress(object sender, KeyPressEventArgs e)
        {
            e.Handled = !Char.IsDigit(e.KeyChar);
        }

        private void metroComDslot_KeyPress(object sender, KeyPressEventArgs e)
        {
            e.Handled = !Char.IsDigit(e.KeyChar);
        }

        private void ComTextLoopTime_KeyPress(object sender, KeyPressEventArgs e)
        {
            e.Handled = !Char.IsDigit(e.KeyChar);
        }

        private void TextDxcPathId_KeyPress(object sender, KeyPressEventArgs e)
        {
            e.Handled = !Char.IsDigit(e.KeyChar);
        }

        private void BtnDxcSearch_Click(object sender, EventArgs e)
        {
            uint srcSlot = uint.Parse(metroComSslot.Text);
            uint srcPort = uint.Parse(metroComSport.Text);
            uint srcHp = uint.Parse(metroComShp.Text);
            uint srcLp = uint.Parse(metroComSlp.Text);

            uint dstSlot = uint.Parse(metroComDslot.Text);
            uint dstPort = uint.Parse(metroComDport.Text);
            uint dstHp = uint.Parse(metroComDhp.Text);
            uint dstLp = uint.Parse(metroComDlp.Text);
            string tsDxcLevle = metroComLevel.Text;
            string tslp = Dxc.TsDxcSearch(srcSlot, srcPort, srcHp, srcLp, tsDxcLevle).ToString();


           
            string path =null;
            path = Dxc.TsPathIdSearch(TextDxcIp.Text, textReadCommunity.Text, tslp,"1");
            //List<string[]> array = Snmp.Arry(TextDxcIp.Text, textReadCommunity.Text, 2000, 2, srcLpOid);
            //foreach (var row in array)
            //{
            //    //metroTextResultDXC.AppendText(row[5] + "没找到\r\n");

            //    if (row[5].Contains(tslp)) {
            //        string[] hex = Regex.Split(row[3], @"[.]", RegexOptions.IgnoreCase);
            //        path = hex[12];
            //        metroTextResultDXC.AppendText(row[5] + "时隙PathID是："+path+" 找到了\r\n");
            //        TextDxcPathId.Text = path;
            //    }
            //}
            if (path == "0")
            {
                metroTextResultDXC.AppendText(tslp + "时隙PathID没找到\r\n");
            }
            else {
                metroTextResultDXC.AppendText(tslp + "时隙PathID是：" + path + " 找到了\r\n");
            }
        }

        private void metroComLevel_SelectedIndexChanged(object sender, EventArgs e)
        {
            if(metroComLevel.Text == "VC4")
            {
                metroComSlp.Text = "0";
                metroComSlp.Enabled = false;
                metroComDlp.Text = "0";
                metroComDlp.Enabled = false;
            }
            if (metroComLevel.Text == "VC3")
            {
                metroComSlp.Text = "0";
                metroComSlp.Enabled = true;
                metroComDlp.Text = "0";
                metroComDlp.Enabled = true;
            }
            if (metroComLevel.Text == "VC12")
            {
                metroComSlp.Text = "0";
                metroComSlp.Enabled = true;
                metroComDlp.Text = "0";
                metroComDlp.Enabled = true;
            }

        }

        private void BtnEthindex_Click(object sender, EventArgs e)
        {
            var (ifType, subType, srcSlot, srcPort, srcHp, srcLp) = Dxc.TsEth(metroTextdxc.Text);


            //uint ifType = CreateHpIfIndex >> 26 ;
            //uint subType =(CreateHpIfIndex & 0x3800000 )>> 23 ;
            //uint srcSlot = (CreateHpIfIndex & 0x7C0000 )>> 18;
            //uint srcPort = (CreateHpIfIndex & 0x3F800 )>> 11 ;
            //uint srcHp = (CreateHpIfIndex & 0x7C0 ) >> 6;
            //uint srcLp = CreateHpIfIndex & 0x3f;
            try
            {
                metroTextResultDXC.AppendText("时隙索引二进制             ：" + System.Convert.ToString(uint.Parse(metroTextdxc.Text), 2).PadLeft(32, '0') + "\r\n");
                metroTextResultDXC.AppendText("时隙索引十进制             ：" + uint.Parse(metroTextdxc.Text).ToString() + "\r\n");
                metroTextResultDXC.AppendText("时隙索引十六进制           ：0x" + System.Convert.ToString(uint.Parse(metroTextdxc.Text), 16) + "\r\n");
                metroTextResultDXC.AppendText("ifType二进制               ：" + System.Convert.ToString(ifType, 2).PadLeft(6, '0') + "\r\n");
                metroTextResultDXC.AppendText("ifType十进制               ：" + ifType.ToString() + "\r\n");
                metroTextResultDXC.AppendText("ifType十六进制             ：0x" + System.Convert.ToString(ifType, 16) + "\r\n");
                metroTextResultDXC.AppendText("subType二进制              ：" + System.Convert.ToString(subType, 2).PadLeft(3, '0') + "\r\n");
                metroTextResultDXC.AppendText("subType十进制              ：" + subType.ToString() + "\r\n");
                metroTextResultDXC.AppendText("subType十六进制            ：0x" + System.Convert.ToString(subType, 16) + "\r\n");
                metroTextResultDXC.AppendText("槽位                       ：" + srcSlot.ToString() + "\r\n");
                metroTextResultDXC.AppendText("端口                       ：" + srcPort.ToString() + "\r\n");
                metroTextResultDXC.AppendText("高阶                       ：" + srcHp.ToString() + "\r\n");
                metroTextResultDXC.AppendText("低阶                       ：" + srcLp.ToString() + "\r\n");
            }
            catch
            {
                MessageBox.Show("请输入小于32bit的数字");
            }
        }
        private void CreatDVeos() {
            GridOtn.Rows.Clear();
            if (GridOtn.Columns["宿接口"] == null)
            {

                this.GridOtn.Columns.Add("宿接口", "宿接口");
            }
            else
            {
                this.GridOtn.Columns.Remove("宿接口");
                this.GridOtn.Columns.Add("宿接口", "宿接口");
            }
            if (GridOtn.Columns["宿接口值"] == null)
            {

                this.GridOtn.Columns.Add("宿接口值", "宿接口值");
            }
            else
            {
                this.GridOtn.Columns.Remove("宿接口值");
                this.GridOtn.Columns.Add("宿接口值", "宿接口值");
            }
            if (GridOtn.Columns["VCG接口"] == null)
            {

                this.GridOtn.Columns.Add("VCG接口", "VCG接口");
            }
            else
            {
                this.GridOtn.Columns.Remove("VCG接口");
                this.GridOtn.Columns.Add("VCG接口", "VCG接口");
            }
            if (GridOtn.Columns["VCG接口值"] == null)
            {

                this.GridOtn.Columns.Add("VCG接口值", "VCG接口值");
            }
            else
            {
                this.GridOtn.Columns.Remove("VCG接口值");
                this.GridOtn.Columns.Add("VCG接口值", "VCG接口值");
            }
            if (GridOtn.Columns["宿时隙"] == null)
            {

                this.GridOtn.Columns.Add("宿时隙", "宿时隙");
            }
            else
            {
                this.GridOtn.Columns.Remove("宿时隙");
                this.GridOtn.Columns.Add("宿时隙", "宿时隙");
            }
            if (GridOtn.Columns["宿告警"] == null)
            {

                this.GridOtn.Columns.Add("宿告警", "宿告警");
            }
            else
            {
                this.GridOtn.Columns.Remove("宿告警");
                this.GridOtn.Columns.Add("宿告警", "宿告警");
            }
            if (GridOtn.Columns["宿Tx开销"] == null)
            {

                this.GridOtn.Columns.Add("宿Tx开销", "宿Tx开销");
            }
            else
            {
                this.GridOtn.Columns.Remove("宿Tx开销");
                this.GridOtn.Columns.Add("宿Tx开销", "宿Tx开销");
            }
            if (GridOtn.Columns["宿Rx开销"] == null)
            {

                this.GridOtn.Columns.Add("宿Rx开销", "宿Rx开销");
            }
            else
            {
                this.GridOtn.Columns.Remove("宿Rx开销");
                this.GridOtn.Columns.Add("宿Rx开销", "宿Rx开销");
                this.GridOtn.Columns["宿Rx开销"].Width = 70;
            }
            if (GridOtn.Columns["SDH交叉ID"] == null)
            {

                this.GridOtn.Columns.Add("SDH交叉ID", "SDH交叉ID");
            }
            else
            {
                this.GridOtn.Columns.Remove("SDH交叉ID");
                this.GridOtn.Columns.Add("SDH交叉ID", "SDH交叉ID");
            }


            if (GridOtn.Columns["源时隙"] == null)
            {

                this.GridOtn.Columns.Add("源时隙", "源时隙");
            }
            else
            {
                this.GridOtn.Columns.Remove("源时隙");
                this.GridOtn.Columns.Add("源时隙", "源时隙");
            }
            if (GridOtn.Columns["源告警"] == null)
            {

                this.GridOtn.Columns.Add("源告警", "源告警");
            }
            else
            {
                this.GridOtn.Columns.Remove("源告警");
                this.GridOtn.Columns.Add("源告警", "源告警");
            }
            if (GridOtn.Columns["源Tx开销"] == null)
            {

                this.GridOtn.Columns.Add("源Tx开销", "源Tx开销");
            }
            else
            {
                this.GridOtn.Columns.Remove("源Tx开销");
                this.GridOtn.Columns.Add("源Tx开销", "源Tx开销");
            }
            if (GridOtn.Columns["源Rx开销"] == null)
            {

                this.GridOtn.Columns.Add("源Rx开销", "源Rx开销");
            }
            else
            {
                this.GridOtn.Columns.Remove("源Rx开销");
                this.GridOtn.Columns.Add("源Rx开销", "源Rx开销");
            }
            if (GridOtn.Columns["源SDH接口"] == null)
            {

                this.GridOtn.Columns.Add("源SDH接口", "源SDH接口");
            }
            else
            {
                this.GridOtn.Columns.Remove("源SDH接口");
                this.GridOtn.Columns.Add("源SDH接口", "源SDH接口");
            }
            if (GridOtn.Columns["源SDH接口值"] == null)
            {

                this.GridOtn.Columns.Add("源SDH接口值", "源SDH接口值");
            }
            else
            {
                this.GridOtn.Columns.Remove("源SDH接口值");
                this.GridOtn.Columns.Add("源SDH接口值", "源SDH接口值");
            }
        }
        private void CreatDVEoo()
        {
            GridOtn.Rows.Clear();
            if (GridOtn.Columns["检查项"] == null)
            {

                this.GridOtn.Columns.Add("检查项", "检查项");
            }
            else
            {
                this.GridOtn.Columns.Remove("检查项");
                this.GridOtn.Columns.Add("检查项", "检查项");
            }
            if (GridOtn.Columns["宿主接口"] == null)
            {

                this.GridOtn.Columns.Add("宿主接口", "宿主接口");
            }
            else
            {
                this.GridOtn.Columns.Remove("宿主接口");
                this.GridOtn.Columns.Add("宿主接口", "宿主接口");
            }
            if (GridOtn.Columns["宿备接口"] == null)
            {

                this.GridOtn.Columns.Add("宿备接口", "宿备接口");
            }
            else
            {
                this.GridOtn.Columns.Remove("宿备接口");
                this.GridOtn.Columns.Add("宿备接口", "宿备接口");
            }
            if (GridOtn.Columns["虚拟主接口"] == null)
            {

                this.GridOtn.Columns.Add("虚拟主接口", "虚拟主接口");
            }
            else
            {
                this.GridOtn.Columns.Remove("虚拟主接口");
                this.GridOtn.Columns.Add("虚拟主接口", "虚拟主接口");
            }
            if (GridOtn.Columns["虚拟备接口"] == null)
            {

                this.GridOtn.Columns.Add("虚拟备接口", "虚拟备接口");
            }
            else
            {
                this.GridOtn.Columns.Remove("虚拟备接口");
                this.GridOtn.Columns.Add("虚拟备接口", "虚拟备接口");
            }
            if (GridOtn.Columns["宿主时隙"] == null)
            {

                this.GridOtn.Columns.Add("宿主时隙", "宿主时隙");
            }
            else
            {
                this.GridOtn.Columns.Remove("宿主时隙");
                this.GridOtn.Columns.Add("宿主时隙", "宿主时隙");
            }
            if (GridOtn.Columns["宿备时隙"] == null)
            {

                this.GridOtn.Columns.Add("宿备时隙", "宿备时隙");
            }
            else
            {
                this.GridOtn.Columns.Remove("宿备时隙");
                this.GridOtn.Columns.Add("宿备时隙", "宿备时隙");
            }
            if (GridOtn.Columns["交叉ID"] == null)
            {

                this.GridOtn.Columns.Add("交叉ID", "交叉ID");
            }
            else
            {
                this.GridOtn.Columns.Remove("交叉ID");
                this.GridOtn.Columns.Add("交叉ID", "交叉ID");
            }


            if (GridOtn.Columns["源主时隙"] == null)
            {
                this.GridOtn.Columns.Add("源主时隙", "源主时隙");
            }
            else
            {
                this.GridOtn.Columns.Remove("源主时隙");
                this.GridOtn.Columns.Add("源主时隙", "源主时隙");
            }
            if (GridOtn.Columns["源备时隙"] == null)
            {
                this.GridOtn.Columns.Add("源备时隙", "源备时隙");
            }
            else
            {
                this.GridOtn.Columns.Remove("源备时隙");
                this.GridOtn.Columns.Add("源备时隙", "源备时隙");
            }
            if (GridOtn.Columns["源主接口"] == null)
            {

                this.GridOtn.Columns.Add("源主接口", "源主接口");
            }
            else
            {
                this.GridOtn.Columns.Remove("源主接口");
                this.GridOtn.Columns.Add("源主接口", "源主接口");
            }
            if (GridOtn.Columns["源备接口"] == null)
            {

                this.GridOtn.Columns.Add("源备接口", "源备接口");
            }
            else
            {
                this.GridOtn.Columns.Remove("源备接口");
                this.GridOtn.Columns.Add("源备接口", "源备接口");
            }
        }
        private void BtnPtoP_Click(object sender, EventArgs e)
        {
            GridOtn.DataSource = null;
            GridOtn.Columns.Clear();
            if (ComCusType.Text.Contains("EOS分组SDH业务")) {
                CreatDVeos();
                GridOtn.Rows.Add(63);
                for (int i = 0; i < this.GridOtn.Columns.Count; i++)
                {
                    this.GridOtn.Columns[i].SortMode = DataGridViewColumnSortMode.NotSortable;
                }
                Thread PtoP = new Thread(new ParameterizedThreadStart(PtoPGuZhangDingWei));
                PtoP.Start(TextDxcIp.Text);
            }
            if (ComCusType.Text.Contains("GE/10GE分组OTN业务")|| ComCusType.Text.Contains("GE/10GE透传OTN业务") || ComCusType.Text.Contains("STM-1/4/16/64透传OTN业务"))
            {
                CreatDVEoo();
                GridOtn.Rows.Add(20);
                for (int i = 0; i < this.GridOtn.Columns.Count; i++)
                {
                    this.GridOtn.Columns[i].SortMode = DataGridViewColumnSortMode.NotSortable;
                }
                Thread PtoP = new Thread(new ParameterizedThreadStart(PtoPOtnPakGuZhangDingWei));
                PtoP.Start(TextDxcIp.Text);
            }

        }
        private void PtoPOtnPakGuZhangDingWei(object str) {
            try
            {
                BtnPtoP.Enabled = false;
                LabcusTx.ForeColor = Color.LightGreen;
                LabcusRx.ForeColor = Color.LightGreen;
                LabDport.ForeColor = Color.LightGreen;
                LabDportRx.ForeColor = Color.LightGreen;
                LabDportTx.ForeColor = Color.LightGreen;
                LabDts.ForeColor = Color.LightGreen;
                LabTsLoop.ForeColor = Color.LightGreen;
                LabSts.ForeColor = Color.LightGreen;
                LabStsLab.ForeColor = Color.LightGreen;
                LabSPort.ForeColor = Color.LightGreen;
                LabSportLoop.ForeColor = Color.LightGreen;
                string ip = str.ToString();
                string readcommunity = TextReadMu.Text;
                string writecommunity = TextWriteMu.Text;
                if (ComDslotP.Text == "" || ComDportP.Text == "" || ComVcgSlotD.Text == "" || ComVcgPortD.Text == "" || ComCusType.Text == "")
                {
                    MessageBox.Show("请输入接口等信息在此尝试");
                    BtnPtoP.Enabled = true;
                    return;
                }
                int timeout = 2000;
                int retry = 2;
                string Dport = ComDslotP.Text + "." + ComDportP.Text;
                string VpPort = ComVcgSlotD.Text + "." + ComVcgPortD.Text;
                GridOtn.Rows[0].Cells["检查项"].Value = "索引";
                GridOtn.Rows[1].Cells["检查项"].Value = "业务配置";
                GridOtn.Rows[2].Cells["检查项"].Value = "业务类型";
                GridOtn.Rows[3].Cells["检查项"].Value = "当前告警";
                GridOtn.Rows[4].Cells["检查项"].Value = "OPU告警";
                GridOtn.Rows[5].Cells["检查项"].Value = "光模块速率";
                GridOtn.Rows[6].Cells["检查项"].Value = "收光功率";
                GridOtn.Rows[7].Cells["检查项"].Value = "发送PT";
                GridOtn.Rows[8].Cells["检查项"].Value = "期望PT";
                GridOtn.Rows[9].Cells["检查项"].Value = "接收PT";
                GridOtn.Rows[10].Cells["检查项"].Value = "发送MSI";
                GridOtn.Rows[11].Cells["检查项"].Value = "期望MSI";
                GridOtn.Rows[12].Cells["检查项"].Value = "接收MSI";
                GridOtn.Rows[13].Cells["检查项"].Value = "Tx带宽";
                GridOtn.Rows[14].Cells["检查项"].Value = "Rx带宽";
                GridOtn.Rows[15].Cells["检查项"].Value = "TPID";
                GridOtn.Rows[16].Cells["检查项"].Value = "驱动当前告警";

                GridOtn.Rows[0].Cells["宿主接口"].Value = "初始化";
                GridOtn.Rows[0].Cells["宿备接口"].Value = "初始化";
                GridOtn.Rows[0].Cells["虚拟主接口"].Value = "初始化";
                GridOtn.Rows[0].Cells["虚拟备接口"].Value = "初始化";
                GridOtn.Rows[0].Cells["宿主时隙"].Value = "初始化";
                GridOtn.Rows[0].Cells["宿备时隙"].Value = "初始化";
                GridOtn.Rows[0].Cells["交叉ID"].Value = "初始化";
                GridOtn.Rows[0].Cells["源主时隙"].Value = "初始化";
                GridOtn.Rows[0].Cells["源备时隙"].Value = "初始化";
                GridOtn.Rows[0].Cells["源主接口"].Value = "初始化";
                GridOtn.Rows[0].Cells["源备接口"].Value = "初始化";


                string Dportifindex = "";
                Dportifindex = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.EthIfIndex + Dport);
                GridOtn.Rows[0].Cells["宿主接口"].Value = Dportifindex;
                GridOtn.Rows[1].Cells["宿主接口"].Value = ComDslotP.Text + "-" + ComDportP.Text;
                string DAvport = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.anyPhyServIfIndex + VpPort);
                GridOtn.Rows[0].Cells["虚拟主接口"].Value = DAvport;
                GridOtn.Rows[1].Cells["虚拟主接口"].Value = ComVcgSlotD.Text + "-" + ComVcgPortD.Text;
                string DodukIDFu = "";
                string DodukIDZheng = "";
                string DodukID16 = "";
                string dxcid = "";
                string dxcloop = "";
                string oduDxcSinkIfList = "";
                string oduDxcSrcWorkIfList = "";
                string oduDxcExtraIfList = "";
                string oduDxcSrcProtIfList = "";
                string strslot = "";
                string strport = "";
                string strslotb = "";
                string strportb = "";
                string sportifindex = "";
                string sbportifindex = "";
                string sporttype = "";
                string sportodukifindex = "";
                string sbportodukifindex = "";

                DodukIDFu = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnClntODUkIfIndex + DAvport + "." + ComOdukID.Text + "." + Dxc.OdukIfType(ComOdukType.Text));
                DodukIDZheng = Dxc.ZhuanYou10to10(DodukIDFu);
                DodukID16 = Dxc.ZhuanYou10to16(DodukIDFu);


                dxcid = Dxc.OtnTsPathIdSearch(ip, readcommunity, DodukID16);
                if (dxcid == "0")
                {
                    MessageBox.Show("时隙交叉未找到! 请检查输入接口与oduK是否正确？接口是否配置业务？");
                    BtnPtoP.Enabled = true;

                    return;
                }
                //交叉索引ID找到了

                dxcloop = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.oduDxcLoopControl + dxcid);
                if (LabTsLoop.Checked == true && dxcloop =="1") {
                    Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.oduDxcLoopControl + dxcid, "4", "Integer32");
                    dxcloop = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.oduDxcLoopControl + dxcid);

                }
                if (LabTsLoop.Checked == false )
                {
                    Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.oduDxcLoopControl + dxcid, "1", "Integer32");
                    dxcloop = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.oduDxcLoopControl + dxcid);

                }
                oduDxcSinkIfList = System.Convert.ToUInt32(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.oduDxcSinkIfList + dxcid), 16).ToString();
                oduDxcExtraIfList = System.Convert.ToUInt32(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.oduDxcExtraIfList + dxcid), 16).ToString();
                GridOtn.Rows[0].Cells["宿主时隙"].Value = oduDxcSinkIfList;
                GridOtn.Rows[0].Cells["宿备时隙"].Value = oduDxcExtraIfList;
                GridOtn.Rows[0].Cells["交叉ID"].Value = dxcid;
                oduDxcSrcWorkIfList = System.Convert.ToUInt32(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.oduDxcSrcWorkIfList + dxcid), 16).ToString();
                GridOtn.Rows[0].Cells["源主时隙"].Value = oduDxcSrcWorkIfList;
                oduDxcSrcProtIfList = System.Convert.ToUInt32(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.oduDxcSrcProtIfList + dxcid), 16).ToString();
                GridOtn.Rows[0].Cells["源备时隙"].Value = oduDxcSrcProtIfList;
                if (DodukIDZheng == oduDxcSinkIfList)
                {
                    var (ifType, subType, srcSlot, srcPort, srcHp, srcLp) = Dxc.TsOtnDxc(oduDxcSrcWorkIfList);
                    strslot = srcSlot.ToString();
                    strport = srcPort.ToString();
                    var (ifType1, subType1, srcSlot1, srcPort1, srcHp1, srcLp1) = Dxc.TsOtnDxc(oduDxcSrcProtIfList);
                    strslotb = srcSlot1.ToString();
                    strportb = srcPort1.ToString();
                    sporttype = Dxc.OdukindexSearch(ip, readcommunity, oduDxcSrcWorkIfList);
                    if (sporttype == "OTN")
                    {
                        sportifindex = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnPhyOtuIfIndex + strslot + "." + strport);
                        sportodukifindex = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnPhyOduIfIndex + strslot + "." + strport);
                        sbportifindex = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnPhyOtuIfIndex + strslotb + "." + strportb);
                        sbportodukifindex = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnPhyOduIfIndex + strslotb + "." + strportb);
                    }
                    if (sporttype == "ANY")
                    {
                        sportifindex = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.anyPhyServIfIndex + strslot + "." + strport);
                    }
                }
                if (DodukIDZheng == oduDxcSrcWorkIfList)
                {
                    var (ifType, subType, srcSlot, srcPort, srcHp, srcLp) = Dxc.TsOtnDxc(oduDxcSinkIfList);
                    strslot = srcSlot.ToString();
                    strport = srcPort.ToString();
                    var (ifType1, subType1, srcSlot1, srcPort1, srcHp1, srcLp1) = Dxc.TsOtnDxc(oduDxcSrcProtIfList);
                    strslotb = srcSlot1.ToString();
                    strportb = srcPort1.ToString();
                    sporttype = Dxc.OdukindexSearch(ip, readcommunity, oduDxcSinkIfList);
                    if (sporttype == "OTN")
                    {
                        sportifindex = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnPhyOtuIfIndex + strslot + "." + strport);
                        sportodukifindex = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnPhyOduIfIndex + strslot + "." + strport);
                        sbportifindex = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnPhyOtuIfIndex + strslotb + "." + strportb);
                        sbportodukifindex = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnPhyOduIfIndex + strslotb + "." + strportb);
                    }
                    if (sporttype == "ANY")
                    {
                        sportifindex = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.anyPhyServIfIndex + strslot + "." + strport);
                    }
                }


                //sportifindex = Dxc.OdukindexSearch(ip, readcommunity, oduDxcSinkIfList);
                GridOtn.Rows[0].Cells["源主接口"].Value = sportifindex;
                GridOtn.Rows[0].Cells["源备接口"].Value = sbportifindex;


                GridOtn.Rows[1].Cells["宿主时隙"].Value = Dxc.TsOtnDxcindex(oduDxcSinkIfList);
                GridOtn.Rows[1].Cells["宿备时隙"].Value = Dxc.TsOtnDxcindex(oduDxcExtraIfList);
                GridOtn.Rows[1].Cells["交叉ID"].Value = Dxc.OduDxcLoopControl(dxcloop);
                GridOtn.Rows[1].Cells["源主时隙"].Value = Dxc.TsOtnDxcindex(oduDxcSrcWorkIfList);
                GridOtn.Rows[1].Cells["源备时隙"].Value = Dxc.TsOtnDxcindex(oduDxcSrcProtIfList);
                GridOtn.Rows[1].Cells["源主接口"].Value = strslot + "-" + strport;
                GridOtn.Rows[1].Cells["源备接口"].Value = strslotb + "-" + strportb;
                string loopctl = "0";
                if (sporttype == "OTN" && LabSportLoop.Checked == true) {

                    loopctl = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnPhyPortLoopState + strslot + "." + strport);
                    GridOtn.Rows[1].Cells["源主接口"].Value = strslot + "-" + strport + "（"+ loopctl + "）";
                    if (loopctl == "2")
                    {
                        GridOtn.Rows[1].Cells["源主接口"].Value = strslot + "-" + strport + "（OTN已系统环回）";
                    }
                    if (loopctl == "0")
                    {
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.otnPhyPortLoopState + strslot + "." + strport, "2", "Integer32");
                        GridOtn.Rows[1].Cells["源主接口"].Value = strslot + "-" + strport + "（OTN系统环回）";
                    }

                }
                if (sporttype == "OTN" && LabSportLoop.Checked == false)
                {
                    loopctl = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnPhyPortLoopState + strslot + "." + strport);
                    if(loopctl == "0"){
                        GridOtn.Rows[1].Cells["源主接口"].Value = strslot + "-" + strport + "（OTN不环回）";
                    }
                    if (loopctl == "1" || loopctl == "2")
                    {
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.otnPhyPortLoopState + strslot + "." + strport, "0", "Integer32");
                        GridOtn.Rows[1].Cells["源主接口"].Value = strslot + "-" + strport + "（OTN取消环回）";
                    }


                }
                if (sporttype == "ANY" && LabSportLoop.Checked == true)
                {
                    loopctl = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.anyPhyPortLoopState + strslot + "." + strport);
                    GridOtn.Rows[1].Cells["源主接口"].Value = strslot + "-" + strport + "（" + loopctl + "）";
                    if (loopctl == "2")
                    {
                        GridOtn.Rows[1].Cells["源主接口"].Value = strslot + "-" + strport + "（ANY已系统环回）";
                    }
                    if (loopctl == "0" )
                    {
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.anyPhyPortLoopState + strslot + "." + strport, "2", "Integer32");
                        GridOtn.Rows[1].Cells["源主接口"].Value = strslot + "-" + strport + "（ANY系统环回）";
                    }



                }
                if (sporttype == "ANY" && LabSportLoop.Checked == false)
                {
                    loopctl = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.anyPhyPortLoopState + strslot + "." + strport);
                    if (loopctl == "0")
                    {
                        GridOtn.Rows[1].Cells["源主接口"].Value = strslot + "-" + strport + "（ANY不环回）";
                    }
                    if (loopctl == "1" || loopctl == "2")
                    {
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.anyPhyPortLoopState + strslot + "." + strport, "0", "Integer32");
                        GridOtn.Rows[1].Cells["源主接口"].Value = strslot + "-" + strport + "（ANY取消环回）";
                    }




                }


                ////业务类型

                string ethIfmediatype = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfMediaType + Dportifindex);
                if (ethIfmediatype == "1") { ethIfmediatype = "自动"; }
                if (ethIfmediatype == "2") { ethIfmediatype = "光口"; }
                if (ethIfmediatype == "3") { ethIfmediatype = "电口"; }
                GridOtn.Rows[2].Cells["宿主接口"].Value = ethIfmediatype;
                GridOtn.Rows[2].Cells["宿备接口"].Value = "";
                GridOtn.Rows[2].Cells["虚拟主接口"].Value = Dxc.AnyPhyServIfTypeValue(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.anyPhyServIfType + VpPort));
                GridOtn.Rows[2].Cells["虚拟备接口"].Value = "";
                GridOtn.Rows[2].Cells["宿主时隙"].Value = Dxc.OduDxcEncMode(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.oduDxcEncMode + dxcid));
                GridOtn.Rows[2].Cells["宿备时隙"].Value = "";
                GridOtn.Rows[2].Cells["交叉ID"].Value = Dxc.OduDxcODUkIfType(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.oduDxcODUkIfType + dxcid));
                GridOtn.Rows[2].Cells["源主时隙"].Value = Dxc.OduDxcServiceType(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.oduDxcServiceType + dxcid));
                GridOtn.Rows[2].Cells["源备时隙"].Value = "";
                if (sporttype == "OTN")
                {
                    GridOtn.Rows[2].Cells["源主接口"].Value = Dxc.AnyPhyServIfTypeValue(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnPhyServIfType + strslot + "." + strport));
                    GridOtn.Rows[2].Cells["源备接口"].Value = Dxc.AnyPhyServIfTypeValue(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnPhyServIfType + strslotb + "." + strportb));
                }
                if (sporttype == "ANY")
                {
                    GridOtn.Rows[2].Cells["源主接口"].Value = Dxc.AnyPhyServIfTypeValue(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.anyPhyServIfType + strslot + "." + strport));
                    GridOtn.Rows[2].Cells["源备接口"].Value = Dxc.AnyPhyServIfTypeValue(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.anyPhyServIfType + strslotb + "." + strportb));
                }
                ///当前告警
                ///
                string DportAlarm = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfOperStatus + Dportifindex);
                GridOtn.Rows[3].Cells["宿主接口"].Value = DportAlarm;
                if (DportAlarm == "1") { GridOtn.Rows[3].Cells["宿主接口"].Value = "up"; }
                if (DportAlarm == "2") { GridOtn.Rows[3].Cells["宿主接口"].Value = "down"; }
                if (DportAlarm == "1")
                {
                    GridOtn.Rows[3].Cells["宿主接口"].Style.BackColor = Color.GreenYellow;
                }
                else
                {
                    GridOtn.Rows[3].Cells["宿主接口"].Style.BackColor = Color.OrangeRed;
                    LabDport.ForeColor = Color.Red;
                }
                GridOtn.Rows[3].Cells["宿备接口"].Value = "";
                //Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.otnIfOTUkAlmMask + DAvport, "ffffffff", "OctetString");
                //Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.otnIfODUkAlmMask + oduDxcSinkIfList, "ffffffff", "OctetString");
                //Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.otnIfODUkAlmMask + oduDxcExtraIfList, "ffffffff", "OctetString");
                //Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.otnIfODUkAlmMask + oduDxcSrcWorkIfList, "ffffffff", "OctetString");
                //Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.otnIfODUkAlmMask + oduDxcSrcProtIfList, "ffffffff", "OctetString");
                //Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.otnIfOTUkAlmMask + sportifindex, "ffffffff", "OctetString");
                //Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.otnIfOTUkAlmMask + sbportifindex, "ffffffff", "OctetString");
                string otnIfOTUkAlmStateVpEth = Alarm.OtuAlarm(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOTUkAlmState + DAvport));
                if (otnIfOTUkAlmStateVpEth.Contains("OK"))
                {
                    GridOtn.Rows[3].Cells["虚拟主接口"].Value = otnIfOTUkAlmStateVpEth;
                    GridOtn.Rows[3].Cells["虚拟主接口"].Style.BackColor = Color.GreenYellow;
                }
                else
                {
                    GridOtn.Rows[3].Cells["虚拟主接口"].Value = otnIfOTUkAlmStateVpEth;
                    GridOtn.Rows[3].Cells["虚拟主接口"].Style.BackColor = Color.OrangeRed;
                    LabDportRx.ForeColor = Color.Red;
                }
                GridOtn.Rows[3].Cells["虚拟备接口"].Value = "";
                string oduDxcSinkIfListAlarm = Alarm.OdukAlarm(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfODUkAlmState + oduDxcSinkIfList));
                if (oduDxcSinkIfListAlarm.Contains("OK"))
                {
                    GridOtn.Rows[3].Cells["宿主时隙"].Value = oduDxcSinkIfListAlarm;
                    GridOtn.Rows[3].Cells["宿主时隙"].Style.BackColor = Color.GreenYellow;

                }
                else
                {
                    GridOtn.Rows[3].Cells["宿主时隙"].Value = oduDxcSinkIfListAlarm;
                    GridOtn.Rows[3].Cells["宿主时隙"].Style.BackColor = Color.OrangeRed;
                    LabDts.ForeColor = Color.Red;
                    LabTsLoop.ForeColor = Color.Red;
                }

                string oduDxcExtraIfListAlarm = Alarm.OdukAlarm(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfODUkAlmState + oduDxcExtraIfList));
                if (oduDxcExtraIfListAlarm.Contains("OK"))
                {
                    GridOtn.Rows[3].Cells["宿备时隙"].Value = oduDxcExtraIfListAlarm;
                    GridOtn.Rows[3].Cells["宿备时隙"].Style.BackColor = Color.GreenYellow;

                }
                else
                {
                    GridOtn.Rows[3].Cells["宿备时隙"].Value = oduDxcExtraIfListAlarm;
                    GridOtn.Rows[3].Cells["宿备时隙"].Style.BackColor = Color.OrangeRed;
                    LabDts.ForeColor = Color.Red;
                    LabTsLoop.ForeColor = Color.Red;
                }
                string oduDxcSrcWorkIfListAlarm = Alarm.OdukAlarm(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfODUkAlmState + oduDxcSrcWorkIfList));
                if (oduDxcSrcWorkIfListAlarm.Contains("OK"))
                {
                    GridOtn.Rows[3].Cells["源主时隙"].Value = oduDxcSrcWorkIfListAlarm;
                    GridOtn.Rows[3].Cells["源主时隙"].Style.BackColor = Color.GreenYellow;

                }
                else
                {
                    GridOtn.Rows[3].Cells["源主时隙"].Value = oduDxcSrcWorkIfListAlarm;
                    GridOtn.Rows[3].Cells["源主时隙"].Style.BackColor = Color.OrangeRed;
                    LabSts.ForeColor = Color.Red;
                    LabStsLab.ForeColor = Color.Red;
                }
                string oduDxcSrcProtIfListAlarm = Alarm.OdukAlarm(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfODUkAlmState + oduDxcSrcProtIfList));
                if (oduDxcSrcProtIfListAlarm.Contains("OK"))
                {
                    GridOtn.Rows[3].Cells["源备时隙"].Value = oduDxcSrcProtIfListAlarm;
                    GridOtn.Rows[3].Cells["源备时隙"].Style.BackColor = Color.GreenYellow;

                }
                else
                {
                    GridOtn.Rows[3].Cells["源备时隙"].Value = oduDxcSrcProtIfListAlarm;
                    GridOtn.Rows[3].Cells["源备时隙"].Style.BackColor = Color.OrangeRed;
                    LabSts.ForeColor = Color.Red;
                    LabStsLab.ForeColor = Color.Red;
                }
                string SAotualarm = Alarm.OtuAlarm(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOTUkAlmState + sportifindex));
                if (SAotualarm.Contains("OK"))
                {
                    GridOtn.Rows[3].Cells["源主接口"].Value = SAotualarm;
                    GridOtn.Rows[3].Cells["源主接口"].Style.BackColor = Color.GreenYellow;

                }
                else
                {
                    GridOtn.Rows[3].Cells["源主接口"].Value = SAotualarm;
                    GridOtn.Rows[3].Cells["源主接口"].Style.BackColor = Color.OrangeRed;
                    LabSPort.ForeColor = Color.Red;
                    LabSportLoop.ForeColor = Color.Red;
                }
                string SBotualarm = Alarm.OtuAlarm(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOTUkAlmState + sbportifindex));
                if (SBotualarm.Contains("OK"))
                {
                    GridOtn.Rows[3].Cells["源备接口"].Value = SBotualarm;
                    GridOtn.Rows[3].Cells["源备接口"].Style.BackColor = Color.GreenYellow;
                    // LabSPort.ForeColor = Color.LightGreen;
                    // LabSportLoop.ForeColor = Color.LightGreen;
                }
                else
                {
                    GridOtn.Rows[3].Cells["源备接口"].Value = SBotualarm;
                    GridOtn.Rows[3].Cells["源备接口"].Style.BackColor = Color.OrangeRed;
                    LabSPort.ForeColor = Color.Red;
                    LabSportLoop.ForeColor = Color.Red;
                }


                ///OPU告警 
                if (ComCusType.Text.Contains("GE/10GE分组OTN业务")|| ComCusType.Text.Contains("GE/10GE透传OTN业务")) {
                    string otnIfOPUkDAportAlmState = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfMtu + Dportifindex);
                    if (otnIfOPUkDAportAlmState.Contains("9600"))
                    {
                        GridOtn.Rows[4].Cells["宿主接口"].Value = "MTU:" + otnIfOPUkDAportAlmState;
                        GridOtn.Rows[4].Cells["宿主接口"].Style.BackColor = Color.GreenYellow;

                    }
                    else
                    {
                        GridOtn.Rows[4].Cells["宿主接口"].Value = "MTU:" + otnIfOPUkDAportAlmState;
                        GridOtn.Rows[4].Cells["宿主接口"].Style.BackColor = Color.Yellow;

                    }
                    GridOtn.Rows[4].Cells["宿备接口"].Value = "";
                }

                string otnIfOPUkVPETHAlmState = Alarm.OpukAlarm(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkAlmState + DAvport));
                if (otnIfOPUkVPETHAlmState.Contains("OK"))
                {
                    GridOtn.Rows[4].Cells["虚拟主接口"].Value = otnIfOPUkVPETHAlmState;
                    GridOtn.Rows[4].Cells["虚拟主接口"].Style.BackColor = Color.GreenYellow;

                }
                else
                {
                    GridOtn.Rows[4].Cells["虚拟主接口"].Value = otnIfOPUkVPETHAlmState;
                    GridOtn.Rows[4].Cells["虚拟主接口"].Style.BackColor = Color.Yellow;

                }
                GridOtn.Rows[4].Cells["虚拟备接口"].Value = "";
                string oduDxcSinkIfListOpuAlarm = Alarm.OpukAlarm(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkAlmState + oduDxcSinkIfList));
                if (oduDxcSinkIfListOpuAlarm.Contains("OK"))
                {
                    GridOtn.Rows[4].Cells["宿主时隙"].Value = oduDxcSinkIfListOpuAlarm;
                    GridOtn.Rows[4].Cells["宿主时隙"].Style.BackColor = Color.GreenYellow;

                }
                else
                {
                    GridOtn.Rows[4].Cells["宿主时隙"].Value = oduDxcSinkIfListOpuAlarm;
                    GridOtn.Rows[4].Cells["宿主时隙"].Style.BackColor = Color.Yellow;

                }
                string oduDxcExtraIfListOpuAlarm = Alarm.OpukAlarm(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkAlmState + oduDxcExtraIfList));
                if (otnIfOPUkVPETHAlmState.Contains("OK"))
                {
                    GridOtn.Rows[4].Cells["宿备时隙"].Value = oduDxcExtraIfListOpuAlarm;
                    GridOtn.Rows[4].Cells["宿备时隙"].Style.BackColor = Color.GreenYellow;

                }
                else
                {
                    GridOtn.Rows[4].Cells["宿备时隙"].Value = oduDxcExtraIfListOpuAlarm;
                    GridOtn.Rows[4].Cells["宿备时隙"].Style.BackColor = Color.Yellow;

                }
                string oduDxcSrcWorkIfListOpuAlarm = Alarm.OpukAlarm(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkAlmState + oduDxcSrcWorkIfList));
                if (oduDxcSrcWorkIfListOpuAlarm.Contains("OK"))
                {
                    GridOtn.Rows[4].Cells["源主时隙"].Value = oduDxcSrcWorkIfListOpuAlarm;
                    GridOtn.Rows[4].Cells["源主时隙"].Style.BackColor = Color.GreenYellow;

                }
                else
                {
                    GridOtn.Rows[4].Cells["源主时隙"].Value = oduDxcSrcWorkIfListOpuAlarm;
                    GridOtn.Rows[4].Cells["源主时隙"].Style.BackColor = Color.Yellow;

                }
                string oduDxcSrcProtIfListOpuAlarm = Alarm.OpukAlarm(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkAlmState + oduDxcSrcProtIfList));
                if (oduDxcSrcWorkIfListOpuAlarm.Contains("OK"))
                {
                    GridOtn.Rows[4].Cells["源备时隙"].Value = oduDxcSrcProtIfListOpuAlarm;
                    GridOtn.Rows[4].Cells["源备时隙"].Style.BackColor = Color.GreenYellow;

                }
                else
                {
                    GridOtn.Rows[4].Cells["源备时隙"].Value = oduDxcSrcProtIfListOpuAlarm;
                    GridOtn.Rows[4].Cells["源备时隙"].Style.BackColor = Color.Yellow;

                }

                string SAopualarm = Alarm.OpukAlarm(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkAlmState + sportifindex));
                if (SAopualarm.Contains("OK"))
                {
                    GridOtn.Rows[4].Cells["源主接口"].Value = SAopualarm;
                    GridOtn.Rows[4].Cells["源主接口"].Style.BackColor = Color.GreenYellow;

                }
                else
                {
                    GridOtn.Rows[4].Cells["源主接口"].Value = SAopualarm;
                    GridOtn.Rows[4].Cells["源主接口"].Style.BackColor = Color.Yellow;

                }
                string SBopualarm = Alarm.OpukAlarm(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkAlmState + sbportifindex));
                if (SBopualarm.Contains("OK"))
                {
                    GridOtn.Rows[4].Cells["源备接口"].Value = SBopualarm;
                    GridOtn.Rows[4].Cells["源备接口"].Style.BackColor = Color.GreenYellow;

                }
                else
                {
                    GridOtn.Rows[4].Cells["源备接口"].Value = SBopualarm;
                    GridOtn.Rows[4].Cells["源备接口"].Style.BackColor = Color.Yellow;

                }
                ///光模块速率
                ///
                GridOtn.Rows[5].Cells["宿主接口"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModBitRate + DAvport) + "Mbps";
                GridOtn.Rows[5].Cells["宿备接口"].Value = "";
                GridOtn.Rows[5].Cells["虚拟主接口"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModBitRate + DAvport) + "Mbps";
                GridOtn.Rows[5].Cells["虚拟备接口"].Value = "";
                GridOtn.Rows[5].Cells["源主接口"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModBitRate + sportifindex) + "Mbps";
                GridOtn.Rows[5].Cells["源备接口"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModBitRate + sbportifindex) + "Mbps";
                ///收光
                GridOtn.Rows[6].Cells["宿主接口"].Value = float.Parse(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModRxPower + DAvport)) / 100;
                if (GridOtn.Rows[6].Cells["宿主接口"].Value.ToString() == "-100") { GridOtn.Rows[3].Cells["宿主接口"].Value = "LOS"; LabDport.ForeColor = Color.Red; }
                if (GridOtn.Rows[6].Cells["宿主接口"].Value.ToString() == "-100") { GridOtn.Rows[3].Cells["宿主接口"].Style.BackColor = Color.OrangeRed; }

                GridOtn.Rows[6].Cells["宿备接口"].Value = "";
                GridOtn.Rows[6].Cells["虚拟主接口"].Value = float.Parse(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModRxPower + DAvport)) / 100;
                GridOtn.Rows[6].Cells["虚拟备接口"].Value = "";
                GridOtn.Rows[6].Cells["源主接口"].Value = float.Parse(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModRxPower + sportifindex)) / 100;
                GridOtn.Rows[6].Cells["源备接口"].Value = float.Parse(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModRxPower + sbportifindex)) / 100;
                //发送PT
                GridOtn.Rows[7].Cells["虚拟主接口"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtTx + DodukIDZheng));
                GridOtn.Rows[7].Cells["虚拟备接口"].Value = "";
                GridOtn.Rows[7].Cells["宿主时隙"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtTx + oduDxcSinkIfList));
                GridOtn.Rows[7].Cells["宿备时隙"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtTx + oduDxcExtraIfList));
                GridOtn.Rows[7].Cells["源主时隙"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtTx + oduDxcSrcWorkIfList));
                GridOtn.Rows[7].Cells["源备时隙"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtTx + oduDxcSrcProtIfList));
                GridOtn.Rows[7].Cells["源主接口"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtTx + sportifindex));
                GridOtn.Rows[7].Cells["源备接口"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtTx + sbportifindex));
                //期望PT
                GridOtn.Rows[8].Cells["虚拟主接口"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtExp + DodukIDZheng));
                GridOtn.Rows[8].Cells["虚拟备接口"].Value = "";
                GridOtn.Rows[8].Cells["宿主时隙"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtExp + oduDxcSinkIfList));
                GridOtn.Rows[8].Cells["宿备时隙"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtExp + oduDxcExtraIfList));
                GridOtn.Rows[8].Cells["源主时隙"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtExp + oduDxcSrcWorkIfList));
                GridOtn.Rows[8].Cells["源备时隙"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtExp + oduDxcSrcProtIfList));
                GridOtn.Rows[8].Cells["源主接口"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtExp + sportifindex));
                GridOtn.Rows[8].Cells["源备接口"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtExp + sbportifindex));
                //接收PT
                GridOtn.Rows[9].Cells["虚拟主接口"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtRx + DodukIDZheng));
                GridOtn.Rows[9].Cells["虚拟备接口"].Value = "";
                GridOtn.Rows[9].Cells["宿主时隙"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtRx + oduDxcSinkIfList));
                GridOtn.Rows[9].Cells["宿备时隙"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtRx + oduDxcExtraIfList));
                GridOtn.Rows[9].Cells["源主时隙"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtRx + oduDxcSrcWorkIfList));
                GridOtn.Rows[9].Cells["源备时隙"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtRx + oduDxcSrcProtIfList));
                GridOtn.Rows[9].Cells["源主接口"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtRx + sportifindex));
                GridOtn.Rows[9].Cells["源备接口"].Value = Alarm.OtnIfOPUkPt(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkPtRx + sbportifindex));
                //发送MSI
                GridOtn.Rows[10].Cells["虚拟主接口"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiTx + DodukIDZheng);
                GridOtn.Rows[10].Cells["虚拟备接口"].Value = "";
                GridOtn.Rows[10].Cells["宿主时隙"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiTx + oduDxcSinkIfList);
                GridOtn.Rows[10].Cells["宿备时隙"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiTx + oduDxcExtraIfList);
                GridOtn.Rows[10].Cells["源主时隙"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiTx + oduDxcSrcWorkIfList);
                GridOtn.Rows[10].Cells["源备时隙"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiTx + oduDxcSrcProtIfList);
                GridOtn.Rows[10].Cells["源主接口"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiTx + sportifindex);
                GridOtn.Rows[10].Cells["源备接口"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiTx + sbportifindex);
                //期望MSI
                GridOtn.Rows[11].Cells["虚拟主接口"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiExp + DodukIDZheng);
                GridOtn.Rows[11].Cells["虚拟备接口"].Value = "";
                GridOtn.Rows[11].Cells["宿主时隙"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiExp + oduDxcSinkIfList);
                GridOtn.Rows[11].Cells["宿备时隙"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiExp + oduDxcExtraIfList);
                GridOtn.Rows[11].Cells["源主时隙"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiExp + oduDxcSrcWorkIfList);
                GridOtn.Rows[11].Cells["源备时隙"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiExp + oduDxcSrcProtIfList);
                GridOtn.Rows[11].Cells["源主接口"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiExp + sportifindex);
                GridOtn.Rows[11].Cells["源备接口"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiExp + sbportifindex);
                //期望MSI     
                GridOtn.Rows[12].Cells["虚拟主接口"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiRx + DodukIDZheng);
                GridOtn.Rows[12].Cells["虚拟备接口"].Value = "";
                GridOtn.Rows[12].Cells["宿主时隙"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiRx + oduDxcSinkIfList);
                GridOtn.Rows[12].Cells["宿备时隙"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiRx + oduDxcExtraIfList);
                GridOtn.Rows[12].Cells["源主时隙"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiRx + oduDxcSrcWorkIfList);
                GridOtn.Rows[12].Cells["源备时隙"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiRx + oduDxcSrcProtIfList);
                GridOtn.Rows[12].Cells["源主接口"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiRx + sportodukifindex);
                GridOtn.Rows[12].Cells["源备接口"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.otnIfOPUkMsiRx + sbportodukifindex);
                //带宽
                if (ComCusType.Text.Contains("GE/10GE分组OTN业务"))
                {
                    try
                    {
                        float ethTxBand = float.Parse(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.rtDownBandWidth + Dport)) / 1000;
                        GridOtn.Rows[13].Cells["宿主接口"].Value = ethTxBand + "Mbps";
                        if (ethTxBand == 0)
                        {
                            LabcusRx.ForeColor = Color.Red;
                            GridOtn.Rows[13].Cells["宿主接口"].Style.BackColor = Color.OrangeRed;

                        }
                        else
                        {
                            LabcusRx.ForeColor = Color.GreenYellow;
                            GridOtn.Rows[13].Cells["宿主接口"].Style.BackColor = Color.GreenYellow;
                        }
                        float ethRxBand = float.Parse(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.rtUpBandWidth + Dport)) / 1000;

                        GridOtn.Rows[14].Cells["宿主接口"].Value = ethRxBand + "Mbps";
                        if (ethRxBand == 0)
                        {
                            LabcusTx.ForeColor = Color.Red;
                            GridOtn.Rows[14].Cells["宿主接口"].Style.BackColor = Color.OrangeRed;

                        }
                        else
                        {
                            LabcusTx.ForeColor = Color.GreenYellow;
                            GridOtn.Rows[14].Cells["宿主接口"].Style.BackColor = Color.GreenYellow;
                        }

                    }
                    catch
                    {
                        GridOtn.Rows[13].Cells["宿主接口"].Value = "请求失败";
                        GridOtn.Rows[13].Cells["宿主接口"].Style.BackColor = Color.OrangeRed;
                        GridOtn.Rows[14].Cells["宿主接口"].Value = "请求失败";
                        GridOtn.Rows[14].Cells["宿主接口"].Style.BackColor = Color.OrangeRed;

                    }

                }
                if (ComCusType.Text.Contains("GE/10GE分组OTN业务")) {
                    string TPID = "";
                    TPID = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfVlanTpId + Dportifindex);
                    GridOtn.Rows[15].Cells["宿主接口"].Value = TPID;
                    if (TPID == "1") { GridOtn.Rows[15].Cells["宿主接口"].Value = "0x8100"; }
                    if (TPID == "2") { GridOtn.Rows[15].Cells["宿主接口"].Value = "0x88a8"; }
                    if (TPID == "3") { GridOtn.Rows[15].Cells["宿主接口"].Value = "0x9100"; }
                    if (TPID == "4") { GridOtn.Rows[15].Cells["宿主接口"].Value = "any0x8100"; }
                    if (TPID == "5") { GridOtn.Rows[15].Cells["宿主接口"].Value = "any0x88a8"; }
                    if (TPID == "6") { GridOtn.Rows[15].Cells["宿主接口"].Value = "any0x9100"; }
                }


                if (GridOtn.Rows[0].Cells["宿备时隙"].Value.ToString() == "0" || GridOtn.Rows[0].Cells["宿备时隙"].Value.ToString() == "初始化" || GridOtn.Rows[0].Cells["宿备时隙"].Value.ToString() == "")
                {
                    GridOtn.Columns.Remove("宿备时隙");
                }
                if (GridOtn.Rows[0].Cells["源备时隙"].Value.ToString() == "0" || GridOtn.Rows[0].Cells["源备时隙"].Value.ToString() == "初始化" || GridOtn.Rows[0].Cells["源备时隙"].Value.ToString() == "")
                {
                    GridOtn.Columns.Remove("源备时隙");
                }
                if (GridOtn.Rows[0].Cells["宿备接口"].Value.ToString() == "0" || GridOtn.Rows[0].Cells["宿备接口"].Value.ToString() == "初始化" || GridOtn.Rows[0].Cells["宿备接口"].Value.ToString() == "")
                {
                    GridOtn.Columns.Remove("宿备接口");
                }
                if (GridOtn.Rows[0].Cells["虚拟备接口"].Value.ToString() == "0" || GridOtn.Rows[0].Cells["虚拟备接口"].Value.ToString() == "初始化" || GridOtn.Rows[0].Cells["虚拟备接口"].Value.ToString() == "")
                {
                    GridOtn.Columns.Remove("虚拟备接口");
                }
                if (GridOtn.Rows[0].Cells["源备接口"].Value.ToString() == "0" || GridOtn.Rows[0].Cells["源备接口"].Value.ToString() == "初始化" || GridOtn.Rows[0].Cells["源备接口"].Value.ToString() == "")
                {
                    GridOtn.Columns.Remove("源备接口");
                }
                MessageBox.Show("排查完成");
                BtnPtoP.Enabled = true;
            }
            catch {
                MessageBox.Show("查询异常，请检查接口是否配置正确后再此尝试");
                BtnPtoP.Enabled = true;

            }

        }
        private void PtoPGuZhangDingWei(object str) {
            try
            {

                BtnPtoP.Enabled = false;
                LabcusTx.ForeColor = Color.LightGreen;
                LabcusRx.ForeColor = Color.LightGreen;
                LabDport.ForeColor = Color.LightGreen;
                LabDportRx.ForeColor = Color.LightGreen;
                LabDportTx.ForeColor = Color.LightGreen;
                LabDportRx.ForeColor = Color.LightGreen;
                LabDts.ForeColor = Color.LightGreen;
                LabTsLoop.ForeColor = Color.LightGreen;
                LabSts.ForeColor = Color.LightGreen;
                LabStsLab.ForeColor = Color.LightGreen;
                LabSPort.ForeColor = Color.LightGreen;
                LabSportLoop.ForeColor = Color.LightGreen;
                string ip = str.ToString();
                string readcommunity = TextReadMu.Text;
                string writecommunity = TextWriteMu.Text;

                int timeout = 2000;
                int retry = 2;
                if (ComDslotP.Text == "" || ComDportP.Text == "" || ComVcgSlotD.Text == "" || ComVcgPortD.Text == "" || ComCusType.Text == "")
                {
                    MessageBox.Show("请输入接口等信息在此尝试");
                    BtnPtoP.Enabled = true;
                    return;
                }
                string Dport = ComDslotP.Text + "." + ComDportP.Text;
                string Vcgport = ComVcgSlotD.Text + "." + ComVcgPortD.Text;
                GridOtn.Rows[0].Cells["宿接口"].Value = "APP版本";
                GridOtn.Rows[0].Cells["宿接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.appVer);
                if (GridOtn.Rows[0].Cells["宿接口值"].Value.ToString().Contains("Request has reached maximum retries"))
                {
                    GridOtn.Rows[0].Cells["宿接口值"].Value = "连接失败";
                    GridOtn.Rows[0].Cells["宿接口值"].Style.BackColor = Color.OrangeRed;
                    BtnPtoP.Enabled = true;
                    return;
                }

                GridOtn.Rows[1].Cells["宿接口"].Value = "FPGA版本";
                GridOtn.Rows[1].Cells["宿接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.fpgaVer);

                GridOtn.Rows[2].Cells["宿接口"].Value = "端口号";
                GridOtn.Rows[2].Cells["宿接口值"].Value = ComDslotP.Text + "/" + ComDportP.Text;

                GridOtn.Rows[3].Cells["宿接口"].Value = "接口索引";
                GridOtn.Rows[3].Cells["宿接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.EthIfIndex + Dport);
                string Dportifindex = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.EthIfIndex + Dport);
                if (Dportifindex.Contains("S"))
                {
                    GridOtn.Rows[3].Cells["宿接口值"].Value = "获取失败";
                    BtnPtoP.Enabled = true;
                    return;
                }
                GridOtn.Rows[4].Cells["宿接口"].Value = "接口类型";
                string ethIfmediatype = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfMediaType + Dportifindex);
                if (ethIfmediatype == "1") { ethIfmediatype = "自动"; }
                if (ethIfmediatype == "2") { ethIfmediatype = "光口"; }
                if (ethIfmediatype == "3") { ethIfmediatype = "电口"; }
                GridOtn.Rows[4].Cells["宿接口值"].Value = ethIfmediatype;

                if (ethIfmediatype.Contains("S"))
                {
                    BtnPtoP.Enabled = true;
                    return;
                }


                GridOtn.Rows[5].Cells["宿接口"].Value = "工作状态";
                GridOtn.Rows[5].Cells["宿接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfOperStatus + Dportifindex);
                if (GridOtn.Rows[5].Cells["宿接口值"].Value.ToString() == "1") { GridOtn.Rows[5].Cells["宿接口值"].Value = "up"; }
                if (GridOtn.Rows[5].Cells["宿接口值"].Value.ToString() == "2") { GridOtn.Rows[5].Cells["宿接口值"].Value = "down"; }
                if (GridOtn.Rows[5].Cells["宿接口值"].Value.ToString() == "up")
                {
                    GridOtn.Rows[5].Cells["宿接口值"].Style.BackColor = Color.GreenYellow;
                    LabDport.ForeColor = Color.LightGreen;

                }
                else
                {
                    GridOtn.Rows[5].Cells["宿接口值"].Style.BackColor = Color.OrangeRed;
                    LabDport.ForeColor = Color.Red;
                }

                GridOtn.Rows[6].Cells["宿接口"].Value = "自协商";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfAutoNegAdminStatus + Dportifindex) == "1") { GridOtn.Rows[6].Cells["宿接口值"].Value = "使能"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfAutoNegAdminStatus + Dportifindex) == "2") { GridOtn.Rows[6].Cells["宿接口值"].Value = "禁止"; }

                GridOtn.Rows[7].Cells["宿接口"].Value = "双工模式";
                GridOtn.Rows[7].Cells["宿接口值"].Value = Dxc.MAUMib(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfMauType + Dportifindex));

                GridOtn.Rows[8].Cells["宿接口"].Value = "VLAN";
                GridOtn.Rows[8].Cells["宿接口值"].Value = "获取起来很麻烦";

                GridOtn.Rows[9].Cells["宿接口"].Value = "TPID";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfVlanTpId + Dportifindex) == "1") { GridOtn.Rows[9].Cells["宿接口值"].Value = "0x8100"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfVlanTpId + Dportifindex) == "2") { GridOtn.Rows[9].Cells["宿接口值"].Value = "0x88a8"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfVlanTpId + Dportifindex) == "3") { GridOtn.Rows[9].Cells["宿接口值"].Value = "0x9100"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfVlanTpId + Dportifindex) == "4") { GridOtn.Rows[9].Cells["宿接口值"].Value = "any0x8100"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfVlanTpId + Dportifindex) == "5") { GridOtn.Rows[9].Cells["宿接口值"].Value = "any0x88a8"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfVlanTpId + Dportifindex) == "6") { GridOtn.Rows[9].Cells["宿接口值"].Value = "any0x9100"; }



                GridOtn.Rows[10].Cells["宿接口"].Value = "MTU";
                GridOtn.Rows[10].Cells["宿接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.ethIfMtu + Dportifindex);

                GridOtn.Rows[11].Cells["宿接口"].Value = "光模块在位";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optSfpPresent + Dportifindex) == "1") { GridOtn.Rows[11].Cells["宿接口值"].Value = "在位"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optSfpPresent + Dportifindex) == "2") { GridOtn.Rows[11].Cells["宿接口值"].Value = "不在位"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optSfpPresent + Dportifindex) == "3") { GridOtn.Rows[11].Cells["宿接口值"].Value = "不支持"; }

                GridOtn.Rows[12].Cells["宿接口"].Value = "速率(Mbps)";
                GridOtn.Rows[12].Cells["宿接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optBitRate + Dportifindex);

                GridOtn.Rows[13].Cells["宿接口"].Value = "光电类型";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optFiberOrCopperType + Dportifindex) == "1") { GridOtn.Rows[13].Cells["宿接口值"].Value = "光模块"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optFiberOrCopperType + Dportifindex) == "2") { GridOtn.Rows[13].Cells["宿接口值"].Value = "电模块"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optFiberOrCopperType + Dportifindex) == "3") { GridOtn.Rows[13].Cells["宿接口值"].Value = "Unkown"; }


                GridOtn.Rows[14].Cells["宿接口"].Value = "激光状态";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optLaserStatus + Dportifindex) == "1") { GridOtn.Rows[14].Cells["宿接口值"].Value = "已关闭"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optLaserStatus + Dportifindex) == "2") { GridOtn.Rows[14].Cells["宿接口值"].Value = "已打开"; }


                GridOtn.Rows[15].Cells["宿接口"].Value = "单双纤";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optSingleDouble + Dportifindex) == "1") { GridOtn.Rows[15].Cells["宿接口值"].Value = "单纤"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optSingleDouble + Dportifindex) == "2") { GridOtn.Rows[15].Cells["宿接口值"].Value = "双纤"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optSingleDouble + Dportifindex) == "3") { GridOtn.Rows[15].Cells["宿接口值"].Value = "Unkown"; }


                GridOtn.Rows[16].Cells["宿接口"].Value = "距离(Km)";
                GridOtn.Rows[16].Cells["宿接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optDistance + Dportifindex);

                GridOtn.Rows[17].Cells["宿接口"].Value = "波长";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optWaveLength + Dportifindex) == "1") { GridOtn.Rows[17].Cells["宿接口值"].Value = "1310nm"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optWaveLength + Dportifindex) == "2") { GridOtn.Rows[17].Cells["宿接口值"].Value = "1550nm"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optWaveLength + Dportifindex) == "3") { GridOtn.Rows[17].Cells["宿接口值"].Value = "Unkown"; }



                GridOtn.Rows[18].Cells["宿接口"].Value = "发光功率";
                GridOtn.Rows[18].Cells["宿接口值"].Value = float.Parse(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optTxPower + Dportifindex)) / 100;

                GridOtn.Rows[19].Cells["宿接口"].Value = "收光功率";
                GridOtn.Rows[19].Cells["宿接口值"].Value = float.Parse(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optRxPower + Dportifindex)) / 100;

                GridOtn.Rows[20].Cells["宿接口"].Value = "TX带宽";
                float ethTxBand = float.Parse(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.rtDownBandWidth + Dport)) / 1000;
                GridOtn.Rows[20].Cells["宿接口值"].Value = ethTxBand + "Mbps";
                if (ethTxBand == 0)
                {
                    LabcusRx.ForeColor = Color.Red;
                    GridOtn.Rows[20].Cells["宿接口值"].Style.BackColor = Color.OrangeRed;

                }
                else
                {
                    LabcusRx.ForeColor = Color.GreenYellow;
                    GridOtn.Rows[20].Cells["宿接口值"].Style.BackColor = Color.GreenYellow;
                }
                GridOtn.Rows[21].Cells["宿接口"].Value = "RX带宽";
                float ethRxBand = float.Parse(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.rtUpBandWidth + Dport)) / 1000;

                GridOtn.Rows[21].Cells["宿接口值"].Value = ethRxBand + "Mbps";
                if (ethRxBand == 0)
                {
                    LabcusTx.ForeColor = Color.Red;
                    GridOtn.Rows[21].Cells["宿接口值"].Style.BackColor = Color.OrangeRed;

                }
                else
                {
                    LabcusTx.ForeColor = Color.GreenYellow;
                    GridOtn.Rows[21].Cells["宿接口值"].Style.BackColor = Color.GreenYellow;
                }
                GridOtn.Rows[22].Cells["宿接口"].Value = "双模端口模式";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.eosServiceMatchType + Dport) == "1") { GridOtn.Rows[22].Cells["宿接口值"].Value = "NOOP模式"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.eosServiceMatchType + Dport) == "2") { GridOtn.Rows[22].Cells["宿接口值"].Value = "Port模式"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.eosServiceMatchType + Dport) == "3") { GridOtn.Rows[22].Cells["宿接口值"].Value = "VLAN模式"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.eosServiceMatchType + Dport) == "4") { GridOtn.Rows[22].Cells["宿接口值"].Value = "MPLS模式"; }





                GridOtn.Rows[0].Cells["VCG接口"].Value = "接口";
                GridOtn.Rows[0].Cells["VCG接口值"].Value = ComVcgSlotD.Text + "/" + ComVcgPortD.Text;

                GridOtn.Rows[1].Cells["VCG接口"].Value = "接口索引";
                GridOtn.Rows[1].Cells["VCG接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortIfIndex + Vcgport);
                string VcgPortIfindex = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortIfIndex + Vcgport);

                GridOtn.Rows[2].Cells["VCG接口"].Value = "VC颗粒";
                string VC = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortBandwidthGranularity + VcgPortIfindex);
                if (VC == "4") { GridOtn.Rows[2].Cells["VCG接口值"].Value = "VC4"; }
                if (VC == "2") { GridOtn.Rows[2].Cells["VCG接口值"].Value = "VC3"; }
                if (VC == "1") { GridOtn.Rows[2].Cells["VCG接口值"].Value = "VC12"; }

                GridOtn.Rows[3].Cells["VCG接口"].Value = "传输协议";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortTransmissionProtocol + VcgPortIfindex) == "1") { GridOtn.Rows[3].Cells["VCG接口值"].Value = "EthOverSDH"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortTransmissionProtocol + VcgPortIfindex) == "2") { GridOtn.Rows[3].Cells["VCG接口值"].Value = "EthOverPDH"; }

                GridOtn.Rows[4].Cells["VCG接口"].Value = "绑定时隙数量";
                GridOtn.Rows[4].Cells["VCG接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortChannelMemberNum + VcgPortIfindex);
                int vcgPortChanneMemberNum = int.Parse(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortChannelMemberNum + VcgPortIfindex));

                GridOtn.Rows[5].Cells["VCG接口"].Value = "LCAS状态";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortLcasEn + VcgPortIfindex) == "1") { GridOtn.Rows[5].Cells["VCG接口值"].Value = "使能"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortLcasEn + VcgPortIfindex) == "2") { GridOtn.Rows[5].Cells["VCG接口值"].Value = "禁止"; }



                GridOtn.Rows[6].Cells["VCG接口"].Value = "VlanId";
                GridOtn.Rows[6].Cells["VCG接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortVlanId + VcgPortIfindex);

                GridOtn.Rows[7].Cells["VCG接口"].Value = "Vlan模式";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortVlanMode + VcgPortIfindex) == "1") { GridOtn.Rows[7].Cells["VCG接口值"].Value = "untaged"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortVlanMode + VcgPortIfindex) == "2") { GridOtn.Rows[7].Cells["VCG接口值"].Value = "taged"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortVlanMode + VcgPortIfindex) == "3") { GridOtn.Rows[7].Cells["VCG接口值"].Value = "stack"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortVlanMode + VcgPortIfindex) == "7") { GridOtn.Rows[7].Cells["VCG接口值"].Value = "transparent"; }



                GridOtn.Rows[8].Cells["VCG接口"].Value = "Tx通道数";
                GridOtn.Rows[8].Cells["VCG接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortTxChannelNum + VcgPortIfindex);

                GridOtn.Rows[9].Cells["VCG接口"].Value = "Rx通道数";
                GridOtn.Rows[9].Cells["VCG接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortRxChannelNum + VcgPortIfindex);


                if (VC == "1")
                {
                    GridOtn.Rows[10].Cells["VCG接口"].Value = "V5字节";
                    if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgTxV5 + VcgPortIfindex) == "13") { GridOtn.Rows[10].Cells["VCG接口值"].Value = "0x0d使用扩展标签"; } else { GridOtn.Rows[10].Cells["VCG接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgTxV5 + VcgPortIfindex); }


                }
                else
                {
                    GridOtn.Rows[10].Cells["VCG接口"].Value = "C2字节";
                    GridOtn.Rows[10].Cells["VCG接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgTxC2 + VcgPortIfindex);
                    if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgTxC2 + VcgPortIfindex) == "2") { GridOtn.Rows[10].Cells["VCG接口值"].Value = "TUG结构"; }
                    if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgTxC2 + VcgPortIfindex) == "15") { GridOtn.Rows[10].Cells["VCG接口值"].Value = "GFP映射"; }
                    if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgTxC2 + VcgPortIfindex) == "0") { GridOtn.Rows[10].Cells["VCG接口值"].Value = "UNEQ未装载"; }
                    if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgTxC2 + VcgPortIfindex) == "17") { GridOtn.Rows[10].Cells["VCG接口值"].Value = "VC-AIS"; }


                }

                GridOtn.Rows[11].Cells["VCG接口"].Value = "当前告警";
                Thread.Sleep(1000);
                GridOtn.Rows[11].Cells["VCG接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgPortAlmStatus + VcgPortIfindex);
                if (GridOtn.Rows[11].Cells["VCG接口值"].Value.ToString() == "00000000")
                {
                    GridOtn.Rows[11].Cells["VCG接口值"].Value = "OK";
                    GridOtn.Rows[11].Cells["VCG接口值"].Style.BackColor = Color.GreenYellow;

                }
                else
                {
                    GridOtn.Rows[11].Cells["VCG接口值"].Style.BackColor = Color.OrangeRed;
                    LabDport.ForeColor = Color.Red;
                    GridOtn.Rows[11].Cells["VCG接口值"].Value = Alarm.VcgAlarm(GridOtn.Rows[11].Cells["VCG接口值"].Value.ToString());
                }


                GridOtn.Rows[12].Cells["VCG接口"].Value = "TxVlan动作";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgTxChange + VcgPortIfindex) == "1") { GridOtn.Rows[12].Cells["VCG接口值"].Value = "不改变"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgTxChange + VcgPortIfindex) == "2") { GridOtn.Rows[12].Cells["VCG接口值"].Value = "添加"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgTxChange + VcgPortIfindex) == "3") { GridOtn.Rows[12].Cells["VCG接口值"].Value = "修改"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgTxChange + VcgPortIfindex) == "4") { GridOtn.Rows[12].Cells["VCG接口值"].Value = "删除"; }


                GridOtn.Rows[13].Cells["VCG接口"].Value = "TxVlanID";
                GridOtn.Rows[13].Cells["VCG接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgTxVid + VcgPortIfindex);

                GridOtn.Rows[14].Cells["VCG接口"].Value = "RxVlan动作";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgRxChange + VcgPortIfindex) == "1") { GridOtn.Rows[14].Cells["VCG接口值"].Value = "不改变"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgRxChange + VcgPortIfindex) == "2") { GridOtn.Rows[14].Cells["VCG接口值"].Value = "添加"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgRxChange + VcgPortIfindex) == "3") { GridOtn.Rows[14].Cells["VCG接口值"].Value = "修改"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgRxChange + VcgPortIfindex) == "4") { GridOtn.Rows[14].Cells["VCG接口值"].Value = "删除"; }

                GridOtn.Rows[15].Cells["VCG接口"].Value = "RxVlanID";
                GridOtn.Rows[15].Cells["VCG接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.vcgRxVid + VcgPortIfindex);


                GridOtn.Rows[16].Cells["VCG接口"].Value = "绑定ETH接口";
                GridOtn.Rows[16].Cells["VCG接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.eosServiceEthPort + VcgPortIfindex);

                GridOtn.Rows[17].Cells["VCG接口"].Value = "绑定VLAN";
                GridOtn.Rows[17].Cells["VCG接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.eosServiceVlanID + VcgPortIfindex);
                Thread Vcgband = new Thread(new ParameterizedThreadStart(VCGband));
                Vcgband.Start(VcgPortIfindex);
                GridOtn.Rows[18].Cells["VCG接口"].Value = "Tx带宽";
                GridOtn.Rows[18].Cells["VCG接口值"].Value = "需要5秒钟";
                GridOtn.Rows[19].Cells["VCG接口"].Value = "Rx带宽";
                GridOtn.Rows[19].Cells["VCG接口值"].Value = "需要5秒钟";



                string dts = "";
                string pathidts = "";
                string sts = "";
                string sportsdh = "";
                string sportsdhifindex = "";
                string tsloop = "";
                string tsloops = "";

                LabTsLoop.ForeColor = Color.LightGreen;
                LabStsLab.ForeColor = Color.LightGreen;
                LabSportLoop.ForeColor = Color.LightGreen;
                LabSts.ForeColor = Color.LightGreen;
                LabSPort.ForeColor = Color.LightGreen;
                LabDts.ForeColor = Color.LightGreen;
                for (int i = 0; i < vcgPortChanneMemberNum; i++)
                {
                    dts = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.hpIfIndex + VcgPortIfindex + "." + (i + 1).ToString());
                    pathidts = Dxc.TsPathIdSearch(ip, readcommunity, dts, VC);
                    tsloops = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.tsDxcloopControlOid + pathidts);


                    if (LabTsLoop.Checked == true && tsloops == "0")
                    {
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.tsDxcFpmMonOid + pathidts, "1", "Integer32");
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.tsDxcloopControlOid + pathidts, "1", "Integer32");
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.tsDxcUnLoopTimeDelayOid + pathidts, "5", "Integer32");

                        tsloop = "双向环回";
                    }
                    if (LabTsLoop.Checked == true && tsloops == "1")
                    {
                        tsloop = "双向环回";

                    }
                    if (LabTsLoop.Checked == false && tsloops == "1")
                    {
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.tsDxcFpmMonOid + pathidts, "1", "Integer32");
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.tsDxcloopControlOid + pathidts, "0", "Integer32");
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.tsDxcUnLoopTimeDelayOid + pathidts, "5", "Integer32");
                        tsloop = "不环回";
                    }
                    if (LabTsLoop.Checked == false && tsloops == "0")
                    {
                        tsloop = "不环回";
                    }
                }
                if (LabTsLoop.Checked == true && tsloops == "0")
                {
                    Thread PtoP = new Thread(new ParameterizedThreadStart(PtoPGuZhangDingWei));
                    PtoP.Start(TextDxcIp.Text);
                    BtnPtoP.Enabled = true;
                    return;
                }
                if (LabTsLoop.Checked == false && tsloops == "1")
                {
                    Thread PtoP = new Thread(new ParameterizedThreadStart(PtoPGuZhangDingWei));
                    PtoP.Start(TextDxcIp.Text);
                    BtnPtoP.Enabled = true;
                    return;
                }

                for (int i = 0; i < vcgPortChanneMemberNum; i++)
                {

                    dts = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.hpIfIndex + VcgPortIfindex + "." + (i + 1).ToString());
                    pathidts = Dxc.TsPathIdSearch(ip, readcommunity, dts, VC);
                    tsloop = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.tsDxcloopControlOid + pathidts);



                    if (LabTsLoop.Checked == true && tsloop == "0")
                    {
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.tsDxcFpmMonOid + pathidts, "1", "Integer32");
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.tsDxcloopControlOid + pathidts, "1", "Integer32");
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.tsDxcUnLoopTimeDelayOid + pathidts, "5", "Integer32");

                        tsloop = "双向环回";
                    }
                    if (LabTsLoop.Checked == true && tsloop == "1")
                    {
                        tsloop = "双向环回";

                    }
                    if (LabTsLoop.Checked == false && tsloop == "1")
                    {
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.tsDxcFpmMonOid + pathidts, "1", "Integer32");
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.tsDxcloopControlOid + pathidts, "0", "Integer32");
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.tsDxcUnLoopTimeDelayOid + pathidts, "5", "Integer32");
                        tsloop = "不环回";
                    }
                    if (LabTsLoop.Checked == false && tsloop == "0")
                    {
                        tsloop = "不环回";
                    }

                    var (ifType, subType, srcSlot, srcPort, srcHp, srcLp) = Dxc.TsVcg(dts);

                    if (VC == "4")
                    {
                        GridOtn.Rows[i].Cells["宿时隙"].Value = srcSlot + "-" + srcPort + "-" + srcHp;

                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.highOrderPathVCMonitorEn + dts, "1", "Integer32");
                        Thread.Sleep(1000);
                        GridOtn.Rows[i].Cells["宿告警"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.highOrderPathVCAlmStatus + dts);
                        if (GridOtn.Rows[i].Cells["宿告警"].Value.ToString() == "00000000")
                        {
                            GridOtn.Rows[i].Cells["宿告警"].Value = "OK";
                            GridOtn.Rows[i].Cells["宿告警"].Style.BackColor = Color.GreenYellow;
                        }
                        else
                        {
                            GridOtn.Rows[i].Cells["宿告警"].Style.BackColor = Color.OrangeRed;
                            LabTsLoop.ForeColor = Color.Red;
                            LabDts.ForeColor = Color.Red;
                            GridOtn.Rows[i].Cells["宿告警"].Value = Alarm.HpAlarm(GridOtn.Rows[i].Cells["宿告警"].Value.ToString());

                        }

                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.highOrderPathVCMonitorEn + dts, "2", "Integer32");
                        GridOtn.Rows[i].Cells["宿Tx开销"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.highOrderPathVCOverheadC2Tx + dts);
                        if (GridOtn.Rows[i].Cells["宿Tx开销"].Value.ToString() == "1") { GridOtn.Rows[i].Cells["宿Tx开销"].Value = "1-UNEQ未装载"; }
                        if (GridOtn.Rows[i].Cells["宿Tx开销"].Value.ToString() == "2") { GridOtn.Rows[i].Cells["宿Tx开销"].Value = "2-TUG结构"; }
                        if (GridOtn.Rows[i].Cells["宿Tx开销"].Value.ToString() == "15") { GridOtn.Rows[i].Cells["宿Tx开销"].Value = "15-GFP映射"; }
                        if (GridOtn.Rows[i].Cells["宿Tx开销"].Value.ToString() == "17") { GridOtn.Rows[i].Cells["宿Tx开销"].Value = "17-VC-AIS"; }



                        GridOtn.Rows[i].Cells["宿Rx开销"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.highOrderPathVCOverheadC2Rx + dts);
                        if (GridOtn.Rows[i].Cells["宿Rx开销"].Value.ToString() == "1") { GridOtn.Rows[i].Cells["宿Rx开销"].Value = "1-UNEQ未装载"; }
                        if (GridOtn.Rows[i].Cells["宿Rx开销"].Value.ToString() == "2") { GridOtn.Rows[i].Cells["宿Rx开销"].Value = "2-TUG结构"; }
                        if (GridOtn.Rows[i].Cells["宿Rx开销"].Value.ToString() == "15") { GridOtn.Rows[i].Cells["宿Rx开销"].Value = "15-GFP映射"; }
                        if (GridOtn.Rows[i].Cells["宿Rx开销"].Value.ToString() == "17") { GridOtn.Rows[i].Cells["宿Rx开销"].Value = "17-VC-AIS"; }

                        GridOtn.Rows[i].Cells["SDH交叉ID"].Value = pathidts + tsloop;
                        if (tsloop == "不环回")
                        {
                            sts = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.tsDxcSourceHpChannelIfIndex + pathidts);
                            (ifType, subType, srcSlot, srcPort, srcHp, srcLp) = Dxc.TsRestore(sts);
                            sportsdh = srcSlot.ToString() + "." + srcPort.ToString();
                            GridOtn.Rows[i].Cells["源时隙"].Value = srcSlot + "-" + srcPort + "-" + srcHp;
                            Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.highOrderPathVCMonitorEn + sts, "1", "Integer32");
                            Thread.Sleep(1000);
                            GridOtn.Rows[i].Cells["源告警"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.highOrderPathVCAlmStatus + sts);
                            if (GridOtn.Rows[i].Cells["源告警"].Value.ToString() == "00000000")
                            {
                                GridOtn.Rows[i].Cells["源告警"].Value = "OK";
                                GridOtn.Rows[i].Cells["源告警"].Style.BackColor = Color.GreenYellow;
                            }
                            else
                            {
                                GridOtn.Rows[i].Cells["源告警"].Style.BackColor = Color.OrangeRed;
                                LabStsLab.ForeColor = Color.Red;
                                LabSts.ForeColor = Color.Red;
                                GridOtn.Rows[i].Cells["源告警"].Value = Alarm.HpAlarm(GridOtn.Rows[i].Cells["源告警"].Value.ToString());

                            }
                            Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.highOrderPathVCMonitorEn + sts, "2", "Integer32");
                            GridOtn.Rows[i].Cells["源Tx开销"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.highOrderPathVCOverheadC2Tx + sts);
                            if (GridOtn.Rows[i].Cells["源Tx开销"].Value.ToString() == "0") { GridOtn.Rows[i].Cells["源Tx开销"].Value = "0-UNEQ未装载"; }
                            if (GridOtn.Rows[i].Cells["源Tx开销"].Value.ToString() == "2") { GridOtn.Rows[i].Cells["源Tx开销"].Value = "2-TUG结构"; }
                            if (GridOtn.Rows[i].Cells["源Tx开销"].Value.ToString() == "15") { GridOtn.Rows[i].Cells["源Tx开销"].Value = "15-GFP映射"; }
                            if (GridOtn.Rows[i].Cells["源Tx开销"].Value.ToString() == "17") { GridOtn.Rows[i].Cells["源Tx开销"].Value = "17-VC-AIS"; }
                            if (GridOtn.Rows[i].Cells["源Tx开销"].Value.ToString() == "255") { GridOtn.Rows[i].Cells["源Tx开销"].Value = "255-VC-AIS"; }
                            GridOtn.Rows[i].Cells["源Rx开销"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.highOrderPathVCOverheadC2Rx + sts);
                            if (GridOtn.Rows[i].Cells["源Rx开销"].Value.ToString() == "0") { GridOtn.Rows[i].Cells["源Rx开销"].Value = "0-UNEQ未装载"; }
                            if (GridOtn.Rows[i].Cells["源Rx开销"].Value.ToString() == "2") { GridOtn.Rows[i].Cells["源Rx开销"].Value = "2-TUG结构"; }
                            if (GridOtn.Rows[i].Cells["源Rx开销"].Value.ToString() == "15") { GridOtn.Rows[i].Cells["源Rx开销"].Value = "15-GFP映射"; }
                            if (GridOtn.Rows[i].Cells["源Rx开销"].Value.ToString() == "17") { GridOtn.Rows[i].Cells["源Rx开销"].Value = "17-VC-AIS"; }
                            if (GridOtn.Rows[i].Cells["源Rx开销"].Value.ToString() == "255") { GridOtn.Rows[i].Cells["源Rx开销"].Value = "255-VC-AIS"; }
                        }


                    }
                    if (VC == "2")
                    {
                        GridOtn.Rows[i].Cells["宿时隙"].Value = srcSlot + "-" + srcPort + "-" + srcHp + "-" + srcLp;

                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.lowOrderPathVCMonitorEn + dts, "1", "Integer32");
                        Thread.Sleep(1000);
                        GridOtn.Rows[i].Cells["宿告警"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.lowOrderPathVCAlmStatus + dts);
                        if (GridOtn.Rows[i].Cells["宿告警"].Value.ToString() == "00000000")
                        {
                            GridOtn.Rows[i].Cells["宿告警"].Value = "OK";
                            GridOtn.Rows[i].Cells["宿告警"].Style.BackColor = Color.GreenYellow;
                        }
                        else
                        {
                            GridOtn.Rows[i].Cells["宿告警"].Style.BackColor = Color.OrangeRed;
                            LabTsLoop.ForeColor = Color.Red;
                            LabDts.ForeColor = Color.Red;
                            GridOtn.Rows[i].Cells["宿告警"].Value = Alarm.LpAlarm(GridOtn.Rows[i].Cells["宿告警"].Value.ToString());


                        }
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.lowOrderPathVCMonitorEn + dts, "2", "Integer32");
                        GridOtn.Rows[i].Cells["宿Tx开销"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.lowOrderPathVCOverheadC2Tx + dts);
                        if (GridOtn.Rows[i].Cells["宿Tx开销"].Value.ToString() == "1") { GridOtn.Rows[i].Cells["宿Tx开销"].Value = "1-UNEQ未装载"; }
                        if (GridOtn.Rows[i].Cells["宿Tx开销"].Value.ToString() == "2") { GridOtn.Rows[i].Cells["宿Tx开销"].Value = "2-TUG结构"; }
                        if (GridOtn.Rows[i].Cells["宿Tx开销"].Value.ToString() == "15") { GridOtn.Rows[i].Cells["宿Tx开销"].Value = "15-GFP映射"; }
                        if (GridOtn.Rows[i].Cells["宿Tx开销"].Value.ToString() == "17") { GridOtn.Rows[i].Cells["宿Tx开销"].Value = "17-VC-AIS"; }
                        GridOtn.Rows[i].Cells["宿Rx开销"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.lowOrderPathVCOverheadC2Rx + dts);
                        if (GridOtn.Rows[i].Cells["宿Rx开销"].Value.ToString() == "1") { GridOtn.Rows[i].Cells["宿Rx开销"].Value = "1-UNEQ未装载"; }
                        if (GridOtn.Rows[i].Cells["宿Rx开销"].Value.ToString() == "2") { GridOtn.Rows[i].Cells["宿Rx开销"].Value = "2-TUG结构"; }
                        if (GridOtn.Rows[i].Cells["宿Rx开销"].Value.ToString() == "15") { GridOtn.Rows[i].Cells["宿Rx开销"].Value = "15-GFP映射"; }
                        if (GridOtn.Rows[i].Cells["宿Rx开销"].Value.ToString() == "17") { GridOtn.Rows[i].Cells["宿Rx开销"].Value = "17-VC-AIS"; }
                        GridOtn.Rows[i].Cells["SDH交叉ID"].Value = pathidts + tsloop;

                        if (tsloop == "不环回")
                        {
                            sts = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.tsDxcSourceLpChannelIfIndex + pathidts);
                            (ifType, subType, srcSlot, srcPort, srcHp, srcLp) = Dxc.TsRestore(sts);
                            sportsdh = srcSlot.ToString() + "." + srcPort.ToString();

                            GridOtn.Rows[i].Cells["源时隙"].Value = srcSlot + "-" + srcPort + "-" + srcHp + "-" + srcLp;
                            //Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.lowOrderPathVCMonitorEn + sts, "1", "Integer32");
                            ////Thread.Sleep(1000);
                            //GridOtn.Rows[i].Cells["源告警"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.lowOrderPathVCAlmStatus + sts);
                            //Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.lowOrderPathVCMonitorEn + sts, "2", "Integer32");
                            //GridOtn.Rows[i].Cells["源Tx开销"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.lowOrderPathVCOverheadC2Tx + sts);
                            //GridOtn.Rows[i].Cells["源Rx开销"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.lowOrderPathVCOverheadC2Rx + sts);

                            sts = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.tsDxcSourceHpChannelIfIndex + pathidts);
                            //GridOtn.Rows[i].Cells["源时隙"].Value = sts;
                            Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.highOrderPathVCMonitorEn + sts, "1", "Integer32");
                            Thread.Sleep(1000);
                            GridOtn.Rows[i].Cells["源告警"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.highOrderPathVCAlmStatus + sts);
                            if (GridOtn.Rows[i].Cells["源告警"].Value.ToString() == "00000000")
                            {
                                GridOtn.Rows[i].Cells["源告警"].Value = "OK";
                                GridOtn.Rows[i].Cells["源告警"].Style.BackColor = Color.GreenYellow;
                            }
                            else
                            {
                                GridOtn.Rows[i].Cells["源告警"].Style.BackColor = Color.OrangeRed;
                                LabStsLab.ForeColor = Color.Red;
                                LabSts.ForeColor = Color.Red;
                                GridOtn.Rows[i].Cells["源告警"].Value = Alarm.LpAlarm(GridOtn.Rows[i].Cells["源告警"].Value.ToString());


                            }

                            Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.highOrderPathVCMonitorEn + sts, "2", "Integer32");
                            GridOtn.Rows[i].Cells["源Tx开销"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.highOrderPathVCOverheadC2Tx + sts);
                            if (GridOtn.Rows[i].Cells["源Tx开销"].Value.ToString() == "0") { GridOtn.Rows[i].Cells["源Tx开销"].Value = "0-UNEQ未装载"; }
                            if (GridOtn.Rows[i].Cells["源Tx开销"].Value.ToString() == "2") { GridOtn.Rows[i].Cells["源Tx开销"].Value = "2-TUG结构"; }
                            if (GridOtn.Rows[i].Cells["源Tx开销"].Value.ToString() == "15") { GridOtn.Rows[i].Cells["源Tx开销"].Value = "15-GFP映射"; }
                            if (GridOtn.Rows[i].Cells["源Tx开销"].Value.ToString() == "17") { GridOtn.Rows[i].Cells["源Tx开销"].Value = "17-VC-AIS"; }
                            if (GridOtn.Rows[i].Cells["源Tx开销"].Value.ToString() == "255") { GridOtn.Rows[i].Cells["源Tx开销"].Value = "255-VC-AIS"; }
                            GridOtn.Rows[i].Cells["源Rx开销"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.highOrderPathVCOverheadC2Rx + sts);
                            if (GridOtn.Rows[i].Cells["源Rx开销"].Value.ToString() == "0") { GridOtn.Rows[i].Cells["源Rx开销"].Value = "0-UNEQ未装载"; }
                            if (GridOtn.Rows[i].Cells["源Rx开销"].Value.ToString() == "2") { GridOtn.Rows[i].Cells["源Rx开销"].Value = "2-TUG结构"; }
                            if (GridOtn.Rows[i].Cells["源Rx开销"].Value.ToString() == "15") { GridOtn.Rows[i].Cells["源Rx开销"].Value = "15-GFP映射"; }
                            if (GridOtn.Rows[i].Cells["源Rx开销"].Value.ToString() == "17") { GridOtn.Rows[i].Cells["源Rx开销"].Value = "17-VC-AIS"; }
                            if (GridOtn.Rows[i].Cells["源Rx开销"].Value.ToString() == "255") { GridOtn.Rows[i].Cells["源Rx开销"].Value = "255-VC-AIS"; }
                        }


                    }
                    if (VC == "1")
                    {
                        GridOtn.Rows[i].Cells["宿时隙"].Value = srcSlot + "-" + srcPort + "-" + srcHp + "-" + srcLp;

                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.lowOrderPathVCMonitorEn + dts, "1", "Integer32");
                        Thread.Sleep(1000);
                        GridOtn.Rows[i].Cells["宿告警"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.lowOrderPathVCAlmStatus + dts);
                        if (GridOtn.Rows[i].Cells["宿告警"].Value.ToString() == "00000000")
                        {
                            GridOtn.Rows[i].Cells["宿告警"].Value = "OK";
                            GridOtn.Rows[i].Cells["宿告警"].Style.BackColor = Color.GreenYellow;
                        }
                        else
                        {
                            GridOtn.Rows[i].Cells["宿告警"].Style.BackColor = Color.OrangeRed;
                            LabTsLoop.ForeColor = Color.Red;
                            LabDts.ForeColor = Color.Red;
                            GridOtn.Rows[i].Cells["宿告警"].Value = Alarm.LpAlarm(GridOtn.Rows[i].Cells["宿告警"].Value.ToString());


                        }
                        Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.lowOrderPathVCMonitorEn + dts, "2", "Integer32");
                        GridOtn.Rows[i].Cells["宿Tx开销"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.lowOrderPathVCOverheadV5Tx + dts);
                        if (GridOtn.Rows[i].Cells["宿Tx开销"].Value.ToString() == "5") { GridOtn.Rows[i].Cells["宿Tx开销"].Value = "5-GFP映射"; }
                        if (GridOtn.Rows[i].Cells["宿Tx开销"].Value.ToString() == "2") { GridOtn.Rows[i].Cells["宿Tx开销"].Value = "2-异步映射"; }
                        if (GridOtn.Rows[i].Cells["宿Tx开销"].Value.ToString() == "7") { GridOtn.Rows[i].Cells["宿Tx开销"].Value = "7-VC-AIS"; }
                        GridOtn.Rows[i].Cells["宿Rx开销"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.lowOrderPathVCOverheadV5Rx + dts);
                        if (GridOtn.Rows[i].Cells["宿Rx开销"].Value.ToString() == "5") { GridOtn.Rows[i].Cells["宿Rx开销"].Value = "5-GFP映射"; }
                        if (GridOtn.Rows[i].Cells["宿Rx开销"].Value.ToString() == "2") { GridOtn.Rows[i].Cells["宿Rx开销"].Value = "2-异步映射"; }
                        if (GridOtn.Rows[i].Cells["宿Rx开销"].Value.ToString() == "7") { GridOtn.Rows[i].Cells["宿Rx开销"].Value = "7-VC-AIS"; }
                        GridOtn.Rows[i].Cells["SDH交叉ID"].Value = pathidts + tsloop;
                        if (tsloop == "不环回")
                        {

                            sts = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.tsDxcSourceLpChannelIfIndex + pathidts);
                            (ifType, subType, srcSlot, srcPort, srcHp, srcLp) = Dxc.TsRestore(sts);
                            sportsdh = srcSlot.ToString() + "." + srcPort.ToString();

                            GridOtn.Rows[i].Cells["源时隙"].Value = srcSlot + "-" + srcPort + "-" + srcHp + "-" + srcLp;


                            sts = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.tsDxcSourceHpChannelIfIndex + pathidts);
                            Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.highOrderPathVCMonitorEn + sts, "1", "Integer32");
                            Thread.Sleep(1000);
                            GridOtn.Rows[i].Cells["源告警"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.highOrderPathVCAlmStatus + sts);
                            if (GridOtn.Rows[i].Cells["源告警"].Value.ToString() == "00000000")
                            {
                                GridOtn.Rows[i].Cells["源告警"].Value = "OK";
                                GridOtn.Rows[i].Cells["源告警"].Style.BackColor = Color.GreenYellow;
                            }
                            else
                            {
                                GridOtn.Rows[i].Cells["源告警"].Style.BackColor = Color.OrangeRed;
                                LabStsLab.ForeColor = Color.Red;
                                LabSts.ForeColor = Color.Red;
                                GridOtn.Rows[i].Cells["源告警"].Value = Alarm.LpAlarm(GridOtn.Rows[i].Cells["源告警"].Value.ToString());

                            }

                            Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.highOrderPathVCMonitorEn + sts, "2", "Integer32");
                            GridOtn.Rows[i].Cells["源Tx开销"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.highOrderPathVCOverheadC2Tx + sts);
                            if (GridOtn.Rows[i].Cells["源Tx开销"].Value.ToString() == "0") { GridOtn.Rows[i].Cells["源Tx开销"].Value = "0-UNEQ未装载"; }
                            if (GridOtn.Rows[i].Cells["源Tx开销"].Value.ToString() == "2") { GridOtn.Rows[i].Cells["源Tx开销"].Value = "2-TUG结构"; }
                            if (GridOtn.Rows[i].Cells["源Tx开销"].Value.ToString() == "15") { GridOtn.Rows[i].Cells["源Tx开销"].Value = "15-GFP映射"; }
                            if (GridOtn.Rows[i].Cells["源Tx开销"].Value.ToString() == "17") { GridOtn.Rows[i].Cells["源Tx开销"].Value = "17-VC-AIS"; }
                            if (GridOtn.Rows[i].Cells["源Tx开销"].Value.ToString() == "255") { GridOtn.Rows[i].Cells["源Tx开销"].Value = "255-VC-AIS"; }
                            GridOtn.Rows[i].Cells["源Rx开销"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.highOrderPathVCOverheadC2Rx + sts);
                            if (GridOtn.Rows[i].Cells["源Rx开销"].Value.ToString() == "0") { GridOtn.Rows[i].Cells["源Rx开销"].Value = "0-UNEQ未装载"; }
                            if (GridOtn.Rows[i].Cells["源Rx开销"].Value.ToString() == "2") { GridOtn.Rows[i].Cells["源Rx开销"].Value = "2-TUG结构"; }
                            if (GridOtn.Rows[i].Cells["源Rx开销"].Value.ToString() == "15") { GridOtn.Rows[i].Cells["源Rx开销"].Value = "15-GFP映射"; }
                            if (GridOtn.Rows[i].Cells["源Rx开销"].Value.ToString() == "17") { GridOtn.Rows[i].Cells["源Rx开销"].Value = "17-VC-AIS"; }
                            if (GridOtn.Rows[i].Cells["源Rx开销"].Value.ToString() == "255") { GridOtn.Rows[i].Cells["源Rx开销"].Value = "255-VC-AIS"; }


                        }

                    }

                }
                if (tsloop == "双向环回")
                {
                    BtnPtoP.Enabled = true;
                    return;
                }


                GridOtn.Rows[0].Cells["源SDH接口"].Value = "接口";
                GridOtn.Rows[0].Cells["源SDH接口值"].Value = sportsdh;

                GridOtn.Rows[1].Cells["源SDH接口"].Value = "索引";
                sportsdhifindex = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.sdhPortIfIndex + sportsdh);
                GridOtn.Rows[1].Cells["源SDH接口值"].Value = sportsdhifindex;

                GridOtn.Rows[2].Cells["源SDH接口"].Value = "速率";
                GridOtn.Rows[2].Cells["源SDH接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.sdhPortType + sportsdhifindex);
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.sdhPortType + sportsdhifindex) == "1") { GridOtn.Rows[2].Cells["源SDH接口值"].Value = "STM-1"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.sdhPortType + sportsdhifindex) == "2") { GridOtn.Rows[2].Cells["源SDH接口值"].Value = "STM-4"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.sdhPortType + sportsdhifindex) == "3") { GridOtn.Rows[2].Cells["源SDH接口值"].Value = "STM-16"; }
                GridOtn.Rows[3].Cells["源SDH接口"].Value = "接口告警";
                Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.sdhPortMonitorEn + sportsdhifindex, "1", "Integer32");
                //Thread.Sleep(1000);
                GridOtn.Rows[3].Cells["源SDH接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.sdhPortAlmStatus + sportsdhifindex);
                if (GridOtn.Rows[3].Cells["源SDH接口值"].Value.ToString() == "00000000")
                {
                    GridOtn.Rows[3].Cells["源SDH接口值"].Value = "OK";
                    GridOtn.Rows[3].Cells["源SDH接口值"].Style.BackColor = Color.GreenYellow;
                }
                else
                {
                    GridOtn.Rows[3].Cells["源SDH接口值"].Style.BackColor = Color.OrangeRed;
                    LabSportLoop.ForeColor = Color.Red;
                    LabSPort.ForeColor = Color.Red;
                    GridOtn.Rows[3].Cells["源SDH接口值"].Value = Alarm.SdhPortAlarm(GridOtn.Rows[3].Cells["源SDH接口值"].Value.ToString());

                }
                Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.sdhPortMonitorEn + sportsdhifindex, "0", "Integer32");

                GridOtn.Rows[4].Cells["源SDH接口"].Value = "再生段告警";
                Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.sdhPortMonitorEn + sportsdhifindex, "1", "Integer32");

                //Thread.Sleep(1000);
                GridOtn.Rows[4].Cells["源SDH接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.rsAlmStatus + sportsdhifindex);
                if (GridOtn.Rows[4].Cells["源SDH接口值"].Value.ToString() == "00000000")
                {
                    GridOtn.Rows[4].Cells["源SDH接口值"].Value = "OK";
                    GridOtn.Rows[4].Cells["源SDH接口值"].Style.BackColor = Color.GreenYellow;
                }
                else
                {
                    GridOtn.Rows[4].Cells["源SDH接口值"].Style.BackColor = Color.OrangeRed;
                    LabSportLoop.ForeColor = Color.Red;
                    LabSPort.ForeColor = Color.Red;
                    GridOtn.Rows[4].Cells["源SDH接口值"].Value = Alarm.RsAlarm(GridOtn.Rows[4].Cells["源SDH接口值"].Value.ToString());


                }
                Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.sdhPortMonitorEn + sportsdhifindex, "0", "Integer32");

                GridOtn.Rows[5].Cells["源SDH接口"].Value = "复用段告警";
                Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.sdhPortMonitorEn + sportsdhifindex, "1", "Integer32");
                //Thread.Sleep(1000);
                GridOtn.Rows[5].Cells["源SDH接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.msAlmStatus + sportsdhifindex);
                if (GridOtn.Rows[5].Cells["源SDH接口值"].Value.ToString() == "00000000")
                {
                    GridOtn.Rows[5].Cells["源SDH接口值"].Value = "OK";
                    GridOtn.Rows[5].Cells["源SDH接口值"].Style.BackColor = Color.GreenYellow;
                }
                else
                {
                    GridOtn.Rows[5].Cells["源SDH接口值"].Style.BackColor = Color.OrangeRed;
                    LabSportLoop.ForeColor = Color.Red;
                    LabSPort.ForeColor = Color.Red;
                    GridOtn.Rows[5].Cells["源SDH接口值"].Value = Alarm.MsAlarm(GridOtn.Rows[5].Cells["源SDH接口值"].Value.ToString());


                }
                Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.sdhPortMonitorEn + sportsdhifindex, "0", "Integer32");

                GridOtn.Rows[6].Cells["源SDH接口"].Value = "环回状态";
                GridOtn.Rows[6].Cells["源SDH接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.sdhPortLoop + sportsdhifindex);
                if (GridOtn.Rows[6].Cells["源SDH接口值"].Value.ToString() == "0") { GridOtn.Rows[6].Cells["源SDH接口值"].Value = "不环回"; }
                if (GridOtn.Rows[6].Cells["源SDH接口值"].Value.ToString() == "1") { GridOtn.Rows[6].Cells["源SDH接口值"].Value = "系统内环"; }
                if (GridOtn.Rows[6].Cells["源SDH接口值"].Value.ToString() == "2") { GridOtn.Rows[6].Cells["源SDH接口值"].Value = "线路外环"; }

                if (LabSportLoop.Checked == true && GridOtn.Rows[6].Cells["源SDH接口值"].Value.ToString() == "不环回")
                {
                    Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.sdhPortLoop + sportsdhifindex, "1", "Integer32");
                    GridOtn.Rows[6].Cells["源SDH接口值"].Value = "系统内环";
                    //GridOtn.Rows.Clear();
                    Thread PtoP = new Thread(new ParameterizedThreadStart(PtoPGuZhangDingWei));
                    PtoP.Start(TextDxcIp.Text);
                    BtnPtoP.Enabled = true;
                    return;

                }
                if (LabSportLoop.Checked == false && GridOtn.Rows[6].Cells["源SDH接口值"].Value.ToString() == "系统内环")
                {
                    Snmp.Set(ip, readcommunity, writecommunity, timeout, retry, Dxc.sdhPortLoop + sportsdhifindex, "0", "Integer32");
                    GridOtn.Rows[6].Cells["源SDH接口值"].Value = "不环回";
                    Thread PtoP = new Thread(new ParameterizedThreadStart(PtoPGuZhangDingWei));
                    PtoP.Start(TextDxcIp.Text);
                    BtnPtoP.Enabled = true;
                    return;

                }




                GridOtn.Rows[11].Cells["源SDH接口"].Value = "光模块在位";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModSfpPresent + sportsdhifindex) == "1") { GridOtn.Rows[11].Cells["源SDH接口值"].Value = "在位"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModSfpPresent + sportsdhifindex) == "2") { GridOtn.Rows[11].Cells["源SDH接口值"].Value = "不在位"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModSfpPresent + sportsdhifindex) == "3") { GridOtn.Rows[11].Cells["源SDH接口值"].Value = "不支持"; }

                GridOtn.Rows[12].Cells["源SDH接口"].Value = "速率(Mbps)";
                GridOtn.Rows[12].Cells["源SDH接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModBitRate + sportsdhifindex);

                GridOtn.Rows[13].Cells["源SDH接口"].Value = "光电类型";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModFiberOrCopperType + sportsdhifindex) == "1") { GridOtn.Rows[13].Cells["源SDH接口值"].Value = "光模块"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModFiberOrCopperType + sportsdhifindex) == "2") { GridOtn.Rows[13].Cells["源SDH接口值"].Value = "电模块"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModFiberOrCopperType + sportsdhifindex) == "3") { GridOtn.Rows[13].Cells["源SDH接口值"].Value = "Unkown"; }


                GridOtn.Rows[14].Cells["源SDH接口"].Value = "激光状态";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModLaserStatus + sportsdhifindex) == "1") { GridOtn.Rows[14].Cells["源SDH接口值"].Value = "已关闭"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModLaserStatus + sportsdhifindex) == "2") { GridOtn.Rows[14].Cells["源SDH接口值"].Value = "已打开"; }


                GridOtn.Rows[15].Cells["源SDH接口"].Value = "单双纤";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModSingleDouble + sportsdhifindex) == "1") { GridOtn.Rows[15].Cells["源SDH接口值"].Value = "单纤"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModSingleDouble + sportsdhifindex) == "2") { GridOtn.Rows[15].Cells["源SDH接口值"].Value = "双纤"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModSingleDouble + sportsdhifindex) == "3") { GridOtn.Rows[15].Cells["源SDH接口值"].Value = "Unkown"; }


                GridOtn.Rows[16].Cells["源SDH接口"].Value = "距离(Km)";
                GridOtn.Rows[16].Cells["源SDH接口值"].Value = Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModDistance + sportsdhifindex);

                GridOtn.Rows[17].Cells["源SDH接口"].Value = "波长";
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModWaveLength + sportsdhifindex) == "1") { GridOtn.Rows[17].Cells["源SDH接口值"].Value = "1310nm"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModWaveLength + sportsdhifindex) == "2") { GridOtn.Rows[17].Cells["源SDH接口值"].Value = "1550nm"; }
                if (Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModWaveLength + sportsdhifindex) == "3") { GridOtn.Rows[17].Cells["源SDH接口值"].Value = "Undown"; }




                GridOtn.Rows[18].Cells["源SDH接口"].Value = "发光功率";
                GridOtn.Rows[18].Cells["源SDH接口值"].Value = float.Parse(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModTxPower + sportsdhifindex)) / 100;

                GridOtn.Rows[19].Cells["源SDH接口"].Value = "收光功率";
                GridOtn.Rows[19].Cells["源SDH接口值"].Value = float.Parse(Snmp.Get(ip, readcommunity, timeout, retry, Dxc.optModRxPower + sportsdhifindex)) / 100;

            }
            catch {
                MessageBox.Show("查询异常，请检查接口是否配置正确，是否配置交叉");
                BtnPtoP.Enabled = true;
            }

        }
        private void VCGband(Object VcgPortIfindex) {
            try
            {

                GridOtn.Rows[18].Cells["VCG接口"].Value = "Tx带宽";
                uint Txbyte0 = uint.Parse(Snmp.Get(TextDxcIp.Text, textReadCommunity.Text, 2000, 2, Dxc.gfpCurrentTxBytes + VcgPortIfindex));
                Thread.Sleep(6000);
                uint Txbyte1 = uint.Parse(Snmp.Get(TextDxcIp.Text, textReadCommunity.Text, 2000, 2, Dxc.gfpCurrentTxBytes + VcgPortIfindex));
                float TxBand = (Txbyte1 - Txbyte0) * 8 / 6 / 1000 / 1000;
                if (TxBand == 0)
                {
                    LabDportTx.ForeColor = Color.Red;
                    GridOtn.Rows[18].Cells["VCG接口值"].Style.BackColor = Color.OrangeRed;

                }
                else
                {
                    LabDportTx.ForeColor = Color.GreenYellow;
                    GridOtn.Rows[18].Cells["VCG接口值"].Style.BackColor = Color.GreenYellow;
                }
                GridOtn.Rows[18].Cells["VCG接口值"].Value = TxBand + "Mbps";

                GridOtn.Rows[19].Cells["VCG接口"].Value = "Rx带宽";
                uint Rxbyte0 = uint.Parse(Snmp.Get(TextDxcIp.Text, textReadCommunity.Text, 2000, 2, Dxc.gfpCurrentRxBytes + VcgPortIfindex));
                Thread.Sleep(6000);
                uint Rxbyte1 = uint.Parse(Snmp.Get(TextDxcIp.Text, textReadCommunity.Text, 2000, 2, Dxc.gfpCurrentRxBytes + VcgPortIfindex));
                float RxBand = (Rxbyte1 - Rxbyte0) * 8 / 6 / 1000 / 1000;
                if (RxBand == 0)
                {
                    LabDportRx.ForeColor = Color.Red;
                    GridOtn.Rows[19].Cells["VCG接口值"].Style.BackColor = Color.OrangeRed;

                }
                else
                {
                    LabDportRx.ForeColor = Color.GreenYellow;
                    GridOtn.Rows[19].Cells["VCG接口值"].Style.BackColor = Color.GreenYellow;
                }
                GridOtn.Rows[19].Cells["VCG接口值"].Value = RxBand + "Mbps";
                BtnPtoP.Enabled = true;
            }
            catch {
                MessageBox.Show("获取VCG带宽失败，请检查接口是否配置正确");
                BtnPtoP.Enabled = true;
            }



        }
        private void TimeTopu_Tick(object sender, EventArgs e)
        {
            Thread dport = new Thread(Dport);
            dport.Start();
            Thread custx = new Thread(CusTx);
            custx.Start();
            Thread cusrx = new Thread(CusRx);
            cusrx.Start();
            Thread dportTx = new Thread(DportTx);
            dportTx.Start();
            Thread dportRx = new Thread(DportRx);
            dportRx.Start();
            Thread dts = new Thread(Dts);
            dts.Start();
            Thread tsLoop = new Thread(TsLoop);
            tsLoop.Start();
            Thread sts = new Thread(Sts);
            sts.Start();
            Thread stsLab = new Thread(StsLab);
            stsLab.Start();
            Thread sPort = new Thread(SPort);
            sPort.Start();
            Thread sportLoop = new Thread(SportLoop);
            sportLoop.Start();

        }
        private void Dport() {
            if (LabDport.ForeColor == Color.Red) {
                LabDport.Visible = false;
                Thread.Sleep(1000);
                LabDport.Visible = true;
            }
        }
        private void CusTx()
        {
            if (LabcusTx.ForeColor == Color.Red)
            {
                LabcusTx.Visible = false;
                Thread.Sleep(1000);
                LabcusTx.Visible = true;
            }
        }
        private void CusRx()
        {
            if (LabcusRx.ForeColor == Color.Red)
            {
                LabcusRx.Visible = false;
                Thread.Sleep(1000);
                LabcusRx.Visible = true;
            }
        }
        private void DportTx()
        {
            if (LabDportTx.ForeColor == Color.Red)
            {
                LabDportTx.Visible = false;
                Thread.Sleep(1000);
                LabDportTx.Visible = true;
            }
        }
        private void DportRx()
        {
            if (LabDportRx.ForeColor == Color.Red)
            {
                LabDportRx.Visible = false;
                Thread.Sleep(1000);
                LabDportRx.Visible = true;
            }
        }
        private void Dts()
        {
            if (LabDts.ForeColor == Color.Red)
            {
                LabDts.Visible = false;
                Thread.Sleep(500);
                LabDts.Visible = true;
            }
        }
        private void TsLoop()
        {
            if (LabTsLoop.ForeColor == Color.Red)
            {
                LabTsLoop.Visible = false;
                Thread.Sleep(500);
                LabTsLoop.Visible = true;
            }
        }
        private void Sts()
        {
            if (LabSts.ForeColor == Color.Red)
            {
                LabSts.Visible = false;
                Thread.Sleep(500);
                LabSts.Visible = true;
            }
        }
        private void StsLab()
        {
            if (LabStsLab.ForeColor == Color.Red)
            {
                LabStsLab.Visible = false;
                Thread.Sleep(500);
                LabStsLab.Visible = true;
            }
        }
        private void SPort()
        {
            if (LabSPort.ForeColor == Color.Red)
            {
                LabSPort.Visible = false;
                Thread.Sleep(500);
                LabSPort.Visible = true;
            }
        }
        private void SportLoop()
        {
            if (LabSportLoop.ForeColor == Color.Red)
            {
                LabSportLoop.Visible = false;
                Thread.Sleep(500);
                LabSportLoop.Visible = true;
            }




            //Thread.Sleep(500);
            //LabcusRx.Visible = false;

        }

        private void metroButton2_Click(object sender, EventArgs e)
        {
            uint i = (uint)int.Parse(metroTextdxc.Text);
            metroTextResultDXC.AppendText("无符号十进制："+i.ToString()+"\r\n");
            string j = System.Convert.ToString(i, 16);
            metroTextResultDXC.AppendText("无符号十六进制：" + j.ToString() + "\r\n");

        }

        private void ComDslotP_SelectedIndexChanged(object sender, EventArgs e)
        {
            ComVcgSlotD.Text = ComDslotP.Text;
        }

        private void ComDportP_SelectedIndexChanged(object sender, EventArgs e)
        {
            ComVcgPortD.Text = ComDportP.Text;
        }

        private void ButCheckFile_Click(object sender, EventArgs e)
        {

            LoadCountsum = 0;
            LoadCountany = 0;
            string shengjiip = "";

            for (int i = 0; i < DGVSTATUS.Rows.Count; i++)
            {
                if ((bool)DGVSTATUS.Rows[i].Cells["执行"].EditedFormattedValue == true)
                {
                    int c = 1;
                    LoadCountsum = LoadCountsum + c;
                    string asd = DGVSTATUS.Rows[i].Cells["ip地址"].Value.ToString();
                    shengjiip = shengjiip + asd + "\r\n";     //设备IP地址
                }


            }
            DialogResult dr = MessageBox.Show("是否确认 检查设备文件大小进行对比？\r\n" + shengjiip + "\r\n一共：" + LoadCountsum.ToString() + "台设备", "提示", MessageBoxButtons.YesNo);
            if (dr == DialogResult.Yes)
            {
                // DGVSTATUS.DataSource = null;
                //DGVSTATUS.Rows.Clear();
                int i = DGVSTATUS.ColumnCount;
                //MessageBox.Show(i.ToString());
                for (int a = 9; a < i; a++)
                {
                    // MessageBox.Show(a.ToString());
                    DGVSTATUS.Columns.RemoveAt(9);


                }
                DGVSTATUS.Refresh();
                // DGVSTATUS.Columns.Clear();
                //DataGridViewCreeatGuding();
                datagridviewcreat();
                string task = "checkfile";
                ParameterizedThreadStart p = new ParameterizedThreadStart(Xianchengchi);
                Thread t = new Thread(p);
                t.Start(task);
            }
            if (dr == DialogResult.No)
            {
                //  buttbatchdownload.Text = "批量重启";
            }

        }

        private void Checkfile(object obj)
        {
            ButCheckFile.Enabled = false;
            MySocket mysocketftp = new MySocket();
            int i = int.Parse(obj.ToString());
            string gpnip = DGVSTATUS.Rows[i].Cells["ip地址"].Value.ToString();
            string devtype = "1.3.6.1.4.1.10072.6.2.1.1.1.2.1";   //设备类型
            string readcommunity = textReadCommunity.Text;      //读团体
            string writecommunity = textWriteCommunity.Text;    //写团体
            string[,] Filesize = null;
            int pingcunt = 5;
            Ping ping = new Ping();
            PingReply pingReply = ping.Send(gpnip, 120);
            bool link = false;
            //判断请求是否超时
            for (int but = 0; but < pingcunt; but++)
            {

                pingReply = ping.Send(gpnip, 120);
                if (pingReply.Status == IPStatus.Success)
                {
                    link = true;
                    DGVSTATUS.Rows[i].Cells["ping"].Value = "OK";
                    DGVSTATUS.Rows[i].Cells["ping"].Style.BackColor = Color.GreenYellow;

                    break;
                }
                Thread.Sleep(XHTime / 3);
            }
            if (link == false)
            {
                DGVSTATUS.Rows[i].Cells["ping"].Value = "NOK";
                
                DGVSTATUS.Rows[i].Cells["ping"].Style.BackColor = Color.Yellow;
                lock (PiLiangShengJi)
                {
                    LoadCountany++;
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 累计完成设备数量：" + LoadCountany.ToString() + "\r\n");

                }
                return;
            }

            DGVSTATUS.Rows[i].Cells["设备类型"].Value = FindDevType.Finddevtype(Snmp.Get(gpnip, readcommunity, 2000, 2, devtype));
            if (FindDevType.Finddevtype(Snmp.Get(gpnip, readcommunity, 2000, 2, devtype)).Contains("7600")) {
                this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = "初始化";
                bool bo = mysocketftp.Connect(gpnip, "23");
                if (bo)
                {
                    mysocketftp.SendData(textusr.Text);
                    for (int t = 0; t <= 1000; t++)
                    {
                        string login = mysocketftp.ReceiveData(int.Parse(ts));
                        // MessageBox.Show(login);
                        if (login.Contains("Password:"))
                        {
                            mysocketftp.SendData(textpsd.Text);
                            break;
                        }
                        Thread.Sleep(10);
                    }
                    for (int f = 0; f <= 1000; f++)
                    {
                        string passd = mysocketftp.ReceiveData(int.Parse(ts));
                        //MessageBox.Show(passd);
                        if (passd.Contains("Error") || passd.Contains("failed") || passd.Contains("Kerberos") || passd.Contains("Bad passwords"))
                        {

                            //textDOS.AppendText("\r\n" + "用户名或密码错误，请重新输入");
                            this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = "密码错误";
                            this.DGVSTATUS.Rows[i].DefaultCellStyle.BackColor = Color.Yellow;
                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 密码错误！ " + "\r\n");

                        }
                        if (passd.Contains("Password:"))
                        {
                            mysocketftp.SendData(textpsd.Text);
                        }
                        if (passd.Contains(">"))
                        {
                            //textDOS.AppendText("\r\n" + "用户名密码正确==========================================OK");
                            mysocketftp.SendData("enable");
                            for (int b = 0; b <= 1000; b++)
                            {
                                string pass = mysocketftp.ReceiveData(int.Parse(ts));
                                if (pass.Contains("Pas"))
                                {
                                    mysocketftp.SendData(textpsden.Text);
                                    //Thread.Sleep(500);
                                    for (int u = 0; u <= 1000; u++)
                                    {
                                        string locked = mysocketftp.ReceiveData(int.Parse(ts));
                                        if (locked.Contains("configuration is locked by other user"))
                                        //configuration is locked by other user
                                        {
                                            //textDOS.AppendText("\r\n" + "已经有用户登录，正在重新登录========================OK");
                                            mysocketftp.SendData("grosadvdebug");
                                            Thread.Sleep(200);
                                            mysocketftp.SendData("vty user limit no");
                                            Thread.Sleep(200);
                                            mysocketftp.SendData("exit");
                                            Thread.Sleep(200);
                                            mysocketftp.SendData("enable");
                                            Thread.Sleep(200);
                                            if (mysocketftp.ReceiveData(int.Parse(ts)).Contains("Pas"))
                                            {
                                                mysocketftp.SendData(textpsden.Text);
                                                Thread.Sleep(200);
                                                if (!mysocketftp.ReceiveData(int.Parse(ts)).Contains("failed"))
                                                {
                                                    this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = "密码错误";
                                                    this.DGVSTATUS.Rows[i].DefaultCellStyle.BackColor = Color.Yellow;
                                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 密码错误！ " + "\r\n");

                                                }

                                                break;
                                            }
                                        }
                                        if (locked.Contains("#"))
                                        {
                                            break;
                                        }
                                        Thread.Sleep(1);
                                    }
                                    break;
                                }
                                if (pass.Contains("#"))
                                {
                                    break;
                                }
                                if (pass.Contains("configuration is locked by other user"))
                                //configuration is locked by other user
                                {
                                    //textDOS.AppendText("\r\n" + "已经有用户登录，正在重新登录=============================OK");
                                    mysocketftp.SendData("grosadvdebug");
                                    Thread.Sleep(200);
                                    mysocketftp.SendData("vty user limit no");
                                    Thread.Sleep(200);
                                    mysocketftp.SendData("exit");
                                    Thread.Sleep(200);
                                    mysocketftp.SendData("enable");
                                    Thread.Sleep(200);
                                    if (mysocketftp.ReceiveData(int.Parse(ts)).Contains("Pas"))
                                    {
                                        mysocketftp.SendData(textpsden.Text);
                                        Thread.Sleep(200);
                                        if (!mysocketftp.ReceiveData(int.Parse(ts)).Contains("failed"))
                                        {
                                            this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = "密码错误";
                                            this.DGVSTATUS.Rows[i].DefaultCellStyle.BackColor = Color.Yellow;
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 密码错误！ " + "\r\n");

                                        }

                                        break;
                                    }
                                    break;
                                }
                                Thread.Sleep(1);
                            }
                            break;
                        }
                        Thread.Sleep(10);
                    }

                    this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = "准备开始";
                    mysocketftp.SendData("screen idle-timeout 0");
                    Thread.Sleep(2 * XHTime);
                    mysocketftp.SendData("grosadvdebug");
                    Thread.Sleep(2 * XHTime);
                    string command0 = mysocketftp.ReceiveData(int.Parse(ts));
                    mysocketftp.SendData("show debug-version");
                    Thread.Sleep(2 * XHTime);
                    string command = mysocketftp.ReceiveData(int.Parse(ts));
                    Regex wave = new Regex(@"Version:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                    string Wave = wave.Match(command).Groups[1].Value;
                    //this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = Wave;
                    command = "";
                    mysocketftp.SendData("show fpga-version");
                    Thread.Sleep(2 * XHTime);
                    command = mysocketftp.ReceiveData(int.Parse(ts));
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    Regex fpga = new Regex(@"fpga_code.bin:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                    string Fpga = fpga.Match(command).Groups[1].Value;

                    
                    mysocketftp.SendData("show all-files enable");
                    Thread.Sleep(2 * XHTime);
                    mysocketftp.SendData("exit");
                    Thread.Sleep(2 * XHTime);
                    mysocketftp.SendData("dosfs");
                    Thread.Sleep(2 * XHTime);
                    mysocketftp.SendData("cd /flash/sys");
                    Thread.Sleep(2 * XHTime);
                    mysocketftp.SendData("rm netid.txt");
                    Thread.Sleep(2 * XHTime);
                    mysocketftp.SendData("exit");

                    Thread.Sleep(2 * XHTime);
                    command = mysocketftp.ReceiveData(int.Parse(ts));
                    command = "";
                    mysocketftp.SendData("dosfs");
                    Thread.Sleep(2 * XHTime);
                    mysocketftp.SendData("cd /flash/sys");
                    Thread.Sleep(2 * XHTime);
                    mysocketftp.SendData("ll");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("dosfs");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("cd /yaffs/sys");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("ll");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    mysocketftp.SendData("cd /flash/sdn");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("ll");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("exit");
                    command = mysocketftp.ReceiveData(int.Parse(ts));
                    this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = Wave + "|" + Fpga;
                    //this.DGVSTATUS.Rows[i].Cells["ping"].Value = "OK" + "|" + "netid已删除";
                    DGVSTATUS.Rows[i].Cells["当前版本"].Style.BackColor = Color.GreenYellow;
                    Filesize = FindDevType.StringToArray(command);


                    mysocketftp.Close();
                }
                else
                {
                    this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = "Telnet失败";
                    this.DGVSTATUS.Rows[i].DefaultCellStyle.BackColor = Color.Yellow;
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 登录Telnet失败！ " + "\r\n");
                    lock (PiLiangShengJi)
                    {
                        LoadCountany++;
                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 累计完成设备数量：" + LoadCountany.ToString() + "\r\n");

                    }
                    return;
                }
                string[,] array = new string[,] {
                { "APP",        "app_code.bin" ,                labapp.Text },
                { "CODE",       "fpga_code.bin" ,               labcode.Text            },
                { "CODE2",      "fpga_code2.bin" ,              labcode2.Text},
                { "CODE3",      "fpga_code3.bin",               labcode3.Text },
                { "CODE4",      "fpga_code4.bin",               labcode4.Text },
                { "SDN",        "wholePack.bin",                labsdn.Text },
                { "NMS",        "nms.fpga",                     labnms.Text },
                { "SW",         "sw.fpga",                      labsw.Text },
                { "Config" ,    "conf_data.txt" ,               labconfig.Text},
                { "Db",         "db.bin",                       labdb.Text },
                { "SlotConfig", "slotconfig.bin" ,              labslotconfig.Text},
                { "FLASH",      "",                             "" },
                { "SysFile",    "sysfile_ini.bin",              labsysfile.Text },
                { "YAFFS",      "",                             ""  },
                { "760S",       "760s.fpga",                    lab760s.Text },
                { "760B",       "760b.fpga",                    lab760b.Text },
                { "760C",       "760c.fpga",                    lab760c.Text },
                { "760D",       "760d.fpga",                    lab760d.Text },
                { "760E",       "760e.fpga",                    lab760e.Text },
                { "UXC",        "uxc_a.fpga" ,                  labuxc.Text},
                { "7610",       "7610.fpga" ,                   lab7610.Text},
                { "7611",       "7611.fpga",                    lab7611.Text },
                { "7612",       "7612.fpga",                    lab7612.Text },
                { "7613",       "7613.fpga",                    lab7613.Text },
                { "7614",       "7614.fpga",                    lab7614.Text },
                { "7616",       "7616.fpga",                    lab7616.Text },
                { "APP2",       "app_code_backup2.bin",         labapp2.Text },
                { "VOSS",       "voss.sh" ,                     labvoss.Text},
                { "REBOOTOS",   "rebootos.sh",                  labrebootos.Text },
                { "CPLD",       "nms.cpld" ,                    labcpld.Text},
            };
                int colunms = DGVSTATUS.ColumnCount;
                int row = array.GetLength(0);

                for (int c = 9; c < colunms; c++)
                {
                    string header = DGVSTATUS.Columns[c].HeaderText;
                    for (int d = 0; d < row; d++)
                    {
                        if (array[d, 0].ToString() == header)
                        {

                            int dxcrow = Filesize.GetLength(0);
                            int dxccol = Filesize.GetLength(1);
                            for (int a = 0; a < dxcrow; a++)
                            {

                                if (Filesize[a, 8] != null)
                                {
                                    if (Filesize[a, 8] == array[d, 1])
                                    {
                                        if (Filesize[a, 4] == array[d, 2])
                                        {
                                            DGVSTATUS.Rows[i].Cells[header].Value = "一样";
                                            DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.GreenYellow;
                                            
                                            break;
                                        }
                                        else
                                        {
                                            DGVSTATUS.Rows[i].Cells[header].Value = "不样" + Filesize[a, 4];
                                            DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.Red;
                                            
                                            break;
                                        }


                                    }
                                    else
                                    {
                                        DGVSTATUS.Rows[i].Cells[header].Value = "没有";
                                        DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.Yellow;
                                        
                                    }

                                }

                            }
                        }
                    }
                }
            }
            if (FindDevType.Finddevtype(Snmp.Get(gpnip, readcommunity, 2000, 2, devtype)).Contains("800"))
            {
                this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = "初始化";
                bool bo = mysocketftp.Connect(gpnip, "23");
                if (bo)
                {
                    mysocketftp.SendData(textusr.Text);
                    for (int t = 0; t <= 1000; t++)
                    {
                        string login = mysocketftp.ReceiveData(int.Parse(ts));
                        // MessageBox.Show(login);
                        if (login.Contains("Password:"))
                        {
                            mysocketftp.SendData(textpsd.Text);
                            break;
                        }
                        Thread.Sleep(10);
                    }
                    for (int f = 0; f <= 1000; f++)
                    {
                        string passd = mysocketftp.ReceiveData(int.Parse(ts));
                        //MessageBox.Show(passd);
                        if (passd.Contains("Error") || passd.Contains("failed") || passd.Contains("Kerberos") || passd.Contains("Bad passwords"))
                        {

                            //textDOS.AppendText("\r\n" + "用户名或密码错误，请重新输入");
                            this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = "密码错误";
                            this.DGVSTATUS.Rows[i].DefaultCellStyle.BackColor = Color.Yellow;
                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 密码错误！ " + "\r\n");

                        }
                        if (passd.Contains("Password:"))
                        {
                            mysocketftp.SendData(textpsd.Text);
                        }
                        if (passd.Contains(">"))
                        {
                            //textDOS.AppendText("\r\n" + "用户名密码正确==========================================OK");
                            mysocketftp.SendData("enable");
                            for (int b = 0; b <= 1000; b++)
                            {
                                string pass = mysocketftp.ReceiveData(int.Parse(ts));
                                if (pass.Contains("Pas"))
                                {
                                    mysocketftp.SendData(textpsden.Text);
                                    //Thread.Sleep(500);
                                    for (int u = 0; u <= 1000; u++)
                                    {
                                        string locked = mysocketftp.ReceiveData(int.Parse(ts));
                                        if (locked.Contains("configuration is locked by other user"))
                                        //configuration is locked by other user
                                        {
                                            //textDOS.AppendText("\r\n" + "已经有用户登录，正在重新登录========================OK");
                                            mysocketftp.SendData("grosadvdebug");
                                            Thread.Sleep(200);
                                            mysocketftp.SendData("vty user limit no");
                                            Thread.Sleep(200);
                                            mysocketftp.SendData("exit");
                                            Thread.Sleep(200);
                                            mysocketftp.SendData("enable");
                                            Thread.Sleep(200);
                                            if (mysocketftp.ReceiveData(int.Parse(ts)).Contains("Pas"))
                                            {
                                                mysocketftp.SendData(textpsden.Text);
                                                Thread.Sleep(200);
                                                if (!mysocketftp.ReceiveData(int.Parse(ts)).Contains("failed"))
                                                {
                                                    this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = "密码错误";
                                                    this.DGVSTATUS.Rows[i].DefaultCellStyle.BackColor = Color.Yellow;
                                                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 密码错误！ " + "\r\n");

                                                }

                                                break;
                                            }
                                        }
                                        if (locked.Contains("#"))
                                        {
                                            break;
                                        }
                                        Thread.Sleep(1);
                                    }
                                    break;
                                }
                                if (pass.Contains("#"))
                                {
                                    break;
                                }
                                if (pass.Contains("configuration is locked by other user"))
                                //configuration is locked by other user
                                {
                                    //textDOS.AppendText("\r\n" + "已经有用户登录，正在重新登录=============================OK");
                                    mysocketftp.SendData("grosadvdebug");
                                    Thread.Sleep(200);
                                    mysocketftp.SendData("vty user limit no");
                                    Thread.Sleep(200);
                                    mysocketftp.SendData("exit");
                                    Thread.Sleep(200);
                                    mysocketftp.SendData("enable");
                                    Thread.Sleep(200);
                                    if (mysocketftp.ReceiveData(int.Parse(ts)).Contains("Pas"))
                                    {
                                        mysocketftp.SendData(textpsden.Text);
                                        Thread.Sleep(200);
                                        if (!mysocketftp.ReceiveData(int.Parse(ts)).Contains("failed"))
                                        {
                                            this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = "密码错误";
                                            this.DGVSTATUS.Rows[i].DefaultCellStyle.BackColor = Color.Yellow;
                                            textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 密码错误！ " + "\r\n");

                                        }

                                        break;
                                    }
                                    break;
                                }
                                Thread.Sleep(1);
                            }
                            break;
                        }
                        Thread.Sleep(10);
                    }

                    this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = "准备开始";
                    mysocketftp.SendData("screen idle-timeout 0");
                    Thread.Sleep(2 * XHTime);
                    mysocketftp.SendData("grosadvdebug");
                    Thread.Sleep(2 * XHTime);
                    string command0 = mysocketftp.ReceiveData(int.Parse(ts));
                    mysocketftp.SendData("show debug-version");
                    Thread.Sleep(2 * XHTime);
                    string command = mysocketftp.ReceiveData(int.Parse(ts));
                    Regex wave = new Regex(@"Version:\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                    string Wave = wave.Match(command).Groups[1].Value;
                    //this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = Wave;
                    command = "";
                    mysocketftp.SendData("show fpga-version");
                    Thread.Sleep(2 * XHTime);
                    command = mysocketftp.ReceiveData(int.Parse(ts));                
                    Regex fpga = new Regex(@"FPGA version :\s*(.*)", RegexOptions.IgnoreCase | RegexOptions.Multiline);
                    string Fpga = fpga.Match(command).Groups[1].Value;

                    Thread.Sleep(1 * XHTime);
                    command = mysocketftp.ReceiveData(int.Parse(ts));
                    command = "";
                    mysocketftp.SendData("grosadvdebug");
                    Thread.Sleep(2 * XHTime);
                    mysocketftp.SendData("show all-files enable");
                    Thread.Sleep(2 * XHTime);
                    mysocketftp.SendData("exit");
                    Thread.Sleep(2 * XHTime);
                    mysocketftp.SendData("show flash file");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("\r\n");
                    Thread.Sleep(1 * XHTime);
                    mysocketftp.SendData("exit");
                    command = mysocketftp.ReceiveData(int.Parse(ts));

                    Filesize = FindDevType.StringToArray(command);


                    this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = Wave + "|" + Fpga;
                    DGVSTATUS.Rows[i].Cells["当前版本"].Style.BackColor = Color.GreenYellow;
                    mysocketftp.Close();
                }
                else
                {
                    this.DGVSTATUS.Rows[i].Cells["当前版本"].Value = "Telnet失败";
                    this.DGVSTATUS.Rows[i].DefaultCellStyle.BackColor = Color.Yellow;
                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 登录Telnet失败！ " + "\r\n");
                    lock (PiLiangShengJi)
                    {
                        LoadCountany++;
                        textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 累计完成设备数量：" + LoadCountany.ToString() + "\r\n");

                    }
                    return;
                }
                string[,] array = new string[,] {
                { "APP",        "app_code.bin" ,labapp.Text },
                { "CODE",       "fpga_code.bin" ,labcode.Text            },
                { "CODE2",      "fpga_code2.bin" ,labcode2.Text},
                { "CODE3",      "fpga_code3.bin",labcode3.Text },
                { "CODE4",      "fpga_code4.bin",labcode4.Text },
                { "SDN",        "sdn_pac.bin",labsdn.Text },
                { "NMS",        "nms.fpga",labnms.Text },
                { "SW",         "sw.fpga",labsw.Text },
                { "Config" ,    "conf_data.txt" ,labconfig.Text},
                { "Db",         "db.bin",labdb.Text },
                { "SlotConfig", "slotconfig.bin" ,labslotconfig.Text},
                { "FLASH",      "","" },
                { "SysFile",    "sysfile_ini.bin",labsysfile.Text },
              //{ "OTNPACK",    "20" },
                { "YAFFS",      "",""  },
                { "760S",       "760s.fpga",lab760s.Text },
                { "760B",       "760b.fpga",lab760b.Text },
                { "760C",       "760c.fpga",lab760c.Text },
                { "760D",       "760d.fpga",lab760d.Text },
                { "760E",       "760e.fpga",lab760e.Text },
                { "UXC",        "uxc_a.fpga" ,labuxc.Text},
                { "7610",       "7610.fpga" ,lab7610.Text},
                { "7611",       "7611.fpga",lab7611.Text },
                { "7612",       "7612.fpga",lab7612.Text },
                { "7613",       "7613.fpga",lab7613.Text },
                { "7614",       "7614.fpga",lab7614.Text },
                { "7616",       "7616.fpga",lab7616.Text },
                { "APP2",       "app_code_backup2.bin",labapp2.Text },
                { "VOSS",       "voss.sh" ,labvoss.Text},
                { "REBOOTOS",   "rebootos.sh",labrebootos.Text },
                { "CPLD",       "nms.cpld" ,labcpld.Text},
            };
                int colunms = DGVSTATUS.ColumnCount;
                int row = array.GetLength(0);

                for (int c = 9; c < colunms; c++)
                {
                    string header = DGVSTATUS.Columns[c].HeaderText;
                    for (int d = 0; d < row; d++)
                    {
                        if (array[d, 0].ToString() == header)
                        {

                            int dxcrow = Filesize.GetLength(0);
                            int dxccol = Filesize.GetLength(1);
                            for (int a = 0; a < dxcrow; a++)
                            {

                                if (Filesize[a, 6] != null)
                                {
                                    if (Filesize[a, 6] == array[d, 1])
                                    {
                                        if (Filesize[a, 2] == array[d, 2])
                                        {
                                            DGVSTATUS.Rows[i].Cells[header].Value = "一样";
                                            DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.GreenYellow;
                                            
                                            break;
                                        }
                                        else
                                        {
                                            DGVSTATUS.Rows[i].Cells[header].Value = "不样" + Filesize[a, 2];
                                            DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.Red;
                                            
                                            break;

                                        }


                                    }
                                    else {
                                        DGVSTATUS.Rows[i].Cells[header].Value = "没有";
                                        DGVSTATUS.Rows[i].Cells[header].Style.BackColor = Color.Yellow;
                                        
                                    }

                                }

                            }
                        }
                    }
                }
            }


            lock (PiLiangShengJi)
            {
                LoadCountany++;
                textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + gpnip + " 累计完成设备数量：" + LoadCountany.ToString() + "\r\n");
                if (LoadCountsum == LoadCountany)
                {

                    textDOS.AppendText(DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "执行完成！一共执行：" + LoadCountany.ToString() + "台设备" + "\r\n");
                    MessageBox.Show("执行完成！一共执行：" + LoadCountany.ToString() + "台设备");
                    LoadCountsum = 0;
                    LoadCountany = 0;
                    ButCheckFile.Enabled = true;


                }
            }

        }

        private void panel1_Paint(object sender, PaintEventArgs e)
        {

        }

        private void 绿色软件下载ToolStripMenuItem_Click(object sender, EventArgs e)
        {
            Software software = new Software
            {
                //ShebeiIp = comip.Text
            };
            //实例化窗体
            software.ShowDialog();// 将窗体显示出来
        }

        private void 卸载GPN模块ToolStripMenuItem_Click(object sender, EventArgs e)
        {
            DialogResult dr = MessageBox.Show("卸载前请确认已经退出网管服务器？", "提示", MessageBoxButtons.YesNo);
            if (dr == DialogResult.Yes)
            {

                //户选择确认的操作
                if (CheckGPN7600EMS() == false)
                {
                    MessageBox.Show("GPN76模块已卸载，请安装后进行卸载！");
                    return;
                }

                Process p = new Process();
                p.StartInfo.FileName = @"C:\Program Files (x86)\InstallShield Installation Information\{F54A1417-6804-4C74-8B36-C44592EDFEF2}\setup.exe";
                //p.StartInfo.Arguments = " -runfromtemp -l0x0409  -removeonly";
                p.Start();
                textDOS.AppendText("\r\n" + DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss") + " " + "GPN模块已卸载==============================================OK" + "\r\n");

            }
            if (dr == DialogResult.No)
            {
                //户选择取消的操作
                return;
            }
        }

        private void 安装GPN模块ToolStripMenuItem_Click(object sender, EventArgs e)
        {
            if (CheckGPN7600EMS() == true)
            {
                MessageBox.Show("GPN7600 EMS已安装，请卸载后进行安装！");
                return;
            }
            if (comgpn76list.Text.Trim() == "")
            {
                MessageBox.Show("请获取GPN模块后，再次点击尝试！");
                return;
            }
            Thread installgpnems = new Thread(InstallGPN)
            {
                IsBackground = true
            };
            installgpnems.Start();
        }

        private void 其他功能ToolStripMenuItem_Click(object sender, EventArgs e)
        {
            //if (string.Compare(btnFtpServerStartStop.Text, "启动FTP") == 0)
            //{
            //    MessageBox.Show("请先③启动FTP服务器,进行后续操作！");
            //    return;
            //}
            MessageBox.Show("支持了三方FTP工具，请先启动第三方FTP工具,然后点击批量升级。否则会出现卡死的情况，得重新关闭软件在打开！"
                + "\r\n" + "注意事项：FTP用户名：admin密码：admin必须一样，APP文件必须和升级的文件名一致");
            Batch batchfrm = new Batch
            {
                FTPIP = comftpip.Text,
                FTPUSR = textftpusr.Text,
                FTPPSD = textftppsd.Text,
                GPNUSR = textusr.Text,
                GPNPSD = textpsd.Text,
                GPNPSDEN = textpsden.Text,
                yanshi = ts,
                app = comapp.Text
            };//实例化窗体
            batchfrm.Show();// 将窗体显示出来
            //this.Hide();//当前窗体隐藏
        }
    }
}